<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-02-02 Sun 14:41 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AWS</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/solarized/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">AWS</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdd3acb5">1. EC2</a>
<ul>
<li><a href="#org0e75b86">1.1. Instance Families</a></li>
<li><a href="#org3fc2fef">1.2. User Data</a></li>
<li><a href="#org565ac2b">1.3. EBS</a>
<ul>
<li><a href="#org414767a">1.3.1. Snapshot</a></li>
</ul>
</li>
<li><a href="#org11d6509">1.4. EFS</a>
<ul>
<li><a href="#org55c2f25">1.4.1. Filesystem and Mount target</a></li>
</ul>
</li>
<li><a href="#orgf5e0f0e">1.5. Instance Store</a></li>
<li><a href="#org8ada9f9">1.6. Load Balancer</a>
<ul>
<li><a href="#org1c71408">1.6.1. ALB</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd75f53c">2. Cloud Formation</a>
<ul>
<li><a href="#org19adcec">2.1. Parameters</a>
<ul>
<li><a href="#org0cdd4d4">2.1.1. Valid types</a></li>
<li><a href="#org0df205d">2.1.2. Constraints</a></li>
</ul>
</li>
<li><a href="#orgf153e6c">2.2. Resources</a></li>
</ul>
</li>
<li><a href="#orga86624e">3. IAM</a>
<ul>
<li><a href="#org5c9addb">3.1. ARN</a></li>
<li><a href="#org009fb00">3.2. CLIs</a>
<ul>
<li><a href="#org0b02fb4">3.2.1. Get account id</a></li>
<li><a href="#org897d6de">3.2.2. Create groud and user</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7c86723">4. Security Group</a>
<ul>
<li><a href="#orge5c2a9e">4.1. Bastion Mode</a></li>
</ul>
</li>
<li><a href="#org4848ba4">5. VPC</a>
<ul>
<li><a href="#org470d277">5.1. ACL</a></li>
<li><a href="#orgc63cce3">5.2. NAT Gateway</a></li>
</ul>
</li>
<li><a href="#org993a6bd">6. Auto Scaling</a></li>
<li><a href="#org3f0c3db">7. S3</a>
<ul>
<li><a href="#orgfd16336">7.1. Object Store</a></li>
<li><a href="#orgeeb1882">7.2. Buckets</a></li>
<li><a href="#org5008eab">7.3. CLI</a>
<ul>
<li><a href="#orgaf34f84">7.3.1. 文件操作</a>
<ul>
<li><a href="#org092fa9f">7.3.1.1. 拷贝</a></li>
</ul>
</li>
<li><a href="#orgaf33484">7.3.2. 目录操作</a>
<ul>
<li><a href="#org29c13b0">7.3.2.1. 创建桶</a></li>
<li><a href="#org5e3349c">7.3.2.2. 同步</a></li>
<li><a href="#org5659df4">7.3.2.3. 删除桶</a></li>
<li><a href="#org075f6f2">7.3.2.4. Versioning for objects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orged9d592">7.4. 静态资源</a>
<ul>
<li><a href="#org1514795">7.4.1. 创建桶</a></li>
<li><a href="#org121f656">7.4.2. 配置桶使其支持 static web hosting</a></li>
<li><a href="#org64f643a">7.4.3. 访问</a></li>
<li><a href="#org28912b1">7.4.4. 自定义域名</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc8b611e">8. 参考资料</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Author</td>
<td class="org-left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">2020-02-02 14:41:11</td>
</tr>
</tbody>
</table>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdd3acb5">1. EC2</a>
<ul>
<li><a href="#org0e75b86">1.1. Instance Families</a></li>
<li><a href="#org3fc2fef">1.2. User Data</a></li>
<li><a href="#org565ac2b">1.3. EBS</a>
<ul>
<li><a href="#org414767a">1.3.1. Snapshot</a></li>
</ul>
</li>
<li><a href="#org11d6509">1.4. EFS</a>
<ul>
<li><a href="#org55c2f25">1.4.1. Filesystem and Mount target</a></li>
</ul>
</li>
<li><a href="#orgf5e0f0e">1.5. Instance Store</a></li>
<li><a href="#org8ada9f9">1.6. Load Balancer</a>
<ul>
<li><a href="#org1c71408">1.6.1. ALB</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd75f53c">2. Cloud Formation</a>
<ul>
<li><a href="#org19adcec">2.1. Parameters</a>
<ul>
<li><a href="#org0cdd4d4">2.1.1. Valid types</a></li>
<li><a href="#org0df205d">2.1.2. Constraints</a></li>
</ul>
</li>
<li><a href="#orgf153e6c">2.2. Resources</a></li>
</ul>
</li>
<li><a href="#orga86624e">3. IAM</a>
<ul>
<li><a href="#org5c9addb">3.1. ARN</a></li>
<li><a href="#org009fb00">3.2. CLIs</a>
<ul>
<li><a href="#org0b02fb4">3.2.1. Get account id</a></li>
<li><a href="#org897d6de">3.2.2. Create groud and user</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7c86723">4. Security Group</a>
<ul>
<li><a href="#orge5c2a9e">4.1. Bastion Mode</a></li>
</ul>
</li>
<li><a href="#org4848ba4">5. VPC</a>
<ul>
<li><a href="#org470d277">5.1. ACL</a></li>
<li><a href="#orgc63cce3">5.2. NAT Gateway</a></li>
</ul>
</li>
<li><a href="#org993a6bd">6. Auto Scaling</a></li>
<li><a href="#org3f0c3db">7. S3</a>
<ul>
<li><a href="#orgfd16336">7.1. Object Store</a></li>
<li><a href="#orgeeb1882">7.2. Buckets</a></li>
<li><a href="#org5008eab">7.3. CLI</a>
<ul>
<li><a href="#orgaf34f84">7.3.1. 文件操作</a>
<ul>
<li><a href="#org092fa9f">7.3.1.1. 拷贝</a></li>
</ul>
</li>
<li><a href="#orgaf33484">7.3.2. 目录操作</a>
<ul>
<li><a href="#org29c13b0">7.3.2.1. 创建桶</a></li>
<li><a href="#org5e3349c">7.3.2.2. 同步</a></li>
<li><a href="#org5659df4">7.3.2.3. 删除桶</a></li>
<li><a href="#org075f6f2">7.3.2.4. Versioning for objects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orged9d592">7.4. 静态资源</a>
<ul>
<li><a href="#org1514795">7.4.1. 创建桶</a></li>
<li><a href="#org121f656">7.4.2. 配置桶使其支持 static web hosting</a></li>
<li><a href="#org64f643a">7.4.3. 访问</a></li>
<li><a href="#org28912b1">7.4.4. 自定义域名</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc8b611e">8. 参考资料</a></li>
</ul>
</div>
</div>





<div id="outline-container-orgdd3acb5" class="outline-2">
<h2 id="orgdd3acb5"><span class="section-number-2">1</span> EC2</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org0e75b86" class="outline-3">
<h3 id="org0e75b86"><span class="section-number-3">1.1</span> Instance Families</h3>
<div class="outline-text-3" id="text-1-1">

<div class="figure">
<p><img src="img/aws_instance_family_format.png" alt="aws_instance_family_format.png">
</p>
</div>

<ul class="org-ul">
<li>T family
Cheap, moderate baseline performance with the ability to burst to higher performance for short periods of time</li>
<li>M family
General purpose, with a balanced ration of CPU and memory</li>
<li>C family
Computing optimized, high CPU performance</li>
<li>R family
Memory optimized, with more memory than CPU power compared to M family</li>
<li>D family
Storage optimized, offering huge HDD capacity</li>
<li>I family
Storage optimized, offering huge SSD capacity</li>
<li>X family
Extensive capacity with a focus on memory, up to 1952 GB memory and 128 virtual cores</li>
<li>F family
Accelerated computing based on FPGAs</li>
<li>P, G, and CG family
Accelerated computing based on GPUs</li>
</ul>
</div>
</div>


<div id="outline-container-org3fc2fef" class="outline-3">
<h3 id="org3fc2fef"><span class="section-number-3">1.2</span> User Data</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The user data is always accessible from the VM with a HTTP GET request to <code>http://169.254.169.254/latest/user-data</code> .
</p>
</div>
</div>


<div id="outline-container-org565ac2b" class="outline-3">
<h3 id="org565ac2b"><span class="section-number-3">1.3</span> EBS</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Elastic Block Store (EBS) provides persistent block-level storage with <b>built-in data replication</b> (Replicate your data on multiple disks to
prevent data loss due to hardware failures). <br>
An EBS volume is separate from an EC2 instance and connected over the network.
</p>


<pre class="example">
EBS is either not attached to an EC2 instance or attached to exactly ONE EC2 instance at a time.
You can't attach the same EBS volume to multiple virtual machines!
</pre>

<pre class="example">
EBS volume is tied to a data center (also called an AZ) and can only be attached over the network to a single EC2 instance FROM THE SAME DATA CENTER.
</pre>


<div class="figure">
<p><img src="img/aws_ebs_attach.png" alt="aws_ebs_attach.png">
</p>
</div>

<p>
Usually, EBS volumes can be found somewhere in the range of <code>/dev/xvdf</code> to <code>/dev/xvdp</code>. <br>
The root volume (<code>/dev/xvda</code>) is an exception: it's <span class="underline">based on the AMI</span> you choose when you launch the EC2 instance,
and contains everything needed to boot the instance (OS files).
</p>
</div>


<div id="outline-container-org414767a" class="outline-4">
<h4 id="org414767a"><span class="section-number-4">1.3.1</span> Snapshot</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
A snapshot is a block-level <span class="underline">incremental backup</span> that is stored in S3.
</p>

<pre class="example">
If your volume is 5 GiB in size and you use 1 GiB of data, your first snapshot will be around 1 GiB in size.
After the first snapshot is created, only the changes will be saved to S3, to reduce the size of the backup.
</pre>
</div>
</div>
</div>


<div id="outline-container-org11d6509" class="outline-3">
<h3 id="org11d6509"><span class="section-number-3">1.4</span> EFS</h3>
<div class="outline-text-3" id="text-1-4">
<p>
EFS filesystem can be used by multiple EC2 instances <span class="underline">from different data centers</span>.
</p>


<div class="figure">
<p><img src="img/aws_ebs_efs_compare.png" alt="aws_ebs_efs_compare.png">
</p>
</div>
</div>


<div id="outline-container-org55c2f25" class="outline-4">
<h4 id="org55c2f25"><span class="section-number-4">1.4.1</span> Filesystem and Mount target</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>Filesystem
Stores your data</li>
<li>Mount target
Makes your data accessible</li>
</ul>




<div class="figure">
<p><img src="img/aws_efs_mount_target.png" alt="aws_efs_mount_target.png">
</p>
</div>


<p>
Filesystem is the resource that stores your data in an AWS region, but you can't access it directly. <br>
It is located in an AWS region and replicates your data under the covers <b>across multiple availability zones</b>. <br>
To do so, you must create an EFS mount target in a subnet.
The mount target provides a <b>network endpoint</b> that you can use to mount the filesystem on an EC2 instance via NFSv4.1. <br>
The EC2 instance must be <span class="underline">in the same subnet</span> as the EFS mount target (but you can create mount targets in multiple subnets).
</p>
</div>
</div>
</div>


<div id="outline-container-orgf5e0f0e" class="outline-3">
<h3 id="orgf5e0f0e"><span class="section-number-3">1.5</span> Instance Store</h3>
<div class="outline-text-3" id="text-1-5">
<p>
An instance store provides block-level storage <span class="underline">directly</span> attached to the machine hosting your VM. <br>
It is part of an EC2 instance (not standalone resources like EBS volume) and available only if your instance is running;
it won't persist your data if you stop or terminate the instance.
</p>


<div class="figure">
<p><img src="img/aws_instance_store.png" alt="aws_instance_store.png">
</p>
</div>


<pre class="example">
Don't use an instance store for data that must not be lost; use it for caching, temporary processing.
</pre>
</div>
</div>


<div id="outline-container-org8ada9f9" class="outline-3">
<h3 id="org8ada9f9"><span class="section-number-3">1.6</span> Load Balancer</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-org1c71408" class="outline-4">
<h4 id="org1c71408"><span class="section-number-4">1.6.1</span> ALB</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
An ALB consists of three required parts and one optional part:
</p>

<ul class="org-ul">
<li><p>
Load balancer
</p>

<p>
Defines some core configurations, like the subnets the load balancer runs in,
whether the load balancer gets public IP addresses, whether it uses IPv4 or both IPv4 and IPv6, and additional attributes.
</p></li>
<li><p>
Listener
</p>

<p>
The listener defines the port and protocol that you can use to make requests to the load balancer. <br>
If you like, the listener can also terminate TLS for you.
A listener links to a target group that is used as the default if no other listener rules match the request.
</p></li>
<li><p>
Target group
</p>

<p>
A target group defines your group of backends.
The target group is responsible for checking the backends by sending periodic health checks. <br>
Usually backends are EC2 instances, but could also be a Docker container running on EC2 Container Service or
a machine in your data center paired with your VPC.
</p></li>
<li><p>
Listener rule
</p>

<p>
(_Optional_) <br>
You can define a listener rule. The rule can choose a different target group based on the HTTP path or host. <br>
Otherwise requests are forwarded to the default target group defined in the listener.
</p></li>
</ul>



<div class="figure">
<p><img src="img/aws_alb.png" alt="aws_alb.png">
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgd75f53c" class="outline-2">
<h2 id="orgd75f53c"><span class="section-number-2">2</span> Cloud Formation</h2>
<div class="outline-text-2" id="text-2">
<p>
A basic CloudFormation template is structured into five parts:
</p>

<ol class="org-ol">
<li>Format version
The latest template format version is 2010-09-09</li>
<li>Description
What is this template about?</li>
<li>Parameters
Parameters are used to customize a template with values: for example, domain name, customer ID, and database password.</li>
<li>Resources
A resource is the smallest block you can describe. Examples are a virtual machine, a load balancer, or an Elastic IP address.</li>
<li>Outputs
An output returns something from your template, such as the public name of an EC2 instance.</li>
</ol>
</div>

<div id="outline-container-org19adcec" class="outline-3">
<h3 id="org19adcec"><span class="section-number-3">2.1</span> <a href="https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">Parameters</a></h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #fd971f;">Parameters</span>:
  <span style="color: #fd971f;">KeyName</span>:
    <span style="color: #fd971f;">Description</span>: <span style="color: #e6db74;">'Key Pair name'</span>
    <span style="color: #fd971f;">Type</span>: <span style="color: #e6db74;">'AWS::EC2::KeyPair::KeyName'</span> <span style="color: #465457;"># </span><span style="color: #465457;">Only key pair names are allowed.</span>
  <span style="color: #fd971f;">NumberOfVirtualMachines</span>:
    <span style="color: #fd971f;">Description</span>: <span style="color: #e6db74;">'How many virtual machine do you like?'</span>
    <span style="color: #fd971f;">Type</span>: Number
    <span style="color: #fd971f;">Default</span>: 1 <span style="color: #465457;"># </span><span style="color: #465457;">The default is one virtual machine.</span>
    <span style="color: #fd971f;">MinValue</span>: 1
    <span style="color: #fd971f;">MaxValue</span>: 5 <span style="color: #465457;"># </span><span style="color: #465457;">Prevent massive costs with an upper bound.</span>
  <span style="color: #fd971f;">WordPressVersion</span>:
    <span style="color: #fd971f;">Description</span>: <span style="color: #e6db74;">'Which version of WordPress do you want?'</span>
    <span style="color: #fd971f;">Type</span>: String
    <span style="color: #fd971f;">AllowedValues</span>: [<span style="color: #e6db74;">'4.1.1'</span>, <span style="color: #e6db74;">'4.0.1'</span>] <span style="color: #465457;"># </span><span style="color: #465457;">Restricted to certain versions</span>
</pre>
</div>
</div>

<div id="outline-container-org0cdd4d4" class="outline-4">
<h4 id="org0cdd4d4"><span class="section-number-4">2.1.1</span> Valid types</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>String</li>
<li>Number</li>
<li>AWS::EC2::AvailabilityZone::Name
such as <code>us-west-2a</code></li>
<li>AWS::EC2::Image::Id</li>
<li>AWS::EC2::Instance::Id</li>
<li>AWS::EC2::KeyPair::KeyName</li>
<li>AWS::EC2::SecurityGroup::Id</li>
<li>AWS::EC2::Subnet::Id</li>
<li>AWS::EC2::Volume::Id
An EBS volume ID (network attached storage)</li>
<li>AWS::EC2::VPC::Id</li>
<li>AWS::Route53::HostedZone::Id
A DNS zone ID</li>
</ul>
</div>
</div>


<div id="outline-container-org0df205d" class="outline-4">
<h4 id="org0df205d"><span class="section-number-4">2.1.2</span> Constraints</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>Default</li>
<li>NoEcho</li>
<li>AllowedValues</li>
<li>AllowedPattern</li>
<li>MinLength, MaxLength</li>
<li>MinValue, MaxValue</li>
<li>ConstraintDescription</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgf153e6c" class="outline-3">
<h3 id="orgf153e6c"><span class="section-number-3">2.2</span> <a href="https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">Resources</a></h3>
<div class="outline-text-3" id="text-2-2">
<p>
A resource has at least <span class="underline">a name</span>, <span class="underline">a type</span>, and <span class="underline">some properties</span>.
</p>
</div>
</div>
</div>



<div id="outline-container-orga86624e" class="outline-2">
<h2 id="orga86624e"><span class="section-number-2">3</span> IAM</h2>
<div class="outline-text-2" id="text-3">
<p>
IAM controls <b>who</b> (authentication) can do <b>what</b> (authorization) in your AWS account.
</p>


<div class="figure">
<p><img src="img/aws_iam_concepts.png" alt="aws_iam_concepts.png">
</p>
</div>

<ul class="org-ul">
<li>IAM user
Used to authenticate people accessing your AWS account.</li>
<li>IAM group
A collection of IAM users.</li>
<li>IAM role
Used to <span class="underline">authenticate AWS resources</span>, for example an EC2 instance.</li>
<li>IAM policy
Used to define the permissions for a user, group, or role.</li>
</ul>
</div>

<div id="outline-container-org5c9addb" class="outline-3">
<h3 id="org5c9addb"><span class="section-number-3">3.1</span> ARN</h3>
<div class="outline-text-3" id="text-3-1">

<div class="figure">
<p><img src="img/aws_arn.png" alt="aws_arn.png">
</p>
</div>
</div>
</div>



<div id="outline-container-org009fb00" class="outline-3">
<h3 id="org009fb00"><span class="section-number-3">3.2</span> CLIs</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org0b02fb4" class="outline-4">
<h4 id="org0b02fb4"><span class="section-number-4">3.2.1</span> Get account id</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-sh">aws iam get-user --query <span style="color: #e6db74;">"User.Arn"</span> --output text
</pre>
</div>
</div>
</div>

<div id="outline-container-org897d6de" class="outline-4">
<h4 id="org897d6de"><span class="section-number-4">3.2.2</span> Create groud and user</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-sh">aws iam create-group --group-name <span style="color: #e6db74;">"admin"</span>
aws iam attach-group-policy --group-name <span style="color: #e6db74;">"admin"</span> --policy-arn <span style="color: #e6db74;">"arn:aws:iam::aws:policy/AdministratorAccess"</span>
aws iam create-user --user-name <span style="color: #e6db74;">"myuser"</span>
aws iam add-user-to-group --group-name <span style="color: #e6db74;">"admin"</span> --user-name <span style="color: #e6db74;">"myuser"</span>
aws iam create-login-profile --user-name <span style="color: #e6db74;">"myuser"</span> --password <span style="color: #e6db74;">"$Password"</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org7c86723" class="outline-2">
<h2 id="org7c86723"><span class="section-number-2">4</span> Security Group</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orge5c2a9e" class="outline-3">
<h3 id="orge5c2a9e"><span class="section-number-3">4.1</span> Bastion Mode</h3>
<div class="outline-text-3" id="text-4-1">

<div class="figure">
<p><img src="img/aws_bastion_mode.png" alt="aws_bastion_mode.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org4848ba4" class="outline-2">
<h2 id="org4848ba4"><span class="section-number-2">5</span> VPC</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org470d277" class="outline-3">
<h3 id="org470d277"><span class="section-number-3">5.1</span> ACL</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Network ACLs restrict traffic that goes from one subnet to another, acting as a firewall.
</p>

<pre class="example">
There's an important difference between security groups and ACLs: security groups are STATEFUL, but ACLs aren't.
If you allow an inbound port on a security group, the corresponding response to requests on that port are allowed as well.
That's not true for ACLs.

Security groups are tied to an instance, while Network ACL are tied to the subnet.
</pre>

<p>
<b>Recommend to start with using security groups to control traffic. If you want to add an extra layer of security, you should use ACL on top.</b>
</p>
</div>
</div>


<div id="outline-container-orgc63cce3" class="outline-3">
<h3 id="orgc63cce3"><span class="section-number-3">5.2</span> NAT Gateway</h3>
<div class="outline-text-3" id="text-5-2">

<div class="figure">
<p><img src="img/aws_nat.png" alt="aws_nat.png">
</p>
</div>


<ul class="org-ul">
<li>VPC 与 IGW 绑定</li>
<li>PrivateSubnet 默认路由指向 NATGateway</li>
<li>Instance 无需分配外网地址（即无法被外部访问）</li>
</ul>

<pre class="example">
  创建 VPC 时会生成默认路由表，Subnet 默认情况下将继承这个路由表，该路由表只有一条记录（ VPC 网段的 local 路由）。
  通常会自定义一个新的路由表给 Subnet 使用，该路由表被 attach 至 VPC （即包含 VPC 网段的 local 路由)，再添加一条指向 IGW 的 default 路由。
</pre>
</div>
</div>
</div>



<div id="outline-container-org993a6bd" class="outline-2">
<h2 id="org993a6bd"><span class="section-number-2">6</span> Auto Scaling</h2>
<div class="outline-text-2" id="text-6">
<p>
To configure auto-scaling, you need to create two parts of the configuration:
</p>

<ul class="org-ul">
<li>launch configuration
Contains all information needed to launch an EC2 instance: instance type (size of virtual machine) and image (AMI) to start from.</li>
<li>auto-scaling group
Tells the EC2 service how many virtual machines should be started with a specific launch configuration, how to monitor the instances,
and in which subnets EC2 instances should be started.</li>
</ul>
</div>
</div>


<div id="outline-container-org3f0c3db" class="outline-2">
<h2 id="org3f0c3db"><span class="section-number-2">7</span> S3</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgfd16336" class="outline-3">
<h3 id="orgfd16336"><span class="section-number-3">7.1</span> Object Store</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Data in S3 is managed as objects, so the storage system is called an <b>object store</b>.
</p>

<p>
In an object store, data is stored as objects.<br>
Each object consists of a <span class="underline">globally unique identifier</span>, <span class="underline">some metadata</span>, and the <span class="underline">data</span> itself,<br>
An object's globally unique identifier (GUID) is also known as its key; you can address the object using the GUID.
</p>


<div class="figure">
<p><img src="img/aws_s3_obj_storage.png" alt="aws_s3_obj_storage.png">
</p>
</div>
</div>
</div>


<div id="outline-container-orgeeb1882" class="outline-3">
<h3 id="orgeeb1882"><span class="section-number-3">7.2</span> Buckets</h3>
<div class="outline-text-3" id="text-7-2">
<p>
S3 uses <b>buckets</b> to group objects.<br>
A bucket is a <span class="underline">container</span> for objects. You can create multiple buckets, <span class="underline">each of which has a globally unique name</span>, <br>
to separate data for different scenarios.
</p>

<p>
You have to choose a bucket name <b>that isn't used by any other AWS customer in any other region</b>.
</p>


<div class="figure">
<p><img src="img/aws_s3_https.png" alt="aws_s3_https.png">
</p>
</div>


<div class="figure">
<p><img src="img/aws_s3_buckets.png" alt="aws_s3_buckets.png">
</p>
</div>
</div>
</div>


<div id="outline-container-org5008eab" class="outline-3">
<h3 id="org5008eab"><span class="section-number-3">7.3</span> CLI</h3>
<div class="outline-text-3" id="text-7-3">
</div>
<div id="outline-container-orgaf34f84" class="outline-4">
<h4 id="orgaf34f84"><span class="section-number-4">7.3.1</span> 文件操作</h4>
<div class="outline-text-4" id="text-7-3-1">
</div>
<div id="outline-container-org092fa9f" class="outline-5">
<h5 id="org092fa9f"><span class="section-number-5">7.3.1.1</span> 拷贝</h5>
<div class="outline-text-5" id="text-7-3-1-1">
<div class="org-src-container">
<pre class="src src-sh">aws s3 cp --recursive s3://haoru.cisco.com/&lt;dir&gt;/ &lt;local-path&gt;
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgaf33484" class="outline-4">
<h4 id="orgaf33484"><span class="section-number-4">7.3.2</span> 目录操作</h4>
<div class="outline-text-4" id="text-7-3-2">
</div>
<div id="outline-container-org29c13b0" class="outline-5">
<h5 id="org29c13b0"><span class="section-number-5">7.3.2.1</span> 创建桶</h5>
<div class="outline-text-5" id="text-7-3-2-1">
<p>
The name of the bucket must be unique among all other S3 buckets, even those in other regions and those of other AWS customers.
</p>

<div class="org-src-container">
<pre class="src src-sh">aws s3 mb s3://haoru.cisco.com
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e3349c" class="outline-5">
<h5 id="org5e3349c"><span class="section-number-5">7.3.2.2</span> 同步</h5>
<div class="outline-text-5" id="text-7-3-2-2">
<div class="org-src-container">
<pre class="src src-sh">aws s3 sync &lt;path&gt; s3://haoru.cisco.com/&lt;dir&gt;
</pre>
</div>
</div>
</div>



<div id="outline-container-org5659df4" class="outline-5">
<h5 id="org5659df4"><span class="section-number-5">7.3.2.3</span> 删除桶</h5>
<div class="outline-text-5" id="text-7-3-2-3">
<div class="org-src-container">
<pre class="src src-sh">aws s3 rb --force s3://haoru.cisco.com
</pre>
</div>
</div>
</div>

<div id="outline-container-org075f6f2" class="outline-5">
<h5 id="org075f6f2"><span class="section-number-5">7.3.2.4</span> Versioning for objects</h5>
<div class="outline-text-5" id="text-7-3-2-4">
<div class="org-src-container">
<pre class="src src-sh">aws s3api put-bucket-versioning --bucket &lt;bucket-name&gt; --versioning-configuration <span style="color: #fd971f;">Status</span>=Enabled <span style="color: #465457;"># </span><span style="color: #465457;">&#21551;&#29992; versioning</span>
aws s3api list-object-versions --bucket &lt;bucket-name&gt; <span style="color: #465457;"># </span><span style="color: #465457;">retrieves all objects and versions</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orged9d592" class="outline-3">
<h3 id="orged9d592"><span class="section-number-3">7.4</span> 静态资源</h3>
<div class="outline-text-3" id="text-7-4">
<p>
参考: <a href="https://github.com/ruanhao/python-for-fun/blob/master/aws/s3/ut.py">https://github.com/ruanhao/python-for-fun/blob/master/aws/s3/ut.py</a>
</p>
</div>

<div id="outline-container-org1514795" class="outline-4">
<h4 id="org1514795"><span class="section-number-4">7.4.1</span> 创建桶</h4>
<div class="outline-text-4" id="text-7-4-1">
<div class="org-src-container">
<pre class="src src-sh">aws s3 mb s3://&lt;BucketName&gt;
aws s3 cp helloworld.html s3://$<span style="color: #fd971f;">BucketName</span>/helloworld.html
</pre>
</div>
</div>
</div>

<div id="outline-container-org121f656" class="outline-4">
<h4 id="org121f656"><span class="section-number-4">7.4.2</span> 配置桶使其支持 static web hosting</h4>
<div class="outline-text-4" id="text-7-4-2">
<p>
Allow everyone to view or download the documents included in your bucket:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws s3api put-bucket-policy --bucket $<span style="color: #fd971f;">BucketName</span> --policy file://bucketpolicy.json
</pre>
</div>

<p>
bucketpolicy.json:
</p>

<div class="org-src-container">
<pre class="src src-js">{
  <span style="color: #e6db74;">"Version"</span>: <span style="color: #e6db74;">"2012-10-17"</span>,
  <span style="color: #e6db74;">"Statement"</span>: [
    {
      <span style="color: #e6db74;">"Sid"</span>: <span style="color: #e6db74;">"AddPerm"</span>,
      <span style="color: #e6db74;">"Effect"</span>: <span style="color: #e6db74;">"Allow"</span>,
      <span style="color: #e6db74;">"Principal"</span>: <span style="color: #e6db74;">"*"</span>,
      <span style="color: #e6db74;">"Action"</span>: [<span style="color: #e6db74;">"s3:GetObject"</span>],
      <span style="color: #e6db74;">"Resource"</span>: [<span style="color: #e6db74;">"arn:aws:s3:::&lt;BucketName&gt;/*"</span>]
    }
  ]
}
</pre>
</div>


<p>
Enable and configure the static web-hosting feature of S3:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws s3 website s3://$<span style="color: #fd971f;">BucketName</span> --index-document helloworld.html
</pre>
</div>
</div>
</div>

<div id="outline-container-org64f643a" class="outline-4">
<h4 id="org64f643a"><span class="section-number-4">7.4.3</span> 访问</h4>
<div class="outline-text-4" id="text-7-4-3">
<p>
<code>http://$BucketName.s3-website-$Region.amazonaws.com</code>
</p>
</div>
</div>


<div id="outline-container-org28912b1" class="outline-4">
<h4 id="org28912b1"><span class="section-number-4">7.4.4</span> 自定义域名</h4>
<div class="outline-text-4" id="text-7-4-4">
<p>
All you have to do is to add a CNAME record for your domain, pointing to the bucket's S3 endpoint.
</p>

<p>
<b>The CNAME record will only work if you comply with the following rules:</b>
</p>

<ul class="org-ul">
<li><p>
Your bucket name must match the CNAME record name
</p>

<p>
For example, if you want to create a CNAME for <code>awsinaction.example.com</code>, your bucket name must be awsinaction.example.com as well.
</p></li>
<li><p>
CNAME records <b>won't work for the primary domain name</b> (such as <code>example.com</code>)
</p>

<p>
You need to use a subdomain for CNAMEs like awsinaction or www, for example.
If you want to link a primary domain name to an S3 bucket, you need to use the Route 53 DNS service from AWS.
</p></li>
</ul>

<p>
Linking a custom domain to your S3 bucket only works for HTTP.
If you want to use HTTPS (and you probably should), use AWS CloudFront together with S3.
AWS CloudFront accepts HTTPS from the client and forwards the request to S3.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc8b611e" class="outline-2">
<h2 id="orgc8b611e"><span class="section-number-2">8</span> 参考资料</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li><a href="https://github.com/AWSinAction/code2">AWS in Action</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>