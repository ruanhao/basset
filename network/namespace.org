#+TITLE:     Network Namespace
#+AUTHOR:    Hao Ruan
#+EMAIL:     ruanhao1116@gmail.com
#+LANGUAGE:  en
#+LINK_HOME: http://www.github.com/ruanhao
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="../css/style.css" />
#+OPTIONS:   H:2 num:3 \n:nil @:t ::t |:t ^:{} _:{} *:t TeX:t LaTeX:t
#+STARTUP:   showall


* 1, 基本原理

** 1.1, namespace

Linux network namespace 用于创建一个独立的网络环境，包括独立的网卡空间，路由表，ARP 表，iptables，等等。

** 1.2, veth pair

veth pair 功能类似 pipe ，发给 veth pair 一端的数据包可以在另一端收到。\\
就好像安装了两个网卡，并且之间用网线连接起来了。

veth pair 可以用于将一个 network namespace 数据发往另一个 network namespace ：

[[images/vpair.png]]

*在各个 namespace 中需要注意配置好正确的路由信息（网段出埠口）*


* 2, 常用命令

- 创建 namespace

  =ip netns add <name>=

- 查看 namespace

  =ip netns list=

- 在 namespace 中执行命令

  =ip netns exec <spacename> <command>=

  直接进入 namespace 环境：

  =ip netns exec <name> bash=

- 创建 veth pair

  =ip link add <tap1> type veth peer name <tap2>=

- 将 tap 移至 namespace 下

  =ip link set <tap> netns <ns>=

- 在 namespace 下启用 tap

  =ip netns exec <ns> ip link set dev <tap> up=
