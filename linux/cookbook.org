#+TITLE: Cookbook
#+OPTIONS: ^:nil

** Hack

- Show related command

  =apropos <command>=

- Generate PDF for *man*

  =man -t <command> | ps2pdf > filename.pdf=

- Count time (C-d to stop)

  =time cat=

- Run a low priority command

  =nice <command>=

- Make current script run on a low priority

  =renice 19 -p $$=

- Iterate files

  =find -type f -name "*.txt" | while read f; do echo "i have $f"; done=


** Archive

- Package directory

  =tar -c <dir> | bzip2 > dir.tar.bz2=

- Decompress package

  =[gzip | bzip2] -dc dir.tar.[gz | bz2] | tar -x=

- Package directory and send to remote

  #+BEGIN_SRC bash
  tar -c <dir> | gzip | ssh user@remote 'dd of=dir.tar.gz'
  #+END_SRC

- Package separate files

  #+BEGIN_SRC bash
  find . -name '*.txt' | tar -c --files-from=- | bzip2 > dir_txt.tar.bz2
  #+END_SRC

- Copy directory to remote

  #+BEGIN_SRC bash
  tar -c <dir> | ssh -C user@remote 'cd /path && tar -x -p'
  #+END_SRC

- Backup whole drive to remote

  #+BEGIN_SRC bash
  dd bs=1M if=/dev/sda | gzip | ssh user@remote 'dd of=sda.gz'
  #+END_SRC


** Network

- Show state of eth0

  =ethtool eth0=

- Set NIC speed manually

  =ethtool --change eth0 autoneg off speed 100 duplex full=

- Show state of wireless NIC

  =iwconfig eth1=

- Set wireless NIC speed manually

  =iwconfig eth1 rate 1Mb/s fixed=

- Show wireless NIC list

  =iwlist scan=

- Show interface list

  =ip link show=

- Rename interface

  =ip link set dev eth0 name <newname>=

- Up / down interface

  =ip link set dev eth0 up=

- Show IP address of NIC

  =ip addr show=

- Add IP and submask

  =ip addr add 1.2.3.4/24 brd + dev eth0=

- Show route list

  =ip route show=

- Set default gateway

  =ip route add default via 1.2.3.254=

- Query DNS IP

  =host baidu.com=

- List Internet service

  =netstat -tupl=

- List active connection

  =netstat -tup=


** Text

- Print certain line

  =sed -n '1000p; 1000q' <filename>=

- Print from line 10 to 20

  =sed -n '10,20p;20q' <filename>=

- Upcase

  #+BEGIN_SRC bash
  tr '[:lower:]' '[:upper:]'
  #+END_SRC

- Filter unprintable char

  =tr -dc '[:print:]' </dev/urandom=

- Remove empty lines

  =grep . FILE=

  =awk NF=

- Delete leading space

  =awk '{$1=$1}1' FILE=


** Debug

- Show system calls

  =strace -c <command> >/dev/null=

- Show system calls for 'open'

  =strace -f -e open ls >/dev/null=

- Show library

  =ltrace -f -e getenv ls >/dev/null=

- Show files opened by current process

  =lsof -p $$=

- Show the process which open the directory

  =lsof ~=

- Show processes sorted by CPU

  =ps -eo pcpu,cpu,nice,state,cputime,args --sort pcpu=

- Show processes sorted by Mem

  =ps -eo rss,args --sort rss=

- Show thread info for certain PID

  =ps -p <pid> -L -o pid,tid,pcpu,state=

- intercept stdout/stderr of another process

  strace -ff -e trace=write -e write=1,2 -p SOME_PID



** System

 - Show all filesystem mounted

   =mount | column -t=
