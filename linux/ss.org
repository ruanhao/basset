#+AUTHOR:    Hao Ruan
#+EMAIL:     ruanhao1116@gmail.com
#+OPTIONS:   H:2 num:nil \n:nil @:t ::t |:t ^:{} _:{} *:t TeX:t LaTeX:t
#+STARTUP:   showall

** /proc/net/sockstat

#+BEGIN_EXAMPLE
#> ss -s
Total: 4049 (kernel 4179)
TCP:   3649 (estab 3291, closed 31, orphaned 0, synrecv 0, timewait 28/0), ports 831

Transport Total     IP        IPv6
          4179      -         -
RAW       0         0         0
UDP       249       138       111
TCP       3618      3604      14
INET      3867      3742      125
FRAG      98        98        0
#+END_EXAMPLE

**** Total: 4049

已使用的所有协议套接字总量

=cat /proc/net/sockstat | head -1=

**** TCP: 3649

由3部分组成:

1. sockstat.tcp_total

   已分配(已建立, 已申请到sk_buff)的TCP套接字数量

   =grep -o 'alloc [0-9]*' /proc/net/sockstat=

2. slabstat.tcp_syns

   =grep -o 'tcp_open_request\s*[0-9]*' /proc/slabinfo=

3. sockstat.tcp_tws

   =grep -o 'tw [0-9]*' /proc/net/sockstat=
**** estab 3291

snmp_stat.tcp_estab (grep 'Tcp:' /proc/net/snmp | cut -f10 -d' ')

其值等于: =ss -at | grep ESTAB  | wc -l=

**** closed 31

sockstat.tcp_total - (sockstat.tcp4_hashed + sockstat.tcp6_hashed - sockstat.tcp_tws)

1. sockstat.tcp_total

   =grep -o 'alloc [0-9]*' /proc/net/sockstat=

2. sockstat.tcp4_hashed

   正在使用(包括侦听)的TCP套接字数量

   =grep -o 'TCP: inuse [0-9]*' /proc/net/sockstat=

3. sockstat.tcp6_hashed

   =grep -o 'TCP6: inuse [0-9]*' /proc/net/sockstat6=

4. sockstat.tcp_tws

   =grep -o 'tw [0-9]*' /proc/net/sockstat=

**** orphaned 0

无主(不属于任何进程)的TCP连接数 (无用, 待销毁的TCP socket数)

沒有跟 fd 綁住的 socket, 通常在 close 之後的一小段時間

sockstat.tcp_orphans (grep -o 'orphan [0-9]*' /proc/net/sockstat)

**** synrecv 0

slabstat.tcp_syns (grep -o 'tcp_open_request\s*[0-9]*' /proc/slabinfo)

**** ports 831

slabstat.tcp_ports (grep -o 'tcp_bind_bucket\s*[0-9]*' /proc/slabinfo)
