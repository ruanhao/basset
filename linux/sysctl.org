#+AUTHOR:    Hao Ruan
#+EMAIL:     ruanhao1116@gmail.com
#+OPTIONS:   H:2 num:nil \n:nil @:t ::t |:t ^:{} _:{} *:t TeX:t LaTeX:t
#+STARTUP:   showall

** File handle limits

**** raise limits on the number of files that a process can open

#+BEGIN_SRC sh
  cat /proc/sys/fs/file-max
  sysctl -w fs.file-max=100000

  ## If you wish that change to be made persistently
  ## you should append to the file /etc/sysctl.conf the line:
  fs.file-max = 100000
  ## Then run the following command to make your change take effect:
  sysctl -p
#+END_SRC

** Socket tuning

**** increase the range of ports

#+BEGIN_SRC sh
## append the following to the bottom of /etc/sysctl.conf
## to use the full range of ports
net.ipv4.ip_local_port_range = 1024 65535
#+END_SRC

**** increase the recycling time of sockets, avoiding large numbers of them staying in the TIME_WAIT status

#+BEGIN_SRC sh
# Enables fast recycling of TIME_WAIT sockets.
# (Use with caution according to the kernel documentation!)
net.ipv4.tcp_tw_recycle = 1

# Allow reuse of sockets in TIME_WAIT state for new connections
# only when it is safe from the network stackâ€™s perspective.
net.ipv4.tcp_tw_reuse = 1
#+END_SRC

**** tune socket buffer

If a socket is listening and busy a connection-backlog will pile up. The kernel will keep pending connections in a buffer before failing. We can tweak several values to increase the size of the backlog.

#+BEGIN_SRC sh
  # 16MB per socket - which sounds like a lot,
  # but will virtually never consume that much
  net.core.rmem_max = 16777216
  net.core.wmem_max = 16777216

  # Increase the number of outstanding syn requests allowed
  # Learn the use of syncookies
  net.ipv4.tcp_max_syn_backlog = 4096
  net.ipv4.tcp_syncookies = 1

  # The maximum number of "backlogged sockets"
  # Default is 128
  net.core.somaxconn = 1024
#+END_SRC

If we've changed these limits you will need to restart the associated daemons.

** Process scheduler
