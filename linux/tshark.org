#+AUTHOR:    Hao Ruan
#+EMAIL:     ruanhao1116@gmail.com
#+LINK_HOME: http://www.github.com/ruanhao
#+OPTIONS:   H:2 num:nil \n:nil @:t ::t |:t ^:{} _:{} *:t TeX:t LaTeX:t
#+STARTUP:   showall


* 一, 基本原理

** 1.1, 基本用法

*** 1.1.1, 抓包

略（参见 tcpdump ）


*** 1.1.2, 抓包停止条件

- =-c= :: 指定抓包数量

- =-a duration:5= :: 指定抓包时间（秒）

- =-a filesize:10= :: 指定 ring buffer 文件大小（ KB ）

- =-a files:7= :: 指定 ring buffer 文件数量

*** 1.1.3, 查看包的信息

=tshark -r <pcap-file>=

#+BEGIN_SRC
选项说明：

-r : 指定读入的 pcap 文件
-Y 'display filter pattern' : 指定 display 过滤表达式
-V : 显示包的详细信息
#+END_SRC

** 1.2, 系统信息查询

- 查看所有网络接口

  =tshark -D=

- 查看所有支持字段

  =tshark -G fields=

- 查看所有支持协议

  =tshark -G protocols=




* 二, 使用示例

- 查看间隔时间内的数据通信量

  #+BEGIN_SRC
  ## 以 10 秒为间隔
  tshark -r pcap -q -z io,stat,10
  #+END_SRC

- 禁用相对序号

  #+BEGIN_SRC
  -o 'tcp.relative_sequence_numbers:FALSE'
  #+END_SRC

- 过滤 Http 信息

  #+BEGIN_SRC
  tshark -n -r test.pcap -Tfields -e http.request.uri -e http.host 'http'
  # output:
  # /index.html     10.74.68.58:8989

  ## -Tfields -e http.request.uri -e http.host : 指定输出项
  #+END_SRC
