#+TITLE:     SSH
#+AUTHOR:    Hao Ruan
#+EMAIL:     haoru@cisco.com
#+LANGUAGE:  en
#+LINK_HOME: http://www.github.com/ruanhao
#+OPTIONS: h:6 html-postamble:nil html-preamble:t tex:t f:t ^:nil
#+HTML_DOCTYPE: <!DOCTYPE html>
#+HTML_HEAD: <link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
#+HTML_HEAD: <link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
 #+HTML: <div class="outline-2" id="meta">
| Author   | {{{author}}} ({{{email}}})    |
| Date     | {{{time(%Y-%m-%d %H:%M:%S)}}} |
#+HTML: </div>
#+TOC: headlines 3
#+STARTUP:   showall


* 远端转发

#+CAPTION: 远端转发示意图
#+NAME: ssh-remote-forward
[[file:./img/ssh-remote-forward.png]]

#+BEGIN_SRC sh
  ssh -N -f -R <remote-port>:<dest-host>:<dest-host-port> user@remote-host
#+END_SRC

<remote-port> 监听在 localhost 上，如需要被外部访问，可以在 remote-host 上再添加一个端口转发:

#+BEGIN_SRC sh
  socat TCP4-LISTEN:8888,reuseaddr,fork TCP4:127.0.0.1:<remote-port> &
#+END_SRC

这样外部可以通过 <remote-host>:8888 访问 <dest-host>:<dest-host-port>

* 在远程机器上运行脚本

#+BEGIN_SRC sh
  ssh user@server bash < /path/to/local/script.sh
#+END_SRC

* 将本地文件和远程的比较

#+BEGIN_SRC sh
  ssh user@host cat /path/to/remotefile | diff /path/to/localfile -
#+END_SRC

* cat 文件

#+BEGIN_SRC sh
  ssh user@host 'mkdir -p .ssh && cat >> .ssh/authorized_keys' < ~/.ssh/id_rsa.pub
#+END_SRC
