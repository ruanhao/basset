#+TITLE:     Numpy
#+AUTHOR:    Hao Ruan
#+EMAIL:     haoru@cisco.com
#+LANGUAGE:  en
#+LINK_HOME: http://www.github.com/ruanhao
#+OPTIONS:   h:6 html-postamble:nil html-preamble:t tex:t f:t ^:nil
#+STARTUP:   showall
#+TOC:       headlines 4
#+HTML_DOCTYPE: <!DOCTYPE html>
#+HTML_HEAD: <link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
#+HTML_HEAD: <link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
 #+HTML: <div class="outline-2" id="meta">
| Author   | {{{author}}} ({{{email}}})    |
| Date     | {{{time(%Y-%m-%d %H:%M:%S)}}} |
#+HTML: </div>

#+BEGIN_SRC ipython :session :exports none
  #! /usr/bin/env python3
  # -*- coding: utf-8 -*-

  import pandas as pd
  import numpy as np
  import matplotlib.pyplot as plt
  import subprocess
  import pprint
  from PIL import Image

  def log(title0, value):
      title1 = ' ' + title0 + ' '
      print("{}\n{}".format(title1.center(30, '='), value))

  def show_dataframe(df):
      global path
      df.to_html("/tmp/df.html")
      subprocess.call('webkit2png -F --transparent /tmp/df.html -D /tmp -o df', shell=True)
      image = Image.open('/tmp/df-full.png')
      box = image.getbbox()
      cropped = image.crop(box)
      w = cropped.size[0]
      h = cropped.size[1]
      ratio = 0.618
      cropped.thumbnail((int(w*ratio), int(h*ratio)), Image.ANTIALIAS)
      cropped.save(path)
      cropped.close()
      image.close()
#+END_SRC

* 数组

** 创建

*** 一维数组

#+BEGIN_SRC ipython :session :results output :exports both
  data = np.array([1,2,4,5], dtype=int)
  log("data", data)
  log("data.shape", data.shape)
  log("data.dtype", data.dtype)
  data[1] = 8
  log("data (modified)", data)
#+END_SRC

*** 二维数组

#+BEGIN_SRC ipython :session :results output :exports both
  data = data = np.array([[1,2], [3,4]])
  log("data", data)
  log("data.shape", data.shape)
  log("data.dtype", data.dtype)
  data[1] = 8
  log("data (modified)", data)
#+END_SRC

*** 序列数组 (arange)

#+BEGIN_SRC ipython :session :results output :exports both
  log("np.arange(10)", np.arange(10))
  log("np.arange(1, 10)", np.arange(1, 10))

#+END_SRC

*** 整形数组 (reshape)

reshape 并不创建新的数组，而是返回一个 *视图* 。

#+BEGIN_SRC ipython :session :results output :exports both
  origin = np.arange(9)
  reshaped = origin.reshape(3, 3)
  log("reshape 3*3", reshaped)
  log("origin (unchaged)", origin)
  reshaped[0,1] = 100
  log("origin (also changed)", origin)


#+END_SRC

*** 全 0 数组 (zeros)

#+BEGIN_SRC ipython :session :results output :exports both
  log("np.zeros((2,2))", np.zeros((2,2)))
#+END_SRC

*** 全 1 数组 (ones)

#+BEGIN_SRC ipython :session :results output :exports both
  log("np.ones((2,2))", np.ones((2,2)))
#+END_SRC

*** 对角数组 (eye)

#+BEGIN_SRC ipython :session :results output :exports both
  log("np.eye(4)", np.eye(4))
#+END_SRC


*** 线性数组 (linspace)

#+BEGIN_SRC ipython :session :results output :exports both
  log("np.linspace(0, 10, num=51)", np.linspace(0, 10, num=51))

#+END_SRC

** 索引

*** 一维数组

#+BEGIN_SRC ipython :session :results output :exports both
  data = np.arange(100, step=10)
  log("data", data)
  log("data[1:5]", data[1:5])
  log("data[4:]", data[4:])
  log("data[:4]", data[:4])

#+END_SRC



*** 二维数组

#+BEGIN_SRC ipython :session :results output :exports both
  data = np.arange(16).reshape(4, 4)
  log("data", data)
  log("data[1:3]", data[1:3])
  log("data[1:]", data[1:])
  log("data[:3]", data[:3])
  log("data[1:3,1:3]", data[1:3,1:3])
  log("data[:,1:3]", data[:,1:3])
  log("data[2:4,:]", data[2:4,:])
  log("data[2:5]", data[2:5])

#+END_SRC


*** 数组索引

#+BEGIN_SRC ipython :session :results output :exports both
  data = np.arange(16).reshape(4,4)
  log("data", data)

  xidx = [0, 2, 3]
  yidx = [1, 2, 3]
  log("data[[0,2,3],[1,2,3]]", data[xidx, yidx])

  # 修改每行里的特定列的数据
  yidx = [0, 3, 2, 0]
  data[np.arange(4), yidx] += 100
  log("data", data)


#+END_SRC


*** 布尔索引

#+BEGIN_SRC ipython :session :results output :exports both
  data = np.arange(16).reshape(4,4)
  log("data", data)
  idx = data >= 10
  log("idx", idx)
  log("data[idx]", data[idx])
  log("data[data%2 == 0]", data[data%2 == 0])
#+END_SRC


** 运算

#+BEGIN_SRC ipython :session :results output :exports both
  x = np.arange(1,5).reshape(2,2)
  y = np.arange(5,9).reshape(2,2)
  log("x", x)
  log("y", y)
  log("x + y", x + y)
  log("np.add(x, y)", np.add(x, y))
  log("y - x", y - x)
  log("np.subtract(y, x)", np.subtract(y, x))
  log("x * y", x * y)
  log("x / y", x / y)
  x = np.array(x, dtype=float)
  y = np.array(y, dtype=float)
  log("x", x)
  log("y", y)
  log("x / y", x / y)
  log("np.sqrt(x)", np.sqrt(x))
  log("x + 10", x + 10)

  data = np.arange(16).reshape(4,4)
  log("data.sum()", data.sum())
  log("data.sum(axis=0)", data.sum(axis=0))
  log("data.sum(axis=1)", data.sum(axis=1))

#+END_SRC
