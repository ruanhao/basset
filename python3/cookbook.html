<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-06-29 Fri 11:32 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>代码仓库</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/solarized/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">代码仓库</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga473140">1. 类</a>
<ul>
<li><a href="#org6506133">1.1. 不调用 <code>__init__</code> 方法来创建实例</a></li>
<li><a href="#org35de7a7">1.2. 创建缓存对象</a></li>
<li><a href="#org978d989">1.3. 抽象类</a></li>
<li><a href="#orgf6778e3">1.4. 动态定义类</a></li>
<li><a href="#org503f817">1.5. 使用元类控制类的创建</a>
<ul>
<li><a href="#org5c8a837">1.5.1. 实例缓存</a></li>
<li><a href="#org6cfb4b4">1.5.2. 单例</a></li>
<li><a href="#org1efaec3">1.5.3. 禁用直接实例化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org837604d">2. 进程与多线程</a>
<ul>
<li><a href="#org0c2176b">2.1. 创建子进程</a></li>
<li><a href="#orgee4b708">2.2. 子进程的输入输出</a></li>
<li><a href="#orgf96460b">2.3. 进程间通信</a></li>
<li><a href="#orga4b8afd">2.4. 创建线程</a></li>
<li><a href="#orga389b62">2.5. 线程加锁</a></li>
<li><a href="#orgac3c97c">2.6. thread local 变量</a></li>
<li><a href="#org5dc32c1">2.7. 线程池</a></li>
</ul>
</li>
<li><a href="#org07afa20">3. 数据结构</a>
<ul>
<li><a href="#orgd314ca2">3.1. 列表</a>
<ul>
<li><a href="#org7e7b327">3.1.1. 列表中删除数据的陷阱</a>
<ul>
<li><a href="#org214f3f8">3.1.1.1. 原理</a></li>
<li><a href="#orge7d766a">3.1.1.2. 解决方法</a></li>
</ul>
</li>
<li><a href="#orgc2554e0">3.1.2. 列表中出现频率最高</a></li>
<li><a href="#orgfa4b008">3.1.3. 列表中最大或最小的几项</a></li>
<li><a href="#org7c908d0">3.1.4. 对列表中的数据分组</a></li>
<li><a href="#org24e06d7">3.1.5. 消除序列中的重复数据，同时保持数据顺序</a></li>
<li><a href="#org0ce200b">3.1.6. 序列解包 (unpack)</a></li>
<li><a href="#orgd04dde7">3.1.7. flatten 列表</a></li>
</ul>
</li>
<li><a href="#org371e7e8">3.2. 字典</a>
<ul>
<li><a href="#org201ec44">3.2.1. 对字典作集合运算</a></li>
<li><a href="#org0ed5154">3.2.2. 组合多个字典当作一个字典使用</a></li>
<li><a href="#orgb414ded">3.2.3. 字典栈</a></li>
</ul>
</li>
<li><a href="#orgcd21b5a">3.3. 队列</a>
<ul>
<li><a href="#orgc213428">3.3.1. 优先队列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfd77e35">4. IO</a>
<ul>
<li><a href="#org419484c">4.1. 文件</a>
<ul>
<li><a href="#org621d272">4.1.1. 将文件描述符包装成文件对象</a></li>
<li><a href="#orgd2ee916">4.1.2. 改变已打开文件的编码方式</a></li>
</ul>
</li>
<li><a href="#orge8622cc">4.2. 内存 IO</a>
<ul>
<li><a href="#org8c4d01f">4.2.1. 内存字符串</a></li>
<li><a href="#orga7dfbc5">4.2.2. 内存比特流</a></li>
</ul>
</li>
<li><a href="#orgbd62e06">4.3. 读写 JSON</a></li>
</ul>
</li>
<li><a href="#orgabc06b6">5. 模块</a>
<ul>
<li><a href="#org3e21342">5.1. 猴子补丁</a></li>
<li><a href="#org88b3e9d">5.2. 将模块拆分出多个文件</a></li>
</ul>
</li>
<li><a href="#org66462c0">6. 数字，日期，时间</a>
<ul>
<li><a href="#orgda5b5a9">6.1. time 模块</a>
<ul>
<li><a href="#org762a374">6.1.1. 获取 Unix Timestamp</a></li>
<li><a href="#org48940fa">6.1.2. 获取具体时间值</a></li>
</ul>
</li>
<li><a href="#org9f9cce9">6.2. datetime 模块</a>
<ul>
<li><a href="#org7878c42">6.2.1. 创建时间</a></li>
<li><a href="#org470896c">6.2.2. 获取 UTC 时间</a></li>
<li><a href="#orgfb76a5d">6.2.3. 获取当前时区时间</a></li>
<li><a href="#orgae12f82">6.2.4. 日期运算</a></li>
<li><a href="#orgdc75df9">6.2.5. 日期转字符串</a></li>
<li><a href="#orgaf29084">6.2.6. 字符串转日期</a></li>
</ul>
</li>
<li><a href="#orgaecb8e8">6.3. 月份缩写</a></li>
<li><a href="#orgb28347a">6.4. 数字精度格式化</a></li>
</ul>
</li>
<li><a href="#org5a78ad4">7. 字符串与文本</a>
<ul>
<li><a href="#org9cc3bbc">7.1. 格式化</a>
<ul>
<li><a href="#orge5ce6b6">7.1.1. 填充与对齐</a></li>
<li><a href="#org5a85e16">7.1.2. 字符串截断</a></li>
<li><a href="#orge4ef3ff">7.1.3. 占位符</a></li>
<li><a href="#org3bd3a8f">7.1.4. 排版</a></li>
</ul>
</li>
<li><a href="#orgec659a4">7.2. 字符串匹配</a>
<ul>
<li><a href="#org819f6be">7.2.1. 使用 shell 风格的通配符匹配字符串</a></li>
<li><a href="#org457e880">7.2.2. 贪婪和非贪婪匹配</a></li>
</ul>
</li>
<li><a href="#org65a153a">7.3. 密码输入</a></li>
</ul>
</li>
<li><a href="#orgd267306">8. 网络</a>
<ul>
<li><a href="#org4528a4e">8.1. netaddr</a>
<ul>
<li><a href="#org8502441">8.1.1. IP 地址操作</a>
<ul>
<li><a href="#org0e94cdb">8.1.1.1. 定义网络</a></li>
<li><a href="#org1d679d0">8.1.1.2. 网络掩码</a></li>
<li><a href="#org2ed46ee">8.1.1.3. 广播地址</a></li>
<li><a href="#org34d9edb">8.1.1.4. 网络地址</a></li>
<li><a href="#org10a3145">8.1.1.5. 主机掩码</a></li>
<li><a href="#orge518457">8.1.1.6. 网段包含主机数量</a></li>
<li><a href="#orgf8ad7fa">8.1.1.7. 获取所有主机地址</a></li>
<li><a href="#org3d736f2">8.1.1.8. 将 IP 地址所在网段根据掩码长度划分子网</a></li>
<li><a href="#org932a2a8">8.1.1.9. 修改掩码长度</a></li>
<li><a href="#org1a96fee">8.1.1.10. 判断公私网</a></li>
<li><a href="#org542086b">8.1.1.11. 定义网段地址范围</a></li>
<li><a href="#org7104c19">8.1.1.12. 地址聚合</a>
<ul>
<li><a href="#orgd84dae1">8.1.1.12.1. IPRange</a></li>
<li><a href="#org46c1ab7">8.1.1.12.2. cidr_merge</a></li>
</ul>
</li>
<li><a href="#org19403e2">8.1.1.13. 地址加减</a></li>
</ul>
</li>
<li><a href="#org68f0e87">8.1.2. MAC 地址操作</a>
<ul>
<li><a href="#org0f7f155">8.1.2.1. 获取厂家信息</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3388e28">8.2. ipaddr</a>
<ul>
<li><a href="#orgf035eb1">8.2.1. 定义地址</a></li>
<li><a href="#org8f7dcc2">8.2.2. 子网掩码</a></li>
<li><a href="#orgc418ecb">8.2.3. 广播地址</a></li>
<li><a href="#orgc2350a9">8.2.4. 网络地址</a></li>
<li><a href="#org431e76f">8.2.5. 主机掩码</a></li>
<li><a href="#org67f2f6b">8.2.6. 地址包含关系</a></li>
<li><a href="#orge9febf9">8.2.7. 地址聚合</a></li>
</ul>
</li>
<li><a href="#orga61c2e1">8.3. networkx (拓扑)</a>
<ul>
<li><a href="#orgde5dfd9">8.3.1. Dot</a>
<ul>
<li><a href="#org9547d45">8.3.1.1. 无向图</a></li>
<li><a href="#orgcc11bfd">8.3.1.2. 有向图</a></li>
<li><a href="#org413dbfe">8.3.1.3. 多重图</a></li>
</ul>
</li>
<li><a href="#org4bb2adf">8.3.2. 描述拓扑</a>
<ul>
<li><a href="#orgf66bea7">8.3.2.1. 无 weight 路径</a></li>
<li><a href="#orgf31ca06">8.3.2.2. 有 weight 路径</a></li>
</ul>
</li>
<li><a href="#org5188ad9">8.3.3. 路径计算</a>
<ul>
<li><a href="#org8ced884">8.3.3.1. 最短路径计算</a></li>
<li><a href="#org9a19402">8.3.3.2. 等价路径计算</a></li>
<li><a href="#orgc21c3e9">8.3.3.3. 可用路径</a>
<ul>
<li><a href="#org132befd">8.3.3.3.1. 获得部分可用路径</a></li>
<li><a href="#org5f1b0c5">8.3.3.3.2. 基于链路 weight 计算可用路径</a></li>
</ul>
</li>
<li><a href="#org04b0d5b">8.3.3.4. 更多路径计算方法</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org79991a7">9. 参考资料</a></li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga473140">1. 类</a>
<ul>
<li><a href="#org6506133">1.1. 不调用 <code>__init__</code> 方法来创建实例</a></li>
<li><a href="#org35de7a7">1.2. 创建缓存对象</a></li>
<li><a href="#org978d989">1.3. 抽象类</a></li>
<li><a href="#orgf6778e3">1.4. 动态定义类</a></li>
<li><a href="#org503f817">1.5. 使用元类控制类的创建</a>
<ul>
<li><a href="#org5c8a837">1.5.1. 实例缓存</a></li>
<li><a href="#org6cfb4b4">1.5.2. 单例</a></li>
<li><a href="#org1efaec3">1.5.3. 禁用直接实例化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org837604d">2. 进程与多线程</a>
<ul>
<li><a href="#org0c2176b">2.1. 创建子进程</a></li>
<li><a href="#orgee4b708">2.2. 子进程的输入输出</a></li>
<li><a href="#orgf96460b">2.3. 进程间通信</a></li>
<li><a href="#orga4b8afd">2.4. 创建线程</a></li>
<li><a href="#orga389b62">2.5. 线程加锁</a></li>
<li><a href="#orgac3c97c">2.6. thread local 变量</a></li>
<li><a href="#org5dc32c1">2.7. 线程池</a></li>
</ul>
</li>
<li><a href="#org07afa20">3. 数据结构</a>
<ul>
<li><a href="#orgd314ca2">3.1. 列表</a>
<ul>
<li><a href="#org7e7b327">3.1.1. 列表中删除数据的陷阱</a>
<ul>
<li><a href="#org214f3f8">3.1.1.1. 原理</a></li>
<li><a href="#orge7d766a">3.1.1.2. 解决方法</a></li>
</ul>
</li>
<li><a href="#orgc2554e0">3.1.2. 列表中出现频率最高</a></li>
<li><a href="#orgfa4b008">3.1.3. 列表中最大或最小的几项</a></li>
<li><a href="#org7c908d0">3.1.4. 对列表中的数据分组</a></li>
<li><a href="#org24e06d7">3.1.5. 消除序列中的重复数据，同时保持数据顺序</a></li>
<li><a href="#org0ce200b">3.1.6. 序列解包 (unpack)</a></li>
<li><a href="#orgd04dde7">3.1.7. flatten 列表</a></li>
</ul>
</li>
<li><a href="#org371e7e8">3.2. 字典</a>
<ul>
<li><a href="#org201ec44">3.2.1. 对字典作集合运算</a></li>
<li><a href="#org0ed5154">3.2.2. 组合多个字典当作一个字典使用</a></li>
<li><a href="#orgb414ded">3.2.3. 字典栈</a></li>
</ul>
</li>
<li><a href="#orgcd21b5a">3.3. 队列</a>
<ul>
<li><a href="#orgc213428">3.3.1. 优先队列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfd77e35">4. IO</a>
<ul>
<li><a href="#org419484c">4.1. 文件</a>
<ul>
<li><a href="#org621d272">4.1.1. 将文件描述符包装成文件对象</a></li>
<li><a href="#orgd2ee916">4.1.2. 改变已打开文件的编码方式</a></li>
</ul>
</li>
<li><a href="#orge8622cc">4.2. 内存 IO</a>
<ul>
<li><a href="#org8c4d01f">4.2.1. 内存字符串</a></li>
<li><a href="#orga7dfbc5">4.2.2. 内存比特流</a></li>
</ul>
</li>
<li><a href="#orgbd62e06">4.3. 读写 JSON</a></li>
</ul>
</li>
<li><a href="#orgabc06b6">5. 模块</a>
<ul>
<li><a href="#org3e21342">5.1. 猴子补丁</a></li>
<li><a href="#org88b3e9d">5.2. 将模块拆分出多个文件</a></li>
</ul>
</li>
<li><a href="#org66462c0">6. 数字，日期，时间</a>
<ul>
<li><a href="#orgda5b5a9">6.1. time 模块</a>
<ul>
<li><a href="#org762a374">6.1.1. 获取 Unix Timestamp</a></li>
<li><a href="#org48940fa">6.1.2. 获取具体时间值</a></li>
</ul>
</li>
<li><a href="#org9f9cce9">6.2. datetime 模块</a>
<ul>
<li><a href="#org7878c42">6.2.1. 创建时间</a></li>
<li><a href="#org470896c">6.2.2. 获取 UTC 时间</a></li>
<li><a href="#orgfb76a5d">6.2.3. 获取当前时区时间</a></li>
<li><a href="#orgae12f82">6.2.4. 日期运算</a></li>
<li><a href="#orgdc75df9">6.2.5. 日期转字符串</a></li>
<li><a href="#orgaf29084">6.2.6. 字符串转日期</a></li>
</ul>
</li>
<li><a href="#orgaecb8e8">6.3. 月份缩写</a></li>
<li><a href="#orgb28347a">6.4. 数字精度格式化</a></li>
</ul>
</li>
<li><a href="#org5a78ad4">7. 字符串与文本</a>
<ul>
<li><a href="#org9cc3bbc">7.1. 格式化</a>
<ul>
<li><a href="#orge5ce6b6">7.1.1. 填充与对齐</a></li>
<li><a href="#org5a85e16">7.1.2. 字符串截断</a></li>
<li><a href="#orge4ef3ff">7.1.3. 占位符</a></li>
<li><a href="#org3bd3a8f">7.1.4. 排版</a></li>
</ul>
</li>
<li><a href="#orgec659a4">7.2. 字符串匹配</a>
<ul>
<li><a href="#org819f6be">7.2.1. 使用 shell 风格的通配符匹配字符串</a></li>
<li><a href="#org457e880">7.2.2. 贪婪和非贪婪匹配</a></li>
</ul>
</li>
<li><a href="#org65a153a">7.3. 密码输入</a></li>
</ul>
</li>
<li><a href="#orgd267306">8. 网络</a>
<ul>
<li><a href="#org4528a4e">8.1. netaddr</a>
<ul>
<li><a href="#org8502441">8.1.1. IP 地址操作</a>
<ul>
<li><a href="#org0e94cdb">8.1.1.1. 定义网络</a></li>
<li><a href="#org1d679d0">8.1.1.2. 网络掩码</a></li>
<li><a href="#org2ed46ee">8.1.1.3. 广播地址</a></li>
<li><a href="#org34d9edb">8.1.1.4. 网络地址</a></li>
<li><a href="#org10a3145">8.1.1.5. 主机掩码</a></li>
<li><a href="#orge518457">8.1.1.6. 网段包含主机数量</a></li>
<li><a href="#orgf8ad7fa">8.1.1.7. 获取所有主机地址</a></li>
<li><a href="#org3d736f2">8.1.1.8. 将 IP 地址所在网段根据掩码长度划分子网</a></li>
<li><a href="#org932a2a8">8.1.1.9. 修改掩码长度</a></li>
<li><a href="#org1a96fee">8.1.1.10. 判断公私网</a></li>
<li><a href="#org542086b">8.1.1.11. 定义网段地址范围</a></li>
<li><a href="#org7104c19">8.1.1.12. 地址聚合</a></li>
<li><a href="#org19403e2">8.1.1.13. 地址加减</a></li>
</ul>
</li>
<li><a href="#org68f0e87">8.1.2. MAC 地址操作</a>
<ul>
<li><a href="#org0f7f155">8.1.2.1. 获取厂家信息</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3388e28">8.2. ipaddr</a>
<ul>
<li><a href="#orgf035eb1">8.2.1. 定义地址</a></li>
<li><a href="#org8f7dcc2">8.2.2. 子网掩码</a></li>
<li><a href="#orgc418ecb">8.2.3. 广播地址</a></li>
<li><a href="#orgc2350a9">8.2.4. 网络地址</a></li>
<li><a href="#org431e76f">8.2.5. 主机掩码</a></li>
<li><a href="#org67f2f6b">8.2.6. 地址包含关系</a></li>
<li><a href="#orge9febf9">8.2.7. 地址聚合</a></li>
</ul>
</li>
<li><a href="#orga61c2e1">8.3. networkx (拓扑)</a>
<ul>
<li><a href="#orgde5dfd9">8.3.1. Dot</a>
<ul>
<li><a href="#org9547d45">8.3.1.1. 无向图</a></li>
<li><a href="#orgcc11bfd">8.3.1.2. 有向图</a></li>
<li><a href="#org413dbfe">8.3.1.3. 多重图</a></li>
</ul>
</li>
<li><a href="#org4bb2adf">8.3.2. 描述拓扑</a>
<ul>
<li><a href="#orgf66bea7">8.3.2.1. 无 weight 路径</a></li>
<li><a href="#orgf31ca06">8.3.2.2. 有 weight 路径</a></li>
</ul>
</li>
<li><a href="#org5188ad9">8.3.3. 路径计算</a>
<ul>
<li><a href="#org8ced884">8.3.3.1. 最短路径计算</a></li>
<li><a href="#org9a19402">8.3.3.2. 等价路径计算</a></li>
<li><a href="#orgc21c3e9">8.3.3.3. 可用路径</a></li>
<li><a href="#org04b0d5b">8.3.3.4. 更多路径计算方法</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org79991a7">9. 参考资料</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Author</td>
<td class="org-left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">2018-06-29 11:32:27</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orga473140" class="outline-2">
<h2 id="orga473140"><span class="section-number-2">1</span> 类</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org6506133" class="outline-3">
<h3 id="org6506133"><span class="section-number-3">1.1</span> 不调用 <code>__init__</code> 方法来创建实例</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> time <span style="color: #d787d7; font-weight: bold;">import</span> localtime

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Date</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, year, month, day<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.year = year
        <span style="color: #d787d7; font-weight: bold;">self</span>.month = month
        <span style="color: #d787d7; font-weight: bold;">self</span>.day = day

    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Class method that bypasses __init__</span>
    <span style="color: #5fafff;">@classmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">today</span><span style="color: #ff8c00; font-size: 150%;">(</span>cls<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #5fafff;">d</span> = cls.__new__<span style="color: #ff8c00; font-size: 150%;">(</span>cls<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #5fafff;">t</span> = localtime<span style="color: #ff8c00; font-size: 150%;">()</span>
        <span style="color: #5fafff;">d.year</span> = t.tm_year
        <span style="color: #5fafff;">d.month</span> = t.tm_mon
        <span style="color: #5fafff;">d.day</span> = t.tm_mday
        <span style="color: #d787d7; font-weight: bold;">return</span> d

<span style="color: #5fafff;">d</span> = Date.__new__<span style="color: #ff8c00; font-size: 150%;">(</span>Date<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>d<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">hasattr</span><span style="color: #ff1493; font-size: 140%;">(</span>d,<span style="color: #87af5f;">'year'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">data</span> = <span style="color: #ff8c00; font-size: 150%;">{</span>
    <span style="color: #87af5f;">'year'</span> : 2012,
    <span style="color: #87af5f;">'month'</span> : 8,
    <span style="color: #87af5f;">'day'</span> : 29
<span style="color: #ff8c00; font-size: 150%;">}</span>

d.__dict__.update<span style="color: #ff8c00; font-size: 150%;">(</span>data<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>d.year<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>d.month<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">d</span> = Date.today<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>d.year, d.month, d.day<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
&lt;__main__.Date object at 0x1085e1588&gt;
False
2012
8
2018 6 13

</pre>
</div>
</div>


<div id="outline-container-org35de7a7" class="outline-3">
<h3 id="org35de7a7"><span class="section-number-3">1.2</span> 创建缓存对象</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.name = name

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Caching support</span>
<span style="color: #d787d7; font-weight: bold;">import</span> weakref
<span style="color: #5fafff;">_spam_cache</span> = weakref.WeakValueDictionary<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">get_spam</span><span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">if</span> name <span style="color: #d787d7; font-weight: bold;">not</span> <span style="color: #d787d7; font-weight: bold;">in</span> _spam_cache:
        <span style="color: #5fafff;">s</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #5fafff;">_spam_cache</span><span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span> = s
    <span style="color: #d787d7; font-weight: bold;">else</span>:
        <span style="color: #5fafff;">s</span> = _spam_cache<span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span>
    <span style="color: #d787d7; font-weight: bold;">return</span> s

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">a</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">b</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'bar'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is b:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> b<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">c</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is c:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> c<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
a is b: False
a is c: True

</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> weakref

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">CachedSpamManager</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>._cache = weakref.WeakValueDictionary<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">get_spam</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> name <span style="color: #d787d7; font-weight: bold;">not</span> <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #d787d7; font-weight: bold;">self</span>._cache:
            <span style="color: #5fafff;">s</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>
            <span style="color: #d787d7; font-weight: bold;">self</span>._cache<span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span> = s
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            <span style="color: #5fafff;">s</span> = <span style="color: #d787d7; font-weight: bold;">self</span>._cache<span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> s

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.name = name

<span style="color: #5fafff;">Spam.manager</span> = CachedSpamManager<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">get_spam</span><span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">return</span> Spam.manager.get_spam<span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">a</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">b</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'bar'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is b:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> b<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">c</span> = get_spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is c:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> c<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
a is b: False
a is c: True

</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Example involving new and some of its problems</span>

<span style="color: #d787d7; font-weight: bold;">import</span> weakref

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span>:
    <span style="color: #5fafff;">_spam_cache</span> = weakref.WeakValueDictionary<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__new__</span><span style="color: #ff8c00; font-size: 150%;">(</span>cls, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> name <span style="color: #d787d7; font-weight: bold;">in</span> cls._spam_cache:
            <span style="color: #d787d7; font-weight: bold;">return</span> cls._spam_cache<span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span>
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            <span style="color: #d787d7; font-weight: bold;">self</span> = <span style="color: #5fafff; font-weight: bold;">super</span><span style="color: #ff8c00; font-size: 150%;">()</span>.__new__<span style="color: #ff8c00; font-size: 150%;">(</span>cls<span style="color: #ff8c00; font-size: 150%;">)</span>
            <span style="color: #5fafff;">cls._spam_cache</span><span style="color: #ff8c00; font-size: 150%;">[</span>name<span style="color: #ff8c00; font-size: 150%;">]</span> = <span style="color: #d787d7; font-weight: bold;">self</span>
            <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d787d7; font-weight: bold;">self</span>

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Initializing Spam'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>.name = name

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"This should print 'Initializing Spam' twice"</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">s</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Dave'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">t</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Dave'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>s <span style="color: #d787d7; font-weight: bold;">is</span> t<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
This should print 'Initializing Spam' twice
Initializing Spam
Initializing Spam
True

</pre>
</div>
</div>

<div id="outline-container-org978d989" class="outline-3">
<h3 id="org978d989"><span class="section-number-3">1.3</span> 抽象类</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> abc <span style="color: #d787d7; font-weight: bold;">import</span> ABCMeta, abstractmethod

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">A</span><span style="color: #ff8c00; font-size: 150%;">(</span>metaclass=ABCMeta<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">@property</span>
    <span style="color: #5fafff;">@abstractmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">name</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">pass</span>

    <span style="color: #5fafff;">@name.setter</span>
    <span style="color: #5fafff;">@abstractmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">name</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, value<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">pass</span>

    <span style="color: #5fafff;">@classmethod</span>
    <span style="color: #5fafff;">@abstractmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">method1</span><span style="color: #ff8c00; font-size: 150%;">(</span>cls<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">pass</span>

    <span style="color: #5fafff;">@staticmethod</span>
    <span style="color: #5fafff;">@abstractmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">method2</span><span style="color: #ff8c00; font-size: 150%;">()</span>:
        <span style="color: #d787d7; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf6778e3" class="outline-3">
<h3 id="orgf6778e3"><span class="section-number-3">1.4</span> 动态定义类</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Example of making a class manually from parts</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Methods</span>
<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name, shares, price<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">self</span>.name = name
    <span style="color: #d787d7; font-weight: bold;">self</span>.shares = shares
    <span style="color: #d787d7; font-weight: bold;">self</span>.price = price

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">cost</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d787d7; font-weight: bold;">self</span>.shares * <span style="color: #d787d7; font-weight: bold;">self</span>.price

<span style="color: #5fafff;">cls_dict</span> = <span style="color: #ff8c00; font-size: 150%;">{</span>
    <span style="color: #87af5f;">'__init__'</span> : __init__,
    <span style="color: #87af5f;">'cost'</span> : cost,
<span style="color: #ff8c00; font-size: 150%;">}</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Make a class</span>
<span style="color: #d787d7; font-weight: bold;">import</span> types

<span style="color: #5fafff;">Stock</span> = types.new_class<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Stock'</span>, <span style="color: #ff1493; font-size: 140%;">()</span>, <span style="color: #ff1493; font-size: 140%;">{}</span>, <span style="color: #d787d7; font-weight: bold;">lambda</span> ns: ns.update<span style="color: #ff1493; font-size: 140%;">(</span>cls_dict<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">s</span> = Stock<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'ACME'</span>, 50, 91.1<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>s<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>s.cost<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
&lt;types.Stock object at 0x1085e1518&gt;
4555.0

</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">An alternative formulation of namedtuples</span>

<span style="color: #d787d7; font-weight: bold;">import</span> operator
<span style="color: #d787d7; font-weight: bold;">import</span> types
<span style="color: #d787d7; font-weight: bold;">import</span> sys

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">named_tuple</span><span style="color: #ff8c00; font-size: 150%;">(</span>classname, fieldnames<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Populate a dictionary of field property accessors</span>
    <span style="color: #5fafff;">cls_dict</span> = <span style="color: #ff8c00; font-size: 150%;">{</span> name: <span style="color: #5fafff; font-weight: bold;">property</span><span style="color: #ff1493; font-size: 140%;">(</span>operator.itemgetter<span style="color: #7fff00; font-size: 130%;">(</span>n<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span>
                 <span style="color: #d787d7; font-weight: bold;">for</span> n, name <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #5fafff; font-weight: bold;">enumerate</span><span style="color: #ff1493; font-size: 140%;">(</span>fieldnames<span style="color: #ff1493; font-size: 140%;">)</span> <span style="color: #ff8c00; font-size: 150%;">}</span>

    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Make a __new__ function and add to the class dict</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__new__</span><span style="color: #ff8c00; font-size: 150%;">(</span>cls, *args<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">len</span><span style="color: #ff8c00; font-size: 150%;">(</span>args<span style="color: #ff8c00; font-size: 150%;">)</span> != <span style="color: #5fafff; font-weight: bold;">len</span><span style="color: #ff8c00; font-size: 150%;">(</span>fieldnames<span style="color: #ff8c00; font-size: 150%;">)</span>:
            <span style="color: #d787d7; font-weight: bold;">raise</span> <span style="color: #5fafff;">TypeError</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Expected {} arguments'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #5fafff; font-weight: bold;">len</span><span style="color: #7fff00; font-size: 130%;">(</span>fieldnames<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #5fafff; font-weight: bold;">tuple</span>.__new__<span style="color: #ff8c00; font-size: 150%;">(</span>cls, <span style="color: #ff1493; font-size: 140%;">(</span>args<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

    <span style="color: #5fafff;">cls_dict</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'__new__'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = __new__

    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Make the class</span>
    <span style="color: #5fafff;">cls</span> = types.new_class<span style="color: #ff8c00; font-size: 150%;">(</span>classname, <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #5fafff; font-weight: bold;">tuple</span>,<span style="color: #ff1493; font-size: 140%;">)</span>, <span style="color: #ff1493; font-size: 140%;">{}</span>,
                           <span style="color: #d787d7; font-weight: bold;">lambda</span> ns: ns.update<span style="color: #ff1493; font-size: 140%;">(</span>cls_dict<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">cls.__module__</span> = sys._getframe<span style="color: #ff8c00; font-size: 150%;">(</span>1<span style="color: #ff8c00; font-size: 150%;">)</span>.f_globals<span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'__name__'</span><span style="color: #ff8c00; font-size: 150%;">]</span>
    <span style="color: #d787d7; font-weight: bold;">return</span> cls

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">Point</span> = named_tuple<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Point'</span>, <span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'x'</span>, <span style="color: #87af5f;">'y'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>Point<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">p</span> = Point<span style="color: #ff8c00; font-size: 150%;">(</span>4, 5<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">len</span><span style="color: #ff1493; font-size: 140%;">(</span>p<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>p.x, p<span style="color: #ff1493; font-size: 140%;">[</span>0<span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>p.y, p<span style="color: #ff1493; font-size: 140%;">[</span>1<span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">try</span>:
        <span style="color: #5fafff;">p.x</span> = 2
    <span style="color: #d787d7; font-weight: bold;">except</span> <span style="color: #5fafff;">AttributeError</span> <span style="color: #d787d7; font-weight: bold;">as</span> e:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>e<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'%s %s'</span> % p<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
&lt;class '__main__.Point'&gt;
2
4 4
5 5
can't set attribute
4 5

</pre>
</div>
</div>


<div id="outline-container-org503f817" class="outline-3">
<h3 id="org503f817"><span class="section-number-3">1.5</span> 使用元类控制类的创建</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org5c8a837" class="outline-4">
<h4 id="org5c8a837"><span class="section-number-4">1.5.1</span> 实例缓存</h4>
<div class="outline-text-4" id="text-1-5-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Cached instances</span>

<span style="color: #d787d7; font-weight: bold;">import</span> weakref

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Cached</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">type</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #5fafff; font-weight: bold;">super</span><span style="color: #ff8c00; font-size: 150%;">()</span>.__init__<span style="color: #ff8c00; font-size: 150%;">(</span>*args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>.__cache = weakref.WeakValueDictionary<span style="color: #ff8c00; font-size: 150%;">()</span>

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__call__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, *args<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> args <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #d787d7; font-weight: bold;">self</span>.__cache:
            <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d787d7; font-weight: bold;">self</span>.__cache<span style="color: #ff8c00; font-size: 150%;">[</span>args<span style="color: #ff8c00; font-size: 150%;">]</span>
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            <span style="color: #5fafff;">obj</span> = <span style="color: #5fafff; font-weight: bold;">super</span><span style="color: #ff8c00; font-size: 150%;">()</span>.__call__<span style="color: #ff8c00; font-size: 150%;">(</span>*args<span style="color: #ff8c00; font-size: 150%;">)</span>
            <span style="color: #d787d7; font-weight: bold;">self</span>.__cache<span style="color: #ff8c00; font-size: 150%;">[</span>args<span style="color: #ff8c00; font-size: 150%;">]</span> = obj
            <span style="color: #d787d7; font-weight: bold;">return</span> obj

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span><span style="color: #ff8c00; font-size: 150%;">(</span>metaclass=Cached<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Creating Spam({!r})'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>name<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>.name = name

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">a</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">b</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'bar'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is b:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> b<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">c</span> = Spam<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'a is c:'</span>, a <span style="color: #d787d7; font-weight: bold;">is</span> c<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
Creating Spam('foo')
Creating Spam('bar')
a is b: False
a is c: True

</pre>
</div>
</div>


<div id="outline-container-org6cfb4b4" class="outline-4">
<h4 id="org6cfb4b4"><span class="section-number-4">1.5.2</span> 单例</h4>
<div class="outline-text-4" id="text-1-5-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Singleton</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Singleton</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">type</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.__instance = <span style="color: #d7875f; font-weight: bold;">None</span>
        <span style="color: #5fafff; font-weight: bold;">super</span><span style="color: #ff8c00; font-size: 150%;">()</span>.__init__<span style="color: #ff8c00; font-size: 150%;">(</span>*args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__call__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #d787d7; font-weight: bold;">self</span>.__instance <span style="color: #d787d7; font-weight: bold;">is</span> <span style="color: #d7875f; font-weight: bold;">None</span>:
            <span style="color: #d787d7; font-weight: bold;">self</span>.__instance = <span style="color: #5fafff; font-weight: bold;">super</span><span style="color: #ff8c00; font-size: 150%;">()</span>.__call__<span style="color: #ff8c00; font-size: 150%;">(</span>*args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>
            <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d787d7; font-weight: bold;">self</span>.__instance
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d787d7; font-weight: bold;">self</span>.__instance

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span><span style="color: #ff8c00; font-size: 150%;">(</span>metaclass=Singleton<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Creating Spam'</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #5fafff;">a</span> = Spam<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #5fafff;">b</span> = Spam<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>a <span style="color: #d787d7; font-weight: bold;">is</span> b<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
Creating Spam
True

</pre>
</div>
</div>


<div id="outline-container-org1efaec3" class="outline-4">
<h4 id="org1efaec3"><span class="section-number-4">1.5.3</span> 禁用直接实例化</h4>
<div class="outline-text-4" id="text-1-5-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Not allowing direct instantiation</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">NoInstances</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">type</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__call__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">raise</span> <span style="color: #5fafff;">TypeError</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Can't instantiate directly"</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Spam</span><span style="color: #ff8c00; font-size: 150%;">(</span>metaclass=NoInstances<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">@staticmethod</span>
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">grok</span><span style="color: #ff8c00; font-size: 150%;">(</span>x<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Spam.grok'</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span> == <span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #d787d7; font-weight: bold;">try</span>:
        <span style="color: #5fafff;">s</span> = Spam<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">except</span> <span style="color: #5fafff;">TypeError</span> <span style="color: #d787d7; font-weight: bold;">as</span> e:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>e<span style="color: #ff8c00; font-size: 150%;">)</span>

    Spam.grok<span style="color: #ff8c00; font-size: 150%;">(</span>42<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
Can't instantiate directly
Spam.grok

</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org837604d" class="outline-2">
<h2 id="org837604d"><span class="section-number-2">2</span> 进程与多线程</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org0c2176b" class="outline-3">
<h3 id="org0c2176b"><span class="section-number-3">2.1</span> 创建子进程</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> multiprocessing <span style="color: #d787d7; font-weight: bold;">import</span> Process
<span style="color: #d787d7; font-weight: bold;">import</span> os

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">run_proc</span><span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Run child process %s (%s)...'</span> % <span style="color: #ff1493; font-size: 140%;">(</span>name, os.getpid<span style="color: #7fff00; font-size: 130%;">()</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">__name__</span>==<span style="color: #87af5f;">'__main__'</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Parent process %s.'</span> % os.getpid<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">p</span> = Process<span style="color: #ff8c00; font-size: 150%;">(</span>target=run_proc, args=<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'test'</span>,<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Child process will start.'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    p.start<span style="color: #ff8c00; font-size: 150%;">()</span>
    p.join<span style="color: #ff8c00; font-size: 150%;">()</span>  <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#31561;&#24453;&#23376;&#36827;&#31243;&#32467;&#26463;&#21518;&#20877;&#32487;&#32493;&#24448;&#19979;&#36816;&#34892;</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Child process end.'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgee4b708" class="outline-3">
<h3 id="orgee4b708"><span class="section-number-3">2.2</span> 子进程的输入输出</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> subprocess

<span style="color: #5fafff;">r</span> = subprocess.call<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'nslookup'</span>, <span style="color: #87af5f;">'www.python.org'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'r: {}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>r<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">p</span> = subprocess.Popen<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'nslookup'</span><span style="color: #ff1493; font-size: 140%;">]</span>, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">output</span>, <span style="color: #5fafff;">err</span> = p.communicate<span style="color: #ff8c00; font-size: 150%;">(</span>b<span style="color: #87af5f;">'set q=mx\npython.org\nexit\n'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>output.decode<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'utf-8'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Exit code:'</span>, p.returncode<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#30456;&#24403;&#20110;&#22312;&#21629;&#20196;&#34892;&#25191;&#34892;&#21629;&#20196;nslookup&#65292;&#28982;&#21518;&#25163;&#21160;&#36755;&#20837;&#65306;</span>
<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">set q=mx</span>
<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">python.org</span>
<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">exit</span>
</pre>
</div>

<pre class="example">
r: 0
Server:		64.104.123.144
Address:	64.104.123.144#53

Non-authoritative answer:
python.org	mail exchanger = 50 mail.python.org.

Authoritative answers can be found from:
org	nameserver = d0.org.afilias-nst.org.
org	nameserver = a2.org.afilias-nst.info.
org	nameserver = a0.org.afilias-nst.info.
org	nameserver = b0.org.afilias-nst.org.
org	nameserver = b2.org.afilias-nst.org.
org	nameserver = c0.org.afilias-nst.info.
a0.org.afilias-nst.info	internet address = 199.19.56.1
a2.org.afilias-nst.info	internet address = 199.249.112.1
b0.org.afilias-nst.org	internet address = 199.19.54.1
b2.org.afilias-nst.org	internet address = 199.249.120.1
c0.org.afilias-nst.info	internet address = 199.19.53.1
d0.org.afilias-nst.org	internet address = 199.19.57.1
a0.org.afilias-nst.info	has AAAA address 2001:500:e::1
a2.org.afilias-nst.info	has AAAA address 2001:500:40::1
b0.org.afilias-nst.org	has AAAA address 2001:500:c::1
b2.org.afilias-nst.org	has AAAA address 2001:500:48::1
c0.org.afilias-nst.info	has AAAA address 2001:500:b::1
d0.org.afilias-nst.org	has AAAA address 2001:500:f::1


Exit code: 0
</pre>
</div>
</div>


<div id="outline-container-orgf96460b" class="outline-3">
<h3 id="orgf96460b"><span class="section-number-3">2.3</span> 进程间通信</h3>
<div class="outline-text-3" id="text-2-3">
<p>
父进程中创建两个子进程，一个往 Queue 里写数据，一个从 Queue 里读数据：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> multiprocessing <span style="color: #d787d7; font-weight: bold;">import</span> Process, Queue
<span style="color: #d787d7; font-weight: bold;">import</span> os, time, random

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">write</span><span style="color: #ff8c00; font-size: 150%;">(</span>q<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Process to write: %s'</span> % os.getpid<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">for</span> value <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'A'</span>, <span style="color: #87af5f;">'B'</span>, <span style="color: #87af5f;">'C'</span><span style="color: #ff8c00; font-size: 150%;">]</span>:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Put %s to queue...'</span> % value<span style="color: #ff8c00; font-size: 150%;">)</span>
        q.put<span style="color: #ff8c00; font-size: 150%;">(</span>value<span style="color: #ff8c00; font-size: 150%;">)</span>
        time.sleep<span style="color: #ff8c00; font-size: 150%;">(</span>random.random<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">read</span><span style="color: #ff8c00; font-size: 150%;">(</span>q<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Process to read: %s'</span> % os.getpid<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">while</span> <span style="color: #d7875f; font-weight: bold;">True</span>:
        <span style="color: #5fafff;">value</span> = q.get<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d7875f; font-weight: bold;">True</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Get %s from queue.'</span> % value<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">q</span> = Queue<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">pw</span> = Process<span style="color: #ff8c00; font-size: 150%;">(</span>target=write, args=<span style="color: #ff1493; font-size: 140%;">(</span>q,<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">pr</span> = Process<span style="color: #ff8c00; font-size: 150%;">(</span>target=read, args=<span style="color: #ff1493; font-size: 140%;">(</span>q,<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
pw.start<span style="color: #ff8c00; font-size: 150%;">()</span>
pr.start<span style="color: #ff8c00; font-size: 150%;">()</span>
pw.join<span style="color: #ff8c00; font-size: 150%;">()</span>
pr.terminate<span style="color: #ff8c00; font-size: 150%;">()</span>  <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">pr &#36827;&#31243;&#37324;&#26159;&#27515;&#24490;&#29615;&#65292;&#26080;&#27861;&#31561;&#24453;&#20854;&#32467;&#26463;&#65292;&#21482;&#33021;&#24378;&#34892;&#32456;&#27490;:</span>
</pre>
</div>

<pre class="example">
Process to write: 92549
Put A to queue...
Process to read: 92550
Get A from queue.
Put B to queue...
Get B from queue.
Put C to queue...
Get C from queue.

</pre>
</div>
</div>


<div id="outline-container-orga4b8afd" class="outline-3">
<h3 id="orga4b8afd"><span class="section-number-3">2.4</span> 创建线程</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> time, threading

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">worker</span><span style="color: #ff8c00; font-size: 150%;">()</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'thread %s is running...'</span> % threading.current_thread<span style="color: #ff1493; font-size: 140%;">()</span>.name<span style="color: #ff8c00; font-size: 150%;">)</span>
    time.sleep<span style="color: #ff8c00; font-size: 150%;">(</span>1<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'thread %s ended.'</span> % threading.current_thread<span style="color: #ff1493; font-size: 140%;">()</span>.name<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">t</span> = threading.Thread<span style="color: #ff8c00; font-size: 150%;">(</span>target=worker, name=<span style="color: #87af5f;">'WorkerThread'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
t.start<span style="color: #ff8c00; font-size: 150%;">()</span>
t.join<span style="color: #ff8c00; font-size: 150%;">()</span>
</pre>
</div>

<pre class="example">
thread WorkerThread is running...
thread WorkerThread ended.

</pre>
</div>
</div>


<div id="outline-container-orga389b62" class="outline-3">
<h3 id="orga389b62"><span class="section-number-3">2.5</span> 线程加锁</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> threading
<span style="color: #d787d7; font-weight: bold;">from</span> concurrent.futures <span style="color: #d787d7; font-weight: bold;">import</span> ThreadPoolExecutor

<span style="color: #5fafff;">lock</span> = threading.Lock<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">count</span> = 0

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">run_thread_without_lock</span><span style="color: #ff8c00; font-size: 150%;">()</span>:
    <span style="color: #d787d7; font-weight: bold;">global</span> count
    <span style="color: #d787d7; font-weight: bold;">while</span> count &lt; 10:
        <span style="color: #5fafff;">count</span> += 1
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"%s, "</span> % count, end=<span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">run_thread_with_lock</span><span style="color: #ff8c00; font-size: 150%;">()</span>:
    <span style="color: #d787d7; font-weight: bold;">global</span> count
    <span style="color: #d787d7; font-weight: bold;">with</span> lock:
        <span style="color: #d787d7; font-weight: bold;">while</span> count &lt; 10:
            <span style="color: #5fafff;">count</span> += 1
            <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"%s, "</span> % count, end=<span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">with</span> ThreadPoolExecutor<span style="color: #ff8c00; font-size: 150%;">(</span>max_workers=4<span style="color: #ff8c00; font-size: 150%;">)</span> <span style="color: #d787d7; font-weight: bold;">as</span> executor:
    <span style="color: #d787d7; font-weight: bold;">for</span> i <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #5fafff; font-weight: bold;">range</span><span style="color: #ff8c00; font-size: 150%;">(</span>5<span style="color: #ff8c00; font-size: 150%;">)</span>:
        executor.submit<span style="color: #ff8c00; font-size: 150%;">(</span>run_thread_without_lock<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">count</span> = 0

<span style="color: #d787d7; font-weight: bold;">with</span> ThreadPoolExecutor<span style="color: #ff8c00; font-size: 150%;">(</span>max_workers=4<span style="color: #ff8c00; font-size: 150%;">)</span> <span style="color: #d787d7; font-weight: bold;">as</span> executor:
    <span style="color: #d787d7; font-weight: bold;">for</span> i <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #5fafff; font-weight: bold;">range</span><span style="color: #ff8c00; font-size: 150%;">(</span>5<span style="color: #ff8c00; font-size: 150%;">)</span>:
        executor.submit<span style="color: #ff8c00; font-size: 150%;">(</span>run_thread_with_lock<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,

</pre>
</div>
</div>


<div id="outline-container-orgac3c97c" class="outline-3">
<h3 id="orgac3c97c"><span class="section-number-3">2.6</span> thread local 变量</h3>
<div class="outline-text-3" id="text-2-6">
<p>
一个线程使用自己的局部变量比使用全局变量好，因为局部变量只有线程自己能看见，不会影响其他线程，而全局变量的修改必须加锁。
</p>

<p>
最常用的地方就是为每个线程绑定一个数据库连接，HTTP 请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> threading, time

<span style="color: #5fafff;">tl</span> = threading.local<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">worker</span><span style="color: #ff8c00; font-size: 150%;">(</span>name<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">tl.name</span> = name
    time.sleep<span style="color: #ff8c00; font-size: 150%;">(</span>3<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"in thread:"</span>, tl.name<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">t</span> = threading.Thread<span style="color: #ff8c00; font-size: 150%;">(</span>target=worker, args=<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"hello"</span>,<span style="color: #ff1493; font-size: 140%;">)</span>, name=<span style="color: #87af5f;">'Thread-A'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
t.start<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">tl.name</span> = <span style="color: #87af5f;">'world'</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"in main:"</span>, tl.name<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
in main: world

</pre>
</div>
</div>


<div id="outline-container-org5dc32c1" class="outline-3">
<h3 id="org5dc32c1"><span class="section-number-3">2.7</span> 线程池</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> concurrent.futures <span style="color: #d787d7; font-weight: bold;">import</span> ThreadPoolExecutor
<span style="color: #d787d7; font-weight: bold;">import</span> urllib.request

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">fetch_url</span><span style="color: #ff8c00; font-size: 150%;">(</span>url<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">u</span> = urllib.request.urlopen<span style="color: #ff8c00; font-size: 150%;">(</span>url<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">data</span> = u.read<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">return</span> data

<span style="color: #5fafff;">pool</span> = ThreadPoolExecutor<span style="color: #ff8c00; font-size: 150%;">(</span>10<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Submit work to the pool</span>
<span style="color: #5fafff;">a</span> = pool.submit<span style="color: #ff8c00; font-size: 150%;">(</span>fetch_url, <span style="color: #87af5f;">'http://www.python.org'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">b</span> = pool.submit<span style="color: #ff8c00; font-size: 150%;">(</span>fetch_url, <span style="color: #87af5f;">'http://www.pypy.org'</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Get the results back</span>
<span style="color: #5fafff;">x</span> = a.result<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">y</span> = b.result<span style="color: #ff8c00; font-size: 150%;">()</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org07afa20" class="outline-2">
<h2 id="org07afa20"><span class="section-number-2">3</span> 数据结构</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgd314ca2" class="outline-3">
<h3 id="orgd314ca2"><span class="section-number-3">3.1</span> 列表</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org7e7b327" class="outline-4">
<h4 id="org7e7b327"><span class="section-number-4">3.1.1</span> 列表中删除数据的陷阱</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">lst</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'a'</span>, <span style="color: #87af5f;">'b'</span>, <span style="color: #87af5f;">'c'</span>, <span style="color: #87af5f;">''</span>, <span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">for</span> i <span style="color: #d787d7; font-weight: bold;">in</span> lst:
    <span style="color: #d787d7; font-weight: bold;">if</span> i <span style="color: #d787d7; font-weight: bold;">is</span> <span style="color: #87af5f;">''</span>:
        lst.remove<span style="color: #ff8c00; font-size: 150%;">(</span>i<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>lst<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
['a', 'b', 'c', '']

</pre>
</div>

<div id="outline-container-org214f3f8" class="outline-5">
<h5 id="org214f3f8"><span class="section-number-5">3.1.1.1</span> 原理</h5>
<div class="outline-text-5" id="text-3-1-1-1">
<p>
list 属于线性表，它的连续在于用一块连续的内存空间存储元素，在调用 <code>remove</code> 时，只是删除了地址内的元素。
</p>

<p>
回到问题，当删除列表中的元素时， <code>for in</code> 是对下标进行操作，而 <code>remove</code> 是对值进行操作, 当 <code>for</code> 到达索引为 3 ，即第一个空字符位置时，符合条件即删除。因为 list 是线性表，所以删除这个空字符时， <b>同时后面的所有元素自动移动位置 1</b> ，此时的 lst 等于 <code>['a', 'b', 'c', '']</code> ，因为 <code>for in</code> 已经遍历到了索引 3 处，所以循环结束。
</p>
</div>
</div>

<div id="outline-container-orge7d766a" class="outline-5">
<h5 id="orge7d766a"><span class="section-number-5">3.1.1.2</span> 解决方法</h5>
<div class="outline-text-5" id="text-3-1-1-2">
<div class="org-src-container">
<pre class="src src-ipython">
<span style="color: #5fafff;">lst</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'a'</span>,<span style="color: #87af5f;">''</span>,<span style="color: #87af5f;">'b'</span>,<span style="color: #87af5f;">''</span>,<span style="color: #87af5f;">'c'</span>,<span style="color: #87af5f;">''</span>,<span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#20570;&#27861;&#19968;</span>
<span style="color: #d787d7; font-weight: bold;">while</span> <span style="color: #87af5f;">''</span> <span style="color: #d787d7; font-weight: bold;">in</span> lst:
    lst.remove<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>lst<span style="color: #ff8c00; font-size: 150%;">)</span>


<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#20570;&#27861;&#20108;</span>

<span style="color: #5fafff;">lst_new</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>i <span style="color: #d787d7; font-weight: bold;">for</span> i <span style="color: #d787d7; font-weight: bold;">in</span> lst <span style="color: #d787d7; font-weight: bold;">if</span> i != <span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">]</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc2554e0" class="outline-4">
<h4 id="orgc2554e0"><span class="section-number-4">3.1.2</span> 列表中出现频率最高</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">words</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
   <span style="color: #87af5f;">'look'</span>, <span style="color: #87af5f;">'into'</span>, <span style="color: #87af5f;">'my'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">'look'</span>, <span style="color: #87af5f;">'into'</span>, <span style="color: #87af5f;">'my'</span>, <span style="color: #87af5f;">'eyes'</span>,
   <span style="color: #87af5f;">'the'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">'the'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">'the'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">'not'</span>, <span style="color: #87af5f;">'around'</span>, <span style="color: #87af5f;">'the'</span>,
   <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">"don't"</span>, <span style="color: #87af5f;">'look'</span>, <span style="color: #87af5f;">'around'</span>, <span style="color: #87af5f;">'the'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">'look'</span>, <span style="color: #87af5f;">'into'</span>,
   <span style="color: #87af5f;">'my'</span>, <span style="color: #87af5f;">'eyes'</span>, <span style="color: #87af5f;">"you're"</span>, <span style="color: #87af5f;">'under'</span>
<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> Counter
<span style="color: #5fafff;">word_counts</span> = Counter<span style="color: #ff8c00; font-size: 150%;">(</span>words<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">top_three</span> = word_counts.most_common<span style="color: #ff8c00; font-size: 150%;">(</span>3<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>top_three<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[('eyes', 8), ('the', 5), ('look', 4)]

</pre>
</div>
</div>


<div id="outline-container-orgfa4b008" class="outline-4">
<h4 id="orgfa4b008"><span class="section-number-4">3.1.3</span> 列表中最大或最小的几项</h4>
<div class="outline-text-4" id="text-3-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> heapq

<span style="color: #5fafff;">portfolio</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'IBM'</span>, <span style="color: #87af5f;">'shares'</span>: 100, <span style="color: #87af5f;">'price'</span>: 91.1<span style="color: #ff1493; font-size: 140%;">}</span>,
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'AAPL'</span>, <span style="color: #87af5f;">'shares'</span>: 50, <span style="color: #87af5f;">'price'</span>: 543.22<span style="color: #ff1493; font-size: 140%;">}</span>,
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'FB'</span>, <span style="color: #87af5f;">'shares'</span>: 200, <span style="color: #87af5f;">'price'</span>: 21.09<span style="color: #ff1493; font-size: 140%;">}</span>,
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'HPQ'</span>, <span style="color: #87af5f;">'shares'</span>: 35, <span style="color: #87af5f;">'price'</span>: 31.75<span style="color: #ff1493; font-size: 140%;">}</span>,
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'YHOO'</span>, <span style="color: #87af5f;">'shares'</span>: 45, <span style="color: #87af5f;">'price'</span>: 16.35<span style="color: #ff1493; font-size: 140%;">}</span>,
   <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'ACME'</span>, <span style="color: #87af5f;">'shares'</span>: 75, <span style="color: #87af5f;">'price'</span>: 115.65<span style="color: #ff1493; font-size: 140%;">}</span>
<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #5fafff;">cheap</span> = heapq.nsmallest<span style="color: #ff8c00; font-size: 150%;">(</span>3, portfolio, key=<span style="color: #d787d7; font-weight: bold;">lambda</span> s: s<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'price'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">expensive</span> = heapq.nlargest<span style="color: #ff8c00; font-size: 150%;">(</span>3, portfolio, key=<span style="color: #d787d7; font-weight: bold;">lambda</span> s: s<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'price'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">r</span> = <span style="color: #ff8c00; font-size: 150%;">{</span><span style="color: #87af5f;">'cheap'</span>: cheap, <span style="color: #87af5f;">'expensive'</span>: expensive<span style="color: #ff8c00; font-size: 150%;">}</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org7c908d0" class="outline-4">
<h4 id="org7c908d0"><span class="section-number-4">3.1.4</span> 对列表中的数据分组</h4>
<div class="outline-text-4" id="text-3-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">rows</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'5412 N CLARK'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/01/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'5148 N CLARK'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/04/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'5800 E 58TH'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/02/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'2122 N CLARK'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/03/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'5645 N RAVENSWOOD'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/02/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'1060 W ADDISON'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/02/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'4801 N BROADWAY'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/01/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
    <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'address'</span>: <span style="color: #87af5f;">'1039 W GRANVILLE'</span>, <span style="color: #87af5f;">'date'</span>: <span style="color: #87af5f;">'07/04/2012'</span><span style="color: #ff1493; font-size: 140%;">}</span>,
<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #d787d7; font-weight: bold;">from</span> itertools <span style="color: #d787d7; font-weight: bold;">import</span> groupby

rows.sort<span style="color: #ff8c00; font-size: 150%;">(</span>key=<span style="color: #d787d7; font-weight: bold;">lambda</span> r: r<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'date'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">for</span> date, items <span style="color: #d787d7; font-weight: bold;">in</span> groupby<span style="color: #ff8c00; font-size: 150%;">(</span>rows, key=<span style="color: #d787d7; font-weight: bold;">lambda</span> r: r<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'date'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>date<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">for</span> i <span style="color: #d787d7; font-weight: bold;">in</span> items:
        <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'    '</span>, i<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
07/01/2012
     {'address': '5412 N CLARK', 'date': '07/01/2012'}
     {'address': '4801 N BROADWAY', 'date': '07/01/2012'}
07/02/2012
     {'address': '5800 E 58TH', 'date': '07/02/2012'}
     {'address': '5645 N RAVENSWOOD', 'date': '07/02/2012'}
     {'address': '1060 W ADDISON', 'date': '07/02/2012'}
07/03/2012
     {'address': '2122 N CLARK', 'date': '07/03/2012'}
07/04/2012
     {'address': '5148 N CLARK', 'date': '07/04/2012'}
     {'address': '1039 W GRANVILLE', 'date': '07/04/2012'}
</pre>

<p>
或者使用 defaultdict 来实现：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> defaultdict
<span style="color: #5fafff;">rows_by_date</span> = defaultdict<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">for</span> row <span style="color: #d787d7; font-weight: bold;">in</span> rows:
    rows_by_date<span style="color: #ff8c00; font-size: 150%;">[</span>row<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'date'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">]</span>.append<span style="color: #ff8c00; font-size: 150%;">(</span>row<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>rows_by_date<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
defaultdict(&lt;class 'list'&gt;, {'07/01/2012': [{'address': '5412 N CLARK', 'date': '07/01/2012'}, {'address': '4801 N BROADWAY', 'date': '07/01/2012'}], '07/02/2012': [{'address': '5800 E 58TH', 'date': '07/02/2012'}, {'address': '5645 N RAVENSWOOD', 'date': '07/02/2012'}, {'address': '1060 W ADDISON', 'date': '07/02/2012'}], '07/03/2012': [{'address': '2122 N CLARK', 'date': '07/03/2012'}], '07/04/2012': [{'address': '5148 N CLARK', 'date': '07/04/2012'}, {'address': '1039 W GRANVILLE', 'date': '07/04/2012'}]})

</pre>
</div>
</div>


<div id="outline-container-org24e06d7" class="outline-4">
<h4 id="org24e06d7"><span class="section-number-4">3.1.5</span> 消除序列中的重复数据，同时保持数据顺序</h4>
<div class="outline-text-4" id="text-3-1-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">dedupe</span><span style="color: #ff8c00; font-size: 150%;">(</span>items, key=<span style="color: #d7875f; font-weight: bold;">None</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">seen</span> = <span style="color: #5fafff; font-weight: bold;">set</span><span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">for</span> item <span style="color: #d787d7; font-weight: bold;">in</span> items:
        <span style="color: #5fafff;">val</span> = item <span style="color: #d787d7; font-weight: bold;">if</span> key <span style="color: #d787d7; font-weight: bold;">is</span> <span style="color: #d7875f; font-weight: bold;">None</span> <span style="color: #d787d7; font-weight: bold;">else</span> key<span style="color: #ff8c00; font-size: 150%;">(</span>item<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">if</span> val <span style="color: #d787d7; font-weight: bold;">not</span> <span style="color: #d787d7; font-weight: bold;">in</span> seen:
            <span style="color: #d787d7; font-weight: bold;">yield</span> item
            seen.add<span style="color: #ff8c00; font-size: 150%;">(</span>val<span style="color: #ff8c00; font-size: 150%;">)</span>


<span style="color: #5fafff;">a</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
        <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'x'</span>: 2, <span style="color: #87af5f;">'y'</span>: 3<span style="color: #ff1493; font-size: 140%;">}</span>,
        <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'x'</span>: 1, <span style="color: #87af5f;">'y'</span>: 4<span style="color: #ff1493; font-size: 140%;">}</span>,
        <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'x'</span>: 2, <span style="color: #87af5f;">'y'</span>: 3<span style="color: #ff1493; font-size: 140%;">}</span>,
        <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'x'</span>: 2, <span style="color: #87af5f;">'y'</span>: 3<span style="color: #ff1493; font-size: 140%;">}</span>,
        <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'x'</span>: 10, <span style="color: #87af5f;">'y'</span>: 15<span style="color: #ff1493; font-size: 140%;">}</span>
    <span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>dedupe<span style="color: #7fff00; font-size: 130%;">(</span>a, key=<span style="color: #d787d7; font-weight: bold;">lambda</span> a: <span style="color: #00bfff; font-size: 120%;">(</span>a<span style="color: #ffff00; font-size: 110%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ffff00; font-size: 110%;">]</span>,a<span style="color: #ffff00; font-size: 110%;">[</span><span style="color: #87af5f;">'y'</span><span style="color: #ffff00; font-size: 110%;">]</span><span style="color: #00bfff; font-size: 120%;">)</span><span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[{'x': 2, 'y': 3}, {'x': 1, 'y': 4}, {'x': 10, 'y': 15}]

</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">dedupe</span><span style="color: #ff8c00; font-size: 150%;">(</span>items<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">seen</span> = <span style="color: #5fafff; font-weight: bold;">set</span><span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">for</span> item <span style="color: #d787d7; font-weight: bold;">in</span> items:
        <span style="color: #d787d7; font-weight: bold;">if</span> item <span style="color: #d787d7; font-weight: bold;">not</span> <span style="color: #d787d7; font-weight: bold;">in</span> seen:
            <span style="color: #d787d7; font-weight: bold;">yield</span> item
            seen.add<span style="color: #ff8c00; font-size: 150%;">(</span>item<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">a</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>1, 5, 2, 1, 9, 1, 5, 10<span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>dedupe<span style="color: #7fff00; font-size: 130%;">(</span>a<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[1, 5, 2, 9, 10]

</pre>
</div>
</div>


<div id="outline-container-org0ce200b" class="outline-4">
<h4 id="org0ce200b"><span class="section-number-4">3.1.6</span> 序列解包 (unpack)</h4>
<div class="outline-text-4" id="text-3-1-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">records</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
     <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'foo'</span>, 1, 2<span style="color: #ff1493; font-size: 140%;">)</span>,
     <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'bar'</span>, <span style="color: #87af5f;">'hello'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
     <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'foo'</span>, 3, 4<span style="color: #ff1493; font-size: 140%;">)</span>,
<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">do_foo</span><span style="color: #ff8c00; font-size: 150%;">(</span>x,y<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'foo'</span>, x, y<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">do_bar</span><span style="color: #ff8c00; font-size: 150%;">(</span>s<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'bar'</span>, s<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">for</span> tag, *args <span style="color: #d787d7; font-weight: bold;">in</span> records:
    <span style="color: #d787d7; font-weight: bold;">if</span> tag == <span style="color: #87af5f;">'foo'</span>:
        do_foo<span style="color: #ff8c00; font-size: 150%;">(</span>*args<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">elif</span> tag == <span style="color: #87af5f;">'bar'</span>:
        do_bar<span style="color: #ff8c00; font-size: 150%;">(</span>*args<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
foo 1 2
bar hello
foo 3 4

</pre>
</div>
</div>


<div id="outline-container-orgd04dde7" class="outline-4">
<h4 id="orgd04dde7"><span class="section-number-4">3.1.7</span> flatten 列表</h4>
<div class="outline-text-4" id="text-3-1-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> Iterable

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">flatten</span><span style="color: #ff8c00; font-size: 150%;">(</span>items, ignore_types=<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #5fafff; font-weight: bold;">str</span>, <span style="color: #5fafff; font-weight: bold;">bytes</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">for</span> x <span style="color: #d787d7; font-weight: bold;">in</span> items:
        <span style="color: #d787d7; font-weight: bold;">if</span> <span style="color: #5fafff; font-weight: bold;">isinstance</span><span style="color: #ff8c00; font-size: 150%;">(</span>x, Iterable<span style="color: #ff8c00; font-size: 150%;">)</span> <span style="color: #d787d7; font-weight: bold;">and</span> <span style="color: #d787d7; font-weight: bold;">not</span> <span style="color: #5fafff; font-weight: bold;">isinstance</span><span style="color: #ff8c00; font-size: 150%;">(</span>x, ignore_types<span style="color: #ff8c00; font-size: 150%;">)</span>:
            <span style="color: #d787d7; font-weight: bold;">yield</span> <span style="color: #d787d7; font-weight: bold;">from</span> flatten<span style="color: #ff8c00; font-size: 150%;">(</span>x<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            <span style="color: #d787d7; font-weight: bold;">yield</span> x

<span style="color: #5fafff;">items</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>1, 2, <span style="color: #ff1493; font-size: 140%;">[</span>3, 4, <span style="color: #7fff00; font-size: 130%;">[</span>5, 6<span style="color: #7fff00; font-size: 130%;">]</span>, 7<span style="color: #ff1493; font-size: 140%;">]</span>, 8<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Produces 1 2 3 4 5 6 7 8</span>
<span style="color: #d787d7; font-weight: bold;">for</span> x <span style="color: #d787d7; font-weight: bold;">in</span> flatten<span style="color: #ff8c00; font-size: 150%;">(</span>items<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>x<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">items</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'Dave'</span>, <span style="color: #87af5f;">'Paula'</span>, <span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'Thomas'</span>, <span style="color: #87af5f;">'Lewis'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">for</span> x <span style="color: #d787d7; font-weight: bold;">in</span> flatten<span style="color: #ff8c00; font-size: 150%;">(</span>items<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>x<span style="color: #ff8c00; font-size: 150%;">)</span>

</pre>
</div>

<pre class="example">
1
2
3
4
5
6
7
8
Dave
Paula
Thomas
Lewis
</pre>
</div>
</div>
</div>


<div id="outline-container-org371e7e8" class="outline-3">
<h3 id="org371e7e8"><span class="section-number-3">3.2</span> 字典</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org201ec44" class="outline-4">
<h4 id="org201ec44"><span class="section-number-4">3.2.1</span> 对字典作集合运算</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">a</span> = <span style="color: #ff8c00; font-size: 150%;">{</span>
   <span style="color: #87af5f;">'x'</span> : 1,
   <span style="color: #87af5f;">'y'</span> : 2,
   <span style="color: #87af5f;">'z'</span> : 3
<span style="color: #ff8c00; font-size: 150%;">}</span>

<span style="color: #5fafff;">b</span> = <span style="color: #ff8c00; font-size: 150%;">{</span>
   <span style="color: #87af5f;">'w'</span> : 10,
   <span style="color: #87af5f;">'x'</span> : 11,
   <span style="color: #87af5f;">'y'</span> : 2
<span style="color: #ff8c00; font-size: 150%;">}</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Common keys:'</span>, a.keys<span style="color: #ff1493; font-size: 140%;">()</span> &amp; b.keys<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Keys in a not in b:'</span>, a.keys<span style="color: #ff1493; font-size: 140%;">()</span> - b.keys<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'(key,value) pairs in common:'</span>, a.items<span style="color: #ff1493; font-size: 140%;">()</span> &amp; b.items<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
Common keys: {'y', 'x'}
Keys in a not in b: {'z'}
(key,value) pairs in common: {('y', 2)}

</pre>
</div>
</div>


<div id="outline-container-org0ed5154" class="outline-4">
<h4 id="org0ed5154"><span class="section-number-4">3.2.2</span> 组合多个字典当作一个字典使用</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">a</span> = <span style="color: #ff8c00; font-size: 150%;">{</span><span style="color: #87af5f;">'x'</span>: 1, <span style="color: #87af5f;">'z'</span>: 3 <span style="color: #ff8c00; font-size: 150%;">}</span>
<span style="color: #5fafff;">b</span> = <span style="color: #ff8c00; font-size: 150%;">{</span><span style="color: #87af5f;">'y'</span>: 2, <span style="color: #87af5f;">'z'</span>: 4 <span style="color: #ff8c00; font-size: 150%;">}</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(a) Simple example of combining</span>
<span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> ChainMap
<span style="color: #5fafff;">c</span> = ChainMap<span style="color: #ff8c00; font-size: 150%;">(</span>a,b<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"c:"</span>, c<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>c<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>      <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Outputs 1  (from a)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>c<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'y'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>      <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Outputs 2  (from b)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>c<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'z'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>      <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Outputs 3  (from a)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Output some common values</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'len(c):'</span>, <span style="color: #5fafff; font-weight: bold;">len</span><span style="color: #ff1493; font-size: 140%;">(</span>c<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'c.keys():'</span>, <span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>c.keys<span style="color: #7fff00; font-size: 130%;">()</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'c.values():'</span>, <span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>c.values<span style="color: #7fff00; font-size: 130%;">()</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Modify some values</span>
<span style="color: #5fafff;">c</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'z'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = 10
<span style="color: #5fafff;">c</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'w'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = 40
<span style="color: #d787d7; font-weight: bold;">del</span> c<span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"a:"</span>, a<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
c: ChainMap({'x': 1, 'z': 3}, {'y': 2, 'z': 4})
1
2
3
len(c): 3
c.keys(): ['z', 'y', 'x']
c.values(): [3, 2, 1]
a: {'z': 10, 'w': 40}

</pre>
</div>
</div>


<div id="outline-container-orgb414ded" class="outline-4">
<h4 id="orgb414ded"><span class="section-number-4">3.2.3</span> 字典栈</h4>
<div class="outline-text-4" id="text-3-2-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Example of stacking mappings (like scopes)</span>
<span style="color: #5fafff;">values</span> = ChainMap<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">values</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = 1

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Add a new mapping</span>
<span style="color: #5fafff;">values</span> = values.new_child<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">values</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = 2

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Add a new mapping</span>
<span style="color: #5fafff;">values</span> = values.new_child<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">values</span><span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff8c00; font-size: 150%;">]</span> = 3

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Discard last mapping</span>
<span style="color: #5fafff;">values</span> = values.parents
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Discard last mapping</span>
<span style="color: #5fafff;">values</span> = values.parents
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>values<span style="color: #ff1493; font-size: 140%;">[</span><span style="color: #87af5f;">'x'</span><span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
ChainMap({'x': 3}, {'x': 2}, {'x': 1})
3
ChainMap({'x': 2}, {'x': 1})
2
ChainMap({'x': 1})
1

</pre>
</div>
</div>
</div>


<div id="outline-container-orgcd21b5a" class="outline-3">
<h3 id="orgcd21b5a"><span class="section-number-3">3.3</span> 队列</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orgc213428" class="outline-4">
<h4 id="orgc213428"><span class="section-number-4">3.3.1</span> 优先队列</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> heapq

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">PriorityQueue</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>._queue = <span style="color: #ff8c00; font-size: 150%;">[]</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>._index = 0

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">push</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, item, priority<span style="color: #ff8c00; font-size: 150%;">)</span>:
        heapq.heappush<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>._queue, <span style="color: #ff1493; font-size: 140%;">(</span>-priority, <span style="color: #d787d7; font-weight: bold;">self</span>._index, item<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>._index += 1

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">pop</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">return</span> heapq.heappop<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>._queue<span style="color: #ff8c00; font-size: 150%;">)[</span>-1<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Example use</span>
<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Item</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, name<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.name = name
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__repr__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #87af5f;">'Item({!r})'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>.name<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">q</span> = PriorityQueue<span style="color: #ff8c00; font-size: 150%;">()</span>
q.push<span style="color: #ff8c00; font-size: 150%;">(</span>Item<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'foo'</span><span style="color: #ff1493; font-size: 140%;">)</span>, 1<span style="color: #ff8c00; font-size: 150%;">)</span>
q.push<span style="color: #ff8c00; font-size: 150%;">(</span>Item<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'bar'</span><span style="color: #ff1493; font-size: 140%;">)</span>, 5<span style="color: #ff8c00; font-size: 150%;">)</span>
q.push<span style="color: #ff8c00; font-size: 150%;">(</span>Item<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'spam'</span><span style="color: #ff1493; font-size: 140%;">)</span>, 4<span style="color: #ff8c00; font-size: 150%;">)</span>
q.push<span style="color: #ff8c00; font-size: 150%;">(</span>Item<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'grok'</span><span style="color: #ff1493; font-size: 140%;">)</span>, 1<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Should be bar:"</span>, q.pop<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Should be spam:"</span>, q.pop<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Should be foo:"</span>, q.pop<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Should be grok:"</span>, q.pop<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
Should be bar: Item('bar')
Should be spam: Item('spam')
Should be foo: Item('foo')
Should be grok: Item('grok')

</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-orgfd77e35" class="outline-2">
<h2 id="orgfd77e35"><span class="section-number-2">4</span> IO</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org419484c" class="outline-3">
<h3 id="org419484c"><span class="section-number-3">4.1</span> 文件</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org621d272" class="outline-4">
<h4 id="org621d272"><span class="section-number-4">4.1.1</span> 将文件描述符包装成文件对象</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> socket <span style="color: #d787d7; font-weight: bold;">import</span> socket, AF_INET, SOCK_STREAM

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">echo_client</span><span style="color: #ff8c00; font-size: 150%;">(</span>client_sock, addr<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Got connection from"</span>, addr<span style="color: #ff8c00; font-size: 150%;">)</span>

    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Make text-mode file wrappers for socket reading/writing</span>
    <span style="color: #5fafff;">client_in</span> = <span style="color: #5fafff; font-weight: bold;">open</span><span style="color: #ff8c00; font-size: 150%;">(</span>client_sock.fileno<span style="color: #ff1493; font-size: 140%;">()</span>, <span style="color: #87af5f;">'rt'</span>, encoding=<span style="color: #87af5f;">'latin-1'</span>, closefd=<span style="color: #d7875f; font-weight: bold;">False</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #5fafff;">client_out</span> = <span style="color: #5fafff; font-weight: bold;">open</span><span style="color: #ff8c00; font-size: 150%;">(</span>client_sock.fileno<span style="color: #ff1493; font-size: 140%;">()</span>, <span style="color: #87af5f;">'wt'</span>, encoding=<span style="color: #87af5f;">'latin-1'</span>, closefd=<span style="color: #d7875f; font-weight: bold;">False</span><span style="color: #ff8c00; font-size: 150%;">)</span>

    <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Echo lines back to the client using file I/O</span>
    <span style="color: #d787d7; font-weight: bold;">for</span> line <span style="color: #d787d7; font-weight: bold;">in</span> client_in:
        client_out.write<span style="color: #ff8c00; font-size: 150%;">(</span>line<span style="color: #ff8c00; font-size: 150%;">)</span>
        client_out.flush<span style="color: #ff8c00; font-size: 150%;">()</span>
    client_sock.close<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">echo_server</span><span style="color: #ff8c00; font-size: 150%;">(</span>address<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">sock</span> = socket<span style="color: #ff8c00; font-size: 150%;">(</span>AF_INET, SOCK_STREAM<span style="color: #ff8c00; font-size: 150%;">)</span>
    sock.bind<span style="color: #ff8c00; font-size: 150%;">(</span>address<span style="color: #ff8c00; font-size: 150%;">)</span>
    sock.listen<span style="color: #ff8c00; font-size: 150%;">(</span>1<span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">while</span> <span style="color: #d7875f; font-weight: bold;">True</span>:
        <span style="color: #5fafff;">client</span>, <span style="color: #5fafff;">addr</span> = sock.accept<span style="color: #ff8c00; font-size: 150%;">()</span>
        echo_client<span style="color: #ff8c00; font-size: 150%;">(</span>client, addr<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Echo serving running on localhost:25000'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
echo_server<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">''</span>, 25000<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2ee916" class="outline-4">
<h4 id="orgd2ee916"><span class="section-number-4">4.1.2</span> 改变已打开文件的编码方式</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Example of adding a text encoding to existing file-like object</span>

<span style="color: #d787d7; font-weight: bold;">import</span> urllib.request
<span style="color: #d787d7; font-weight: bold;">import</span> io

<span style="color: #5fafff;">u</span> = urllib.request.urlopen<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'http://www.python.org'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">f</span> = io.TextIOWrapper<span style="color: #ff8c00; font-size: 150%;">(</span>u, encoding=<span style="color: #87af5f;">'utf-8'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">text</span> = f.read<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>text<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge8622cc" class="outline-3">
<h3 id="orge8622cc"><span class="section-number-3">4.2</span> 内存 IO</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org8c4d01f" class="outline-4">
<h4 id="org8c4d01f"><span class="section-number-4">4.2.1</span> 内存字符串</h4>
<div class="outline-text-4" id="text-4-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> io <span style="color: #d787d7; font-weight: bold;">import</span> StringIO
<span style="color: #5fafff;">f</span> = StringIO<span style="color: #ff8c00; font-size: 150%;">()</span>
f.write<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'hello'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
f.write<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">' '</span><span style="color: #ff8c00; font-size: 150%;">)</span>
f.write<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'world!'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>f.getvalue<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">f</span> = StringIO<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Hello!\nHi!\nGoodbye!'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">while</span> <span style="color: #d7875f; font-weight: bold;">True</span>:
    <span style="color: #5fafff;">s</span> = f.readline<span style="color: #ff8c00; font-size: 150%;">()</span>
    <span style="color: #d787d7; font-weight: bold;">if</span> s == <span style="color: #87af5f;">''</span>:  <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">eof</span>
        <span style="color: #d787d7; font-weight: bold;">break</span>
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>s, end=<span style="color: #87af5f;">''</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga7dfbc5" class="outline-4">
<h4 id="orga7dfbc5"><span class="section-number-4">4.2.2</span> 内存比特流</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> io <span style="color: #d787d7; font-weight: bold;">import</span> BytesIO
<span style="color: #5fafff;">f</span> = BytesIO<span style="color: #ff8c00; font-size: 150%;">()</span>
f.write<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'&#20013;&#25991;'</span>.encode<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'utf-8'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>f.getvalue<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">f</span> = BytesIO<span style="color: #ff8c00; font-size: 150%;">(</span>b<span style="color: #87af5f;">'\xe4\xb8\xad\xe6\x96\x87'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">r</span> = f.read<span style="color: #ff8c00; font-size: 150%;">()</span>.decode<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'utf-8'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgbd62e06" class="outline-3">
<h3 id="orgbd62e06"><span class="section-number-3">4.3</span> 读写 JSON</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Some advanced JSON examples involving ordered dicts and classes</span>
<span style="color: #d787d7; font-weight: bold;">import</span> json

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Some JSON encoded text</span>
<span style="color: #5fafff;">s</span> = <span style="color: #87af5f;">'{"name": "ACME", "shares": 50, "price": 490.1}'</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(a) Turning JSON into an OrderedDict</span>

<span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> OrderedDict
<span style="color: #5fafff;">data</span> = json.loads<span style="color: #ff8c00; font-size: 150%;">(</span>s, object_pairs_hook=OrderedDict<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>data<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(b) Using JSON to populate an instance</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">JSONObject</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, d<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.__dict__ = d

<span style="color: #5fafff;">data</span> = json.loads<span style="color: #ff8c00; font-size: 150%;">(</span>s, object_hook=JSONObject<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>data.name<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>data.shares<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>data.price<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(c) Encoding instances</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Point</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, x, y<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>.x = x
        <span style="color: #d787d7; font-weight: bold;">self</span>.y = y

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">serialize_instance</span><span style="color: #ff8c00; font-size: 150%;">(</span>obj<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">d</span> = <span style="color: #ff8c00; font-size: 150%;">{</span> <span style="color: #87af5f;">'__classname__'</span> : <span style="color: #5fafff; font-weight: bold;">type</span><span style="color: #ff1493; font-size: 140%;">(</span>obj<span style="color: #ff1493; font-size: 140%;">)</span>.<span style="color: #5fafff; font-weight: bold;">__name__</span> <span style="color: #ff8c00; font-size: 150%;">}</span>
    d.update<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">vars</span><span style="color: #ff1493; font-size: 140%;">(</span>obj<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">return</span> d

<span style="color: #5fafff;">p</span> = Point<span style="color: #ff8c00; font-size: 150%;">(</span>3,4<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">s</span> = json.dumps<span style="color: #ff8c00; font-size: 150%;">(</span>p, default=serialize_instance<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>s<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(d) Decoding instances</span>
<span style="color: #5fafff;">classes</span> = <span style="color: #ff8c00; font-size: 150%;">{</span>
    <span style="color: #87af5f;">'Point'</span> : Point
<span style="color: #ff8c00; font-size: 150%;">}</span>

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">unserialize_object</span><span style="color: #ff8c00; font-size: 150%;">(</span>d<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">clsname</span> = d.pop<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'__classname__'</span>, <span style="color: #d7875f; font-weight: bold;">None</span><span style="color: #ff8c00; font-size: 150%;">)</span>
    <span style="color: #d787d7; font-weight: bold;">if</span> clsname:
        <span style="color: #5fafff;">cls</span> = classes<span style="color: #ff8c00; font-size: 150%;">[</span>clsname<span style="color: #ff8c00; font-size: 150%;">]</span>
        <span style="color: #5fafff;">obj</span> = cls.__new__<span style="color: #ff8c00; font-size: 150%;">(</span>cls<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">for</span> key, value <span style="color: #d787d7; font-weight: bold;">in</span> d.items<span style="color: #ff8c00; font-size: 150%;">()</span>:
            <span style="color: #5fafff; font-weight: bold;">setattr</span><span style="color: #ff8c00; font-size: 150%;">(</span>obj, key, value<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> obj
    <span style="color: #d787d7; font-weight: bold;">else</span>:
        <span style="color: #d787d7; font-weight: bold;">return</span> d

<span style="color: #5fafff;">a</span> = json.loads<span style="color: #ff8c00; font-size: 150%;">(</span>s, object_hook=unserialize_object<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>a<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>a.x<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>a.y<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
OrderedDict([('name', 'ACME'), ('shares', 50), ('price', 490.1)])
ACME
50
490.1
{"__classname__": "Point", "x": 3, "y": 4}
&lt;__main__.Point object at 0x1086228d0&gt;
3
4

</pre>
</div>
</div>
</div>


<div id="outline-container-orgabc06b6" class="outline-2">
<h2 id="orgabc06b6"><span class="section-number-2">5</span> 模块</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org3e21342" class="outline-3">
<h3 id="org3e21342"><span class="section-number-3">5.1</span> 猴子补丁</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> importlib
<span style="color: #d787d7; font-weight: bold;">import</span> sys
<span style="color: #d787d7; font-weight: bold;">from</span> collections <span style="color: #d787d7; font-weight: bold;">import</span> defaultdict

<span style="color: #5fafff;">_post_import_hooks</span> = defaultdict<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">PostImportFinder</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>._skip = <span style="color: #5fafff; font-weight: bold;">set</span><span style="color: #ff8c00; font-size: 150%;">()</span>

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">find_module</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, fullname, path=<span style="color: #d7875f; font-weight: bold;">None</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> fullname <span style="color: #d787d7; font-weight: bold;">in</span> <span style="color: #d787d7; font-weight: bold;">self</span>._skip:
            <span style="color: #d787d7; font-weight: bold;">return</span> <span style="color: #d7875f; font-weight: bold;">None</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>._skip.add<span style="color: #ff8c00; font-size: 150%;">(</span>fullname<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> PostImportLoader<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">PostImportLoader</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">__init__</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, finder<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">self</span>._finder = finder

    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">load_module</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #d787d7; font-weight: bold;">self</span>, fullname<span style="color: #ff8c00; font-size: 150%;">)</span>:
        importlib.import_module<span style="color: #ff8c00; font-size: 150%;">(</span>fullname<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #5fafff;">module</span> = sys.modules<span style="color: #ff8c00; font-size: 150%;">[</span>fullname<span style="color: #ff8c00; font-size: 150%;">]</span>
        <span style="color: #d787d7; font-weight: bold;">for</span> func <span style="color: #d787d7; font-weight: bold;">in</span> _post_import_hooks<span style="color: #ff8c00; font-size: 150%;">[</span>fullname<span style="color: #ff8c00; font-size: 150%;">]</span>:
            func<span style="color: #ff8c00; font-size: 150%;">(</span>module<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">self</span>._finder._skip.remove<span style="color: #ff8c00; font-size: 150%;">(</span>fullname<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> module

<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">when_imported</span><span style="color: #ff8c00; font-size: 150%;">(</span>fullname<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">decorate</span><span style="color: #ff8c00; font-size: 150%;">(</span>func<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #d787d7; font-weight: bold;">if</span> fullname <span style="color: #d787d7; font-weight: bold;">in</span> sys.modules:
            func<span style="color: #ff8c00; font-size: 150%;">(</span>sys.modules<span style="color: #ff1493; font-size: 140%;">[</span>fullname<span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">else</span>:
            _post_import_hooks<span style="color: #ff8c00; font-size: 150%;">[</span>fullname<span style="color: #ff8c00; font-size: 150%;">]</span>.append<span style="color: #ff8c00; font-size: 150%;">(</span>func<span style="color: #ff8c00; font-size: 150%;">)</span>
        <span style="color: #d787d7; font-weight: bold;">return</span> func
    <span style="color: #d787d7; font-weight: bold;">return</span> decorate

sys.meta_path.insert<span style="color: #ff8c00; font-size: 150%;">(</span>0, PostImportFinder<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">@when_imported</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'threading'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">warn_threads</span><span style="color: #ff8c00; font-size: 150%;">(</span>mod<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Threads? Are you crazy?'</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">import</span> threading
</pre>
</div>
</div>
</div>


<div id="outline-container-org88b3e9d" class="outline-3">
<h3 id="org88b3e9d"><span class="section-number-3">5.2</span> 将模块拆分出多个文件</h3>
<div class="outline-text-3" id="text-5-2">
<p>
模块 mymodule 目录结构：
</p>

<pre class="example">
mymodule
├── __init__.py
├── a.py
└── b.py
</pre>

<p>
<code>__init__.py</code> 文件内容:
</p>

<pre class="example">
from .a import A
from .b import B
</pre>

<p>
<code>a.py</code> 文件内容：
</p>

<pre class="example">
class A:
    def spam(self):
        print('A.spam')
</pre>

<p>
<code>b.py</code> 文件内容：
</p>

<pre class="example">
from .a import A

class B(A):
    def bar(self):
        print('B.bar')
</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> mymodule
<span style="color: #5fafff;">a</span> = mymodule.A<span style="color: #ff8c00; font-size: 150%;">()</span>
a.spam<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #5fafff;">b</span> = mymodule.B<span style="color: #ff8c00; font-size: 150%;">()</span>
b.bar<span style="color: #ff8c00; font-size: 150%;">()</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org66462c0" class="outline-2">
<h2 id="org66462c0"><span class="section-number-2">6</span> 数字，日期，时间</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgda5b5a9" class="outline-3">
<h3 id="orgda5b5a9"><span class="section-number-3">6.1</span> time 模块</h3>
<div class="outline-text-3" id="text-6-1">
<p>
time 模块始终返回 UTC 时间。
</p>
</div>

<div id="outline-container-org762a374" class="outline-4">
<h4 id="org762a374"><span class="section-number-4">6.1.1</span> 获取 Unix Timestamp</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
即从 Epoch (1970年1月1日00:00:00 UTC) 开始所经过的秒数。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> time
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>time.time<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48940fa" class="outline-4">
<h4 id="org48940fa"><span class="section-number-4">6.1.2</span> 获取具体时间值</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">current_time</span> = time.time<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">current_struct_time</span> = time.gmtime<span style="color: #ff8c00; font-size: 150%;">(</span>current_time<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>current_struct_time<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">current_year</span> = current_struct_time.tm_year
<span style="color: #5fafff;">current_mon</span>  = current_struct_time.tm_mon
<span style="color: #5fafff;">current_mday</span> = current_struct_time.tm_mday
<span style="color: #5fafff;">current_hour</span> = current_struct_time.tm_hour
<span style="color: #5fafff;">current_min</span>  = current_struct_time.tm_min
<span style="color: #5fafff;">r</span> = <span style="color: #ff8c00; font-size: 150%;">(</span>current_year, current_mon, current_mday, current_hour, current_min<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f9cce9" class="outline-3">
<h3 id="org9f9cce9"><span class="section-number-3">6.2</span> datetime 模块</h3>
<div class="outline-text-3" id="text-6-2">
<p>
datetime 模块简化了日期操作，如增加天数，设置时区等。
</p>
</div>

<div id="outline-container-org7878c42" class="outline-4">
<h4 id="org7878c42"><span class="section-number-4">6.2.1</span> 创建时间</h4>
<div class="outline-text-4" id="text-6-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> datetime
<span style="color: #5fafff;">d</span> = datetime.datetime<span style="color: #ff8c00; font-size: 150%;">(</span>year=2017, month=12, day=31, hour=12, minute=59, second=59<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">r</span> = <span style="color: #ff8c00; font-size: 150%;">(</span>d.year, d.month, d.day, d.hour, d.minute, d.second, d.microsecond<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org470896c" class="outline-4">
<h4 id="org470896c"><span class="section-number-4">6.2.2</span> 获取 UTC 时间</h4>
<div class="outline-text-4" id="text-6-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>datetime.datetime.utcnow<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfb76a5d" class="outline-4">
<h4 id="orgfb76a5d"><span class="section-number-4">6.2.3</span> 获取当前时区时间</h4>
<div class="outline-text-4" id="text-6-2-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>datetime.datetime.now<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae12f82" class="outline-4">
<h4 id="orgae12f82"><span class="section-number-4">6.2.4</span> 日期运算</h4>
<div class="outline-text-4" id="text-6-2-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">today</span> = datetime.datetime.now<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">diff</span> = datetime.timedelta<span style="color: #ff8c00; font-size: 150%;">(</span>weeks=3, days=2<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">future</span> = today + diff
<span style="color: #5fafff;">past</span> = today - diff
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #ff1493; font-size: 140%;">(</span>future, past<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdc75df9" class="outline-4">
<h4 id="orgdc75df9"><span class="section-number-4">6.2.5</span> 日期转字符串</h4>
<div class="outline-text-4" id="text-6-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">r</span> = <span style="color: #87af5f;">'{:%Y-%m-%d %H:%M}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff8c00; font-size: 150%;">(</span>datetime.datetime<span style="color: #ff1493; font-size: 140%;">(</span>2001, 2, 3, 4, 5<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgaf29084" class="outline-4">
<h4 id="orgaf29084"><span class="section-number-4">6.2.6</span> 字符串转日期</h4>
<div class="outline-text-4" id="text-6-2-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">r</span> = datetime.datetime.strptime<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"Mar 03, 2010"</span>, <span style="color: #87af5f;">"%b %d, %Y"</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaecb8e8" class="outline-3">
<h3 id="orgaecb8e8"><span class="section-number-3">6.3</span> 月份缩写</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> calendar <span style="color: #d787d7; font-weight: bold;">import</span> month_abbr
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>month_abbr<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgb28347a" class="outline-3">
<h3 id="orgb28347a"><span class="section-number-3">6.4</span> 数字精度格式化</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:06.2f}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>3.141592653589793<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:04d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>42<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:+d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>42<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{: d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>42<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{: d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>-42<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:=5d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #7fff00; font-size: 130%;">(</span>- 23<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:=+5d}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #7fff00; font-size: 130%;">(</span>23<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org5a78ad4" class="outline-2">
<h2 id="org5a78ad4"><span class="section-number-2">7</span> 字符串与文本</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org9cc3bbc" class="outline-3">
<h3 id="org9cc3bbc"><span class="section-number-3">7.1</span> 格式化</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orge5ce6b6" class="outline-4">
<h4 id="orge5ce6b6"><span class="section-number-4">7.1.1</span> 填充与对齐</h4>
<div class="outline-text-4" id="text-7-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:&gt;10}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'test'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:10}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'test'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:^10}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'test'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:_&lt;10}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'test'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org5a85e16" class="outline-4">
<h4 id="org5a85e16"><span class="section-number-4">7.1.2</span> 字符串截断</h4>
<div class="outline-text-4" id="text-7-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:.5}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'xylophone'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{:10.5}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'xylophone'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge4ef3ff" class="outline-4">
<h4 id="orge4ef3ff"><span class="section-number-4">7.1.3</span> 占位符</h4>
<div class="outline-text-4" id="text-7-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">data</span> = <span style="color: #ff8c00; font-size: 150%;">{</span><span style="color: #87af5f;">'first'</span>: <span style="color: #87af5f;">'Hodor'</span>, <span style="color: #87af5f;">'last'</span>: <span style="color: #87af5f;">'Hodor!'</span><span style="color: #ff8c00; font-size: 150%;">}</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{first} {last}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>**data<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{first} {last}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>first=<span style="color: #87af5f;">'Hodor'</span>, last=<span style="color: #87af5f;">'Hodor!'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">person</span> = <span style="color: #ff8c00; font-size: 150%;">{</span><span style="color: #87af5f;">'first'</span>: <span style="color: #87af5f;">'Jean-Luc'</span>, <span style="color: #87af5f;">'last'</span>: <span style="color: #87af5f;">'Picard'</span><span style="color: #ff8c00; font-size: 150%;">}</span>
<span style="color: #5fafff;">data</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>4, 8, 15, 16, 23, 42<span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">class</span> <span style="color: #5fafff;">Plant</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">object</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">category</span> = <span style="color: #87af5f;">'tree'</span>
    <span style="color: #5fafff;">kinds</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'oak'</span><span style="color: #ff1493; font-size: 140%;">}</span>, <span style="color: #ff1493; font-size: 140%;">{</span><span style="color: #87af5f;">'name'</span>: <span style="color: #87af5f;">'maple'</span><span style="color: #ff1493; font-size: 140%;">}</span><span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{p[first]} {p[last]}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>p=person<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{d[4]} {d[5]}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>d=data<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'{p.category}: {p.kinds[0][name]}'</span>.<span style="color: #5fafff; font-weight: bold;">format</span><span style="color: #ff1493; font-size: 140%;">(</span>p=Plant<span style="color: #7fff00; font-size: 130%;">()</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-org3bd3a8f" class="outline-4">
<h4 id="org3bd3a8f"><span class="section-number-4">7.1.4</span> 排版</h4>
<div class="outline-text-4" id="text-7-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> textwrap

<span style="color: #5fafff;">s</span> = <span style="color: #87af5f;">"Look into my eyes, look into my eyes, the eyes, the eyes, \</span>
<span style="color: #87af5f;">the eyes, not around the eyes, don't look around the eyes, \</span>
<span style="color: #87af5f;">look into my eyes, you're under."</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>textwrap.fill<span style="color: #ff1493; font-size: 140%;">(</span>s, 70<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>textwrap.fill<span style="color: #ff1493; font-size: 140%;">(</span>s, 40<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>textwrap.fill<span style="color: #ff1493; font-size: 140%;">(</span>s, 40, initial_indent=<span style="color: #87af5f;">'    '</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>textwrap.fill<span style="color: #ff1493; font-size: 140%;">(</span>s, 40, subsequent_indent=<span style="color: #87af5f;">'    '</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">()</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec659a4" class="outline-3">
<h3 id="orgec659a4"><span class="section-number-3">7.2</span> 字符串匹配</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org819f6be" class="outline-4">
<h4 id="org819f6be"><span class="section-number-4">7.2.1</span> 使用 shell 风格的通配符匹配字符串</h4>
<div class="outline-text-4" id="text-7-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> fnmatch <span style="color: #d787d7; font-weight: bold;">import</span> fnmatchcase <span style="color: #d787d7; font-weight: bold;">as</span> match

<span style="color: #5fafff;">addresses</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
    <span style="color: #87af5f;">'5412 N CLARK ST'</span>,
    <span style="color: #87af5f;">'1060 W ADDISON ST'</span>,
    <span style="color: #87af5f;">'1039 W GRANVILLE AVE'</span>,
    <span style="color: #87af5f;">'2122 N CLARK ST'</span>,
    <span style="color: #87af5f;">'4802 N BROADWAY'</span>,
<span style="color: #ff8c00; font-size: 150%;">]</span>

<span style="color: #5fafff;">a</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>addr <span style="color: #d787d7; font-weight: bold;">for</span> addr <span style="color: #d787d7; font-weight: bold;">in</span> addresses <span style="color: #d787d7; font-weight: bold;">if</span> match<span style="color: #ff1493; font-size: 140%;">(</span>addr, <span style="color: #87af5f;">'* ST'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>a<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">b</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>addr <span style="color: #d787d7; font-weight: bold;">for</span> addr <span style="color: #d787d7; font-weight: bold;">in</span> addresses <span style="color: #d787d7; font-weight: bold;">if</span> match<span style="color: #ff1493; font-size: 140%;">(</span>addr, <span style="color: #87af5f;">'54[0-9][0-9] *CLARK*'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>b<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org457e880" class="outline-4">
<h4 id="org457e880"><span class="section-number-4">7.2.2</span> 贪婪和非贪婪匹配</h4>
<div class="outline-text-4" id="text-7-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> re

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">Sample text</span>
<span style="color: #5fafff;">text</span> = <span style="color: #87af5f;">'Computer says "no." Phone says "yes."'</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(a) Regex that finds quoted strings - longest match</span>
<span style="color: #5fafff;">str_pat</span> = re.<span style="color: #5fafff; font-weight: bold;">compile</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #87af5f;">'\"(.*)\"'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>str_pat.findall<span style="color: #ff1493; font-size: 140%;">(</span>text<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">(b) Regex that finds quoted strings - shortest match</span>
<span style="color: #5fafff;">str_pat</span> = re.<span style="color: #5fafff; font-weight: bold;">compile</span><span style="color: #ff8c00; font-size: 150%;">(</span>r<span style="color: #87af5f;">'\"(.*?)\"'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>str_pat.findall<span style="color: #ff1493; font-size: 140%;">(</span>text<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org65a153a" class="outline-3">
<h3 id="org65a153a"><span class="section-number-3">7.3</span> 密码输入</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> getpass

<span style="color: #5fafff;">user</span> = getpass.getuser<span style="color: #ff8c00; font-size: 150%;">()</span>
<span style="color: #5fafff;">passwd</span> = getpass.getpass<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'User:'</span>, user<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'Passwd:'</span>, passwd<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgd267306" class="outline-2">
<h2 id="orgd267306"><span class="section-number-2">8</span> 网络</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org4528a4e" class="outline-3">
<h3 id="org4528a4e"><span class="section-number-3">8.1</span> netaddr</h3>
<div class="outline-text-3" id="text-8-1">
<p>
netaddr 有两个基本类： <code>IPAddress</code> 和 <code>IPNetwork</code>
</p>
</div>

<div id="outline-container-org8502441" class="outline-4">
<h4 id="org8502441"><span class="section-number-4">8.1.1</span> IP 地址操作</h4>
<div class="outline-text-4" id="text-8-1-1">
</div>
<div id="outline-container-org0e94cdb" class="outline-5">
<h5 id="org0e94cdb"><span class="section-number-5">8.1.1.1</span> 定义网络</h5>
<div class="outline-text-5" id="text-8-1-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> netaddr <span style="color: #d787d7; font-weight: bold;">import</span> IPAddress, IPNetwork
<span style="color: #5fafff;">nw</span> = IPNetwork<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'192.168.0.1/24'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.0.1/24

</pre>
</div>
</div>

<div id="outline-container-org1d679d0" class="outline-5">
<h5 id="org1d679d0"><span class="section-number-5">8.1.1.2</span> 网络掩码</h5>
<div class="outline-text-5" id="text-8-1-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw.netmask<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
255.255.255.0

</pre>
</div>
</div>

<div id="outline-container-org2ed46ee" class="outline-5">
<h5 id="org2ed46ee"><span class="section-number-5">8.1.1.3</span> 广播地址</h5>
<div class="outline-text-5" id="text-8-1-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw.broadcast<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.0.255

</pre>
</div>
</div>

<div id="outline-container-org34d9edb" class="outline-5">
<h5 id="org34d9edb"><span class="section-number-5">8.1.1.4</span> 网络地址</h5>
<div class="outline-text-5" id="text-8-1-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw.network<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.0.0

</pre>
</div>
</div>

<div id="outline-container-org10a3145" class="outline-5">
<h5 id="org10a3145"><span class="section-number-5">8.1.1.5</span> 主机掩码</h5>
<div class="outline-text-5" id="text-8-1-1-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw.hostmask<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
0.0.0.255

</pre>
</div>
</div>

<div id="outline-container-orge518457" class="outline-5">
<h5 id="orge518457"><span class="section-number-5">8.1.1.6</span> 网段包含主机数量</h5>
<div class="outline-text-5" id="text-8-1-1-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw.size<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
256

</pre>
</div>
</div>

<div id="outline-container-orgf8ad7fa" class="outline-5">
<h5 id="orgf8ad7fa"><span class="section-number-5">8.1.1.7</span> 获取所有主机地址</h5>
<div class="outline-text-5" id="text-8-1-1-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> itertools
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>itertools.islice<span style="color: #7fff00; font-size: 130%;">(</span>nw.iter_hosts<span style="color: #00bfff; font-size: 120%;">()</span>, 3<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[IPAddress('192.168.0.1'), IPAddress('192.168.0.2'), IPAddress('192.168.0.3')]

</pre>
</div>
</div>

<div id="outline-container-org3d736f2" class="outline-5">
<h5 id="org3d736f2"><span class="section-number-5">8.1.1.8</span> 将 IP 地址所在网段根据掩码长度划分子网</h5>
<div class="outline-text-5" id="text-8-1-1-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">subnets</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>x <span style="color: #d787d7; font-weight: bold;">for</span> x <span style="color: #d787d7; font-weight: bold;">in</span> nw.subnet<span style="color: #ff1493; font-size: 140%;">(</span>30<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">]</span> <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#20998;&#20026;&#25513;&#30721;&#38271;&#24230;&#20026; 30 &#30340;&#20960;&#20010;&#23376;&#32593;</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>subnets<span style="color: #ff1493; font-size: 140%;">[</span>:3<span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[IPNetwork('192.168.0.0/30'), IPNetwork('192.168.0.4/30'), IPNetwork('192.168.0.8/30')]

</pre>
</div>
</div>


<div id="outline-container-org932a2a8" class="outline-5">
<h5 id="org932a2a8"><span class="section-number-5">8.1.1.9</span> 修改掩码长度</h5>
<div class="outline-text-5" id="text-8-1-1-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">nw.prefixlen</span> = 28
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>nw<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.0.1/28

</pre>
</div>
</div>


<div id="outline-container-org1a96fee" class="outline-5">
<h5 id="org1a96fee"><span class="section-number-5">8.1.1.10</span> 判断公私网</h5>
<div class="outline-text-5" id="text-8-1-1-10">
<div class="org-src-container">
<pre class="src src-ipython">log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"IPAddress('10.74.68.58').is_private()"</span>, IPAddress<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'10.74.68.58'</span><span style="color: #ff1493; font-size: 140%;">)</span>.is_private<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"IPAddress('1.1.1.2').is_private()"</span>, IPAddress<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'1.1.1.2'</span><span style="color: #ff1493; font-size: 140%;">)</span>.is_private<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
 IPAddress('10.74.68.58').is_private()
True
 IPAddress('1.1.1.2').is_private()
False

</pre>
</div>
</div>


<div id="outline-container-org542086b" class="outline-5">
<h5 id="org542086b"><span class="section-number-5">8.1.1.11</span> 定义网段地址范围</h5>
<div class="outline-text-5" id="text-8-1-1-11">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> netaddr <span style="color: #d787d7; font-weight: bold;">import</span> IPRange
<span style="color: #5fafff;">ipRange</span> = IPRange<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'192.168.1.10'</span>, <span style="color: #87af5f;">'192.168.1.130'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipRange<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.1.10-192.168.1.130

</pre>
</div>
</div>


<div id="outline-container-org7104c19" class="outline-5">
<h5 id="org7104c19"><span class="section-number-5">8.1.1.12</span> 地址聚合</h5>
<div class="outline-text-5" id="text-8-1-1-12">
</div>
<div id="outline-container-orgd84dae1" class="outline-6">
<h6 id="orgd84dae1"><span class="section-number-6">8.1.1.12.1</span> IPRange</h6>
<div class="outline-text-6" id="text-8-1-1-12-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipRange.cidrs<span style="color: #ff1493; font-size: 140%;">()</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[IPNetwork('192.168.1.10/31'), IPNetwork('192.168.1.12/30'), IPNetwork('192.168.1.16/28'), IPNetwork('192.168.1.32/27'), IPNetwork('192.168.1.64/26'), IPNetwork('192.168.1.128/31'), IPNetwork('192.168.1.130/32')]

</pre>
</div>
</div>


<div id="outline-container-org46c1ab7" class="outline-6">
<h6 id="org46c1ab7"><span class="section-number-6">8.1.1.12.2</span> cidr_merge</h6>
<div class="outline-text-6" id="text-8-1-1-12-2">
<p>
这个方法可以用于路由汇总的计算
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> netaddr <span style="color: #d787d7; font-weight: bold;">import</span> cidr_merge
<span style="color: #5fafff;">ip_list</span> = <span style="color: #ff8c00; font-size: 150%;">[]</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.1.0/25"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.1.128/25"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.0.0/24"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.3.0/26"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.3.64/26"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>cidr_merge<span style="color: #ff1493; font-size: 140%;">(</span>ip_list<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

</pre>
</div>

<pre class="example">
[IPNetwork('192.168.0.0/23'), IPNetwork('192.168.3.0/25')]

</pre>
</div>
</div>
</div>


<div id="outline-container-org19403e2" class="outline-5">
<h5 id="org19403e2"><span class="section-number-5">8.1.1.13</span> 地址加减</h5>
<div class="outline-text-5" id="text-8-1-1-13">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">ip</span> = IPAddress<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'172.20.1.1'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">ip</span> += 256
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ip<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">ip</span> -= 3
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ip<span style="color: #ff8c00; font-size: 150%;">)</span>

</pre>
</div>

<pre class="example">
172.20.2.1
172.20.1.254

</pre>
</div>
</div>
</div>





<div id="outline-container-org68f0e87" class="outline-4">
<h4 id="org68f0e87"><span class="section-number-4">8.1.2</span> MAC 地址操作</h4>
<div class="outline-text-4" id="text-8-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">from</span> netaddr <span style="color: #d787d7; font-weight: bold;">import</span> *
<span style="color: #5fafff;">mac</span> = EUI<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'98:5a:eb:9f:35:f8'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">mac.dialect</span> = mac_unix
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"unix mac"</span>, mac<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">mac.dialect</span> = mac_cisco
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"cisco mac"</span>, mac<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">mac.dialect</span> = mac_bare
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"bare mac"</span>, mac<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
========== unix mac ==========
98:5a:eb:9f:35:f8
========= cisco mac ==========
985a.eb9f.35f8
========== bare mac ==========
985AEB9F35F8

</pre>
</div>

<div id="outline-container-org0f7f155" class="outline-5">
<h5 id="org0f7f155"><span class="section-number-5">8.1.2.1</span> 获取厂家信息</h5>
<div class="outline-text-5" id="text-8-1-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>mac.info<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
{'OUI': {'address': ['1 Infinite Loop', 'Cupertino  CA  95014', 'US'],
 'idx': 9984747,
 'offset': 750381,
 'org': 'Apple, Inc.',
 'oui': '98-5A-EB',
 'size': 123}}

</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-org3388e28" class="outline-3">
<h3 id="org3388e28"><span class="section-number-3">8.2</span> ipaddr</h3>
<div class="outline-text-3" id="text-8-2">
<p>
轻量级 IP 处理模块，不支持 MAC 地址处理。
</p>

<p>
Python3.3 起，加入标准库中，模块名为 <b>ipaddress</b>
</p>
</div>

<div id="outline-container-orgf035eb1" class="outline-4">
<h4 id="orgf035eb1"><span class="section-number-4">8.2.1</span> 定义地址</h4>
<div class="outline-text-4" id="text-8-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> ipaddr
<span style="color: #5fafff;">ipv4</span> = ipaddr.IPNetwork<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'192.168.33.83/28'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #5fafff;">ipv6</span> = ipaddr.IPNetwork<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">'2017:11:AF::17/56'</span><span style="color: #ff8c00; font-size: 150%;">)</span>
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"ipv4"</span>, ipv4<span style="color: #ff8c00; font-size: 150%;">)</span>
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"ipv6"</span>, ipv6<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
============ ipv4 ============
192.168.33.83/28
============ ipv6 ============
2017:11:af::17/56

</pre>
</div>
</div>

<div id="outline-container-org8f7dcc2" class="outline-4">
<h4 id="org8f7dcc2"><span class="section-number-4">8.2.2</span> 子网掩码</h4>
<div class="outline-text-4" id="text-8-2-2">
<div class="org-src-container">
<pre class="src src-ipython">log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"ipv4.netmask"</span>, ipv4.netmask<span style="color: #ff8c00; font-size: 150%;">)</span>
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"ipv6.netmask"</span>, ipv6.netmask<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
======== ipv4.netmask ========
255.255.255.240
======== ipv6.netmask ========
ffff:ffff:ffff:ff00::

</pre>
</div>
</div>


<div id="outline-container-orgc418ecb" class="outline-4">
<h4 id="orgc418ecb"><span class="section-number-4">8.2.3</span> 广播地址</h4>
<div class="outline-text-4" id="text-8-2-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipv4.broadcast<span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipv6.broadcast<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.33.95
2017:11:af:ff:ffff:ffff:ffff:ffff

</pre>
</div>
</div>


<div id="outline-container-orgc2350a9" class="outline-4">
<h4 id="orgc2350a9"><span class="section-number-4">8.2.4</span> 网络地址</h4>
<div class="outline-text-4" id="text-8-2-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipv4.network<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
192.168.33.80

</pre>
</div>
</div>


<div id="outline-container-org431e76f" class="outline-4">
<h4 id="org431e76f"><span class="section-number-4">8.2.5</span> 主机掩码</h4>
<div class="outline-text-4" id="text-8-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipv4.hostmask<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
0.0.0.15

</pre>
</div>
</div>


<div id="outline-container-org67f2f6b" class="outline-4">
<h4 id="org67f2f6b"><span class="section-number-4">8.2.6</span> 地址包含关系</h4>
<div class="outline-text-4" id="text-8-2-6">
<div class="org-src-container">
<pre class="src src-ipython">log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"ipaddr.IPAddress('192.168.33.84') in ipv4"</span>, ipaddr.IPAddress<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'192.168.33.84'</span><span style="color: #ff1493; font-size: 140%;">)</span> <span style="color: #d787d7; font-weight: bold;">in</span> ipv4<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
 ipaddr.IPAddress('192.168.33.84') in ipv4
True

</pre>
</div>
</div>


<div id="outline-container-orge9febf9" class="outline-4">
<h4 id="orge9febf9"><span class="section-number-4">8.2.7</span> 地址聚合</h4>
<div class="outline-text-4" id="text-8-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">ip_list</span> = <span style="color: #ff8c00; font-size: 150%;">[]</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.1.0/25"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.1.128/25"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.0.0/24"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.3.0/26"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
ip_list.append<span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.IPNetwork<span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">"192.168.3.64/26"</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
<span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>ipaddr.CollapseAddrList<span style="color: #ff1493; font-size: 140%;">(</span>ip_list<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[IPv4Network('192.168.0.0/23'), IPv4Network('192.168.3.0/25')]

</pre>
</div>
</div>
</div>




<div id="outline-container-orga61c2e1" class="outline-3">
<h3 id="orga61c2e1"><span class="section-number-3">8.3</span> <a href="https://networkx.github.io">networkx</a> (拓扑)</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-orgde5dfd9" class="outline-4">
<h4 id="orgde5dfd9"><span class="section-number-4">8.3.1</span> Dot</h4>
<div class="outline-text-4" id="text-8-3-1">
</div>
<div id="outline-container-org9547d45" class="outline-5">
<h5 id="org9547d45"><span class="section-number-5">8.3.1.1</span> 无向图</h5>
<div class="outline-text-5" id="text-8-3-1-1">

<div class="figure">
<p><img src="img/dot_graph.png" alt="dot_graph.png">
</p>
</div>
</div>
</div>


<div id="outline-container-orgcc11bfd" class="outline-5">
<h5 id="orgcc11bfd"><span class="section-number-5">8.3.1.2</span> 有向图</h5>
<div class="outline-text-5" id="text-8-3-1-2">

<div class="figure">
<p><img src="img/dot_digraph.png" alt="dot_digraph.png">
</p>
</div>
</div>
</div>


<div id="outline-container-org413dbfe" class="outline-5">
<h5 id="org413dbfe"><span class="section-number-5">8.3.1.3</span> 多重图</h5>
<div class="outline-text-5" id="text-8-3-1-3">

<div class="figure">
<p><img src="img/dot_multigraph.png" alt="dot_multigraph.png">
</p>
</div>
</div>
</div>
</div>



<div id="outline-container-org4bb2adf" class="outline-4">
<h4 id="org4bb2adf"><span class="section-number-4">8.3.2</span> 描述拓扑</h4>
<div class="outline-text-4" id="text-8-3-2">
<p>
networks 对拓扑分为有向图 (<code>nx.Graph()</code>) ，无向图 (<code>nx.DiGraph()</code>) 和多重图 (<code>nx.MultiGraph()</code>, <code>nx.MultiDiGraph()</code>) 。
</p>
</div>



<div id="outline-container-orgf66bea7" class="outline-5">
<h5 id="orgf66bea7"><span class="section-number-5">8.3.2.1</span> 无 weight 路径</h5>
<div class="outline-text-5" id="text-8-3-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">import</span> networkx <span style="color: #d787d7; font-weight: bold;">as</span> nx
<span style="color: #5fafff;">nodes</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'SH'</span>, <span style="color: #87af5f;">'GZ'</span>, <span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'XA'</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #5fafff;">G</span> = nx.Graph<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">for</span> node <span style="color: #d787d7; font-weight: bold;">in</span> nodes:
    G.add_node<span style="color: #ff8c00; font-size: 150%;">(</span>node<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">edges</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'SH'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'GZ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'SH'</span>, <span style="color: #87af5f;">'GZ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'SH'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'GZ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'SH'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'BJ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'SH'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'BJ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'GZ'</span><span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'BJ'</span><span style="color: #ff1493; font-size: 140%;">)</span>
<span style="color: #ff8c00; font-size: 150%;">]</span>

G.add_edges_from<span style="color: #ff8c00; font-size: 150%;">(</span>edges<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>


<div class="figure">
<p><img src="img/dot_graph_networkx.png" alt="dot_graph_networkx.png">
</p>
</div>
</div>
</div>

<div id="outline-container-orgf31ca06" class="outline-5">
<h5 id="orgf31ca06"><span class="section-number-5">8.3.2.2</span> 有 weight 路径</h5>
<div class="outline-text-5" id="text-8-3-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #5fafff;">nodes</span> = <span style="color: #ff8c00; font-size: 150%;">[</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'SH'</span>, <span style="color: #87af5f;">'GZ'</span>, <span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'XA'</span><span style="color: #ff8c00; font-size: 150%;">]</span>
<span style="color: #5fafff;">WG</span> = nx.Graph<span style="color: #ff8c00; font-size: 150%;">()</span>

<span style="color: #d787d7; font-weight: bold;">for</span> node <span style="color: #d787d7; font-weight: bold;">in</span> nodes:
    WG.add_node<span style="color: #ff8c00; font-size: 150%;">(</span>node<span style="color: #ff8c00; font-size: 150%;">)</span>

<span style="color: #5fafff;">edges</span> = <span style="color: #ff8c00; font-size: 150%;">[</span>
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'SH'</span>, 1200<span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'BJ'</span>, <span style="color: #87af5f;">'GZ'</span>, 2500<span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'SH'</span>, <span style="color: #87af5f;">'GZ'</span>, 1300<span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'SH'</span>, 280<span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'HZ'</span>, <span style="color: #87af5f;">'GZ'</span>, 1000<span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'SH'</span>, 300<span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'NJ'</span>, <span style="color: #87af5f;">'BJ'</span>, 900<span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'SH'</span>, 800<span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'BJ'</span>, 850<span style="color: #ff1493; font-size: 140%;">)</span>,

    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'GZ'</span>, 2600<span style="color: #ff1493; font-size: 140%;">)</span>,
    <span style="color: #ff1493; font-size: 140%;">(</span><span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'BJ'</span>, 2000<span style="color: #ff1493; font-size: 140%;">)</span>
<span style="color: #ff8c00; font-size: 150%;">]</span>

WG.add_weighted_edges_from<span style="color: #ff8c00; font-size: 150%;">(</span>edges<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<p>
可以动态修改链路 weight : <code>WG['HZ']['SH']['weight']=10000</code>
</p>


<div class="figure">
<p><img src="img/dot_graph_networkx_weight.png" alt="dot_graph_networkx_weight.png">
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org5188ad9" class="outline-4">
<h4 id="org5188ad9"><span class="section-number-4">8.3.3</span> 路径计算</h4>
<div class="outline-text-4" id="text-8-3-3">
</div>
<div id="outline-container-org8ced884" class="outline-5">
<h5 id="org8ced884"><span class="section-number-5">8.3.3.1</span> 最短路径计算</h5>
<div class="outline-text-5" id="text-8-3-3-1">
<div class="org-src-container">
<pre class="src src-ipython">log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"nx.shortest_path(WG, 'XA', 'HZ')"</span>, nx.shortest_path<span style="color: #ff1493; font-size: 140%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span>, weight=<span style="color: #d7875f; font-weight: bold;">None</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>  <span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#19981;&#32771;&#34385; weight&#65292;&#30456;&#24403;&#20110;&#25152;&#26377;&#36335;&#24452; weight &#37117;&#20026; 1</span>
log<span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #87af5f;">"nx.shortest_path(WG, 'XA', 'HZ', weight='weight')"</span>, nx.shortest_path<span style="color: #ff1493; font-size: 140%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span>, weight=<span style="color: #87af5f;">'weight'</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
 nx.shortest_path(WG, 'XA', 'HZ')
['XA', 'GZ', 'HZ']
 nx.shortest_path(WG, 'XA', 'HZ', weight='weight')
['XA', 'BJ', 'SH', 'HZ']

</pre>
</div>
</div>


<div id="outline-container-org9a19402" class="outline-5">
<h5 id="org9a19402"><span class="section-number-5">8.3.3.2</span> 等价路径计算</h5>
<div class="outline-text-5" id="text-8-3-3-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>nx.all_shortest_paths<span style="color: #7fff00; font-size: 130%;">(</span>G, <span style="color: #87af5f;">'WH'</span>, <span style="color: #87af5f;">'GZ'</span>, weight=<span style="color: #d7875f; font-weight: bold;">None</span><span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[['WH', 'SH', 'GZ'], ['WH', 'BJ', 'GZ']]

</pre>
</div>
</div>


<div id="outline-container-orgc21c3e9" class="outline-5">
<h5 id="orgc21c3e9"><span class="section-number-5">8.3.3.3</span> 可用路径</h5>
<div class="outline-text-5" id="text-8-3-3-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">for</span> p <span style="color: #d787d7; font-weight: bold;">in</span> nx.all_simple_paths<span style="color: #ff8c00; font-size: 150%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>p<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
['XA', 'GZ', 'BJ', 'SH', 'HZ']
['XA', 'GZ', 'BJ', 'NJ', 'SH', 'HZ']
['XA', 'GZ', 'BJ', 'WH', 'SH', 'HZ']
['XA', 'GZ', 'SH', 'HZ']
['XA', 'GZ', 'HZ']
['XA', 'BJ', 'SH', 'GZ', 'HZ']
['XA', 'BJ', 'SH', 'HZ']
['XA', 'BJ', 'GZ', 'SH', 'HZ']
['XA', 'BJ', 'GZ', 'HZ']
['XA', 'BJ', 'NJ', 'SH', 'GZ', 'HZ']
['XA', 'BJ', 'NJ', 'SH', 'HZ']
['XA', 'BJ', 'WH', 'SH', 'GZ', 'HZ']
['XA', 'BJ', 'WH', 'SH', 'HZ']
</pre>
</div>

<div id="outline-container-org132befd" class="outline-6">
<h6 id="org132befd"><span class="section-number-6">8.3.3.3.1</span> 获得部分可用路径</h6>
<div class="outline-text-6" id="text-8-3-3-3-1">
<p>
当网络中节点增加，可用路径就会变得非常多。
对于一个全互联网络（即每两个节点之间都直连），任意两点之间的可用路径多达 <code>(n-2)!</code> 条。
</p>

<p>
可以对可用路径的计算加以限制：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#20174; XA &#21040; HZ &#32463;&#36807;&#30340;&#33410;&#28857;&#25968;&#37327;&#26368;&#22810;&#20026; 3 &#20010;&#65288;&#19981;&#21253;&#25324;&#36215;&#22987;&#33410;&#28857;&#65289;</span>
<span style="color: #d787d7; font-weight: bold;">for</span> p <span style="color: #d787d7; font-weight: bold;">in</span> nx.all_simple_paths<span style="color: #ff8c00; font-size: 150%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span>, 3<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>p<span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
['XA', 'GZ', 'SH', 'HZ']
['XA', 'GZ', 'HZ']
['XA', 'BJ', 'SH', 'HZ']
['XA', 'BJ', 'GZ', 'HZ']

</pre>
</div>
</div>

<div id="outline-container-org5f1b0c5" class="outline-6">
<h6 id="org5f1b0c5"><span class="section-number-6">8.3.3.3.2</span> 基于链路 weight 计算可用路径</h6>
<div class="outline-text-6" id="text-8-3-3-3-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #707070; font-style: italic;"># </span><span style="color: #707070; font-style: italic;">&#29992;&#20110;&#35745;&#31639;&#19968;&#26465;&#36335;&#24452;&#24635; weight &#20540;</span>
<span style="color: #d787d7; font-weight: bold;">def</span> <span style="color: #5fafff;">get_path_wight</span><span style="color: #ff8c00; font-size: 150%;">(</span>g, path<span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #5fafff;">_weight</span> = 0
    <span style="color: #d787d7; font-weight: bold;">for</span> edge <span style="color: #d787d7; font-weight: bold;">in</span> nx.utils.pairwise<span style="color: #ff8c00; font-size: 150%;">(</span>path<span style="color: #ff8c00; font-size: 150%;">)</span>:
        <span style="color: #5fafff;">_weight</span> += g.edges<span style="color: #ff8c00; font-size: 150%;">[</span>edge<span style="color: #ff1493; font-size: 140%;">[</span>0<span style="color: #ff1493; font-size: 140%;">]</span>, edge<span style="color: #ff1493; font-size: 140%;">[</span>1<span style="color: #ff1493; font-size: 140%;">]</span><span style="color: #ff8c00; font-size: 150%;">][</span><span style="color: #87af5f;">'weight'</span><span style="color: #ff8c00; font-size: 150%;">]</span>
    <span style="color: #d787d7; font-weight: bold;">return</span> _weight


<span style="color: #d787d7; font-weight: bold;">for</span> path <span style="color: #d787d7; font-weight: bold;">in</span> nx.shortest_simple_paths<span style="color: #ff8c00; font-size: 150%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span>, weight=<span style="color: #87af5f;">'weight'</span><span style="color: #ff8c00; font-size: 150%;">)</span>:
    <span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span>path, get_path_wight<span style="color: #ff1493; font-size: 140%;">(</span>WG, path<span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>

</pre>
</div>

<pre class="example">
['XA', 'BJ', 'SH', 'HZ'] 3480
['XA', 'BJ', 'NJ', 'SH', 'HZ'] 3480
['XA', 'GZ', 'HZ'] 3600
['XA', 'BJ', 'WH', 'SH', 'HZ'] 3930
['XA', 'GZ', 'SH', 'HZ'] 4180
['XA', 'BJ', 'SH', 'GZ', 'HZ'] 5500
['XA', 'BJ', 'NJ', 'SH', 'GZ', 'HZ'] 5500
['XA', 'BJ', 'GZ', 'HZ'] 5500
['XA', 'BJ', 'WH', 'SH', 'GZ', 'HZ'] 5950
['XA', 'BJ', 'GZ', 'SH', 'HZ'] 6080
['XA', 'GZ', 'BJ', 'SH', 'HZ'] 6580
['XA', 'GZ', 'BJ', 'NJ', 'SH', 'HZ'] 6580
['XA', 'GZ', 'BJ', 'WH', 'SH', 'HZ'] 7030
</pre>

<p>
<code>nx.shortest_simple_paths()</code> 会根据 weight 值对输出路径排序，返回一个生成器。
</p>

<p>
若想获得 4 条最优路径，则:
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #d787d7; font-weight: bold;">print</span><span style="color: #ff8c00; font-size: 150%;">(</span><span style="color: #5fafff; font-weight: bold;">list</span><span style="color: #ff1493; font-size: 140%;">(</span>itertools.islice<span style="color: #7fff00; font-size: 130%;">(</span>nx.shortest_simple_paths<span style="color: #00bfff; font-size: 120%;">(</span>WG, <span style="color: #87af5f;">'XA'</span>, <span style="color: #87af5f;">'HZ'</span>, weight=<span style="color: #87af5f;">'weight'</span><span style="color: #00bfff; font-size: 120%;">)</span>, 4<span style="color: #7fff00; font-size: 130%;">)</span><span style="color: #ff1493; font-size: 140%;">)</span><span style="color: #ff8c00; font-size: 150%;">)</span>
</pre>
</div>

<pre class="example">
[['XA', 'BJ', 'SH', 'HZ'], ['XA', 'BJ', 'NJ', 'SH', 'HZ'], ['XA', 'GZ', 'HZ'], ['XA', 'BJ', 'WH', 'SH', 'HZ']]

</pre>
</div>
</div>
</div>


<div id="outline-container-org04b0d5b" class="outline-5">
<h5 id="org04b0d5b"><span class="section-number-5">8.3.3.4</span> <a href="https://networkx.github.io/documentation/stable/reference/algorithms/shortest_paths.html">更多路径计算方法</a></h5>
</div>
</div>
</div>
</div>




<div id="outline-container-org79991a7" class="outline-2">
<h2 id="org79991a7"><span class="section-number-2">9</span> 参考资料</h2>
</div>
</div>
</body>
</html>