<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-10-05 Fri 14:16 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pandas V2</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/solarized/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas V2</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge665278">1. 核心数据结构创建与基本操作</a>
<ul>
<li><a href="#orgc8f0088">1.1. 索引对象</a></li>
<li><a href="#org64781c2">1.2. Panel</a></li>
<li><a href="#org4c58297">1.3. Series</a>
<ul>
<li><a href="#org3fa3c7e">1.3.1. 创建</a>
<ul>
<li><a href="#org58074b3">1.3.1.1. 从 ndarray 创建</a></li>
<li><a href="#orga57b7cd">1.3.1.2. 从字典创建</a></li>
<li><a href="#org53bea81">1.3.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#org9b32649">1.3.2. 基本操作</a>
<ul>
<li><a href="#org41bcc27">1.3.2.1. 赋值</a></li>
<li><a href="#orgd05900a">1.3.2.2. 与标量相乘</a></li>
<li><a href="#orgc298272">1.3.2.3. 应用数学函数</a></li>
<li><a href="#orgda0d4d0">1.3.2.4. 映射 (apply)</a></li>
<li><a href="#orgc88ae32">1.3.2.5. 排序(sort_index/sort_values)</a></li>
<li><a href="#org8e9f963">1.3.2.6. 唯一值，计数和成员(unique/count/isin)</a></li>
<li><a href="#org460f1ab">1.3.2.7. 排名(rank)</a></li>
<li><a href="#orge5e9930">1.3.2.8. 在字典上下文中使用</a></li>
<li><a href="#org5dbd9ee">1.3.2.9. 检查缺失数据</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org73acf34">1.4. DataFrame</a>
<ul>
<li><a href="#org7f6e788">1.4.1. 创建</a>
<ul>
<li><a href="#org92b42b3">1.4.1.1. 从字典创建</a></li>
<li><a href="#org101f92e">1.4.1.2. 从结构化数据列表创建</a></li>
<li><a href="#org60b3cd0">1.4.1.3. 从字典列表创建</a></li>
<li><a href="#org0695934">1.4.1.4. 从元组字典创建</a></li>
<li><a href="#orgd132ac9">1.4.1.5. 从 Series 创建</a></li>
<li><a href="#org8fbe1c1">1.4.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#org6950ecf">1.4.2. 基本操作</a>
<ul>
<li><a href="#orga580996">1.4.2.1. 转置</a></li>
<li><a href="#orge1a7778">1.4.2.2. 算数运算填充</a></li>
<li><a href="#orga1e0eeb">1.4.2.3. 和 Series 之间的运算（广播机制）</a></li>
<li><a href="#org0398910">1.4.2.4. 应用函数</a></li>
<li><a href="#orgb6eed22">1.4.2.5. 行/列映射 (apply)</a></li>
<li><a href="#org3cc6a79">1.4.2.6. 逐元素映射 (applymap)</a></li>
<li><a href="#orgf6318b1">1.4.2.7. 排序(sort_index/sort_values)</a></li>
<li><a href="#org4ecc8d5">1.4.2.8. 排名(rank)</a></li>
<li><a href="#org419c86e">1.4.2.9. 转换为 ndarray 对象</a></li>
<li><a href="#org1085211">1.4.2.10. 统计</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3b85a64">2. 索引</a>
<ul>
<li><a href="#org11d3388">2.1. Series</a>
<ul>
<li><a href="#orgc66e10d">2.1.1. 设置对象自身和索引的 name 属性</a></li>
<li><a href="#orgc33a1da">2.1.2. 获取值和索引</a></li>
<li><a href="#org0623515">2.1.3. 索引对齐</a></li>
<li><a href="#org8396e84">2.1.4. 重建索引</a></li>
<li><a href="#orgcba1694">2.1.5. 删除索引</a></li>
<li><a href="#org96ae81f">2.1.6. 标签索引</a></li>
<li><a href="#org59276b6">2.1.7. 布尔索引</a></li>
</ul>
</li>
<li><a href="#org547b9e5">2.2. DataFrame</a>
<ul>
<li><a href="#org6aac104">2.2.1. 设置行/列索引的 name 属性</a></li>
<li><a href="#org4aa88ed">2.2.2. 重建索引</a></li>
<li><a href="#org5e68c5e">2.2.3. 索引对齐</a></li>
<li><a href="#orgf7a52ac">2.2.4. 列赋值</a></li>
<li><a href="#orgd5bcb56">2.2.5. 删除行/列</a></li>
<li><a href="#orgfb4cdaf">2.2.6. 标签索引</a></li>
<li><a href="#org7535e0e">2.2.7. 正则索引</a></li>
<li><a href="#org6475858">2.2.8. 整数索引</a></li>
<li><a href="#orgc9dbc63">2.2.9. 布尔索引</a></li>
<li><a href="#org27ea4b6">2.2.10. loc 索引</a></li>
<li><a href="#orgd53848d">2.2.11. iloc 索引</a></li>
<li><a href="#orge99125e">2.2.12. at 索引</a></li>
<li><a href="#orgce60ef9">2.2.13. 随机索引</a></li>
<li><a href="#org88ee57b">2.2.14. 重命名行/列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2c55905">3. 数据清洗</a>
<ul>
<li><a href="#org6600e17">3.1. 处理缺失值</a>
<ul>
<li><a href="#org042fcc4">3.1.1. 过滤缺失值(dropna)</a></li>
<li><a href="#org57fe1bb">3.1.2. 补全缺失值(fillna)</a></li>
</ul>
</li>
<li><a href="#org053b3d2">3.2. 数据转换</a>
<ul>
<li><a href="#org5019b75">3.2.1. 删除重复值</a></li>
<li><a href="#orgf6652c2">3.2.2. 使用函数或映射进行数据转换</a></li>
<li><a href="#orga16160f">3.2.3. 替代值(replace)</a></li>
<li><a href="#org5b47ca2">3.2.4. 重命名索引</a></li>
<li><a href="#org3a60ac6">3.2.5. 离散化和分箱(cut/qcut)</a></li>
<li><a href="#orgf8f6763">3.2.6. 检测异常值(any)</a></li>
<li><a href="#orgded3b72">3.2.7. 随机重排序(sample/take)</a>
<ul>
<li><a href="#org95ca39e">3.2.7.1. 使用 take 优化内存 </a></li>
</ul>
</li>
<li><a href="#org59e18ec">3.2.8. 指标矩阵(get_dummies)</a></li>
<li><a href="#org815de93">3.2.9. 向量化函数</a>
<ul>
<li><a href="#orgc76a2da">3.2.9.1. str</a></li>
<li><a href="#org8c1698c">3.2.9.2. dt</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org85f8594">4. 数据规整：连接，联合，重塑</a>
<ul>
<li><a href="#orgb13ca18">4.1. 分层索引</a>
<ul>
<li><a href="#orgde62afb">4.1.1. 层级交换(swaplevel)与排序(sort_index)</a></li>
<li><a href="#org9da3325">4.1.2. 列索引转为行索引 (set_index)</a></li>
<li><a href="#org9877fb9">4.1.3. 行索引转为列索引 (reset_index)</a></li>
</ul>
</li>
<li><a href="#org39bd5c7">4.2. 连接与合并</a>
<ul>
<li><a href="#orga38b562">4.2.1. merge</a>
<ul>
<li><a href="#org4d0cb6e">4.2.1.1. 基本用法</a></li>
<li><a href="#org4cb09ef">4.2.1.2. 合并类型(inner,outer,left,right)</a></li>
<li><a href="#orgee9b641">4.2.1.3. 按索引合并</a></li>
<li><a href="#org29e158b">4.2.1.4. join</a></li>
</ul>
</li>
<li><a href="#org20c78c6">4.2.2. concat</a>
<ul>
<li><a href="#org8e83fb2">4.2.2.1. join_axes</a></li>
<li><a href="#org10fa929">4.2.2.2. 区分拼接在一起的各部分</a></li>
<li><a href="#org1a89b63">4.2.2.3. ignore_index</a></li>
</ul>
</li>
<li><a href="#orge3fcae6">4.2.3. combine_first</a></li>
</ul>
</li>
<li><a href="#org0c1736d">4.3. 重排列表格型数据</a>
<ul>
<li><a href="#orgf6a442d">4.3.1. 使用多层索引进行重塑(stack/unstack)</a></li>
<li><a href="#orgc030043">4.3.2. 将列的值转换为列索引(pivot)</a></li>
<li><a href="#orgb3ad0ff">4.3.3. 将列索引转换为列的值(melt)</a>
<ul>
<li><a href="#orgbf41c70">4.3.3.1. 使用pivot将数据重塑会原先的布局</a></li>
<li><a href="#org1073df7">4.3.3.2. 指定列的子集作为值列</a></li>
<li><a href="#org1bca7ce">4.3.3.3. 不指定分组指标</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3bbbc12">5. 聚合与分组操作</a>
<ul>
<li><a href="#org72c9349">5.1. GroupBy 对象</a>
<ul>
<li><a href="#org5c13718">5.1.1. 获取某个 Group (get_group)</a></li>
<li><a href="#org3b78027">5.1.2. GroupBy 对象的列索引</a></li>
<li><a href="#org8afee18">5.1.3. 使用字典和Series分组</a></li>
<li><a href="#orgb653410">5.1.4. 使用函数分组</a>
<ul>
<li><a href="#orgb131d54">5.1.4.1. 与其他分组键混合</a></li>
</ul>
</li>
<li><a href="#org7658ffb">5.1.5. 根据索引层级分组</a></li>
</ul>
</li>
<li><a href="#org262febb">5.2. 数据聚合</a>
<ul>
<li><a href="#orgc7f7e9a">5.2.1. 对GroupBy对象调用聚合方法</a></li>
<li><a href="#orgfd803db">5.2.2. 逐列与多函数应用</a>
<ul>
<li><a href="#orgd450f30">5.2.2.1. 各列同时使用多个函数聚合</a></li>
<li><a href="#orge9e559c">5.2.2.2. 使用不同的函数对多个列聚合</a></li>
</ul>
</li>
<li><a href="#org4337650">5.2.3. 返回不含行索引的聚合数据</a></li>
<li><a href="#orgf3f5272">5.2.4. GroupBy.apply</a></li>
<li><a href="#orgb20e452">5.2.5. 禁用分组键(group_keys=False)</a></li>
<li><a href="#orgdbab16b">5.2.6. GroupBy.transform</a></li>
<li><a href="#org7491191">5.2.7. 时间分组重采样(resample)</a>
<ul>
<li><a href="#org7b53d24">5.2.7.1. TimeGrouper 对象</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb208f97">5.3. 透视表(pivot_table)</a></li>
<li><a href="#orgdc82581">5.4. 交叉表(cross_table)</a></li>
<li><a href="#org745789b">5.5. Categorial 类型数据</a>
<ul>
<li><a href="#orga3e1a15">5.5.1. 直接创建 Categorical 对象</a></li>
<li><a href="#org4a5eb17">5.5.2. Categorical 对象排序规则</a></li>
<li><a href="#org2c55124">5.5.3. 使用 Categorical 对象进行分箱统计</a></li>
<li><a href="#orgceb66ea">5.5.4. 使用 Categorical 对象的性能优势</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8ecbcde">6. 时间序列</a>
<ul>
<li><a href="#org4e52f7d">6.1. 时间选择</a>
<ul>
<li><a href="#org414d4cf">6.1.1. 使用能解释为日期的字符串</a></li>
<li><a href="#org409ce9c">6.1.2. 使用年份或月份选择数据切片</a></li>
</ul>
</li>
<li><a href="#orge3f6438">6.2. 日期范围，频率，偏移</a>
<ul>
<li><a href="#orgfa856c7">6.2.1. 生成范围</a></li>
<li><a href="#orgb349c07">6.2.2. 日期频率</a>
<ul>
<li><a href="#org09ede7e">6.2.2.1. 月中某星期</a></li>
</ul>
</li>
<li><a href="#org5ee9a09">6.2.3. 日期偏移</a>
<ul>
<li><a href="#org093d5e1">6.2.3.1. 推移数据不改变时间戳</a></li>
<li><a href="#org85af320">6.2.3.2. 推移数据不改变时间戳</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0baa236">6.3. 重采样(resample)</a>
<ul>
<li><a href="#org294fe02">6.3.1. 下采样</a>
<ul>
<li><a href="#orge5102d2">6.3.1.1. 采样时间基数(base)</a></li>
<li><a href="#orgd29a3cf">6.3.1.2. 半开区间</a></li>
<li><a href="#org2eb0592">6.3.1.3. OHLC 重采样</a></li>
<li><a href="#org9d94ab2">6.3.1.4. 采样后对各列聚合(agg)</a></li>
</ul>
</li>
<li><a href="#org0e5cbb1">6.3.2. 上采样与插值</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org52890b4">7. 移动窗口函数</a>
<ul>
<li><a href="#org27487af">7.1. rolling</a>
<ul>
<li><a href="#orgf154868">7.1.1. 按长度确定窗口</a></li>
<li><a href="#org98d683a">7.1.2. 按时间确定窗口</a></li>
</ul>
</li>
<li><a href="#orgbea6cab">7.2. expanding</a></li>
<li><a href="#org9317781">7.3. ewm</a></li>
<li><a href="#org2f1004d">7.4. 二元窗口函数</a>
<ul>
<li><a href="#org1f91c14">7.4.1. corr</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb1c9fb4">8. 实用方法</a>
<ul>
<li><a href="#org71410ab">8.1. 链式操作</a>
<ul>
<li><a href="#orgd2f599d">8.1.1. DataFrame.assign</a></li>
<li><a href="#orgcdbf795">8.1.2. pd.pipe</a></li>
</ul>
</li>
<li><a href="#org21f9f22">8.2. 查看 DataFrame 信息</a></li>
<li><a href="#org945eb9e">8.3. 排序</a>
<ul>
<li><a href="#orgde4b36e">8.3.1. 找出插入值应处位置(searchsorted)</a></li>
<li><a href="#org188350d">8.3.2. nlargest(n)/nsmallest(n)</a></li>
<li><a href="#orgf060184">8.3.3. 排序并输出对应索引(Series.argsort)</a></li>
</ul>
</li>
<li><a href="#org9f75248">8.4. 列操作</a>
<ul>
<li><a href="#org399ab16">8.4.1. 数据增长值(diff)</a></li>
<li><a href="#org3c50753">8.4.2. 数据增长率(pct_change)</a></li>
<li><a href="#org58a50a8">8.4.3. 累加值(cumsum)</a></li>
<li><a href="#org68dd460">8.4.4. 资金曲线(cumprod)</a></li>
<li><a href="#orgc6c3b97">8.4.5. np.where</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge665278">1. 核心数据结构创建与基本操作</a>
<ul>
<li><a href="#orgc8f0088">1.1. 索引对象</a></li>
<li><a href="#org64781c2">1.2. Panel</a></li>
<li><a href="#org4c58297">1.3. Series</a>
<ul>
<li><a href="#org3fa3c7e">1.3.1. 创建</a>
<ul>
<li><a href="#org58074b3">1.3.1.1. 从 ndarray 创建</a></li>
<li><a href="#orga57b7cd">1.3.1.2. 从字典创建</a></li>
<li><a href="#org53bea81">1.3.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#org9b32649">1.3.2. 基本操作</a>
<ul>
<li><a href="#org41bcc27">1.3.2.1. 赋值</a></li>
<li><a href="#orgd05900a">1.3.2.2. 与标量相乘</a></li>
<li><a href="#orgc298272">1.3.2.3. 应用数学函数</a></li>
<li><a href="#orgda0d4d0">1.3.2.4. 映射 (apply)</a></li>
<li><a href="#orgc88ae32">1.3.2.5. 排序(sort_index/sort_values)</a></li>
<li><a href="#org8e9f963">1.3.2.6. 唯一值，计数和成员(unique/count/isin)</a></li>
<li><a href="#org460f1ab">1.3.2.7. 排名(rank)</a></li>
<li><a href="#orge5e9930">1.3.2.8. 在字典上下文中使用</a></li>
<li><a href="#org5dbd9ee">1.3.2.9. 检查缺失数据</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org73acf34">1.4. DataFrame</a>
<ul>
<li><a href="#org7f6e788">1.4.1. 创建</a>
<ul>
<li><a href="#org92b42b3">1.4.1.1. 从字典创建</a></li>
<li><a href="#org101f92e">1.4.1.2. 从结构化数据列表创建</a></li>
<li><a href="#org60b3cd0">1.4.1.3. 从字典列表创建</a></li>
<li><a href="#org0695934">1.4.1.4. 从元组字典创建</a></li>
<li><a href="#orgd132ac9">1.4.1.5. 从 Series 创建</a></li>
<li><a href="#org8fbe1c1">1.4.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#org6950ecf">1.4.2. 基本操作</a>
<ul>
<li><a href="#orga580996">1.4.2.1. 转置</a></li>
<li><a href="#orge1a7778">1.4.2.2. 算数运算填充</a></li>
<li><a href="#orga1e0eeb">1.4.2.3. 和 Series 之间的运算（广播机制）</a></li>
<li><a href="#org0398910">1.4.2.4. 应用函数</a></li>
<li><a href="#orgb6eed22">1.4.2.5. 行/列映射 (apply)</a></li>
<li><a href="#org3cc6a79">1.4.2.6. 逐元素映射 (applymap)</a></li>
<li><a href="#orgf6318b1">1.4.2.7. 排序(sort_index/sort_values)</a></li>
<li><a href="#org4ecc8d5">1.4.2.8. 排名(rank)</a></li>
<li><a href="#org419c86e">1.4.2.9. 转换为 ndarray 对象</a></li>
<li><a href="#org1085211">1.4.2.10. 统计</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3b85a64">2. 索引</a>
<ul>
<li><a href="#org11d3388">2.1. Series</a>
<ul>
<li><a href="#orgc66e10d">2.1.1. 设置对象自身和索引的 name 属性</a></li>
<li><a href="#orgc33a1da">2.1.2. 获取值和索引</a></li>
<li><a href="#org0623515">2.1.3. 索引对齐</a></li>
<li><a href="#org8396e84">2.1.4. 重建索引</a></li>
<li><a href="#orgcba1694">2.1.5. 删除索引</a></li>
<li><a href="#org96ae81f">2.1.6. 标签索引</a></li>
<li><a href="#org59276b6">2.1.7. 布尔索引</a></li>
</ul>
</li>
<li><a href="#org547b9e5">2.2. DataFrame</a>
<ul>
<li><a href="#org6aac104">2.2.1. 设置行/列索引的 name 属性</a></li>
<li><a href="#org4aa88ed">2.2.2. 重建索引</a></li>
<li><a href="#org5e68c5e">2.2.3. 索引对齐</a></li>
<li><a href="#orgf7a52ac">2.2.4. 列赋值</a></li>
<li><a href="#orgd5bcb56">2.2.5. 删除行/列</a></li>
<li><a href="#orgfb4cdaf">2.2.6. 标签索引</a></li>
<li><a href="#org7535e0e">2.2.7. 正则索引</a></li>
<li><a href="#org6475858">2.2.8. 整数索引</a></li>
<li><a href="#orgc9dbc63">2.2.9. 布尔索引</a></li>
<li><a href="#org27ea4b6">2.2.10. loc 索引</a></li>
<li><a href="#orgd53848d">2.2.11. iloc 索引</a></li>
<li><a href="#orge99125e">2.2.12. at 索引</a></li>
<li><a href="#orgce60ef9">2.2.13. 随机索引</a></li>
<li><a href="#org88ee57b">2.2.14. 重命名行/列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2c55905">3. 数据清洗</a>
<ul>
<li><a href="#org6600e17">3.1. 处理缺失值</a>
<ul>
<li><a href="#org042fcc4">3.1.1. 过滤缺失值(dropna)</a></li>
<li><a href="#org57fe1bb">3.1.2. 补全缺失值(fillna)</a></li>
</ul>
</li>
<li><a href="#org053b3d2">3.2. 数据转换</a>
<ul>
<li><a href="#org5019b75">3.2.1. 删除重复值</a></li>
<li><a href="#orgf6652c2">3.2.2. 使用函数或映射进行数据转换</a></li>
<li><a href="#orga16160f">3.2.3. 替代值(replace)</a></li>
<li><a href="#org5b47ca2">3.2.4. 重命名索引</a></li>
<li><a href="#org3a60ac6">3.2.5. 离散化和分箱(cut/qcut)</a></li>
<li><a href="#orgf8f6763">3.2.6. 检测异常值(any)</a></li>
<li><a href="#orgded3b72">3.2.7. 随机重排序(sample/take)</a>
<ul>
<li><a href="#org95ca39e">3.2.7.1. 使用 take 优化内存 </a></li>
</ul>
</li>
<li><a href="#org59e18ec">3.2.8. 指标矩阵(get_dummies)</a></li>
<li><a href="#org815de93">3.2.9. 向量化函数</a>
<ul>
<li><a href="#orgc76a2da">3.2.9.1. str</a></li>
<li><a href="#org8c1698c">3.2.9.2. dt</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org85f8594">4. 数据规整：连接，联合，重塑</a>
<ul>
<li><a href="#orgb13ca18">4.1. 分层索引</a>
<ul>
<li><a href="#orgde62afb">4.1.1. 层级交换(swaplevel)与排序(sort_index)</a></li>
<li><a href="#org9da3325">4.1.2. 列索引转为行索引 (set_index)</a></li>
<li><a href="#org9877fb9">4.1.3. 行索引转为列索引 (reset_index)</a></li>
</ul>
</li>
<li><a href="#org39bd5c7">4.2. 连接与合并</a>
<ul>
<li><a href="#orga38b562">4.2.1. merge</a>
<ul>
<li><a href="#org4d0cb6e">4.2.1.1. 基本用法</a></li>
<li><a href="#org4cb09ef">4.2.1.2. 合并类型(inner,outer,left,right)</a></li>
<li><a href="#orgee9b641">4.2.1.3. 按索引合并</a></li>
<li><a href="#org29e158b">4.2.1.4. join</a></li>
</ul>
</li>
<li><a href="#org20c78c6">4.2.2. concat</a>
<ul>
<li><a href="#org8e83fb2">4.2.2.1. join_axes</a></li>
<li><a href="#org10fa929">4.2.2.2. 区分拼接在一起的各部分</a></li>
<li><a href="#org1a89b63">4.2.2.3. ignore_index</a></li>
</ul>
</li>
<li><a href="#orge3fcae6">4.2.3. combine_first</a></li>
</ul>
</li>
<li><a href="#org0c1736d">4.3. 重排列表格型数据</a>
<ul>
<li><a href="#orgf6a442d">4.3.1. 使用多层索引进行重塑(stack/unstack)</a></li>
<li><a href="#orgc030043">4.3.2. 将列的值转换为列索引(pivot)</a></li>
<li><a href="#orgb3ad0ff">4.3.3. 将列索引转换为列的值(melt)</a>
<ul>
<li><a href="#orgbf41c70">4.3.3.1. 使用pivot将数据重塑会原先的布局</a></li>
<li><a href="#org1073df7">4.3.3.2. 指定列的子集作为值列</a></li>
<li><a href="#org1bca7ce">4.3.3.3. 不指定分组指标</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3bbbc12">5. 聚合与分组操作</a>
<ul>
<li><a href="#org72c9349">5.1. GroupBy 对象</a>
<ul>
<li><a href="#org5c13718">5.1.1. 获取某个 Group (get_group)</a></li>
<li><a href="#org3b78027">5.1.2. GroupBy 对象的列索引</a></li>
<li><a href="#org8afee18">5.1.3. 使用字典和Series分组</a></li>
<li><a href="#orgb653410">5.1.4. 使用函数分组</a>
<ul>
<li><a href="#orgb131d54">5.1.4.1. 与其他分组键混合</a></li>
</ul>
</li>
<li><a href="#org7658ffb">5.1.5. 根据索引层级分组</a></li>
</ul>
</li>
<li><a href="#org262febb">5.2. 数据聚合</a>
<ul>
<li><a href="#orgc7f7e9a">5.2.1. 对GroupBy对象调用聚合方法</a></li>
<li><a href="#orgfd803db">5.2.2. 逐列与多函数应用</a>
<ul>
<li><a href="#orgd450f30">5.2.2.1. 各列同时使用多个函数聚合</a></li>
<li><a href="#orge9e559c">5.2.2.2. 使用不同的函数对多个列聚合</a></li>
</ul>
</li>
<li><a href="#org4337650">5.2.3. 返回不含行索引的聚合数据</a></li>
<li><a href="#orgf3f5272">5.2.4. GroupBy.apply</a></li>
<li><a href="#orgb20e452">5.2.5. 禁用分组键(group_keys=False)</a></li>
<li><a href="#orgdbab16b">5.2.6. GroupBy.transform</a></li>
<li><a href="#org7491191">5.2.7. 时间分组重采样(resample)</a>
<ul>
<li><a href="#org7b53d24">5.2.7.1. TimeGrouper 对象</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb208f97">5.3. 透视表(pivot_table)</a></li>
<li><a href="#orgdc82581">5.4. 交叉表(cross_table)</a></li>
<li><a href="#org745789b">5.5. Categorial 类型数据</a>
<ul>
<li><a href="#orga3e1a15">5.5.1. 直接创建 Categorical 对象</a></li>
<li><a href="#org4a5eb17">5.5.2. Categorical 对象排序规则</a></li>
<li><a href="#org2c55124">5.5.3. 使用 Categorical 对象进行分箱统计</a></li>
<li><a href="#orgceb66ea">5.5.4. 使用 Categorical 对象的性能优势</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8ecbcde">6. 时间序列</a>
<ul>
<li><a href="#org4e52f7d">6.1. 时间选择</a>
<ul>
<li><a href="#org414d4cf">6.1.1. 使用能解释为日期的字符串</a></li>
<li><a href="#org409ce9c">6.1.2. 使用年份或月份选择数据切片</a></li>
</ul>
</li>
<li><a href="#orge3f6438">6.2. 日期范围，频率，偏移</a>
<ul>
<li><a href="#orgfa856c7">6.2.1. 生成范围</a></li>
<li><a href="#orgb349c07">6.2.2. 日期频率</a>
<ul>
<li><a href="#org09ede7e">6.2.2.1. 月中某星期</a></li>
</ul>
</li>
<li><a href="#org5ee9a09">6.2.3. 日期偏移</a>
<ul>
<li><a href="#org093d5e1">6.2.3.1. 推移数据不改变时间戳</a></li>
<li><a href="#org85af320">6.2.3.2. 推移数据不改变时间戳</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0baa236">6.3. 重采样(resample)</a>
<ul>
<li><a href="#org294fe02">6.3.1. 下采样</a>
<ul>
<li><a href="#orge5102d2">6.3.1.1. 采样时间基数(base)</a></li>
<li><a href="#orgd29a3cf">6.3.1.2. 半开区间</a></li>
<li><a href="#org2eb0592">6.3.1.3. OHLC 重采样</a></li>
<li><a href="#org9d94ab2">6.3.1.4. 采样后对各列聚合(agg)</a></li>
</ul>
</li>
<li><a href="#org0e5cbb1">6.3.2. 上采样与插值</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org52890b4">7. 移动窗口函数</a>
<ul>
<li><a href="#org27487af">7.1. rolling</a>
<ul>
<li><a href="#orgf154868">7.1.1. 按长度确定窗口</a></li>
<li><a href="#org98d683a">7.1.2. 按时间确定窗口</a></li>
</ul>
</li>
<li><a href="#orgbea6cab">7.2. expanding</a></li>
<li><a href="#org9317781">7.3. ewm</a></li>
<li><a href="#org2f1004d">7.4. 二元窗口函数</a>
<ul>
<li><a href="#org1f91c14">7.4.1. corr</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb1c9fb4">8. 实用方法</a>
<ul>
<li><a href="#org71410ab">8.1. 链式操作</a>
<ul>
<li><a href="#orgd2f599d">8.1.1. DataFrame.assign</a></li>
<li><a href="#orgcdbf795">8.1.2. pd.pipe</a></li>
</ul>
</li>
<li><a href="#org21f9f22">8.2. 查看 DataFrame 信息</a></li>
<li><a href="#org945eb9e">8.3. 排序</a>
<ul>
<li><a href="#orgde4b36e">8.3.1. 找出插入值应处位置(searchsorted)</a></li>
<li><a href="#org188350d">8.3.2. nlargest(n)/nsmallest(n)</a></li>
<li><a href="#orgf060184">8.3.3. 排序并输出对应索引(Series.argsort)</a></li>
</ul>
</li>
<li><a href="#org9f75248">8.4. 列操作</a>
<ul>
<li><a href="#org399ab16">8.4.1. 数据增长值(diff)</a></li>
<li><a href="#org3c50753">8.4.2. 数据增长率(pct_change)</a></li>
<li><a href="#org58a50a8">8.4.3. 累加值(cumsum)</a></li>
<li><a href="#org68dd460">8.4.4. 资金曲线(cumprod)</a></li>
<li><a href="#orgc6c3b97">8.4.5. np.where</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Author</td>
<td class="org-left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">2018-10-05 14:16:32</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orge665278" class="outline-2">
<h2 id="orge665278"><span class="section-number-2">1</span> 核心数据结构创建与基本操作</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgc8f0088" class="outline-3">
<h3 id="orgc8f0088"><span class="section-number-3">1.1</span> 索引对象</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Pandas 中的索引对象适用于存储标签和其他元数据的。
</p>

<p>
索引对象是不可变的。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(3), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abc'</span>))
<span style="color: #fd971f;">index</span> = s.index
log(<span style="color: #e6db74;">"index"</span>, index)
log(<span style="color: #e6db74;">"index[1:]"</span>, index[1:])
<span style="color: #f92672; font-weight: bold;">try</span>:
    <span style="color: #fd971f;">index</span>[1] = <span style="color: #e6db74;">'d'</span> <span style="color: #465457;"># </span><span style="color: #465457;">TypeError</span>
<span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">Exception</span> <span style="color: #f92672; font-weight: bold;">as</span> e:
    log(<span style="color: #e6db74;">"TypeError"</span>, e)
</pre>
</div>

<pre class="example">
==================================== index =====================================
Index(['a', 'b', 'c'], dtype='object')
================================== index[1:] ===================================
Index(['b', 'c'], dtype='object')
================================== TypeError ===================================
Index does not support mutable operations

</pre>
</div>
</div>




<div id="outline-container-org64781c2" class="outline-3">
<h3 id="org64781c2"><span class="section-number-3">1.2</span> Panel</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Panel 是三维带标签的数组。
</p>

<p>
Panel 由三个标签组成：
</p>

<dl class="org-dl">
<dt>items</dt><dd>坐标轴 0 ，索引对应的元素是一个 DataFrame</dd>
<dt>major_axis</dt><dd>坐标轴 1 , DataFrame 里的行标签</dd>
<dt>minor_axis</dt><dd>坐标轴 2 , DataFrame 里的列标签</dd>
</dl>
</div>
</div>



<div id="outline-container-org4c58297" class="outline-3">
<h3 id="org4c58297"><span class="section-number-3">1.3</span> Series</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Series 是一维带标签的数组，数组里可以放任意的数据（整数，浮点数，字符串，Python Object）。
</p>

<p>
其基本的创建函数是： <code>pd.Series(data, index=index)</code>
</p>

<p>
其中 index 是一个列表，用来作为数据的标签。data 可以是不同的数据类型：
</p>

<ul class="org-ul">
<li>Python 字典</li>
<li>ndarray 对象</li>
<li>一个标量值，如 5</li>
</ul>
</div>


<div id="outline-container-org3fa3c7e" class="outline-4">
<h4 id="org3fa3c7e"><span class="section-number-4">1.3.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-3-1">
</div>
<div id="outline-container-org58074b3" class="outline-5">
<h5 id="org58074b3"><span class="section-number-5">1.3.1.1</span> 从 ndarray 创建</h5>
<div class="outline-text-5" id="text-1-3-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
<span style="color: #fd971f;">s2</span> = pd.Series(np.random.randn(5))
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s2.index"</span>, s2.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    1.048359
b   -0.206651
c    0.875843
d    0.417848
e    1.849956
dtype: float64
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s2 ======================================
0   -0.298220
1   -0.550852
2   -0.558227
3   -1.762704
4   -1.475406
dtype: float64
=================================== s2.index ===================================
RangeIndex(start=0, stop=5, step=1)
</pre>
</div>
</div>


<div id="outline-container-orga57b7cd" class="outline-5">
<h5 id="orga57b7cd"><span class="section-number-5">1.3.1.2</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-3-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'a'</span> : 0., <span style="color: #e6db74;">'b'</span> : 1., <span style="color: #e6db74;">'d'</span> : 3}
<span style="color: #fd971f;">s</span> = pd.Series(d, index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    NaN
d    3.0
dtype: float64

</pre>
</div>
</div>


<div id="outline-container-org53bea81" class="outline-5">
<h5 id="org53bea81"><span class="section-number-5">1.3.1.3</span> 从标量创建</h5>
<div class="outline-text-5" id="text-1-3-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(3, index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    3
b    3
c    3
d    3
e    3
dtype: int64

</pre>
</div>
</div>
</div>


<div id="outline-container-org9b32649" class="outline-4">
<h4 id="org9b32649"><span class="section-number-4">1.3.2</span> 基本操作</h4>
<div class="outline-text-4" id="text-1-3-2">
</div>
<div id="outline-container-org41bcc27" class="outline-5">
<h5 id="org41bcc27"><span class="section-number-5">1.3.2.1</span> 赋值</h5>
<div class="outline-text-5" id="text-1-3-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
<span style="color: #fd971f;">s</span>[<span style="color: #e6db74;">'b'</span>:<span style="color: #e6db74;">'a'</span>] = 5
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
d    4
b    7
a   -5
c    3
dtype: int64
====================================== s =======================================
d    4
b    5
a    5
c    3
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-orgd05900a" class="outline-5">
<h5 id="orgd05900a"><span class="section-number-5">1.3.2.2</span> 与标量相乘</h5>
<div class="outline-text-5" id="text-1-3-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s * 2"</span>, s * 2)
</pre>
</div>

<pre class="example">
==================================== s * 2 =====================================
d     8
b    14
a   -10
c     6
dtype: int64

</pre>
</div>
</div>



<div id="outline-container-orgc298272" class="outline-5">
<h5 id="orgc298272"><span class="section-number-5">1.3.2.3</span> 应用数学函数</h5>
<div class="outline-text-5" id="text-1-3-2-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"np.exp(s)"</span>, np.exp(s))
</pre>
</div>

<pre class="example">
================================== np.exp(s) ===================================
d      54.598150
b    1096.633158
a       0.006738
c      20.085537
dtype: float64

</pre>
</div>
</div>


<div id="outline-container-orgda0d4d0" class="outline-5">
<h5 id="orgda0d4d0"><span class="section-number-5">1.3.2.4</span> 映射 (apply)</h5>
<div class="outline-text-5" id="text-1-3-2-4">
<p>
<code>s.apply(value_to_value_func) -&gt; Series</code>
</p>
</div>
</div>


<div id="outline-container-orgc88ae32" class="outline-5">
<h5 id="orgc88ae32"><span class="section-number-5">1.3.2.5</span> 排序(sort_index/sort_values)</h5>
<div class="outline-text-5" id="text-1-3-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(4), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'dabc'</span>))
log(<span style="color: #e6db74;">"s.sort_index()"</span>, s.sort_index())
log(<span style="color: #e6db74;">"s.sort_values()"</span>, s.sort_values())
</pre>
</div>

<pre class="example">
================================ s.sort_index() ================================
a    1
b    2
c    3
d    0
dtype: int64
=============================== s.sort_values() ================================
d    0
a    1
b    2
c    3
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org8e9f963" class="outline-5">
<h5 id="org8e9f963"><span class="section-number-5">1.3.2.6</span> 唯一值，计数和成员(unique/count/isin)</h5>
<div class="outline-text-5" id="text-1-3-2-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'cadaabbcc'</span>))
log(<span style="color: #e6db74;">"s.unique()"</span>, s.unique())
log(<span style="color: #e6db74;">"s.value_counts()"</span>, s.value_counts())
log(<span style="color: #e6db74;">"s.isin(['b', 'c'])"</span>, s.isin([<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>]))
</pre>
</div>
</div>
</div>


<div id="outline-container-org460f1ab" class="outline-5">
<h5 id="org460f1ab"><span class="section-number-5">1.3.2.7</span> 排名(rank)</h5>
<div class="outline-text-5" id="text-1-3-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([7, -5, 7, 4, 2, 0, 4])
log(<span style="color: #e6db74;">"s.rank()"</span>, s.rank())
log(<span style="color: #e6db74;">"s.rank(method='first')"</span>, s.rank(method=<span style="color: #e6db74;">'first'</span>))
log(<span style="color: #e6db74;">"s.rank(ascending=False, method='max')"</span>, s.rank(ascending=<span style="color: #ae81ff;">False</span>, method=<span style="color: #e6db74;">'max'</span>))

</pre>
</div>

<pre class="example">
=================================== s.rank() ===================================
0    6.5
1    1.0
2    6.5
3    4.5
4    3.0
5    2.0
6    4.5
dtype: float64
============================ s.rank(method='first') ============================
0    6.0
1    1.0
2    7.0
3    4.0
4    3.0
5    2.0
6    5.0
dtype: float64
==================== s.rank(ascending=False, method='max') =====================
0    2.0
1    7.0
2    2.0
3    4.0
4    5.0
5    6.0
6    4.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-orge5e9930" class="outline-5">
<h5 id="orge5e9930"><span class="section-number-5">1.3.2.8</span> 在字典上下文中使用</h5>
<div class="outline-text-5" id="text-1-3-2-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"'b' in s"</span>, <span style="color: #e6db74;">'b'</span> <span style="color: #f92672; font-weight: bold;">in</span> s)
log(<span style="color: #e6db74;">"'e' in s"</span>, <span style="color: #e6db74;">'e'</span> <span style="color: #f92672; font-weight: bold;">in</span> s)
log(<span style="color: #e6db74;">"7 in s"</span>, 7 <span style="color: #f92672; font-weight: bold;">in</span> s)
</pre>
</div>

<pre class="example">
: =================================== 'b' in s ===================================
: True
: =================================== 'e' in s ===================================
: False
: ==================================== 7 in s ====================================
: False
</pre>
</div>
</div>


<div id="outline-container-org5dbd9ee" class="outline-5">
<h5 id="org5dbd9ee"><span class="section-number-5">1.3.2.9</span> 检查缺失数据</h5>
<div class="outline-text-5" id="text-1-3-2-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Ohio'</span>: 35000, <span style="color: #e6db74;">'Texas'</span>: 71000, <span style="color: #e6db74;">'Oregon'</span>: 16000, <span style="color: #e6db74;">'Utah'</span>: 5000}
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'California'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Oregon'</span>, <span style="color: #e6db74;">'Texas'</span>]
<span style="color: #fd971f;">s</span> = pd.Series(data, index=states)
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.isnull()"</span>, s.isnull())
log(<span style="color: #e6db74;">"s.notnull()"</span>, s.notnull())
</pre>
</div>

<pre class="example">
====================================== s =======================================
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
================================== s.isnull() ==================================
California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
================================= s.notnull() ==================================
California    False
Ohio           True
Oregon         True
Texas          True
dtype: bool
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-org73acf34" class="outline-3">
<h3 id="org73acf34"><span class="section-number-3">1.4</span> DataFrame</h3>
<div class="outline-text-3" id="text-1-4">
<p>
DataFrame 是 <b>二维带行索引和列索引的矩阵</b> 。
</p>

<p>
可以把 DataFrame 想象成一个包含 <span class="underline">已排序的列</span> 的集合。
</p>

<p>
创建 DataFrame 的基本格式是：
</p>

<div class="org-src-container">
<pre class="src src-ipython">pd.DataFrame(data, index=index, columns=columns)
</pre>
</div>

<p>
其中 index 是行标签，=columns= 是列标签，=data= 可以是下面的数据：
</p>

<ul class="org-ul">
<li>由一维 numpy 数组，list，Series 构成的字典</li>
<li>二维 numpy 数组</li>
<li>一个 Series</li>
<li>另外的 DataFrame 对象</li>
</ul>
</div>


<div id="outline-container-org7f6e788" class="outline-4">
<h4 id="org7f6e788"><span class="section-number-4">1.4.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-4-1">
</div>
<div id="outline-container-org92b42b3" class="outline-5">
<h5 id="org92b42b3"><span class="section-number-5">1.4.1.1</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-4-1-1">
<p>
<code>key</code> 为 DataFrame 的列； <code>value</code> 为对应列下的值
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'one'</span> : pd.Series([1, 2, 3], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>]),
     <span style="color: #e6db74;">'two'</span> : pd.Series([1, 2, 3, 4], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])}

log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['d', 'b', 'a'])"</span>, pd.DataFrame(d, index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three'])"</span>,
    pd.DataFrame(d, index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>], columns=[<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
==================== pd.DataFrame(d, index=['d', 'b', 'a']) ====================
   one  two
d  NaN    4
b  2.0    2
a  1.0    1
======= pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three']) =======
   two three
d    4   NaN
b    2   NaN
a    1   NaN
</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'one'</span> : [1, 2, 3, 4],
     <span style="color: #e6db74;">'two'</span> : [21, 22, 23, 24]}

log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['a', 'b', 'c', 'd'])"</span>, pd.DataFrame(d, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
0    1   21
1    2   22
2    3   23
3    4   24
================= pd.DataFrame(d, index=['a', 'b', 'c', 'd']) ==================
   one  two
a    1   21
b    2   22
c    3   23
d    4   24
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
                  <span style="color: #e6db74;">'A'</span>: 1,
                  <span style="color: #e6db74;">'B'</span>: pd.Timestamp(<span style="color: #e6db74;">'20160301'</span>),
                  <span style="color: #e6db74;">'C'</span>: <span style="color: #a6e22e;">range</span>(4),
                  <span style="color: #e6db74;">'D'</span>: np.arange(5, 9),
                  <span style="color: #e6db74;">'E'</span>: <span style="color: #e6db74;">'text'</span>,
                  <span style="color: #e6db74;">'F'</span>: [<span style="color: #e6db74;">'AA'</span>, <span style="color: #e6db74;">'BB'</span>, <span style="color: #e6db74;">'CC'</span>, <span style="color: #e6db74;">'DD'</span>]})
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD

</pre>
</div>
</div>


<div id="outline-container-org101f92e" class="outline-5">
<h5 id="org101f92e"><span class="section-number-5">1.4.1.2</span> 从结构化数据列表创建</h5>
<div class="outline-text-5" id="text-1-4-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [(1, 2.2, <span style="color: #e6db74;">'Hello'</span>), (2, 3., <span style="color: #e6db74;">"World"</span>)]

log(<span style="color: #e6db74;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #e6db74;">"pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #e6db74;">'first'</span>, <span style="color: #e6db74;">'second'</span>], columns=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>, <span style="color: #e6db74;">'C'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   0    1      2
0  1  2.2  Hello
1  2  3.0  World
==== pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C']) ====
        A    B      C
first   1  2.2  Hello
second  2  3.0  World

</pre>
</div>
</div>


<div id="outline-container-org60b3cd0" class="outline-5">
<h5 id="org60b3cd0"><span class="section-number-5">1.4.1.3</span> 从字典列表创建</h5>
<div class="outline-text-5" id="text-1-4-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [{<span style="color: #e6db74;">'a'</span>: 1, <span style="color: #e6db74;">'b'</span>: 2}, {<span style="color: #e6db74;">'a'</span>: 5, <span style="color: #e6db74;">'b'</span>: 10, <span style="color: #e6db74;">'c'</span>: 20}]

log(<span style="color: #e6db74;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #e6db74;">"pd.DataFrame(data, index=['first', 'second'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #e6db74;">'first'</span>, <span style="color: #e6db74;">'second'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(data, columns=['a', 'b'])"</span>,
    pd.DataFrame(data, columns=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>]))

</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   a   b     c
0  1   2   NaN
1  5  10  20.0
================ pd.DataFrame(data, index=['first', 'second']) =================
        a   b     c
first   1   2   NaN
second  5  10  20.0
==================== pd.DataFrame(data, columns=['a', 'b']) ====================
   a   b
0  1   2
1  5  10
</pre>
</div>
</div>




<div id="outline-container-org0695934" class="outline-5">
<h5 id="org0695934"><span class="section-number-5">1.4.1.4</span> 从元组字典创建</h5>
<div class="outline-text-5" id="text-1-4-1-4">
<p>
实际应用中，会通过数据清洗的方式，把数据整理成方便 Pandas 导入且可读性好的格式。
然后再通过 <b>reindex/groupby</b> 等方式转换成复杂数据结构。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {(<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 1, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 2},
     (<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 3, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 4},
     (<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 5, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 6},
     (<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 7, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 8},
     (<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'D'</span>): 9, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 10}}

<span style="color: #465457;"># </span><span style="color: #465457;">&#22810;&#32423;&#26631;&#31614;</span>
log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
       a              b
       b    a    c    a     b
A B  1.0  4.0  5.0  8.0  10.0
  C  2.0  3.0  6.0  7.0   NaN
  D  NaN  NaN  NaN  NaN   9.0

</pre>
</div>
</div>



<div id="outline-container-orgd132ac9" class="outline-5">
<h5 id="orgd132ac9"><span class="section-number-5">1.4.1.5</span> 从 Series 创建</h5>
<div class="outline-text-5" id="text-1-4-1-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"pd.DataFrame(s)"</span>, pd.DataFrame(s))
log(<span style="color: #e6db74;">"pd.DataFrame(s, index=['a', 'c', 'd'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>], columns=[<span style="color: #e6db74;">'A'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(s) ================================
          0
a  1.052429
b -0.183841
c -0.567050
d -0.946448
e -0.245539
==================== pd.DataFrame(s, index=['a', 'c', 'd']) ====================
          0
a  1.052429
c -0.567050
d -0.946448
============ pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A']) =============
          A
a  1.052429
c -0.567050
d -0.946448
</pre>
</div>
</div>



<div id="outline-container-org8fbe1c1" class="outline-5">
<h5 id="org8fbe1c1"><span class="section-number-5">1.4.1.6</span> 指定行列索引创建</h5>
<div class="outline-text-5" id="text-1-4-1-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">dates</span> = pd.date_range(<span style="color: #e6db74;">'20160301'</span>, periods=6)
log(<span style="color: #e6db74;">"dates"</span>, dates)

<span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCD'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.048170  1.536653  0.286190 -0.105748
2016-03-02  0.212721 -0.019064 -0.235831 -0.123454
2016-03-03 -0.465780  0.908629  0.148821  0.736669
2016-03-04  1.020257  1.094551  0.508659  0.018455
2016-03-05 -0.065958  0.437436 -1.026936  0.028647
2016-03-06 -0.055553  0.853023 -0.155418  0.160215
</pre>
</div>
</div>
</div>


<div id="outline-container-org6950ecf" class="outline-4">
<h4 id="org6950ecf"><span class="section-number-4">1.4.2</span> 基本操作</h4>
<div class="outline-text-4" id="text-1-4-2">
</div>
<div id="outline-container-orga580996" class="outline-5">
<h5 id="orga580996"><span class="section-number-5">1.4.2.1</span> 转置</h5>
<div class="outline-text-5" id="text-1-4-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Nevada'</span>: {2001: 2.4, 2002: 2.9},
        <span style="color: #e6db74;">'Ohio'</span>: {2001: 1.5, 2001: 1.7, 2002: 3.6}}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.T"</span>, df.T)
</pre>
</div>

<pre class="example">
====================================== df ======================================
      Nevada  Ohio
2001     2.4   1.7
2002     2.9   3.6
===================================== df.T =====================================
        2001  2002
Nevada   2.4   2.9
Ohio     1.7   3.6

</pre>
</div>
</div>



<div id="outline-container-orge1a7778" class="outline-5">
<h5 id="orge1a7778"><span class="section-number-5">1.4.2.2</span> 算数运算填充</h5>
<div class="outline-text-5" id="text-1-4-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.arange(12.).reshape((3, 4)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))

<span style="color: #fd971f;">df2</span> = pd.DataFrame(np.arange(20.).reshape((4, 5)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df1 + df2"</span>, df1 + df2)
log(<span style="color: #e6db74;">"df1.add(df2, fill_value=0)"</span>, df1.add(df2, fill_value=0))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
     a    b     c     d
0  0.0  1.0   2.0   3.0
1  4.0  5.0   6.0   7.0
2  8.0  9.0  10.0  11.0
===================================== df2 ======================================
      a     b     c     d     e
0   0.0   1.0   2.0   3.0   4.0
1   5.0   6.0   7.0   8.0   9.0
2  10.0  11.0  12.0  13.0  14.0
3  15.0  16.0  17.0  18.0  19.0
================================== df1 + df2 ===================================
      a     b     c     d   e
0   0.0   2.0   4.0   6.0 NaN
1   9.0  11.0  13.0  15.0 NaN
2  18.0  20.0  22.0  24.0 NaN
3   NaN   NaN   NaN   NaN NaN
========================== df1.add(df2, fill_value=0) ==========================
      a     b     c     d     e
0   0.0   2.0   4.0   6.0   4.0
1   9.0  11.0  13.0  15.0   9.0
2  18.0  20.0  22.0  24.0  14.0
3  15.0  16.0  17.0  18.0  19.0
</pre>
</div>
</div>



<div id="outline-container-orga1e0eeb" class="outline-5">
<h5 id="orga1e0eeb"><span class="section-number-5">1.4.2.3</span> 和 Series 之间的运算（广播机制）</h5>
<div class="outline-text-5" id="text-1-4-2-3">
<p>
默认会将 Series 的索引与 DataFrame 的列进行匹配，并广播到各行：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12.).reshape((4, 3)),
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bde'</span>),
                  index=[<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Oregon'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">s</span> = df.iloc[0]
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"df - s"</span>, df - s)
<span style="color: #fd971f;">s2</span> = pd.Series(<span style="color: #a6e22e;">range</span>(3), index=[<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'e'</span>, <span style="color: #e6db74;">'f'</span>])
log(<span style="color: #e6db74;">"df + s2"</span>, df + s2)
</pre>
</div>

<pre class="example">
====================================== df ======================================
          b     d     e
Utah    0.0   1.0   2.0
Ohio    3.0   4.0   5.0
Texas   6.0   7.0   8.0
Oregon  9.0  10.0  11.0
====================================== s =======================================
b    0.0
d    1.0
e    2.0
Name: Utah, dtype: float64
==================================== df - s ====================================
          b    d    e
Utah    0.0  0.0  0.0
Ohio    3.0  3.0  3.0
Texas   6.0  6.0  6.0
Oregon  9.0  9.0  9.0
=================================== df + s2 ====================================
          b   d     e   f
Utah    0.0 NaN   3.0 NaN
Ohio    3.0 NaN   6.0 NaN
Texas   6.0 NaN   9.0 NaN
Oregon  9.0 NaN  12.0 NaN
</pre>

<p>
如果想在列上广播，在行上匹配，必须使用 <span class="underline">算数方法</span> 中的一种：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s3</span> = df[<span style="color: #e6db74;">'d'</span>]
log(<span style="color: #e6db74;">"df.sub(s3, axis='index')"</span>, df.sub(s3, axis=<span style="color: #e6db74;">'index'</span>))
</pre>
</div>

<pre class="example">
=========================== df.sub(s3, axis='index') ===========================
          b    d    e
Utah   -1.0  0.0  1.0
Ohio   -1.0  0.0  1.0
Texas  -1.0  0.0  1.0
Oregon -1.0  0.0  1.0

</pre>
</div>
</div>


<div id="outline-container-org0398910" class="outline-5">
<h5 id="org0398910"><span class="section-number-5">1.4.2.4</span> 应用函数</h5>
<div class="outline-text-5" id="text-1-4-2-4">
<p>
从本质上讲，DataFrame 内部用的数据结构就是 numpy 的 ndarray 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"np.exp(df)"</span>, np.exp(df))
log(<span style="color: #e6db74;">"np.sin(df)"</span>, np.sin(df))
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
0  0.384419 -0.261265 -0.776319 -1.083965
1 -0.280943  1.203641  0.392169 -2.484636
2  1.101764  0.041095  1.075932  0.543424
3  0.472131  0.070010 -0.199482 -0.140922
4 -0.479721  0.281841  1.163404  0.694684
5 -0.464032 -1.058426 -0.692909  0.244612
6  1.082909  1.101045 -1.151583 -1.061644
7  0.533688 -1.130648 -0.350829  1.444129
8 -0.019973  1.649555  1.037025  0.059973
9 -0.337814 -2.070719  1.277318 -0.913099
================================== np.exp(df) ==================================
        one       two     three      four
0  1.468760  0.770077  0.460097  0.338252
1  0.755072  3.332227  1.480187  0.083356
2  3.009471  1.041951  2.932725  1.721893
3  1.603407  1.072519  0.819155  0.868557
4  0.618956  1.325568  3.200812  2.003075
5  0.628743  0.347002  0.500119  1.277125
6  2.953258  3.007307  0.316136  0.345887
7  1.705209  0.322824  0.704104  4.238160
8  0.980226  5.204665  2.820814  1.061808
9  0.713328  0.126095  3.587005  0.401279
================================== np.sin(df) ==================================
        one       two     three      four
0  0.375020 -0.258303 -0.700658 -0.883820
1 -0.277262  0.933352  0.382193 -0.610710
2  0.892006  0.041083  0.880033  0.517070
3  0.454785  0.069953 -0.198162 -0.140456
4 -0.461532  0.278124  0.918157  0.640142
5 -0.447558 -0.871585 -0.638778  0.242180
6  0.883325  0.891681 -0.913410 -0.873158
7  0.508712 -0.904688 -0.343677  0.991988
8 -0.019971  0.996900  0.860895  0.059937
9 -0.331425 -0.877620  0.957243 -0.791402
</pre>
</div>
</div>


<div id="outline-container-orgb6eed22" class="outline-5">
<h5 id="orgb6eed22"><span class="section-number-5">1.4.2.5</span> 行/列映射 (apply)</h5>
<div class="outline-text-5" id="text-1-4-2-5">
<p>
<code>df.apply(series_to_series_func) -&gt; DataFrame</code>
</p>

<p>
<code>df.apply(series_to_value_func) -&gt; Series</code>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape(4, 3),
                  index=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABC'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.apply(lambda x: x.max() - x.min())"</span>, df.<span style="color: #a6e22e;">apply</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.<span style="color: #a6e22e;">max</span>() - x.<span style="color: #a6e22e;">min</span>()))
log(<span style="color: #e6db74;">"df.apply(lambda x: x.max() - x.min(), axis=1)"</span>, df.<span style="color: #a6e22e;">apply</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.<span style="color: #a6e22e;">max</span>() - x.<span style="color: #a6e22e;">min</span>(), axis=1))
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">min_max</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> pd.Series([x.<span style="color: #a6e22e;">min</span>(), x.<span style="color: #a6e22e;">max</span>()], index=[<span style="color: #e6db74;">'min'</span>, <span style="color: #e6db74;">'max'</span>])
log(<span style="color: #e6db74;">"df.apply(min_max, axis=1)"</span>, df.<span style="color: #a6e22e;">apply</span>(min_max, axis=1))
</pre>
</div>

<pre class="example">
====================================== df ======================================
       A   B   C
one    0   1   2
two    3   4   5
three  6   7   8
four   9  10  11
==================== df.apply(lambda x: x.max() - x.min()) =====================
A    9
B    9
C    9
dtype: int64
================ df.apply(lambda x: x.max() - x.min(), axis=1) =================
one      2
two      2
three    2
four     2
dtype: int64
========================== df.apply(min_max, axis=1) ===========================
       min  max
one      0    2
two      3    5
three    6    8
four     9   11
</pre>
</div>
</div>


<div id="outline-container-org3cc6a79" class="outline-5">
<h5 id="org3cc6a79"><span class="section-number-5">1.4.2.6</span> 逐元素映射 (applymap)</h5>
<div class="outline-text-5" id="text-1-4-2-6">
<p>
<code>df.applymap(value_to_value_func) -&gt; DataFrame</code>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(4, 3),
                  index=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABC'</span>))

log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.applymap(lambda x: '{0:.03f}'.format(x))"</span>, df.applymap(<span style="color: #f92672; font-weight: bold;">lambda</span> x: <span style="color: #e6db74;">'{0:.03f}'</span>.<span style="color: #a6e22e;">format</span>(x)))
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf6318b1" class="outline-5">
<h5 id="orgf6318b1"><span class="section-number-5">1.4.2.7</span> 排序(sort_index/sort_values)</h5>
<div class="outline-text-5" id="text-1-4-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(8).reshape((2, 4)),
                  index=[<span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'one'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'dabc'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.sort_index()"</span>, df.sort_index())
log(<span style="color: #e6db74;">"df.sort_index(axis=1)"</span>, df.sort_index(axis=1))
log(<span style="color: #e6db74;">"df.sort_values(by='a')"</span>, df.sort_values(by=<span style="color: #e6db74;">'a'</span>))
log(<span style="color: #e6db74;">"df.sort_values(by=['a', 'b'])"</span>, df.sort_values(by=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
=============================== df.sort_index() ================================
       d  a  b  c
one    4  5  6  7
three  0  1  2  3
============================ df.sort_index(axis=1) =============================
       a  b  c  d
three  1  2  3  0
one    5  6  7  4
============================ df.sort_values(by='a') ============================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
======================== df.sort_values(by=['a', 'b']) =========================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
</pre>
</div>
</div>


<div id="outline-container-org4ecc8d5" class="outline-5">
<h5 id="org4ecc8d5"><span class="section-number-5">1.4.2.8</span> 排名(rank)</h5>
<div class="outline-text-5" id="text-1-4-2-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'b'</span>: [4.3, 7, -3, 2], <span style="color: #e6db74;">'a'</span>: [0, 1, 0, 1], <span style="color: #e6db74;">'c'</span>: [-2, 5, 8, -2.5]})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.rank(axis='columns')"</span>, df.rank(axis=<span style="color: #e6db74;">'columns'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
     b  a    c
0  4.3  0 -2.0
1  7.0  1  5.0
2 -3.0  0  8.0
3  2.0  1 -2.5
=========================== df.rank(axis='columns') ============================
     b    a    c
0  3.0  2.0  1.0
1  3.0  1.0  2.0
2  1.0  2.0  3.0
3  3.0  2.0  1.0
</pre>
</div>
</div>


<div id="outline-container-org419c86e" class="outline-5">
<h5 id="org419c86e"><span class="section-number-5">1.4.2.9</span> 转换为 ndarray 对象</h5>
<div class="outline-text-5" id="text-1-4-2-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
<span style="color: #fd971f;">ary</span> = np.asarray(df)
log(<span style="color: #e6db74;">"ary"</span>, ary)
log(<span style="color: #e6db74;">"ary == df.values"</span>, ary == df.values)
log(<span style="color: #e6db74;">"ary == df"</span>, ary == df)
</pre>
</div>

<pre class="example">
===================================== ary ======================================
[[ 2.04624678 -0.6312282   0.67979273 -0.44172316]
 [-0.86094589  1.94346553 -2.14098712 -0.59540524]
 [-0.15020567  0.89921316  1.57976154  1.28561354]
 [ 0.36556931  0.74106876 -1.11107492 -0.0127461 ]
 [ 1.0701633  -1.33064105  0.21082171  2.11969444]
 [-1.40825621  0.77820317  0.28563787 -0.00318099]
 [-0.41136998  0.73250492  1.42237664 -1.03227235]
 [-0.05801189  0.2636244  -1.40155875 -1.28585849]
 [-1.00331627  0.53425829 -0.37204681  0.34346003]
 [-0.39496311 -1.61744328 -0.95510468 -0.5185989 ]]
=============================== ary == df.values ===============================
[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
================================== ary == df ===================================
    one   two  three  four
0  True  True   True  True
1  True  True   True  True
2  True  True   True  True
3  True  True   True  True
4  True  True   True  True
5  True  True   True  True
6  True  True   True  True
7  True  True   True  True
8  True  True   True  True
9  True  True   True  True
</pre>
</div>
</div>



<div id="outline-container-org1085211" class="outline-5">
<h5 id="org1085211"><span class="section-number-5">1.4.2.10</span> 统计</h5>
<div class="outline-text-5" id="text-1-4-2-10">
<ul class="org-ul">
<li>count
非 NA 值个数</li>
<li>describe
计算 Series 或 DataFrame 各列的汇总统计集合</li>
<li>min, max</li>
<li>argmin, argmax
最大最小值所在索引位置（整数）</li>
<li>idxmin, idxmax
最大最小值所在索引标签</li>
<li>quantile
计算样本从 0 到 1 间的分位数</li>
<li>sum</li>
<li>mean</li>
<li>median</li>
<li>mad
平均值的平均绝对偏差</li>
<li>mod
频繁统计</li>
<li>prod
所有值的积</li>
<li>var
样本方差</li>
<li>std
标准差</li>
<li>skew
样本偏度（第三时刻）值</li>
<li>kurt
样本峰度（第四时刻）值</li>
<li>cumsum
累计值</li>
<li>cummin, cummax</li>
<li>cumprod</li>
<li>diff
计算第一个算术差值（对时间序列有用）</li>
<li>pct_change
计算百分比</li>
</ul>
</div>
</div>
</div>
</div>
</div>





<div id="outline-container-org3b85a64" class="outline-2">
<h2 id="org3b85a64"><span class="section-number-2">2</span> 索引</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org11d3388" class="outline-3">
<h3 id="org11d3388"><span class="section-number-3">2.1</span> Series</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgc66e10d" class="outline-4">
<h4 id="orgc66e10d"><span class="section-number-4">2.1.1</span> 设置对象自身和索引的 name 属性</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Ohio'</span>: 35000, <span style="color: #e6db74;">'Texas'</span>: 71000, <span style="color: #e6db74;">'Oregon'</span>: 16000, <span style="color: #e6db74;">'Utah'</span>: 5000}
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'California'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Oregon'</span>, <span style="color: #e6db74;">'Texas'</span>]
<span style="color: #fd971f;">s</span> = pd.Series(data, index=states)
<span style="color: #fd971f;">s.name</span> = <span style="color: #e6db74;">'population'</span>
<span style="color: #fd971f;">s.index.name</span> = <span style="color: #e6db74;">'state'</span>
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
state
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
Name: population, dtype: float64

</pre>
</div>
</div>


<div id="outline-container-orgc33a1da" class="outline-4">
<h4 id="orgc33a1da"><span class="section-number-4">2.1.2</span> 获取值和索引</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.values"</span>, s.values)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.007460
b   -0.346364
c   -1.524387
d   -0.389066
e    0.464790
dtype: float64
=================================== s.values ===================================
[ 0.00745967 -0.34636371 -1.52438655 -0.38906608  0.46479046]
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
</pre>
</div>
</div>


<div id="outline-container-org0623515" class="outline-4">
<h4 id="org0623515"><span class="section-number-4">2.1.3</span> 索引对齐</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
相同索引值才进行操作
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s1</span> = pd.Series(np.random.randint(3, size=3), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'e'</span>])
<span style="color: #fd971f;">s2</span> = pd.Series(np.random.randint(3, size=3), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s1"</span>, s1)
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s1 + s2"</span>, s1 + s2)
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a    1
c    0
e    1
dtype: int64
====================================== s2 ======================================
a    1
d    1
e    0
dtype: int64
=================================== s1 + s2 ====================================
a    2.0
c    NaN
d    NaN
e    1.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-org8396e84" class="outline-4">
<h4 id="org8396e84"><span class="section-number-4">2.1.4</span> 重建索引</h4>
<div class="outline-text-4" id="text-2-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4.5, 7.2, -5.3, 3.6], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.reindex(['a', 'b', 'c', 'd', 'e'])"</span>, s.reindex([<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>]))
</pre>
</div>

<pre class="example">
====================================== s =======================================
d    4.5
b    7.2
a   -5.3
c    3.6
dtype: float64
===================== s.reindex(['a', 'b', 'c', 'd', 'e']) =====================
a   -5.3
b    7.2
c    3.6
d    4.5
e    NaN
dtype: float64
</pre>

<p>
重建索引时插值:
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([<span style="color: #e6db74;">'blue'</span>, <span style="color: #e6db74;">'purple'</span>, <span style="color: #e6db74;">'yellow'</span>], index=[0, 2, 4])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.reindex(range(6), method='ffill')"</span>, s.reindex(<span style="color: #a6e22e;">range</span>(6), method=<span style="color: #e6db74;">'ffill'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
0      blue
2    purple
4    yellow
dtype: object
===================== s.reindex(range(6), method='ffill') ======================
0      blue
1      blue
2    purple
3    purple
4    yellow
5    yellow
dtype: object
</pre>
</div>
</div>



<div id="outline-container-orgcba1694" class="outline-4">
<h4 id="orgcba1694"><span class="section-number-4">2.1.5</span> 删除索引</h4>
<div class="outline-text-4" id="text-2-1-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.arange(5.), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.drop('c')"</span>, s.drop(<span style="color: #e6db74;">'c'</span>))
log(<span style="color: #e6db74;">"s.drop(['d', 'c'])"</span>, s.drop([<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'c'</span>]))
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    2.0
d    3.0
e    4.0
dtype: float64
================================= s.drop('c') ==================================
a    0.0
b    1.0
d    3.0
e    4.0
dtype: float64
============================== s.drop(['d', 'c']) ==============================
a    0.0
b    1.0
e    4.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-org96ae81f" class="outline-4">
<h4 id="org96ae81f"><span class="section-number-4">2.1.6</span> 标签索引</h4>
<div class="outline-text-4" id="text-2-1-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s['a']"</span>, s[<span style="color: #e6db74;">'a'</span>])
<span style="color: #fd971f;">s</span>[<span style="color: #e6db74;">'d'</span>] = 6
log(<span style="color: #e6db74;">"s[['c', 'a', 'd']]"</span>, s[[<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'d'</span>]])
log(<span style="color: #e6db74;">"s['b' : 'c']"</span>, s[<span style="color: #e6db74;">'b'</span> : <span style="color: #e6db74;">'c'</span>])

</pre>
</div>

<pre class="example">
====================================== s =======================================
a    4
b    7
c   -5
d    3
dtype: int64
==================================== s['a'] ====================================
4
============================== s[['c', 'a', 'd']] ==============================
c   -5
a    4
d    6
dtype: int64
================================= s['b' : 'c'] =================================
b    7
c   -5
dtype: int64
</pre>
</div>
</div>





<div id="outline-container-org59276b6" class="outline-4">
<h4 id="org59276b6"><span class="section-number-4">2.1.7</span> 布尔索引</h4>
<div class="outline-text-4" id="text-2-1-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s[s &gt; 0]"</span>, s[s &gt; 0])
</pre>
</div>

<pre class="example">
=================================== s[s &gt; 0] ===================================
d    4
b    7
c    3
dtype: int64

</pre>
</div>
</div>
</div>






<div id="outline-container-org547b9e5" class="outline-3">
<h3 id="org547b9e5"><span class="section-number-3">2.2</span> DataFrame</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org6aac104" class="outline-4">
<h4 id="org6aac104"><span class="section-number-4">2.2.1</span> 设置行/列索引的 name 属性</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Nevada'</span>: {2001: 2.4, 2002: 2.9},
        <span style="color: #e6db74;">'Ohio'</span>: {2001: 1.5, 2001: 1.7, 2002: 3.6}}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
<span style="color: #fd971f;">df.index.name</span> = <span style="color: #e6db74;">'year'</span>
<span style="color: #fd971f;">df.columns.name</span> = <span style="color: #e6db74;">'state'</span>
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
state  Nevada  Ohio
year
2001      2.4   1.7
2002      2.9   3.6

</pre>
</div>
</div>


<div id="outline-container-org4aa88ed" class="outline-4">
<h4 id="org4aa88ed"><span class="section-number-4">2.2.2</span> 重建索引</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
在 DataFrame 中， <code>reindex</code> 可以改变行索引，列索引，也可以同时改变两者。
</p>

<p>
<code>fill method</code> 只对行重新索引有效，不适用列。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(9).reshape((3,3)),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'acd'</span>),
                  columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'California'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#37325;&#24314;&#34892;&#32034;&#24341;</span>
log(<span style="color: #e6db74;">"df.reindex(['a', 'b', 'c', 'd'])"</span>, df.reindex([<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
<span style="color: #465457;"># </span><span style="color: #465457;">&#37325;&#24314;&#21015;&#32034;&#24341;</span>
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'California'</span>]
log(<span style="color: #e6db74;">"df.reindex(columns=states)"</span>, df.reindex(columns=states))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   Ohio  Texas  California
a     0      1           2
c     3      4           5
d     6      7           8
======================= df.reindex(['a', 'b', 'c', 'd']) =======================
   Ohio  Texas  California
a   0.0    1.0         2.0
b   NaN    NaN         NaN
c   3.0    4.0         5.0
d   6.0    7.0         8.0
========================== df.reindex(columns=states) ==========================
   Texas  Utah  California
a      1   NaN           2
c      4   NaN           5
d      7   NaN           8
</pre>
</div>
</div>


<div id="outline-container-org5e68c5e" class="outline-4">
<h4 id="org5e68c5e"><span class="section-number-4">2.2.3</span> 索引对齐</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
DataFrame 在进行数据计算时， <b>会自动按行和列进行数据对齐</b> 。
最终的计算结果会合并两个 DataFrame 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.arange(9.).reshape((3, 3)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcd'</span>),
                   index=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Colorado'</span>])

<span style="color: #fd971f;">df2</span> = pd.DataFrame(np.arange(12.).reshape((4, 3)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bde'</span>),
                   index=[<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Oregon'</span>])

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df1 + df2"</span>, df1 + df2)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf7a52ac" class="outline-4">
<h4 id="orgf7a52ac"><span class="section-number-4">2.2.4</span> 列赋值</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
当将列表或数组赋值给一个列时，长度必须和 DataFrame 的长度相匹配。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns, index=index)
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'debt'</span>] = 16.5 <span style="color: #465457;"># </span><span style="color: #465457;">&#26631;&#37327;&#36171;&#20540;</span>
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'income'</span>] = np.arange(6.) <span style="color: #465457;"># </span><span style="color: #465457;">&#25968;&#32452;&#36171;&#20540;</span>
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       year   state  pop  debt  income
one    2000    Ohio  1.5  16.5     0.0
two    2001    Ohio  1.7  16.5     1.0
three  2002    Ohio  3.6  16.5     2.0
four   2001  Nevada  2.4  16.5     3.0
five   2002  Nevada  2.9  16.5     4.0
six    2003  Nevada  3.2  16.5     5.0

</pre>


<p>
将 Series 赋值给一列时，Series 的索引会按照 DataFrame 的索引重新排列。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">val</span> = pd.Series([-1.2, -1.5, -1.7], index=[<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>])
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'debt'</span>] = val
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       year   state  pop  debt  income
one    2000    Ohio  1.5   NaN     0.0
two    2001    Ohio  1.7  -1.2     1.0
three  2002    Ohio  3.6   NaN     2.0
four   2001  Nevada  2.4  -1.5     3.0
five   2002  Nevada  2.9  -1.7     4.0
six    2003  Nevada  3.2   NaN     5.0

</pre>
</div>
</div>



<div id="outline-container-orgd5bcb56" class="outline-4">
<h4 id="orgd5bcb56"><span class="section-number-4">2.2.5</span> 删除行/列</h4>
<div class="outline-text-4" id="text-2-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns, index=index)
<span style="color: #f92672; font-weight: bold;">del</span> df[<span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">yearSeries</span> = df.pop(<span style="color: #e6db74;">'year'</span>)
df.drop(<span style="color: #e6db74;">'state'</span>, axis=<span style="color: #e6db74;">'columns'</span>, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
Empty DataFrame
Columns: []
Index: [one, two, three, four, five, six]

</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.drop('Colorado')"</span>, df.drop(<span style="color: #e6db74;">'Colorado'</span>)) <span style="color: #465457;"># </span><span style="color: #465457;">&#21024;&#38500;&#34892;</span>
log(<span style="color: #e6db74;">"df.drop('two', axis='columns')"</span>, df.drop(<span style="color: #e6db74;">'two'</span>, axis=<span style="color: #e6db74;">'columns'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df.drop('Colorado') ==============================
          one  two  three  four
Ohio        0    1      2     3
Utah        8    9     10    11
New York   12   13     14    15
======================== df.drop('two', axis='columns') ========================
          one  three  four
Ohio        0      2     3
Colorado    4      6     7
Utah        8     10    11
New York   12     14    15
</pre>
</div>
</div>



<div id="outline-container-orgfb4cdaf" class="outline-4">
<h4 id="orgfb4cdaf"><span class="section-number-4">2.2.6</span> 标签索引</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
从 DataFrame 中玄虚的列是数据的 <span class="underline">视图</span> ，而不是拷贝。
如果需要复制，应当显式地使用 Series 的 <code>copy</code> 方法。
</p>

<p>
返回的 Series 与原 DataFrame 有相同的索引，且 Series 的 <code>name</code> 属性也会被合理地设置。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df['state']"</span>, df[<span style="color: #e6db74;">'state'</span>])
log(<span style="color: #e6db74;">"df.year"</span>, df.year)
log(<span style="color: #e6db74;">"df[['state', 'pop']]"</span>, df[[<span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]])
</pre>
</div>

<pre class="example">
====================================== df ======================================
   year   state  pop
0  2000    Ohio  1.5
1  2001    Ohio  1.7
2  2002    Ohio  3.6
3  2001  Nevada  2.4
4  2002  Nevada  2.9
5  2003  Nevada  3.2
================================= df['state'] ==================================
0      Ohio
1      Ohio
2      Ohio
3    Nevada
4    Nevada
5    Nevada
Name: state, dtype: object
=================================== df.year ====================================
0    2000
1    2001
2    2002
3    2001
4    2002
5    2003
Name: year, dtype: int64
============================= df[['state', 'pop']] =============================
    state  pop
0    Ohio  1.5
1    Ohio  1.7
2    Ohio  3.6
3  Nevada  2.4
4  Nevada  2.9
5  Nevada  3.2
</pre>
</div>
</div>


<div id="outline-container-org7535e0e" class="outline-4">
<h4 id="org7535e0e"><span class="section-number-4">2.2.7</span> 正则索引</h4>
<div class="outline-text-4" id="text-2-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.filter(regex=r'^t.*$')"</span>, df.<span style="color: #a6e22e;">filter</span>(regex=r<span style="color: #e6db74;">'^t.*$'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.266558  0.390929  0.381822 -0.662022
B  0.947612  1.492351  1.824414 -0.682042
C  0.920167 -0.387809 -1.606654 -0.692762
D -0.491672  0.135303  1.653127  0.036277
E -0.922068  0.128126 -1.823203  0.054199
F -0.023060 -0.725380  0.062327 -0.608580
========================== df.filter(regex=r'^t.*$') ===========================
        two     three
A  0.390929  0.381822
B  1.492351  1.824414
C -0.387809 -1.606654
D  0.135303  1.653127
E  0.128126 -1.823203
F -0.725380  0.062327
</pre>
</div>
</div>


<div id="outline-container-org6475858" class="outline-4">
<h4 id="org6475858"><span class="section-number-4">2.2.8</span> 整数索引</h4>
<div class="outline-text-4" id="text-2-2-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df[:2]"</span>, df[:2])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
==================================== df[:2] ====================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
</pre>
</div>
</div>


<div id="outline-container-orgc9dbc63" class="outline-4">
<h4 id="orgc9dbc63"><span class="section-number-4">2.2.9</span> 布尔索引</h4>
<div class="outline-text-4" id="text-2-2-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df[df['three'] &gt; 5]"</span>, df[df[<span style="color: #e6db74;">'three'</span>] &gt; 5])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df[df['three'] &gt; 5] ==============================
          one  two  three  four
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
</pre>
</div>
</div>


<div id="outline-container-org27ea4b6" class="outline-4">
<h4 id="org27ea4b6"><span class="section-number-4">2.2.10</span> loc 索引</h4>
<div class="outline-text-4" id="text-2-2-10">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.loc['Colorado', ['two', 'three']]"</span>, df.loc[<span style="color: #e6db74;">'Colorado'</span>, [<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>]])
log(<span style="color: #e6db74;">"df.loc[:'Utah', 'two']"</span>, df.loc[:<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'two'</span>])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
===================== df.loc['Colorado', ['two', 'three']] =====================
two      5
three    6
Name: Colorado, dtype: int64
============================ df.loc[:'Utah', 'two'] ============================
Ohio        1
Colorado    5
Utah        9
Name: two, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-orgd53848d" class="outline-4">
<h4 id="orgd53848d"><span class="section-number-4">2.2.11</span> iloc 索引</h4>
<div class="outline-text-4" id="text-2-2-11">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.iloc[2, [3, 0, 1]]"</span>, df.iloc[2, [3, 0, 1]])
log(<span style="color: #e6db74;">"df.iloc[[1, 2], [3, 0, 1]]"</span>, df.iloc[[1, 2], [3, 0, 1]])
log(<span style="color: #e6db74;">"df.iloc[:, :3][df.three &gt; 5]"</span>, df.iloc[:, :3][df.three &gt; 5])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================ df.iloc[2, [3, 0, 1]] =============================
four    11
one      8
two      9
Name: Utah, dtype: int64
========================== df.iloc[[1, 2], [3, 0, 1]] ==========================
          four  one  two
Colorado     7    4    5
Utah        11    8    9
========================= df.iloc[:, :3][df.three &gt; 5] =========================
          one  two  three
Colorado    4    5      6
Utah        8    9     10
New York   12   13     14
</pre>
</div>
</div>


<div id="outline-container-orge99125e" class="outline-4">
<h4 id="orge99125e"><span class="section-number-4">2.2.12</span> at 索引</h4>
<div class="outline-text-4" id="text-2-2-12">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.at['A', 'one']"</span>, df.at[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'one'</span>])
</pre>
</div>
</div>
</div>


<div id="outline-container-orgce60ef9" class="outline-4">
<h4 id="orgce60ef9"><span class="section-number-4">2.2.13</span> 随机索引</h4>
<div class="outline-text-4" id="text-2-2-13">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.sample(frac=0.5)"</span>, df.sample(frac=0.5))  <span style="color: #465457;"># </span><span style="color: #465457;">Randomly</span>
log(<span style="color: #e6db74;">"df.sample(n=3)"</span>, df.sample(n=3))  <span style="color: #465457;"># </span><span style="color: #465457;">Randomly</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df.sample(frac=0.5) ==============================
          one  two  three  four
Ohio        0    1      2     3
New York   12   13     14    15
================================ df.sample(n=3) ================================
          one  two  three  four
Colorado    4    5      6     7
Ohio        0    1      2     3
Utah        8    9     10    11
</pre>
</div>
</div>


<div id="outline-container-org88ee57b" class="outline-4">
<h4 id="org88ee57b"><span class="section-number-4">2.2.14</span> 重命名行/列</h4>
<div class="outline-text-4" id="text-2-2-14">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"origin df"</span>, df)
df.rename(columns={<span style="color: #e6db74;">'three'</span>: <span style="color: #e6db74;">'san'</span>}, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df (column index renamed)"</span>, df)
df.rename(index={<span style="color: #e6db74;">'C'</span>: <span style="color: #e6db74;">'ccc'</span>}, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df (index renamed)"</span>, df)
</pre>
</div>

<pre class="example">
================================== origin df ===================================
        one       two     three      four
A -1.293186 -1.303202 -0.434815  1.157079
B  0.559491  1.651170  1.130642  0.372430
C  0.087382  0.948737  0.103419 -0.364204
D  0.363415  0.463077 -1.130338 -1.252423
E -0.570689 -1.141226  0.144087 -0.297187
F  1.028409  1.627355 -1.264463 -0.109870
========================== df (column index renamed) ===========================
        one       two       san      four
A -1.293186 -1.303202 -0.434815  1.157079
B  0.559491  1.651170  1.130642  0.372430
C  0.087382  0.948737  0.103419 -0.364204
D  0.363415  0.463077 -1.130338 -1.252423
E -0.570689 -1.141226  0.144087 -0.297187
F  1.028409  1.627355 -1.264463 -0.109870
============================== df (index renamed) ==============================
          one       two       san      four
A   -1.293186 -1.303202 -0.434815  1.157079
B    0.559491  1.651170  1.130642  0.372430
ccc  0.087382  0.948737  0.103419 -0.364204
D    0.363415  0.463077 -1.130338 -1.252423
E   -0.570689 -1.141226  0.144087 -0.297187
F    1.028409  1.627355 -1.264463 -0.109870
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org2c55905" class="outline-2">
<h2 id="org2c55905"><span class="section-number-2">3</span> 数据清洗</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org6600e17" class="outline-3">
<h3 id="org6600e17"><span class="section-number-3">3.1</span> 处理缺失值</h3>
<div class="outline-text-3" id="text-3-1">
<p>
pandas 对象的所有统计信息默认情况下是 <span class="underline">排除</span> 缺失值的。
</p>

<p>
Python 内建的 None 值也被当做 NA 处理。
</p>


<div class="figure">
<p><img src="img/pandas_nan.png" alt="pandas_nan.png">
</p>
</div>
</div>

<div id="outline-container-org042fcc4" class="outline-4">
<h4 id="org042fcc4"><span class="section-number-4">3.1.1</span> 过滤缺失值(dropna)</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([1, np.nan, 3.5, np.nan, 7])
log(<span style="color: #e6db74;">"s.dropna()"</span>, s.dropna()) <span style="color: #465457;"># </span><span style="color: #465457;">&#31561;&#20215;&#20110; s[s.notnull()]</span>
</pre>
</div>

<pre class="example">
================================== s.dropna() ==================================
0    1.0
2    3.5
4    7.0
dtype: float64

</pre>


<p>
当处理 DataFrame 对象时， <code>dropna</code> <b>默认情况下删除包含缺失值的行</b> ：
（使用 <code>axis = 1</code> 删除列）
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame([
    [1, 6.5, 3],
    [1, np.nan, np.nan],
    [np.nan, np.nan, np.nan],
    [np.nan, 6.5, 3]
])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.dropna()"</span>, df.dropna())
</pre>
</div>

<pre class="example">
====================================== df ======================================
     0    1    2
0  1.0  6.5  3.0
1  1.0  NaN  NaN
2  NaN  NaN  NaN
3  NaN  6.5  3.0
================================= df.dropna() ==================================
     0    1    2
0  1.0  6.5  3.0

</pre>


<p>
当传入 <code>how = 'all'</code> 时， <b>删除所有值均为 NA 的那些行</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.dropna(how='all')"</span>, df.dropna(how=<span style="color: #e6db74;">'all'</span>))
</pre>
</div>

<p>
使用 <code>thresh</code> 参数来保留 <b>包含一定数量观察值</b> 的行：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(7, 3))
<span style="color: #fd971f;">df.iloc</span>[:4, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[:2, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.dropna()"</span>, df.dropna())
log(<span style="color: #e6db74;">"df.dropna(thresh=2)"</span>, df.dropna(thresh=2))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0 -0.215937       NaN       NaN
1 -1.358234       NaN       NaN
2  0.331335       NaN -0.901148
3 -0.466495       NaN  2.392151
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
================================= df.dropna() ==================================
          0         1         2
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
============================= df.dropna(thresh=2) ==============================
          0         1         2
2  0.331335       NaN -0.901148
3 -0.466495       NaN  2.392151
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
</pre>
</div>
</div>

<div id="outline-container-org57fe1bb" class="outline-4">
<h4 id="org57fe1bb"><span class="section-number-4">3.1.2</span> 补全缺失值(fillna)</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(7, 3))
<span style="color: #fd971f;">df.iloc</span>[:4, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[:2, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.fillna(0)"</span>, df.fillna(0))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0  0.997841       NaN       NaN
1 -0.554321       NaN       NaN
2 -0.804640       NaN  0.838684
3  0.666262       NaN -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991
================================= df.fillna(0) =================================
          0         1         2
0  0.997841  0.000000  0.000000
1 -0.554321  0.000000  0.000000
2 -0.804640  0.000000  0.838684
3  0.666262  0.000000 -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991
</pre>

<p>
调用 <code>fillna</code> 时使用字典，可以 <b>为不同列设定不同的填充值</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.fillna({1: 0.5, 2: 0})"</span>, df.fillna({1: 0.5, 2: 0}))
</pre>
</div>

<pre class="example">
========================== df.fillna({1: 0.5, 2: 0}) ===========================
          0         1         2
0  0.997841  0.500000  0.000000
1 -0.554321  0.500000  0.000000
2 -0.804640  0.500000  0.838684
3  0.666262  0.500000 -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991

</pre>

<p>
使用 <b>插值方法</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 3))
<span style="color: #fd971f;">df.iloc</span>[2:, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[4:, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.fillna(method='ffill')"</span>, df.fillna(method=<span style="color: #e6db74;">'ffill'</span>))
log(<span style="color: #e6db74;">"df.fillna(method='ffill', limit=2)"</span>, df.fillna(method=<span style="color: #e6db74;">'ffill'</span>, limit=2))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125       NaN -1.686062
3 -0.411193       NaN -0.738710
4 -0.038864       NaN       NaN
5 -0.561398       NaN       NaN
========================== df.fillna(method='ffill') ===========================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125  0.912126 -1.686062
3 -0.411193  0.912126 -0.738710
4 -0.038864  0.912126 -0.738710
5 -0.561398  0.912126 -0.738710
====================== df.fillna(method='ffill', limit=2) ======================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125  0.912126 -1.686062
3 -0.411193  0.912126 -0.738710
4 -0.038864       NaN -0.738710
5 -0.561398       NaN -0.738710
</pre>
</div>
</div>
</div>



<div id="outline-container-org053b3d2" class="outline-3">
<h3 id="org053b3d2"><span class="section-number-3">3.2</span> 数据转换</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org5019b75" class="outline-4">
<h4 id="org5019b75"><span class="section-number-4">3.2.1</span> 删除重复值</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"k1"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>] * 3 + [<span style="color: #e6db74;">'two'</span>],
        <span style="color: #e6db74;">"k2"</span>: [1, 1, 2, 3, 3, 4, 4]
    }
)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.duplicated()"</span>, df.duplicated())
</pre>
</div>

<pre class="example">
====================================== df ======================================
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4
6  two   4
=============================== df.duplicated() ================================
0    False
1    False
2    False
3    False
4    False
5    False
6     True
dtype: bool
</pre>

<p>
<code>drop_duplicates</code> 返回的是 DataFrame ，内容是 <code>duplicated</code> 返回 Series 中为 False 的部分：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.drop_duplicates()"</span>, df.drop_duplicates())
</pre>
</div>

<pre class="example">
============================= df.drop_duplicates() =============================
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4

</pre>

<p>
<b>基于某列</b> 去除重复值：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'v1'</span>] = <span style="color: #a6e22e;">range</span>(7)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.drop_duplicates(['k1'])"</span>, df.drop_duplicates([<span style="color: #e6db74;">'k1'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
    k1  k2  v1
0  one   1   0
1  two   1   1
2  one   2   2
3  two   3   3
4  one   3   4
5  two   4   5
6  two   4   6
========================== df.drop_duplicates(['k1']) ==========================
    k1  k2  v1
0  one   1   0
1  two   1   1
</pre>

<p>
<code>drop_duplicates</code> 默认保留第一个观测值，传入参数 <code>keep = 'last'</code> 将返回最后一个：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.drop_duplicates(['k1', 'k2'], keep='last')"</span>, df.drop_duplicates([<span style="color: #e6db74;">'k1'</span>, <span style="color: #e6db74;">'k2'</span>], keep=<span style="color: #e6db74;">'last'</span>))
</pre>
</div>

<pre class="example">
================ df.drop_duplicates(['k1', 'k2'], keep='last') =================
    k1  k2  v1
0  one   1   0
1  two   1   1
2  one   2   2
3  two   3   3
4  one   3   4
6  two   4   6

</pre>
</div>
</div>

<div id="outline-container-orgf6652c2" class="outline-4">
<h4 id="orgf6652c2"><span class="section-number-4">3.2.2</span> 使用函数或映射进行数据转换</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-ipython">  <span style="color: #fd971f;">df</span> = pd.DataFrame(
      {
          <span style="color: #e6db74;">"food"</span>: [<span style="color: #e6db74;">'bacon'</span>,
                   <span style="color: #e6db74;">'pulled pork'</span>,
                   <span style="color: #e6db74;">'bacon'</span>,
                   <span style="color: #e6db74;">'Pastrami'</span>,
                   <span style="color: #e6db74;">'corned beef'</span>,
                   <span style="color: #e6db74;">'Bacon'</span>,
                   <span style="color: #e6db74;">'pastrami'</span>,
                   <span style="color: #e6db74;">'honey ham'</span>,
                   <span style="color: #e6db74;">'nova lox'</span>],
          <span style="color: #e6db74;">"ounces"</span>: [4, 3, 12, 6, 7.5, 8, 3, 5, 6]
      }
  )

  <span style="color: #fd971f;">meat_to_animal</span> = {
      <span style="color: #e6db74;">"bacon"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"pulled pork"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"pastrami"</span>: <span style="color: #e6db74;">'cow'</span>,
      <span style="color: #e6db74;">"corned beef"</span>: <span style="color: #e6db74;">'cow'</span>,
      <span style="color: #e6db74;">"honey ham"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"nova lox"</span>: <span style="color: #e6db74;">'salmon'</span>
  }

log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#23558;&#20540;&#36716;&#25442;&#20026;&#23567;&#20889;</span>
<span style="color: #fd971f;">lowercased</span> = df[<span style="color: #e6db74;">'food'</span>].<span style="color: #a6e22e;">str</span>.lower()
log(<span style="color: #e6db74;">"lowercased"</span>, lowercased)
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'animal'</span>] = lowercased.<span style="color: #a6e22e;">map</span>(meat_to_animal)
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#20063;&#21487;&#20197; data['food'].map(lambda x: meat_to_animal[x.lower()])</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
          food  ounces
0        bacon     4.0
1  pulled pork     3.0
2        bacon    12.0
3     Pastrami     6.0
4  corned beef     7.5
5        Bacon     8.0
6     pastrami     3.0
7    honey ham     5.0
8     nova lox     6.0
================================== lowercased ==================================
0          bacon
1    pulled pork
2          bacon
3       pastrami
4    corned beef
5          bacon
6       pastrami
7      honey ham
8       nova lox
Name: food, dtype: object
====================================== df ======================================
          food  ounces  animal
0        bacon     4.0     pig
1  pulled pork     3.0     pig
2        bacon    12.0     pig
3     Pastrami     6.0     cow
4  corned beef     7.5     cow
5        Bacon     8.0     pig
6     pastrami     3.0     cow
7    honey ham     5.0     pig
8     nova lox     6.0  salmon
</pre>
</div>
</div>

<div id="outline-container-orga16160f" class="outline-4">
<h4 id="orga16160f"><span class="section-number-4">3.2.3</span> 替代值(replace)</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
使用 <code>fillna()</code> 是通用值替换的特殊案例。
</p>

<p>
使用 <code>map()</code> 可以用来修改一个数据中的值，但是 <code>replace()</code> 提供了 <b>更为简单</b> 的实现。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([1, -999, 2, -999, -1000, 3])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.replace(-999, np.nan)"</span>, s.replace(-999, np.nan))
</pre>
</div>

<pre class="example">
====================================== s =======================================
0       1
1    -999
2       2
3    -999
4   -1000
5       3
dtype: int64
=========================== s.replace(-999, np.nan) ============================
0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
</pre>

<p>
如果想要 <b>一次替代多个值</b> ，可以传入一个列表：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s.replace([-999, -1000], np.nan)"</span>, s.replace([-999, -1000], np.nan))
</pre>
</div>

<pre class="example">
======================= s.replace([-999, -1000], np.nan) =======================
0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64

</pre>

<p>
<b>将不同的值替换为不同的值</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s.replace([-999, -1000], [np.nan, 0])"</span>, s.replace([-999, -1000], [np.nan, 0]))
log(<span style="color: #e6db74;">"s.replace({-999: np.nan, -1000: 0})"</span>, s.replace({-999: np.nan, -1000: 0}))
</pre>
</div>

<pre class="example">
==================== s.replace([-999, -1000], [np.nan, 0]) =====================
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
===================== s.replace({-999: np.nan, -1000: 0}) ======================
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-org5b47ca2" class="outline-4">
<h4 id="org5b47ca2"><span class="section-number-4">3.2.4</span> 重命名索引</h4>
<div class="outline-text-4" id="text-3-2-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape((3,4)),
                  index=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Colorado'</span>, <span style="color: #e6db74;">'New York'</span>],
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])

<span style="color: #fd971f;">df.index</span> = df.index.<span style="color: #a6e22e;">map</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x[:4].upper())
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.rename(index=str.title, columns=str.upper)"</span>, df.rename(index=<span style="color: #a6e22e;">str</span>.title, columns=<span style="color: #a6e22e;">str</span>.upper))
log(<span style="color: #e6db74;">"df.rename(index={'OHIO': 'INDIANA'}, columns={'three': 'peekaboo'})"</span>, df.rename(index={<span style="color: #e6db74;">'OHIO'</span>: <span style="color: #e6db74;">'INDIANA'</span>}, columns={<span style="color: #e6db74;">'three'</span>: <span style="color: #e6db74;">'peekaboo'</span>}))
</pre>
</div>

<pre class="example">
====================================== df ======================================
      one  two  three  four
OHIO    0    1      2     3
COLO    4    5      6     7
NEW     8    9     10    11
================ df.rename(index=str.title, columns=str.upper) =================
      ONE  TWO  THREE  FOUR
Ohio    0    1      2     3
Colo    4    5      6     7
New     8    9     10    11
===== df.rename(index={'OHIO': 'INDIANA'}, columns={'three': 'peekaboo'}) ======
         one  two  peekaboo  four
INDIANA    0    1         2     3
COLO       4    5         6     7
NEW        8    9        10    11
</pre>
</div>
</div>


<div id="outline-container-org3a60ac6" class="outline-4">
<h4 id="org3a60ac6"><span class="section-number-4">3.2.5</span> 离散化和分箱(cut/qcut)</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
连续值经常需要离散化，或者分离成 <span class="underline">箱子</span> 进行分析。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">ages</span> = [20, 22, 25, 27, 21, 23, 37, 31, 61, 45, 41, 32]
<span style="color: #fd971f;">bins</span> = [18, 25, 35, 60, 100]
<span style="color: #fd971f;">cats</span> = pd.cut(ages, bins)
log(<span style="color: #e6db74;">"cats"</span>, cats)
log(<span style="color: #e6db74;">"cats.codes"</span>, cats.codes)
log(<span style="color: #e6db74;">"cats.categories"</span>, cats.categories)
log(<span style="color: #e6db74;">"cats.value_counts()"</span>, cats.value_counts())
</pre>
</div>

<pre class="example">
===================================== cats =====================================
[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
Length: 12
Categories (4, interval[int64]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
================================== cats.codes ==================================
[0 0 0 1 0 0 2 1 3 2 2 1]
=============================== cats.categories ================================
IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]]
              closed='right',
              dtype='interval[int64]')
============================= cats.value_counts() ==============================
(18, 25]     5
(25, 35]     3
(35, 60]     3
(60, 100]    1
dtype: int64
</pre>

<p>
通过传递 <code>right = False</code> 来改变区间哪一边是封闭的。
</p>

<p>
<b>自定义箱名</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">group_names</span> = [<span style="color: #e6db74;">'Youth'</span>, <span style="color: #e6db74;">'YoungAdult'</span>, <span style="color: #e6db74;">'MiddleAged'</span>, <span style="color: #e6db74;">'Senior'</span>]
log(<span style="color: #e6db74;">"pd.cut(ages, bins, labels=group_names)"</span>, pd.cut(ages, bins, labels=group_names))
</pre>
</div>

<pre class="example">
==================== pd.cut(ages, bins, labels=group_names) ====================
[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]
Length: 12
Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]

</pre>

<p>
若 <b>使用分箱的个数代替箱边</b> ， pandas 将根据数据中的最小值和最大值计算出等长的箱：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = np.random.rand(20)
<span style="color: #465457;"># </span><span style="color: #465457;">precision &#34920;&#31034;&#23558;&#21313;&#36827;&#21046;&#31934;&#24230;&#38480;&#21046;&#22312;&#20004;&#20301;</span>
log(<span style="color: #e6db74;">"pd.cut(data, 4, precision=2)"</span>, pd.cut(data, 4, precision=2))
</pre>
</div>

<pre class="example">
========================= pd.cut(data, 4, precision=2) =========================
[(0.5, 0.73], (0.5, 0.73], (0.73, 0.97], (0.26, 0.5], (0.024, 0.26], ..., (0.024, 0.26], (0.26, 0.5], (0.73, 0.97], (0.5, 0.73], (0.73, 0.97]]
Length: 20
Categories (4, interval[float64]): [(0.024, 0.26] &lt; (0.26, 0.5] &lt; (0.5, 0.73] &lt; (0.73, 0.97]]

</pre>

<p>
使用 <code>cut</code> 通常不会使每个箱具有相同的数据量。
<code>qcut</code> 基于样本分位数进行分箱，可以获得 <b>等长的箱</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = np.random.randn(1000)
<span style="color: #fd971f;">qcats</span> = pd.qcut(data, 4)
log(<span style="color: #e6db74;">"qcats.value_counts()"</span>, qcats.value_counts())
</pre>
</div>

<pre class="example">
============================= qcats.value_counts() =============================
(-3.532, -0.671]    250
(-0.671, 0.0582]    250
(0.0582, 0.744]     250
(0.744, 3.077]      250
dtype: int64

</pre>


<p>
<b>自定义分位数</b> ：(0 和 1 之间的数字)
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">qcuts</span> = pd.qcut(data, [0, 0.1, 0.5, 0.9, 1])
log(<span style="color: #e6db74;">"qcuts.value_counts()"</span>, qcuts.value_counts())
</pre>
</div>

<pre class="example">
============================= qcuts.value_counts() =============================
(-3.532, -1.302]    100
(-1.302, 0.0582]    400
(0.0582, 1.374]     400
(1.374, 3.077]      100
dtype: int64

</pre>
</div>
</div>


<div id="outline-container-orgf8f6763" class="outline-4">
<h4 id="orgf8f6763"><span class="section-number-4">3.2.6</span> 检测异常值(any)</h4>
<div class="outline-text-4" id="text-3-2-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(5, 4))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"np.abs(df) &gt; 1"</span>, np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1)
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any()"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>())
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any(axis=1)"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>(axis=1))
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any().any()"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>().<span style="color: #a6e22e;">any</span>())
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2         3
0  0.634347 -0.504562  0.337217  0.191453
1 -0.378714 -1.212778 -0.194362 -2.113623
2 -1.422029  0.532520 -0.348306  0.059880
3 -1.184722 -0.297884 -0.620028  0.378589
4  0.846286 -0.714991 -0.127334 -0.089754
================================ np.abs(df) &gt; 1 ================================
       0      1      2      3
0  False  False  False  False
1  False   True  False   True
2   True  False  False  False
3   True  False  False  False
4  False  False  False  False
============================ (np.abs(df) &gt; 1).any() ============================
0     True
1     True
2    False
3     True
dtype: bool
========================= (np.abs(df) &gt; 1).any(axis=1) =========================
0    False
1     True
2     True
3     True
4    False
dtype: bool
========================= (np.abs(df) &gt; 1).any().any() =========================
True
</pre>
</div>
</div>


<div id="outline-container-orgded3b72" class="outline-4">
<h4 id="orgded3b72"><span class="section-number-4">3.2.7</span> 随机重排序(sample/take)</h4>
<div class="outline-text-4" id="text-3-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(5*4).reshape((5, 4)))
<span style="color: #fd971f;">sampler</span> = np.random.permutation(5)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"sampler"</span>, sampler)
log(<span style="color: #e6db74;">"df.take(sampler)"</span>, df.take(sampler)) <span style="color: #465457;"># </span><span style="color: #465457;">&#21644; iloc &#31867;&#20284;</span>

log(<span style="color: #e6db74;">"df.sample(3)"</span>, df.sample(3))
log(<span style="color: #e6db74;">"df.sample(3, replace=True)"</span>, df.sample(3, replace=<span style="color: #ae81ff;">True</span>)) <span style="color: #465457;"># </span><span style="color: #465457;">&#20801;&#35768;&#26377;&#37325;&#22797;</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
    0   1   2   3
0   0   1   2   3
1   4   5   6   7
2   8   9  10  11
3  12  13  14  15
4  16  17  18  19
=================================== sampler ====================================
[2 3 0 1 4]
=============================== df.take(sampler) ===============================
    0   1   2   3
2   8   9  10  11
3  12  13  14  15
0   0   1   2   3
1   4   5   6   7
4  16  17  18  19
================================= df.sample(3) =================================
   0  1   2   3
2  8  9  10  11
0  0  1   2   3
1  4  5   6   7
========================== df.sample(3, replace=True) ==========================
    0   1   2   3
3  12  13  14  15
3  12  13  14  15
0   0   1   2   3
</pre>
</div>


<div id="outline-container-org95ca39e" class="outline-5">
<h5 id="org95ca39e"><span class="section-number-5">3.2.7.1</span> 使用 take 优化内存 <a id="org05a02ee"></a></h5>
<div class="outline-text-5" id="text-3-2-7-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">values</span> = pd.Series([0, 1, 0, 0] * 2)
<span style="color: #fd971f;">dim</span> = pd.Series([<span style="color: #e6db74;">'apple'</span>, <span style="color: #e6db74;">'orange'</span>])
log(<span style="color: #e6db74;">"values"</span>, values)
log(<span style="color: #e6db74;">"dim"</span>, dim)
log(<span style="color: #e6db74;">"dim.take(values)"</span>, dim.take(values))
</pre>
</div>

<pre class="example">
============================================== values ==============================================
0    0
1    1
2    0
3    0
4    0
5    1
6    0
7    0
dtype: int64
=============================================== dim ================================================
0     apple
1    orange
dtype: object
========================================= dim.take(values) =========================================
0     apple
1    orange
0     apple
0     apple
0     apple
1    orange
0     apple
0     apple
dtype: object
</pre>
</div>
</div>
</div>



<div id="outline-container-org59e18ec" class="outline-4">
<h4 id="org59e18ec"><span class="section-number-4">3.2.8</span> 指标矩阵(get_dummies)</h4>
<div class="outline-text-4" id="text-3-2-8">
<p>
如果一列有 k 个不同的值，可以衍生一个k 列的，值为 0 或 1 的矩阵。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key'</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacab'</span>), <span style="color: #e6db74;">'data'</span>: <span style="color: #a6e22e;">range</span>(6)})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"pd.get_dummies(df['key'])"</span>, pd.get_dummies(df[<span style="color: #e6db74;">'key'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
  key  data
0   b     0
1   b     1
2   a     2
3   c     3
4   a     4
5   b     5
========================== pd.get_dummies(df['key']) ===========================
   a  b  c
0  0  1  0
1  0  1  0
2  1  0  0
3  0  0  1
4  1  0  0
5  0  1  0
</pre>

<p>
添加前缀：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">dummies</span> = pd.get_dummies(df[<span style="color: #e6db74;">'key'</span>], prefix=<span style="color: #e6db74;">'key'</span>)
log(<span style="color: #e6db74;">"dummies"</span>, dummies)
<span style="color: #fd971f;">df_with_dummies</span> = df[[<span style="color: #e6db74;">'data'</span>]].join(dummies)
log(<span style="color: #e6db74;">"df_with_dummies"</span>, df_with_dummies)
</pre>
</div>

<pre class="example">
=================================== dummies ====================================
   key_a  key_b  key_c
0      0      1      0
1      0      1      0
2      1      0      0
3      0      0      1
4      1      0      0
5      0      1      0
=============================== df_with_dummies ================================
   data  key_a  key_b  key_c
0     0      0      1      0
1     1      0      1      0
2     2      1      0      0
3     3      0      0      1
4     4      1      0      0
5     5      0      1      0
</pre>

<p>
<code>get_dummies</code> 与 <code>cut</code> 等离散化函数结合使用是 <b>统计操作中一个有用的方法</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">np.random.seed(12345)
<span style="color: #fd971f;">values</span> = np.random.rand(10)
log(<span style="color: #e6db74;">"values"</span>, values)
<span style="color: #fd971f;">bins</span> = [0, 0.2, 0.4, 0.6, 0.8, 1]
log(<span style="color: #e6db74;">"pd.get_dummies(pd.cut(values, bins))"</span>, pd.get_dummies(pd.cut(values, bins)))
</pre>
</div>

<pre class="example">
==================================== values ====================================
[0.92961609 0.31637555 0.18391881 0.20456028 0.56772503 0.5955447
 0.96451452 0.6531771  0.74890664 0.65356987]
===================== pd.get_dummies(pd.cut(values, bins)) =====================
   (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]
0           0           0           0           0           1
1           0           1           0           0           0
2           1           0           0           0           0
3           0           1           0           0           0
4           0           0           1           0           0
5           0           0           1           0           0
6           0           0           0           0           1
7           0           0           0           1           0
8           0           0           0           1           0
9           0           0           0           1           0
</pre>
</div>
</div>




<div id="outline-container-org815de93" class="outline-4">
<h4 id="org815de93"><span class="section-number-4">3.2.9</span> 向量化函数</h4>
<div class="outline-text-4" id="text-3-2-9">
</div>
<div id="outline-container-orgc76a2da" class="outline-5">
<h5 id="orgc76a2da"><span class="section-number-5">3.2.9.1</span> str</h5>
<div class="outline-text-5" id="text-3-2-9-1">
<p>
为序列添加字符串操作方法，并能跳过 NA
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'Dave'</span>: <span style="color: #e6db74;">'dave@google.com'</span>,
    <span style="color: #e6db74;">"Steve"</span>: <span style="color: #e6db74;">'steve@gmail.com'</span>,
    <span style="color: #e6db74;">"Rob"</span>: <span style="color: #e6db74;">'rob@gmail.com'</span>,
    <span style="color: #e6db74;">"Wes"</span>: np.nan
}
<span style="color: #fd971f;">s</span> = pd.Series(data)
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.str.contains('gmail')"</span>, s.<span style="color: #a6e22e;">str</span>.contains(<span style="color: #e6db74;">'gmail'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
Dave     dave@google.com
Steve    steve@gmail.com
Rob        rob@gmail.com
Wes                  NaN
dtype: object
=========================== s.str.contains('gmail') ============================
Dave     False
Steve     True
Rob       True
Wes        NaN
dtype: object
</pre>
</div>
</div>


<div id="outline-container-org8c1698c" class="outline-5">
<h5 id="org8c1698c"><span class="section-number-5">3.2.9.2</span> dt</h5>
<div class="outline-text-5" id="text-3-2-9-2">
<p>
为序列添加时间操作方法
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">t</span> = pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, periods=10)
<span style="color: #fd971f;">s</span> = pd.Series(t)
<span style="color: #fd971f;">s</span>[3] = np.nan
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.dt.minute"</span>, s.dt.minute)
log(<span style="color: #e6db74;">"s.dt.dayofyear"</span>, s.dt.dayofyear)
log(<span style="color: #e6db74;">"s.dt.weekday"</span>, s.dt.weekday)
log(<span style="color: #e6db74;">"s.dt.weekday_name"</span>, s.dt.weekday_name)
log(<span style="color: #e6db74;">"s.dt.days_in_month"</span>, s.dt.days_in_month)
log(<span style="color: #e6db74;">"s.dt.is_month_start"</span>, s.dt.is_month_start)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0   2000-01-01
1   2000-01-02
2   2000-01-03
3          NaT
4   2000-01-05
5   2000-01-06
6   2000-01-07
7   2000-01-08
8   2000-01-09
9   2000-01-10
dtype: datetime64[ns]
================================= s.dt.minute ==================================
0    0.0
1    0.0
2    0.0
3    NaN
4    0.0
5    0.0
6    0.0
7    0.0
8    0.0
9    0.0
dtype: float64
================================ s.dt.dayofyear ================================
0     1.0
1     2.0
2     3.0
3     NaN
4     5.0
5     6.0
6     7.0
7     8.0
8     9.0
9    10.0
dtype: float64
================================= s.dt.weekday =================================
0    5.0
1    6.0
2    0.0
3    NaN
4    2.0
5    3.0
6    4.0
7    5.0
8    6.0
9    0.0
dtype: float64
============================== s.dt.weekday_name ===============================
0     Saturday
1       Sunday
2       Monday
3          NaN
4    Wednesday
5     Thursday
6       Friday
7     Saturday
8       Sunday
9       Monday
dtype: object
============================== s.dt.days_in_month ==============================
0    31.0
1    31.0
2    31.0
3     NaN
4    31.0
5    31.0
6    31.0
7    31.0
8    31.0
9    31.0
dtype: float64
============================= s.dt.is_month_start ==============================
0     True
1    False
2    False
3    False
4    False
5    False
6    False
7    False
8    False
9    False
dtype: bool
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org85f8594" class="outline-2">
<h2 id="org85f8594"><span class="section-number-2">4</span> 数据规整：连接，联合，重塑</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgb13ca18" class="outline-3">
<h3 id="orgb13ca18"><span class="section-number-3">4.1</span> 分层索引</h3>
<div class="outline-text-3" id="text-4-1">
<p>
分层索引提供了一种在 <b>低维度的形式中处理高维度数据</b> 的方式，它使用 <code>pd.MultiIndex</code> 类来表示。
</p>

<p>
比如在分析股票数据：
</p>
<ul class="org-ul">
<li>一级行索引可以是日期</li>
<li>二级行索引可以是股票代码</li>
<li>列索引可以是股票的交易量，开盘价，收盘价等等</li>
</ul>

<p>
这样就可以把多个股票放在同一个时间维度下进行考察和分析。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(9),
              index=[[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'d'</span>],
                     [1, 2, 3, 1, 3, 1, 2, 2, 3]])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a  1    1.007189
   2   -1.296221
   3    0.274992
b  1    0.228913
   3    1.352917
c  1    0.886429
   2   -2.001637
d  2   -0.371843
   3    1.669025
dtype: float64
=================================== s.index ====================================
MultiIndex(levels=[['a', 'b', 'c', 'd'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 2, 0, 1, 1, 2]])
</pre>

<p>
选取数据子集：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s['b']"</span>, s[<span style="color: #e6db74;">'b'</span>])
log(<span style="color: #e6db74;">"s['b':'c']"</span>, s[<span style="color: #e6db74;">'b'</span>:<span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s.loc[['b', 'd']]"</span>, s.loc[[<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'d'</span>]])
<span style="color: #465457;"># </span><span style="color: #465457;">&#36873;&#25321;&#20869;&#37096;&#23618;&#32423;</span>
log(<span style="color: #e6db74;">"s.loc[:, 2]"</span>, s.loc[:, 2])
</pre>
</div>

<pre class="example">
==================================== s['b'] ====================================
1    0.228913
3    1.352917
dtype: float64
================================== s['b':'c'] ==================================
b  1    0.228913
   3    1.352917
c  1    0.886429
   2   -2.001637
dtype: float64
============================== s.loc[['b', 'd']] ===============================
b  1    0.228913
   3    1.352917
d  2   -0.371843
   3    1.669025
dtype: float64
================================= s.loc[:, 2] ==================================
a   -1.296221
c   -2.001637
d   -0.371843
dtype: float64
</pre>
</div>

<div id="outline-container-orgde62afb" class="outline-4">
<h4 id="orgde62afb"><span class="section-number-4">4.1.1</span> 层级交换(swaplevel)与排序(sort_index)</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
<code>swaplevel</code> 接收两个层级序号或层级名称，返回一个进行了层级变更的新对象， <span class="underline">数据是不变的</span> 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape((4, 3)),
                  index=[[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>], [1, 2, 1, 2]],
                  columns=[[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Colorado'</span>], [<span style="color: #e6db74;">'Green'</span>, <span style="color: #e6db74;">'Red'</span>, <span style="color: #e6db74;">'Green'</span>]]
)
<span style="color: #fd971f;">df.index.names</span> = [<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>]
<span style="color: #fd971f;">df.columns.names</span> = [<span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'color'</span>]
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.swaplevel('key1', 'key2')"</span>, df.swaplevel(<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
state      Ohio     Colorado
color     Green Red    Green
key1 key2
a    1        0   1        2
     2        3   4        5
b    1        6   7        8
     2        9  10       11
========================= df.swaplevel('key1', 'key2') =========================
state      Ohio     Colorado
color     Green Red    Green
key2 key1
1    a        0   1        2
2    a        3   4        5
1    b        6   7        8
2    b        9  10       11
</pre>

<p>
<code>sort_index</code> 只能在单一层级上对数据进行排序。
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.sort_index(level=1)"</span>, df.sort_index(level=1))
log(<span style="color: #e6db74;">"df.swaplevel(0, 1).sort_index(level=0)"</span>, df.swaplevel(0, 1).sort_index(level=0))

</pre>
</div>

<pre class="example">
============================ df.sort_index(level=1) ============================
state      Ohio     Colorado
color     Green Red    Green
key1 key2
a    1        0   1        2
b    1        6   7        8
a    2        3   4        5
b    2        9  10       11
==================== df.swaplevel(0, 1).sort_index(level=0) ====================
state      Ohio     Colorado
color     Green Red    Green
key2 key1
1    a        0   1        2
     b        6   7        8
2    a        3   4        5
     b        9  10       11
</pre>


<p>
<b>如果索引按照字典顺序从最外层开始排序，则数据选择性能会更好</b>
</p>
</div>
</div>


<div id="outline-container-org9da3325" class="outline-4">
<h4 id="org9da3325"><span class="section-number-4">4.1.2</span> 列索引转为行索引 (set_index)</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
    <span style="color: #e6db74;">"a"</span>: <span style="color: #a6e22e;">range</span>(7),
    <span style="color: #e6db74;">"b"</span>: <span style="color: #a6e22e;">range</span>(7, 0, -1),
    <span style="color: #e6db74;">"c"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>],
    <span style="color: #e6db74;">"d"</span>: [0, 1, 2, 0, 1, 2, 3]
})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.set_index(['c', 'd'])"</span>, df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   a  b    c  d
0  0  7  one  0
1  1  6  one  1
2  2  5  one  2
3  3  4  two  0
4  4  3  two  1
5  5  2  two  2
6  6  1  two  3
=========================== df.set_index(['c', 'd']) ===========================
       a  b
c   d
one 0  0  7
    1  1  6
    2  2  5
two 0  3  4
    1  4  3
    2  5  2
    3  6  1
</pre>

<p>
默认情况下，用过行索引的列会从 DataFrame 中删除，也可以选择留下：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.set_index(['c', 'd'], drop=False)"</span>, df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>], drop=<span style="color: #ae81ff;">False</span>))
</pre>
</div>

<pre class="example">
===================== df.set_index(['c', 'd'], drop=False) =====================
       a  b    c  d
c   d
one 0  0  7  one  0
    1  1  6  one  1
    2  2  5  one  2
two 0  3  4  two  0
    1  4  3  two  1
    2  5  2  two  2
    3  6  1  two  3
</pre>
</div>
</div>


<div id="outline-container-org9877fb9" class="outline-4">
<h4 id="org9877fb9"><span class="section-number-4">4.1.3</span> 行索引转为列索引 (reset_index)</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
<code>reset_index</code> 是 <code>set_index</code> 的 <b>反操作</b> ，分层索引的行索引层级会被移动为列索引。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
    <span style="color: #e6db74;">"a"</span>: <span style="color: #a6e22e;">range</span>(7),
    <span style="color: #e6db74;">"b"</span>: <span style="color: #a6e22e;">range</span>(7, 0, -1),
    <span style="color: #e6db74;">"c"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>],
    <span style="color: #e6db74;">"d"</span>: [0, 1, 2, 0, 1, 2, 3]
})
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">df2</span> = df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df2.reset_index()"</span>, df2.reset_index())
</pre>
</div>

<pre class="example">
====================================== df ======================================
   a  b    c  d
0  0  7  one  0
1  1  6  one  1
2  2  5  one  2
3  3  4  two  0
4  4  3  two  1
5  5  2  two  2
6  6  1  two  3
===================================== df2 ======================================
       a  b
c   d
one 0  0  7
    1  1  6
    2  2  5
two 0  3  4
    1  4  3
    2  5  2
    3  6  1
============================== df2.reset_index() ===============================
     c  d  a  b
0  one  0  0  7
1  one  1  1  6
2  one  2  2  5
3  two  0  3  4
4  two  1  4  3
5  two  2  5  2
6  two  3  6  1
</pre>
</div>
</div>
</div>


<div id="outline-container-org39bd5c7" class="outline-3">
<h3 id="org39bd5c7"><span class="section-number-3">4.2</span> 连接与合并</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-orga38b562" class="outline-4">
<h4 id="orga38b562"><span class="section-number-4">4.2.1</span> merge</h4>
<div class="outline-text-4" id="text-4-2-1">
</div>
<div id="outline-container-org4d0cb6e" class="outline-5">
<h5 id="org4d0cb6e"><span class="section-number-5">4.2.1.1</span> 基本用法</h5>
<div class="outline-text-5" id="text-4-2-1-1">
<p>
合并或连接操作是通过一个或多个键，连接行来联合数据集。
</p>


<div class="figure">
<p><img src="img/pandas_merge.png" alt="pandas_merge.png">
</p>
</div>


<div class="figure">
<p><img src="img/pandas_merge2.png" alt="pandas_merge2.png">
</p>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacaab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(7)
})

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(3)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2)"</span>, pd.merge(df1, df2))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
  key  data1
0   b      0
1   b      1
2   a      2
3   c      3
4   a      4
5   a      5
6   b      6
===================================== df2 ======================================
  key  data2
0   a      0
1   b      1
2   d      2
============================== pd.merge(df1, df2) ==============================
  key  data1  data2
0   b      0      1
1   b      1      1
2   b      6      1
3   a      2      0
4   a      4      0
5   a      5      0
</pre>

<p>
若没有指定在哪一列上进行连接，即没有指定连接的键信息， <code>merge</code> 会自动将 <b>重叠列名作为连接键</b> 。
</p>

<p>
显示指定连接键才是好的做法：
</p>

<div class="org-src-container">
<pre class="src src-ipython">pd.merge(df1, df2, on=<span style="color: #e6db74;">'key'</span>)
</pre>
</div>

<p>
如果每个对象的列名是不同的，可以分别为它们指定列名：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"lkey"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacaab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(7)
})

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"rkey"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(3)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2, left_on='lkey', right_on='rkey')"</span>, pd.merge(df1, df2, left_on=<span style="color: #e6db74;">'lkey'</span>, right_on=<span style="color: #e6db74;">'rkey'</span>))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
  lkey  data1
0    b      0
1    b      1
2    a      2
3    c      3
4    a      4
5    a      5
6    b      6
===================================== df2 ======================================
  rkey  data2
0    a      0
1    b      1
2    d      2
============= pd.merge(df1, df2, left_on='lkey', right_on='rkey') ==============
  lkey  data1 rkey  data2
0    b      0    b      1
1    b      1    b      1
2    b      6    b      1
3    a      2    a      0
4    a      4    a      0
5    a      5    a      0
</pre>
</div>
</div>


<div id="outline-container-org4cb09ef" class="outline-5">
<h5 id="org4cb09ef"><span class="section-number-5">4.2.1.2</span> 合并类型(inner,outer,left,right)</h5>
<div class="outline-text-5" id="text-4-2-1-2">
<p>
默认情况下， <code>merge</code> 做的是内连接。
</p>

<p>
<b>多对多的连接是行的笛卡尔积</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(6)
})
<span style="color: #fd971f;">df1.index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ababd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(5)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2, on='key', how='left')"</span>, pd.merge(df1, df2, on=<span style="color: #e6db74;">'key'</span>, how=<span style="color: #e6db74;">'left'</span>))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
      key  data1
one     b      0
two     b      1
three   a      2
four    c      3
five    a      4
six     b      5
===================================== df2 ======================================
  key  data2
0   a      0
1   b      1
2   a      2
3   b      3
4   d      4
=================== pd.merge(df1, df2, on='key', how='left') ===================
   key  data1  data2
0    b      0    1.0
1    b      0    3.0
2    b      1    1.0
3    b      1    3.0
4    a      2    0.0
5    a      2    2.0
6    c      3    NaN
7    a      4    0.0
8    a      4    2.0
9    b      5    1.0
10   b      5    3.0
</pre>

<p>
<span class="underline">如上例所示，进行列-列连接时，索引对象会被丢弃。</span>
</p>
</div>
</div>



<div id="outline-container-orgee9b641" class="outline-5">
<h5 id="orgee9b641"><span class="section-number-5">4.2.1.3</span> 按索引合并<a id="org8a8d1c2"></a></h5>
<div class="outline-text-5" id="text-4-2-1-3">
<div class="org-src-container">
<pre class="src src-ipython">  <span style="color: #fd971f;">left1</span> = pd.DataFrame({
      <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abaabc'</span>),
      <span style="color: #e6db74;">"value"</span>: <span style="color: #a6e22e;">range</span>(6)
  })

  <span style="color: #fd971f;">right1</span> = pd.DataFrame({
      <span style="color: #e6db74;">"group_val"</span>: [3.5, 7]
  }, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>])

log(<span style="color: #e6db74;">"left1"</span>, left1)
log(<span style="color: #e6db74;">"right1"</span>, right1)
log(<span style="color: #e6db74;">"pd.merge(left1, right1, left_on='key', right_index=True)"</span>, pd.merge(left1, right1, left_on=<span style="color: #e6db74;">'key'</span>, right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== left1 =====================================
  key  value
0   a      0
1   b      1
2   a      2
3   a      3
4   b      4
5   c      5
==================================== right1 ====================================
   group_val
a        3.5
b        7.0
=========== pd.merge(left1, right1, left_on='key', right_index=True) ===========
  key  value  group_val
0   a      0        3.5
2   a      2        3.5
3   a      3        3.5
1   b      1        7.0
4   b      4        7.0
</pre>

<p>
多层索引的情况下，在索引上的连接是一个隐式的多键合并，
<b>必须以列表的方式指明合并所需的多个列：</b>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">lefth</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"key1"</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">"key2"</span>: [2000, 2001, 2002, 2001, 2002],
        <span style="color: #e6db74;">"data"</span>: np.arange(5)
    }
)

<span style="color: #fd971f;">righth</span> = pd.DataFrame(np.arange(12).reshape((6, 2)),
                      index=[
                          [<span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>],
                          [2001, 2000, 2000, 2000, 2001, 2002]
                      ],
                      columns=[<span style="color: #e6db74;">'event1'</span>, <span style="color: #e6db74;">'event2'</span>]
)

log(<span style="color: #e6db74;">"lefth"</span>, lefth)
log(<span style="color: #e6db74;">"righth"</span>, righth)
log(<span style="color: #e6db74;">"pd.merge(lefth, righth, left_on=['key1', 'key2'], right_index=True)"</span>, pd.merge(lefth, righth, left_on=[<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>], right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== lefth =====================================
     key1  key2  data
0    Ohio  2000     0
1    Ohio  2001     1
2    Ohio  2002     2
3  Nevada  2001     3
4  Nevada  2002     4
==================================== righth ====================================
             event1  event2
Nevada 2001       0       1
       2000       2       3
Ohio   2000       4       5
       2000       6       7
       2001       8       9
       2002      10      11
===== pd.merge(lefth, righth, left_on=['key1', 'key2'], right_index=True) ======
     key1  key2  data  event1  event2
0    Ohio  2000     0       4       5
0    Ohio  2000     0       6       7
1    Ohio  2001     1       8       9
2    Ohio  2002     2      10      11
3  Nevada  2001     3       0       1
</pre>

<p>
两边都使用索引合并：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)

<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)

log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"pd.merge(left2, right2, how='outer', left_index=True, right_index=True)"</span>, pd.merge(left2, right2, how=<span style="color: #e6db74;">'outer'</span>, left_index=<span style="color: #ae81ff;">True</span>, right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
=== pd.merge(left2, right2, how='outer', left_index=True, right_index=True) ====
   Ohio  Nevada  Missouri  Alabama
a   1.0     2.0       NaN      NaN
b   NaN     NaN       7.0      8.0
c   3.0     4.0       9.0     10.0
d   NaN     NaN      11.0     12.0
e   5.0     6.0      13.0     14.0
</pre>
</div>
</div>


<div id="outline-container-org29e158b" class="outline-5">
<h5 id="org29e158b"><span class="section-number-5">4.2.1.4</span> join</h5>
<div class="outline-text-5" id="text-4-2-1-4">
<p>
DataFrame 有一个方便的 <code>join</code> 方法，底层仍然是使用 <code>merge</code> ，用于 <b>按照索引合并</b> 。(_默认是左连接_)
</p>


<p>
之前的例子中，可以这样写：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)

<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)

log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"left2.join(right2, how='outer')"</span>, left2.join(right2, how=<span style="color: #e6db74;">'outer'</span>))
</pre>
</div>

<pre class="example">
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
======================= left2.join(right2, how='outer') ========================
   Ohio  Nevada  Missouri  Alabama
a   1.0     2.0       NaN      NaN
b   NaN     NaN       7.0      8.0
c   3.0     4.0       9.0     10.0
d   NaN     NaN      11.0     12.0
e   5.0     6.0      13.0     14.0
</pre>

<p>
<code>join</code> 也支持使用连接键：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abaabc'</span>),
    <span style="color: #e6db74;">"value"</span>: <span style="color: #a6e22e;">range</span>(6)
})

<span style="color: #fd971f;">right1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"group_val"</span>: [3.5, 7]
}, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>])

log(<span style="color: #e6db74;">"left1"</span>, left1)
log(<span style="color: #e6db74;">"right1"</span>, right1)
log(<span style="color: #e6db74;">"left1.join(right1, on='key')"</span>, left1.join(right1, on=<span style="color: #e6db74;">'key'</span>))
</pre>
</div>

<pre class="example">
==================================== left1 =====================================
  key  value
0   a      0
1   b      1
2   a      2
3   a      3
4   b      4
5   c      5
==================================== right1 ====================================
   group_val
a        3.5
b        7.0
========================= left1.join(right1, on='key') =========================
  key  value  group_val
0   a      0        3.5
1   b      1        7.0
2   a      2        3.5
3   a      3        3.5
4   b      4        7.0
5   c      5        NaN
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">another</span> = pd.DataFrame(
    [[7, 8], [9, 10], [11, 12], [16, 17]],
    index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'acef'</span>),
    columns=[<span style="color: #e6db74;">'New York'</span>, <span style="color: #e6db74;">'Oregon'</span>]
)
<span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)
<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)
log(<span style="color: #e6db74;">"another"</span>, another)
log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"left2.join([right2, another])"</span>, left2.join([right2, another]))
</pre>
</div>

<pre class="example">
=================================== another ====================================
   New York  Oregon
a         7       8
c         9      10
e        11      12
f        16      17
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
======================== left2.join([right2, another]) =========================
   Ohio  Nevada  Missouri  Alabama  New York  Oregon
a     1       2       NaN      NaN         7       8
c     3       4       9.0     10.0         9      10
e     5       6      13.0     14.0        11      12
</pre>
</div>
</div>
</div>


<div id="outline-container-org20c78c6" class="outline-4">
<h4 id="org20c78c6"><span class="section-number-4">4.2.2</span> concat</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
<code>concat</code> 方法本质其实就是<a href="#org8a8d1c2">按索引合并</a> ，默认情况下 <code>concat</code> 方法是沿着 <code>axis = 0</code> 的轴向生效的，
<b>生成另一个 Series</b> ；如传递 <code>axis = 1</code> ， <b>返回的结果则是 DataFrame</b> 。
</p>


<div class="figure">
<p><img src="img/pandas_concat.png" alt="pandas_concat.png">
</p>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s1</span> = pd.Series([0, 1], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>])
<span style="color: #fd971f;">s2</span> = pd.Series([2, 3, 4], index=[<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
<span style="color: #fd971f;">s3</span> = pd.Series([5, 6], index=[<span style="color: #e6db74;">'f'</span>, <span style="color: #e6db74;">'g'</span>])
log(<span style="color: #e6db74;">"s1"</span>, s1)
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s3"</span>, s3)
log(<span style="color: #e6db74;">"pd.concat([s1, s2, s3])"</span>, pd.concat([s1, s2, s3]))
log(<span style="color: #e6db74;">"pd.concat([s1, s2, s3], axis=1)"</span>, pd.concat([s1, s2, s3], axis=1))
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a    0
b    1
dtype: int64
====================================== s2 ======================================
c    2
d    3
e    4
dtype: int64
====================================== s3 ======================================
f    5
g    6
dtype: int64
=========================== pd.concat([s1, s2, s3]) ============================
a    0
b    1
c    2
d    3
e    4
f    5
g    6
dtype: int64
======================= pd.concat([s1, s2, s3], axis=1) ========================
     0    1    2
a  0.0  NaN  NaN
b  1.0  NaN  NaN
c  NaN  2.0  NaN
d  NaN  3.0  NaN
e  NaN  4.0  NaN
f  NaN  NaN  5.0
g  NaN  NaN  6.0
</pre>

<p>
<code>concat</code> 默认使用 <span class="underline">外连接</span> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s4</span> = pd.concat([s1, s3])
log(<span style="color: #e6db74;">"s4"</span>, s4)
log(<span style="color: #e6db74;">"pd.concat([s1, s4], axis=1)"</span>, pd.concat([s1, s4], axis=1))
log(<span style="color: #e6db74;">"pd.concat([s1, s4], axis=1, join='inner')"</span>, pd.concat([s1, s4], axis=1, join=<span style="color: #e6db74;">'inner'</span>))
</pre>
</div>

<pre class="example">
====================================== s4 ======================================
a    0
b    1
f    5
g    6
dtype: int64
========================= pd.concat([s1, s4], axis=1) ==========================
     0  1
a  0.0  0
b  1.0  1
f  NaN  5
g  NaN  6
================== pd.concat([s1, s4], axis=1, join='inner') ===================
   0  1
a  0  0
b  1  1
</pre>
</div>


<div id="outline-container-org8e83fb2" class="outline-5">
<h5 id="org8e83fb2"><span class="section-number-5">4.2.2.1</span> join_axes</h5>
<div class="outline-text-5" id="text-4-2-2-1">
<p>
可以使用 <code>join_axes</code> 来指定其他轴向的轴：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"pd.concat([s1, s4], axis=1, join_axes=[['a', 'c', 'b', 'e']])"</span>, pd.concat([s1, s4], axis=1, join_axes=[[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'e'</span>]]))
</pre>
</div>

<pre class="example">
======== pd.concat([s1, s4], axis=1, join_axes=[['a', 'c', 'b', 'e']]) =========
     0    1
a  0.0  0.0
c  NaN  NaN
b  1.0  1.0
e  NaN  NaN

</pre>
</div>
</div>


<div id="outline-container-org10fa929" class="outline-5">
<h5 id="org10fa929"><span class="section-number-5">4.2.2.2</span> 区分拼接在一起的各部分</h5>
<div class="outline-text-5" id="text-4-2-2-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">result</span> = pd.concat([s1, s2, s3], keys=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>])
log(<span style="color: #e6db74;">"result"</span>, result)
log(<span style="color: #e6db74;">"result.unstack()"</span>, result.unstack())
</pre>
</div>

<pre class="example">
==================================== result ====================================
one    a    0
       b    1
two    c    2
       d    3
       e    4
three  f    5
       g    6
dtype: int64
=============================== result.unstack() ===============================
         a    b    c    d    e    f    g
one    0.0  1.0  NaN  NaN  NaN  NaN  NaN
two    NaN  NaN  2.0  3.0  4.0  NaN  NaN
three  NaN  NaN  NaN  NaN  NaN  5.0  6.0
</pre>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"pd.concat([s1, s2, s3], axis=1, keys=['one', 'two', 'three'])"</span>, pd.concat([s1, s2, s3], axis=1, keys=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>]))
</pre>
</div>

<pre class="example">
======== pd.concat([s1, s2, s3], axis=1, keys=['one', 'two', 'three']) =========
   one  two  three
a  0.0  NaN    NaN
b  1.0  NaN    NaN
c  NaN  2.0    NaN
d  NaN  3.0    NaN
e  NaN  4.0    NaN
f  NaN  NaN    5.0
g  NaN  NaN    6.0
</pre>


<p>
应用于 DataFrame 对象：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.arange(6).reshape((3, 2)),
                   index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abc'</span>),
                   columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>]
)
<span style="color: #fd971f;">df2</span> = pd.DataFrame(5 + np.arange(4).reshape((2, 2)),
                   index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ac'</span>),
                   columns=[<span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>]
)

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)

log(<span style="color: #e6db74;">"pd.concat([df1, df2])"</span>, pd.concat([df1, df2]))
log(<span style="color: #e6db74;">"pd.concat([df1, df2], keys=['level1', 'level2'])"</span>, pd.concat([df1, df2], keys=[<span style="color: #e6db74;">'level1'</span>, <span style="color: #e6db74;">'level2'</span>]))
log(<span style="color: #e6db74;">"pd.concat([df1, df2], axis=1)"</span>, pd.concat([df1, df2], axis=1))
log(<span style="color: #e6db74;">"pd.concat([df1, df2], axis=1, keys=['level1', 'level2'])"</span>, pd.concat([df1, df2], axis=1, keys=[<span style="color: #e6db74;">'level1'</span>, <span style="color: #e6db74;">'level2'</span>]))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
   one  two
a    0    1
b    2    3
c    4    5
===================================== df2 ======================================
   three  four
a      5     6
c      7     8
============================ pd.concat([df1, df2]) =============================
   four  one  three  two
a   NaN  0.0    NaN  1.0
b   NaN  2.0    NaN  3.0
c   NaN  4.0    NaN  5.0
a   6.0  NaN    5.0  NaN
c   8.0  NaN    7.0  NaN
=============== pd.concat([df1, df2], keys=['level1', 'level2']) ===============
          four  one  three  two
level1 a   NaN  0.0    NaN  1.0
       b   NaN  2.0    NaN  3.0
       c   NaN  4.0    NaN  5.0
level2 a   6.0  NaN    5.0  NaN
       c   8.0  NaN    7.0  NaN
======================== pd.concat([df1, df2], axis=1) =========================
   one  two  three  four
a    0    1    5.0   6.0
b    2    3    NaN   NaN
c    4    5    7.0   8.0
=========== pd.concat([df1, df2], axis=1, keys=['level1', 'level2']) ===========
  level1     level2
     one two  three four
a      0   1    5.0  6.0
b      2   3    NaN  NaN
c      4   5    7.0  8.0
</pre>
</div>
</div>


<div id="outline-container-org1a89b63" class="outline-5">
<h5 id="org1a89b63"><span class="section-number-5">4.2.2.3</span> ignore_index</h5>
<div class="outline-text-5" id="text-4-2-2-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.random.randn(3, 4), columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))
<span style="color: #fd971f;">df2</span> = pd.DataFrame(np.random.randn(2, 3), columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bda'</span>))
log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.concat([df1, df2])"</span>, pd.concat([df1, df2]))
log(<span style="color: #e6db74;">"pd.concat([df1, df2], ignore_index=True)"</span>, pd.concat([df1, df2], ignore_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
          a         b         c         d
0  0.308352 -0.010026  1.317371 -0.614389
1  0.363210  1.110404 -0.240416 -0.455806
2  0.926422 -0.429935  0.196401 -1.392373
===================================== df2 ======================================
          b         d         a
0 -1.277329 -0.447157  0.619382
1 -0.210343 -0.526383 -1.627948
============================ pd.concat([df1, df2]) =============================
          a         b         c         d
0  0.308352 -0.010026  1.317371 -0.614389
1  0.363210  1.110404 -0.240416 -0.455806
2  0.926422 -0.429935  0.196401 -1.392373
0  0.619382 -1.277329       NaN -0.447157
1 -1.627948 -0.210343       NaN -0.526383
=================== pd.concat([df1, df2], ignore_index=True) ===================
          a         b         c         d
0  0.308352 -0.010026  1.317371 -0.614389
1  0.363210  1.110404 -0.240416 -0.455806
2  0.926422 -0.429935  0.196401 -1.392373
3  0.619382 -1.277329       NaN -0.447157
4 -1.627948 -0.210343       NaN -0.526383
</pre>
</div>
</div>
</div>





<div id="outline-container-orge3fcae6" class="outline-4">
<h4 id="orge3fcae6"><span class="section-number-4">4.2.3</span> combine_first</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
<code>combine_first</code> 既不是合并操作，也不是连接操作，它是用来填补调用对象的缺失值：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">a</span> = pd.Series([np.nan, 2.5, 0, 3.5, 4.5, np.nan],
              index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'fedcba'</span>)
)
<span style="color: #fd971f;">b</span> = pd.Series([0, np.nan, 2, np.nan, np.nan, 5],
              index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcdef'</span>)
)
log(<span style="color: #e6db74;">"a"</span>, a)
log(<span style="color: #e6db74;">"b"</span>, b)
log(<span style="color: #e6db74;">"b.combine_first(a)"</span>, b.combine_first(a))
</pre>
</div>

<pre class="example">
====================================== a =======================================
f    NaN
e    2.5
d    0.0
c    3.5
b    4.5
a    NaN
dtype: float64
====================================== b =======================================
a    0.0
b    NaN
c    2.0
d    NaN
e    NaN
f    5.0
dtype: float64
============================== b.combine_first(a) ==============================
a    0.0
b    4.5
c    2.0
d    0.0
e    2.5
f    5.0
dtype: float64
</pre>

<p>
在 DataFrame 中， <code>combine_first</code> 逐列做相同的操作：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"a"</span>: [1, np.nan, 5, np.nan],
        <span style="color: #e6db74;">"b"</span>: [np.nan, 2, np.nan, 6],
        <span style="color: #e6db74;">"c"</span>: <span style="color: #a6e22e;">range</span>(2, 18, 4)
    }
)

<span style="color: #fd971f;">df2</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"a"</span>: [5, 4, np.nan, 3, 7],
        <span style="color: #e6db74;">"b"</span>: [np.nan, 3, 4, 6, 8]
    }
)

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df1.combine_first(df2)"</span>, df1.combine_first(df2))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
     a    b   c
0  1.0  NaN   2
1  NaN  2.0   6
2  5.0  NaN  10
3  NaN  6.0  14
===================================== df2 ======================================
     a    b
0  5.0  NaN
1  4.0  3.0
2  NaN  4.0
3  3.0  6.0
4  7.0  8.0
============================ df1.combine_first(df2) ============================
     a    b     c
0  1.0  NaN   2.0
1  4.0  2.0   6.0
2  5.0  4.0  10.0
3  3.0  6.0  14.0
4  7.0  8.0   NaN
</pre>
</div>
</div>
</div>


<div id="outline-container-org0c1736d" class="outline-3">
<h3 id="org0c1736d"><span class="section-number-3">4.3</span> 重排列表格型数据</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-orgf6a442d" class="outline-4">
<h4 id="orgf6a442d"><span class="section-number-4">4.3.1</span> 使用多层索引进行重塑(stack/unstack)</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li><p>
stack
</p>

<p>
将列中的数据透视到行
</p></li>

<li><p>
unstack
</p>

<p>
将行中的数据透视到列
</p></li>
</ul>



<div class="figure">
<p><img src="img/pandas_stack.png" alt="pandas_stack.png">
</p>
</div>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(6).reshape((2, 3)),
                  index=pd.Index([<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Colorado'</span>], name=<span style="color: #e6db74;">'state'</span>),
                  columns=pd.Index([<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>], name=<span style="color: #e6db74;">'number'</span>)
)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.stack()"</span>, df.stack())
log(<span style="color: #e6db74;">"df.stack().unstack()"</span>, df.stack().unstack())
log(<span style="color: #e6db74;">"df.stack().unstack(0)"</span>, df.stack().unstack(0))
log(<span style="color: #e6db74;">"df.stack().unstack('state')"</span>, df.stack().unstack(<span style="color: #e6db74;">'state'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
number    one  two  three
state
Ohio        0    1      2
Colorado    3    4      5
================================== df.stack() ==================================
state     number
Ohio      one       0
          two       1
          three     2
Colorado  one       3
          two       4
          three     5
dtype: int64
============================= df.stack().unstack() =============================
number    one  two  three
state
Ohio        0    1      2
Colorado    3    4      5
============================ df.stack().unstack(0) =============================
state   Ohio  Colorado
number
one        0         3
two        1         4
three      2         5
========================= df.stack().unstack('state') ==========================
state   Ohio  Colorado
number
one        0         3
two        1         4
three      2         5
</pre>

<p>
当层级中的所有值并未包含于每个子分组中， <code>unstack</code> 会引入缺失值：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s1</span> = pd.Series([0, 1, 2, 3], index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))
<span style="color: #fd971f;">s2</span> = pd.Series([4, 5, 6], index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'cde'</span>))
<span style="color: #fd971f;">df</span> = pd.concat([s1, s2], keys=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.unstack()"</span>, df.unstack())
</pre>
</div>

<pre class="example">
====================================== df ======================================
one  a    0
     b    1
     c    2
     d    3
two  c    4
     d    5
     e    6
dtype: int64
================================= df.unstack() =================================
       a    b    c    d    e
one  0.0  1.0  2.0  3.0  NaN
two  NaN  NaN  4.0  5.0  6.0
</pre>

<p>
默认情况下， <code>stack</code> 会滤除缺失值：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.unstack().stack()"</span>, df.unstack().stack())
log(<span style="color: #e6db74;">"df.unstack().stack(dropna=False)"</span>, df.unstack().stack(dropna=<span style="color: #ae81ff;">False</span>))
</pre>
</div>

<pre class="example">
============================= df.unstack().stack() =============================
one  a    0.0
     b    1.0
     c    2.0
     d    3.0
two  c    4.0
     d    5.0
     e    6.0
dtype: float64
======================= df.unstack().stack(dropna=False) =======================
one  a    0.0
     b    1.0
     c    2.0
     d    3.0
     e    NaN
two  a    NaN
     b    NaN
     c    4.0
     d    5.0
     e    6.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-orgc030043" class="outline-4">
<h4 id="orgc030043"><span class="section-number-4">4.3.2</span> 将列的值转换为列索引(pivot)</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
<code>pivot(&lt;用作行索引的列&gt;, &lt;用作列索引的列&gt;, &lt;可选的数值列&gt;)</code>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [
    [<span style="color: #e6db74;">'1959-03-31'</span>, <span style="color: #e6db74;">'realgdp'</span>, 2710.349],
    [<span style="color: #e6db74;">'1959-03-31'</span>, <span style="color: #e6db74;">'infl'</span>, 0],
    [<span style="color: #e6db74;">'1959-03-31'</span>, <span style="color: #e6db74;">'unemp'</span>, 5.8],
    [<span style="color: #e6db74;">'1959-06-30'</span>, <span style="color: #e6db74;">'realgdp'</span>, 2778.801],
    [<span style="color: #e6db74;">'1959-06-30'</span>, <span style="color: #e6db74;">'infl'</span>, 2.34],
    [<span style="color: #e6db74;">'1959-06-30'</span>, <span style="color: #e6db74;">'unemp'</span>, 5.1],
    [<span style="color: #e6db74;">'1959-09-30'</span>, <span style="color: #e6db74;">'realgdp'</span>, 2775.488],
    [<span style="color: #e6db74;">'1959-09-30'</span>, <span style="color: #e6db74;">'infl'</span>, 2.74],
    [<span style="color: #e6db74;">'1959-09-30'</span>, <span style="color: #e6db74;">'unemp'</span>, 5.3],
    [<span style="color: #e6db74;">'1959-12-31'</span>, <span style="color: #e6db74;">'realgdp'</span>, 2785.204]
]

<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=[<span style="color: #e6db74;">'date'</span>, <span style="color: #e6db74;">'item'</span>, <span style="color: #e6db74;">'value'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#38024;&#23545;&#25152;&#26377; date &#65292;&#23558; item &#30340;&#20540;&#36716;&#25442;&#20026;&#21015;&#32034;&#24341;&#65292;&#22635;&#20837; value</span>
log(<span style="color: #e6db74;">"df.pivot('date', 'item', 'value')"</span>, df.pivot(<span style="color: #e6db74;">'date'</span>, <span style="color: #e6db74;">'item'</span>, <span style="color: #e6db74;">'value'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
         date     item     value
0  1959-03-31  realgdp  2710.349
1  1959-03-31     infl     0.000
2  1959-03-31    unemp     5.800
3  1959-06-30  realgdp  2778.801
4  1959-06-30     infl     2.340
5  1959-06-30    unemp     5.100
6  1959-09-30  realgdp  2775.488
7  1959-09-30     infl     2.740
8  1959-09-30    unemp     5.300
9  1959-12-31  realgdp  2785.204
====================== df.pivot('date', 'item', 'value') =======================
item        infl   realgdp  unemp
date
1959-03-31  0.00  2710.349    5.8
1959-06-30  2.34  2778.801    5.1
1959-09-30  2.74  2775.488    5.3
1959-12-31   NaN  2785.204    NaN
</pre>

<p>
多个数值列:
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'value2'</span>] = np.random.randn(<span style="color: #a6e22e;">len</span>(df))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.pivot('date', 'item')"</span>, df.pivot(<span style="color: #e6db74;">'date'</span>, <span style="color: #e6db74;">'item'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
         date     item     value    value2
0  1959-03-31  realgdp  2710.349 -0.894763
1  1959-03-31     infl     0.000  1.673363
2  1959-03-31    unemp     5.800  0.185811
3  1959-06-30  realgdp  2778.801 -0.905169
4  1959-06-30     infl     2.340  0.697258
5  1959-06-30    unemp     5.100  0.342515
6  1959-09-30  realgdp  2775.488 -0.544010
7  1959-09-30     infl     2.740  0.591888
8  1959-09-30    unemp     5.300 -0.605425
9  1959-12-31  realgdp  2785.204  1.386318
=========================== df.pivot('date', 'item') ===========================
           value                    value2
item        infl   realgdp unemp      infl   realgdp     unemp
date
1959-03-31  0.00  2710.349   5.8  1.673363 -0.894763  0.185811
1959-06-30  2.34  2778.801   5.1  0.697258 -0.905169  0.342515
1959-09-30  2.74  2775.488   5.3  0.591888 -0.544010 -0.605425
1959-12-31   NaN  2785.204   NaN       NaN  1.386318       NaN
</pre>

<p>
<b>注意：</b>
</p>

<p>
<code>pivot</code> 等价于使用 <code>set_index</code> 创建分层索引，然后调用 <code>unstack</code> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.set_index(['date', 'item']).unstack('item')"</span>, df.set_index([<span style="color: #e6db74;">'date'</span>, <span style="color: #e6db74;">'item'</span>]).unstack(<span style="color: #e6db74;">'item'</span>))
</pre>
</div>

<pre class="example">
================ df.set_index(['date', 'item']).unstack('item') ================
           value                    value2
item        infl   realgdp unemp      infl   realgdp     unemp
date
1959-03-31  0.00  2710.349   5.8  1.673363 -0.894763  0.185811
1959-06-30  2.34  2778.801   5.1  0.697258 -0.905169  0.342515
1959-09-30  2.74  2775.488   5.3  0.591888 -0.544010 -0.605425
1959-12-31   NaN  2785.204   NaN       NaN  1.386318       NaN

</pre>
</div>
</div>



<div id="outline-container-orgb3ad0ff" class="outline-4">
<h4 id="orgb3ad0ff"><span class="section-number-4">4.3.3</span> 将列索引转换为列的值(melt)</h4>
<div class="outline-text-4" id="text-4-3-3">

<div class="figure">
<p><img src="img/pandas_melt.png" alt="pandas_melt.png">
</p>
</div>

<p>
<code>pd.melt(df, &lt;分组指标&gt;)</code>
</p>

<p>
<code>melt</code> 用于将多列合并成一列（ <span class="underline">每个观测值分别位于一行</span> ），可以看成是 <code>pivot</code> 的 <b>反操作</b> 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"key"</span>: [<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'baz'</span>],
        <span style="color: #e6db74;">"A"</span>: [1, 2, 3],
        <span style="color: #e6db74;">"B"</span>: [4, 5, 6],
        <span style="color: #e6db74;">"C"</span>: [7, 8, 9]
    }
)
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">key &#21015;&#20316;&#20026;&#20998;&#32452;&#25351;&#26631;&#65292;&#20854;&#20182;&#21015;&#22343;&#20316;&#20026;&#25968;&#25454;&#20540;</span>
log(<span style="color: #e6db74;">"pd.melt(df, ['key'])"</span>, pd.melt(df, [<span style="color: #e6db74;">'key'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   key  A  B  C
0  foo  1  4  7
1  bar  2  5  8
2  baz  3  6  9
============================= pd.melt(df, ['key']) =============================
   key variable  value
0  foo        A      1
1  bar        A      2
2  baz        A      3
3  foo        B      4
4  bar        B      5
5  baz        B      6
6  foo        C      7
7  bar        C      8
8  baz        C      9
</pre>
</div>

<div id="outline-container-orgbf41c70" class="outline-5">
<h5 id="orgbf41c70"><span class="section-number-5">4.3.3.1</span> 使用pivot将数据重塑会原先的布局</h5>
<div class="outline-text-5" id="text-4-3-3-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">reshaped</span> = pd.melt(df, [<span style="color: #e6db74;">'key'</span>]).pivot(<span style="color: #e6db74;">'key'</span>, <span style="color: #e6db74;">'variable'</span>, <span style="color: #e6db74;">'value'</span>)
log(<span style="color: #e6db74;">"reshaped"</span>, reshaped)
log(<span style="color: #e6db74;">"reshaped.reset_index()"</span>, reshaped.reset_index())
</pre>
</div>

<pre class="example">
=================================== reshaped ===================================
variable  A  B  C
key
bar       2  5  8
baz       3  6  9
foo       1  4  7
============================ reshaped.reset_index() ============================
variable  key  A  B  C
0         bar  2  5  8
1         baz  3  6  9
2         foo  1  4  7
</pre>
</div>
</div>


<div id="outline-container-org1073df7" class="outline-5">
<h5 id="org1073df7"><span class="section-number-5">4.3.3.2</span> 指定列的子集作为值列</h5>
<div class="outline-text-5" id="text-4-3-3-2">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"pd.melt(df, id_vars=['key'], value_vars=['A', 'B'])"</span>, pd.melt(df, id_vars=[<span style="color: #e6db74;">'key'</span>], value_vars=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>]))
</pre>
</div>

<pre class="example">
============= pd.melt(df, id_vars=['key'], value_vars=['A', 'B']) ==============
   key variable  value
0  foo        A      1
1  bar        A      2
2  baz        A      3
3  foo        B      4
4  bar        B      5
5  baz        B      6

</pre>
</div>
</div>



<div id="outline-container-org1bca7ce" class="outline-5">
<h5 id="org1bca7ce"><span class="section-number-5">4.3.3.3</span> 不指定分组指标</h5>
<div class="outline-text-5" id="text-4-3-3-3">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"pd.melt(df, value_vars=['A', 'B', 'C'])"</span>, pd.melt(df, value_vars=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>, <span style="color: #e6db74;">'C'</span>]))
log(<span style="color: #e6db74;">"pd.melt(df, value_vars=['key', 'A', 'C'])"</span>, pd.melt(df, value_vars=[<span style="color: #e6db74;">'key'</span>, <span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   key  A  B  C
0  foo  1  4  7
1  bar  2  5  8
2  baz  3  6  9
=================== pd.melt(df, value_vars=['A', 'B', 'C']) ====================
  variable  value
0        A      1
1        A      2
2        A      3
3        B      4
4        B      5
5        B      6
6        C      7
7        C      8
8        C      9
================== pd.melt(df, value_vars=['key', 'A', 'C']) ===================
  variable value
0      key   foo
1      key   bar
2      key   baz
3        A     1
4        A     2
5        A     3
6        C     7
7        C     8
8        C     9
</pre>
</div>
</div>
</div>
</div>
</div>



<div id="outline-container-org3bbbc12" class="outline-2">
<h2 id="org3bbbc12"><span class="section-number-2">5</span> 聚合与分组操作</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org72c9349" class="outline-3">
<h3 id="org72c9349"><span class="section-number-3">5.1</span> GroupBy 对象</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key1'</span> : [<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>],
                   <span style="color: #e6db74;">'key2'</span> : [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>],
                   <span style="color: #e6db74;">'data1'</span> : np.random.randn(5),
                   <span style="color: #e6db74;">'data2'</span> : np.random.randn(5)})
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">grouped</span> = df.groupby(<span style="color: #e6db74;">'key1'</span>)
log(<span style="color: #e6db74;">"grouped"</span>, grouped)
log(<span style="color: #e6db74;">"dict(list(grouped))['a']"</span>, <span style="color: #a6e22e;">dict</span>(<span style="color: #a6e22e;">list</span>(grouped))[<span style="color: #e6db74;">'a'</span>])

</pre>
</div>

<pre class="example">
====================================== df ======================================
  key1 key2     data1     data2
0    a  one  0.560161  0.462387
1    a  two -0.815368 -0.866780
2    b  one  1.004914  0.653270
3    b  two  0.361801 -1.956438
4    a  one -0.340487 -0.128474
=================================== grouped ====================================
&lt;pandas.core.groupby.groupby.DataFrameGroupBy object at 0x11ac212b0&gt;
=========================== dict(list(grouped))['a'] ===========================
  key1 key2     data1     data2
0    a  one  0.560161  0.462387
1    a  two -0.815368 -0.866780
4    a  one -0.340487 -0.128474
</pre>
</div>

<div id="outline-container-org5c13718" class="outline-4">
<h4 id="org5c13718"><span class="section-number-4">5.1.1</span> 获取某个 Group (get_group)</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.groupby('key1').get_group('a')"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>).get_group(<span style="color: #e6db74;">'a'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
  key1 key2     data1     data2
0    a  one  0.560161  0.462387
1    a  two -0.815368 -0.866780
2    b  one  1.004914  0.653270
3    b  two  0.361801 -1.956438
4    a  one -0.340487 -0.128474
====================== df.groupby('key1').get_group('a') =======================
  key1 key2     data1     data2
0    a  one  0.560161  0.462387
1    a  two -0.815368 -0.866780
4    a  one -0.340487 -0.128474
</pre>
</div>
</div>

<div id="outline-container-org3b78027" class="outline-4">
<h4 id="org3b78027"><span class="section-number-4">5.1.2</span> GroupBy 对象的列索引</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
对 <code>GroupBy</code> 对象进行列索引，等效于对该列或列的子集做聚合。
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"list(df.groupby('key1')"</span>, <span style="color: #a6e22e;">list</span>(df.groupby(<span style="color: #e6db74;">'key1'</span>)))
<span style="color: #f92672; font-weight: bold;">print</span>()
<span style="color: #465457;"># </span><span style="color: #465457;">&#31561;&#25928;&#20110; df['date1'].groupby(df['key1'])</span>
log(<span style="color: #e6db74;">"df.groupby('key1')['data1']"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>)[<span style="color: #e6db74;">'data1'</span>])
log(<span style="color: #e6db74;">"list(df.groupby('key1')['data1'])"</span>, <span style="color: #a6e22e;">list</span>(df.groupby(<span style="color: #e6db74;">'key1'</span>)[<span style="color: #e6db74;">'data1'</span>]))

<span style="color: #465457;"># </span><span style="color: #465457;">&#31561;&#25928;&#20110; df[['date2']].groupby(df['key1'])</span>
log(<span style="color: #e6db74;">"df.groupby('key1')[['data2']]"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>)[[<span style="color: #e6db74;">'data2'</span>]])
log(<span style="color: #e6db74;">"list(df.groupby('key1')[['data2']])"</span>, <span style="color: #a6e22e;">list</span>(df.groupby(<span style="color: #e6db74;">'key1'</span>)[[<span style="color: #e6db74;">'data2'</span>]]))
<span style="color: #f92672; font-weight: bold;">print</span>()
log(<span style="color: #e6db74;">"type(df.groupby(['key1', 'key2'])[['data2']].mean())"</span>, <span style="color: #a6e22e;">type</span>(df.groupby([<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>])[[<span style="color: #e6db74;">'data2'</span>]].mean()))
log(<span style="color: #e6db74;">"df.groupby(['key1', 'key2'])[['data2']].mean()"</span>, df.groupby([<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>])[[<span style="color: #e6db74;">'data2'</span>]].mean())

log(<span style="color: #e6db74;">"type(df.groupby(['key1', 'key2'])['data2'].mean())"</span>, <span style="color: #a6e22e;">type</span>(df.groupby([<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>])[<span style="color: #e6db74;">'data2'</span>].mean()))
log(<span style="color: #e6db74;">"df.groupby(['key1', 'key2'])['data2'].mean()"</span>, df.groupby([<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>])[<span style="color: #e6db74;">'data2'</span>].mean())
</pre>
</div>

<pre class="example">
====================================== df ======================================
  key1 key2     data1     data2
0    a  one -0.199651 -0.279757
1    a  two -1.053575  0.356160
2    b  one  2.185409  1.448519
3    b  two -0.701065  1.565013
4    a  one  0.666953  0.000710
=========================== list(df.groupby('key1') ============================
[('a',   key1 key2     data1     data2
0    a  one -0.199651 -0.279757
1    a  two -1.053575  0.356160
4    a  one  0.666953  0.000710), ('b',   key1 key2     data1     data2
2    b  one  2.185409  1.448519
3    b  two -0.701065  1.565013)]

========================= df.groupby('key1')['data1'] ==========================
&lt;pandas.core.groupby.groupby.SeriesGroupBy object at 0x112278320&gt;
====================== list(df.groupby('key1')['data1']) =======================
[('a', 0   -0.199651
1   -1.053575
4    0.666953
Name: data1, dtype: float64), ('b', 2    2.185409
3   -0.701065
Name: data1, dtype: float64)]
======================== df.groupby('key1')[['data2']] =========================
&lt;pandas.core.groupby.groupby.DataFrameGroupBy object at 0x1122784a8&gt;
===================== list(df.groupby('key1')[['data2']]) ======================
[('a',   key1 key2     data1     data2
0    a  one -0.199651 -0.279757
1    a  two -1.053575  0.356160
4    a  one  0.666953  0.000710), ('b',   key1 key2     data1     data2
2    b  one  2.185409  1.448519
3    b  two -0.701065  1.565013)]

============= type(df.groupby(['key1', 'key2'])[['data2']].mean()) =============
&lt;class 'pandas.core.frame.DataFrame'&gt;
================ df.groupby(['key1', 'key2'])[['data2']].mean() ================
              data2
key1 key2
a    one  -0.139523
     two   0.356160
b    one   1.448519
     two   1.565013
============== type(df.groupby(['key1', 'key2'])['data2'].mean()) ==============
&lt;class 'pandas.core.series.Series'&gt;
================= df.groupby(['key1', 'key2'])['data2'].mean() =================
key1  key2
a     one    -0.139523
      two     0.356160
b     one     1.448519
      two     1.565013
Name: data2, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-org8afee18" class="outline-4">
<h4 id="org8afee18"><span class="section-number-4">5.1.3</span> 使用字典和Series分组</h4>
<div class="outline-text-4" id="text-5-1-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">people</span> = pd.DataFrame(np.random.randn(5, 5),
                      columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>),
                      index=[<span style="color: #e6db74;">'Joe'</span>, <span style="color: #e6db74;">'Steve'</span>, <span style="color: #e6db74;">'Wes'</span>, <span style="color: #e6db74;">'Jim'</span>, <span style="color: #e6db74;">'Travis'</span>]
)
people.iloc[2:3, [1, 2]] = np.nan
log(<span style="color: #e6db74;">"people"</span>, people)
<span style="color: #fd971f;">mapping</span> = {
    <span style="color: #e6db74;">"a"</span>: <span style="color: #e6db74;">'red'</span>,
    <span style="color: #e6db74;">"b"</span>: <span style="color: #e6db74;">'red'</span>,
    <span style="color: #e6db74;">"c"</span>: <span style="color: #e6db74;">'blue'</span>,
    <span style="color: #e6db74;">"d"</span>: <span style="color: #e6db74;">'blue'</span>,
    <span style="color: #e6db74;">"e"</span>: <span style="color: #e6db74;">'red'</span>,
    <span style="color: #e6db74;">"f"</span>: <span style="color: #e6db74;">'orange'</span>               <span style="color: #465457;"># </span><span style="color: #465457;">&#27809;&#26377;&#20316;&#29992;</span>
}
log(<span style="color: #e6db74;">"people.groupby(mapping, axis=1).sum()"</span>, people.groupby(mapping, axis=1).<span style="color: #a6e22e;">sum</span>())
</pre>
</div>

<pre class="example">
==================================== people ====================================
               a         b         c         d         e
Joe     0.411963 -0.851885 -0.603098  0.711264  0.244195
Steve  -0.192852 -0.761196  0.147913 -1.878708 -1.548063
Wes     0.226710       NaN       NaN -1.139280 -0.126362
Jim    -1.152243 -0.869533 -0.078809 -0.971286 -1.517877
Travis  0.381503  0.533020  0.446621  1.446923 -0.279701
==================== people.groupby(mapping, axis=1).sum() =====================
            blue       red
Joe     0.108166 -0.195727
Steve  -1.730795 -2.502111
Wes    -1.139280  0.100347
Jim    -1.050096 -3.539654
Travis  1.893544  0.634822
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">map_series</span> = pd.Series(mapping)
log(<span style="color: #e6db74;">"map_series"</span>, map_series)
log(<span style="color: #e6db74;">"people.groupby(map_series, axis=1).count()"</span>, people.groupby(map_series, axis=1).count())
</pre>
</div>

<pre class="example">
================================== map_series ==================================
a       red
b       red
c      blue
d      blue
e       red
f    orange
dtype: object
================== people.groupby(map_series, axis=1).count() ==================
        blue  red
Joe        2    3
Steve      2    3
Wes        1    2
Jim        2    3
Travis     2    3
</pre>
</div>
</div>


<div id="outline-container-orgb653410" class="outline-4">
<h4 id="orgb653410"><span class="section-number-4">5.1.4</span> 使用函数分组</h4>
<div class="outline-text-4" id="text-5-1-4">
<p>
使用函数定义分组关系是一种更为通用的方式，
作为分组键传递的函数将会按照每个索引值调用一次，返回值会被用作分组名称。
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"people"</span>, people)
log(<span style="color: #e6db74;">"people.groupby(len).sum()"</span>, people.groupby(<span style="color: #a6e22e;">len</span>).<span style="color: #a6e22e;">sum</span>())
</pre>
</div>

<pre class="example">
==================================== people ====================================
               a         b         c         d         e
Joe     0.411963 -0.851885 -0.603098  0.711264  0.244195
Steve  -0.192852 -0.761196  0.147913 -1.878708 -1.548063
Wes     0.226710       NaN       NaN -1.139280 -0.126362
Jim    -1.152243 -0.869533 -0.078809 -0.971286 -1.517877
Travis  0.381503  0.533020  0.446621  1.446923 -0.279701
========================== people.groupby(len).sum() ===========================
          a         b         c         d         e
3 -0.513571 -1.721418 -0.681908 -1.399303 -1.400044
5 -0.192852 -0.761196  0.147913 -1.878708 -1.548063
6  0.381503  0.533020  0.446621  1.446923 -0.279701
</pre>
</div>


<div id="outline-container-orgb131d54" class="outline-5">
<h5 id="orgb131d54"><span class="section-number-5">5.1.4.1</span> 与其他分组键混合</h5>
<div class="outline-text-5" id="text-5-1-4-1">
<p>
<span class="underline">所有的对象都会在内部转换为数组</span>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">key_list</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>]
log(<span style="color: #e6db74;">"people"</span>, people)
log(<span style="color: #e6db74;">"people.groupby([len, key_list]).min()"</span>, people.groupby([<span style="color: #a6e22e;">len</span>, key_list]).<span style="color: #a6e22e;">min</span>())
</pre>
</div>

<pre class="example">
==================================== people ====================================
               a         b         c         d         e
Joe     0.411963 -0.851885 -0.603098  0.711264  0.244195
Steve  -0.192852 -0.761196  0.147913 -1.878708 -1.548063
Wes     0.226710       NaN       NaN -1.139280 -0.126362
Jim    -1.152243 -0.869533 -0.078809 -0.971286 -1.517877
Travis  0.381503  0.533020  0.446621  1.446923 -0.279701
==================== people.groupby([len, key_list]).min() =====================
              a         b         c         d         e
3 one  0.226710 -0.851885 -0.603098 -1.139280 -0.126362
  two -1.152243 -0.869533 -0.078809 -0.971286 -1.517877
5 one -0.192852 -0.761196  0.147913 -1.878708 -1.548063
6 two  0.381503  0.533020  0.446621  1.446923 -0.279701
</pre>
</div>
</div>
</div>


<div id="outline-container-org7658ffb" class="outline-4">
<h4 id="org7658ffb"><span class="section-number-4">5.1.5</span> 根据索引层级分组</h4>
<div class="outline-text-4" id="text-5-1-5">
<p>
能够在轴索引的某个层级上进行聚合。
</p>

<p>
将层级数值或名称传递给 <code>level</code> 关键字：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">columns</span> = pd.MultiIndex.from_arrays(
    [
        [<span style="color: #e6db74;">'US'</span>, <span style="color: #e6db74;">'US'</span>, <span style="color: #e6db74;">'US'</span>, <span style="color: #e6db74;">'JP'</span>, <span style="color: #e6db74;">'JP'</span>],
        [1, 3, 5, 1, 3]
    ],
    names=[<span style="color: #e6db74;">'cty'</span>, <span style="color: #e6db74;">'tenor'</span>])
<span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(4, 5), columns=columns)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.groupby(level='cty', axis=1).count())"</span>, df.groupby(level=<span style="color: #e6db74;">'cty'</span>, axis=1).count())
</pre>
</div>

<pre class="example">
====================================== df ======================================
cty          US                            JP
tenor         1         3         5         1         3
0      1.102170 -0.112435  1.085613 -0.967759  0.883713
1      0.076930 -0.051798 -0.141812  0.625950  0.097327
2     -0.261993 -0.041604  0.793321 -1.847407 -1.173491
3     -2.023053  0.002613 -0.638650 -0.320731 -0.519337
=================== df.groupby(level='cty', axis=1).count()) ===================
cty  JP  US
0     2   3
1     2   3
2     2   3
3     2   3
</pre>
</div>
</div>
</div>



<div id="outline-container-org262febb" class="outline-3">
<h3 id="org262febb"><span class="section-number-3">5.2</span> 数据聚合</h3>
<div class="outline-text-3" id="text-5-2">

<div class="figure">
<p><img src="img/pandas_agg.png" alt="pandas_agg.png">
</p>
</div>
</div>



<div id="outline-container-orgc7f7e9a" class="outline-4">
<h4 id="orgc7f7e9a"><span class="section-number-4">5.2.1</span> 对GroupBy对象调用聚合方法</h4>
<div class="outline-text-4" id="text-5-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key1'</span> : [<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>],
                   <span style="color: #e6db74;">'key2'</span> : [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>],
                   <span style="color: #e6db74;">'data1'</span> : np.random.randn(5),
                   <span style="color: #e6db74;">'data2'</span> : np.random.randn(5)})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.groupby('key1')['data1'].quantile(0.9)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>)[<span style="color: #e6db74;">'data1'</span>].quantile(0.9))
log(<span style="color: #e6db74;">"df['data1'].groupby(df['key1']).quantile(0.9)"</span>, df[<span style="color: #e6db74;">'data1'</span>].groupby(df[<span style="color: #e6db74;">'key1'</span>]).quantile(0.9))

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">my_quantile_0_9</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> s.quantile(0.9)

log(<span style="color: #e6db74;">"df.groupby('key1')['data1'].agg(my_quantile_0_9)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>)[<span style="color: #e6db74;">'data1'</span>].agg(my_quantile_0_9))
log(<span style="color: #e6db74;">"df.groupby('key1').agg(my_quantile_0_9)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>).agg(my_quantile_0_9))
</pre>
</div>

<pre class="example">
====================================== df ======================================
  key1 key2     data1     data2
0    a  one  0.115562 -0.159065
1    a  two -0.953228 -0.255576
2    b  one -0.552461 -0.230414
3    b  two  1.400817  0.179607
4    a  one -0.337459  0.781640
================== df.groupby('key1')['data1'].quantile(0.9) ===================
key1
a    0.024958
b    1.205490
Name: data1, dtype: float64
================ df['data1'].groupby(df['key1']).quantile(0.9) =================
key1
a    0.024958
b    1.205490
Name: data1, dtype: float64
=============== df.groupby('key1')['data1'].agg(my_quantile_0_9) ===============
key1
a    0.024958
b    1.205490
Name: data1, dtype: float64
=================== df.groupby('key1').agg(my_quantile_0_9) ====================
         data1     data2
key1
a     0.024958  0.593499
b     1.205490  0.138605
</pre>
</div>
</div>



<div id="outline-container-orgfd803db" class="outline-4">
<h4 id="orgfd803db"><span class="section-number-4">5.2.2</span> 逐列与多函数应用</h4>
<div class="outline-text-4" id="text-5-2-2">
</div>
<div id="outline-container-orgd450f30" class="outline-5">
<h5 id="orgd450f30"><span class="section-number-5">5.2.2.1</span> 各列同时使用多个函数聚合</h5>
<div class="outline-text-5" id="text-5-2-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [
    (16.99, 1.01, <span style="color: #e6db74;">'No'</span>, <span style="color: #e6db74;">'Sat'</span>, <span style="color: #e6db74;">'Dinner'</span>, 2),
    (17.99, 1.01, <span style="color: #e6db74;">'No'</span>, <span style="color: #e6db74;">'Sat'</span>, <span style="color: #e6db74;">'Lunch'</span>, 2),
    (10.34, 1.66, <span style="color: #e6db74;">'Yes'</span>, <span style="color: #e6db74;">'Sun'</span>, <span style="color: #e6db74;">'Lunch'</span>, 3),
    (21.01, 3.50, <span style="color: #e6db74;">'Yes'</span>, <span style="color: #e6db74;">'Sun'</span>, <span style="color: #e6db74;">'Dinner'</span>, 3),
    (23.68, 3.31, <span style="color: #e6db74;">'Yes'</span>, <span style="color: #e6db74;">'Fri'</span>, <span style="color: #e6db74;">'Lunch'</span>, 2),
    (27.59, 3.61, <span style="color: #e6db74;">'Yes'</span>, <span style="color: #e6db74;">'Fri'</span>, <span style="color: #e6db74;">'Dinner'</span>, 4),
    (25.29, 4.71, <span style="color: #e6db74;">'Yes'</span>, <span style="color: #e6db74;">'Sun'</span>, <span style="color: #e6db74;">'Dinner'</span>, 4),
]
<span style="color: #fd971f;">columns</span>=[<span style="color: #e6db74;">'total_bill'</span>, <span style="color: #e6db74;">'tip'</span>, <span style="color: #e6db74;">'smoker'</span>, <span style="color: #e6db74;">'day'</span>, <span style="color: #e6db74;">'time'</span>, <span style="color: #e6db74;">'size'</span>]
<span style="color: #fd971f;">tips</span> = pd.DataFrame(data, columns=columns)
<span style="color: #fd971f;">tips</span>[<span style="color: #e6db74;">'tip_pct'</span>] = tips[<span style="color: #e6db74;">'tip'</span>] / tips[<span style="color: #e6db74;">'total_bill'</span>]
log(<span style="color: #e6db74;">"tips"</span>, tips)

</pre>
</div>

<pre class="example">
===================================== tips =====================================
   total_bill   tip smoker  day    time  size   tip_pct
0       16.99  1.01     No  Sat  Dinner     2  0.059447
1       17.99  1.01     No  Sat   Lunch     2  0.056142
2       10.34  1.66    Yes  Sun   Lunch     3  0.160542
3       21.01  3.50    Yes  Sun  Dinner     3  0.166587
4       23.68  3.31    Yes  Fri   Lunch     2  0.139780
5       27.59  3.61    Yes  Fri  Dinner     4  0.130845
6       25.29  4.71    Yes  Sun  Dinner     4  0.186240

</pre>

<p>
传递函数或函数名的列表，可以获得 <b>列名是函数名</b> 的 DataFrame ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">peak_to_peak</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> s.<span style="color: #a6e22e;">max</span>() - s.<span style="color: #a6e22e;">min</span>()

log(<span style="color: #e6db74;">"tips.groupby(['day', 'smoker'])['tip_pct'].agg(['mean', 'std', peak_to_peak])"</span>, tips.groupby([<span style="color: #e6db74;">'day'</span>, <span style="color: #e6db74;">'smoker'</span>])[<span style="color: #e6db74;">'tip_pct'</span>].agg([<span style="color: #e6db74;">'mean'</span>, <span style="color: #e6db74;">'std'</span>, peak_to_peak]))
log(<span style="color: #e6db74;">"tips.groupby(['day', 'smoker'])['tip_pct'].agg([('foo', 'mean'), ('bar', np.std)])"</span>, tips.groupby([<span style="color: #e6db74;">'day'</span>, <span style="color: #e6db74;">'smoker'</span>])[<span style="color: #e6db74;">'tip_pct'</span>].agg([(<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'mean'</span>), (<span style="color: #e6db74;">'bar'</span>, np.std)]))
</pre>
</div>

<pre class="example">
===== tips.groupby(['day', 'smoker'])['tip_pct'].agg(['mean', 'std', peak_to_peak]) ======
                mean       std  peak_to_peak
day smoker
Fri Yes     0.135312  0.006319      0.008936
Sat No      0.057795  0.002337      0.003304
Sun Yes     0.171123  0.013436      0.025698
=== tips.groupby(['day', 'smoker'])['tip_pct'].agg([('foo', 'mean'), ('bar', np.std)]) ===
                 foo       bar
day smoker
Fri Yes     0.135312  0.006319
Sat No      0.057795  0.002337
Sun Yes     0.171123  0.013436
</pre>
</div>
</div>

<div id="outline-container-orge9e559c" class="outline-5">
<h5 id="orge9e559c"><span class="section-number-5">5.2.2.2</span> 使用不同的函数对多个列聚合</h5>
<div class="outline-text-5" id="text-5-2-2-2">
<p>
只有多个函数应用于至少一个列时，DataFrame 才具有分层列。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">grouped</span> = tips.groupby([<span style="color: #e6db74;">'day'</span>, <span style="color: #e6db74;">'smoker'</span>])
log(<span style="color: #e6db74;">"grouped.agg({'tip': np.max, 'size': 'sum'})"</span>, grouped.agg({<span style="color: #e6db74;">'tip'</span>: np.<span style="color: #a6e22e;">max</span>, <span style="color: #e6db74;">'size'</span>: <span style="color: #e6db74;">'sum'</span>}))
log(<span style="color: #e6db74;">"grouped.agg({'tip_pct': ['min', 'max', 'mean', 'std'], 'size': 'sum'})"</span>, grouped.agg({<span style="color: #e6db74;">'tip_pct'</span>: [<span style="color: #e6db74;">'min'</span>, <span style="color: #e6db74;">'max'</span>, <span style="color: #e6db74;">'mean'</span>, <span style="color: #e6db74;">'std'</span>], <span style="color: #e6db74;">'size'</span>: <span style="color: #e6db74;">'sum'</span>}))
</pre>
</div>

<pre class="example">
====================== grouped.agg({'tip': np.max, 'size': 'sum'}) =======================
             tip  size
day smoker
Fri Yes     3.61     6
Sat No      1.01     4
Sun Yes     4.71    10
========= grouped.agg({'tip_pct': ['min', 'max', 'mean', 'std'], 'size': 'sum'}) =========
             tip_pct                               size
                 min       max      mean       std  sum
day smoker
Fri Yes     0.130845  0.139780  0.135312  0.006319    6
Sat No      0.056142  0.059447  0.057795  0.002337    4
Sun Yes     0.160542  0.186240  0.171123  0.013436   10
</pre>
</div>
</div>
</div>




<div id="outline-container-org4337650" class="outline-4">
<h4 id="org4337650"><span class="section-number-4">5.2.3</span> 返回不含行索引的聚合数据</h4>
<div class="outline-text-4" id="text-5-2-3">
<p>
通过向 <code>groupby</code> 传递 <code>as_index = False</code> 来禁用分组键作为索引的行为：
（通过在结果上调用 <code>reset_index</code> 可以获得相同的效果）
</p>


<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"tips.groupby(['day', 'smoker'], as_index=False).mean()"</span>, tips.groupby([<span style="color: #e6db74;">'day'</span>, <span style="color: #e6db74;">'smoker'</span>], as_index=<span style="color: #ae81ff;">False</span>).mean())
</pre>
</div>

<pre class="example">
================= tips.groupby(['day', 'smoker'], as_index=False).mean() =================
   day smoker  total_bill   tip      size   tip_pct
0  Fri    Yes      25.635  3.46  3.000000  0.135312
1  Sat     No      17.490  1.01  2.000000  0.057795
2  Sun    Yes      18.880  3.29  3.333333  0.171123

</pre>
</div>
</div>


<div id="outline-container-orgf3f5272" class="outline-4">
<h4 id="orgf3f5272"><span class="section-number-4">5.2.4</span> GroupBy.apply</h4>
<div class="outline-text-4" id="text-5-2-4">
<p>
<code>GroupBy.agg</code> 方法将一个函数使用在一个数列上，然后返回一个标量的值。即每次传入的是一列数据，对其聚合后返回标量。
</p>

<p>
<code>GroupBy.apply</code> 是一个 <span class="underline">更一般化</span> 的方法：将一个数据分拆-应用-汇总。会将当前分组后的数据一起传入，可以返回标量，也可以返回多维数据。
</p>

<p>
在 GroupBy 对象内部，当调用 <code>describe</code> 这样的方法时，实际上是以下代码的 <span class="underline">简写</span> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">f</span> = <span style="color: #f92672; font-weight: bold;">lambda</span> x: x.describe()
grouped.<span style="color: #a6e22e;">apply</span>(f)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key1'</span>: [<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>],
                  <span style="color: #e6db74;">'key2'</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>],
                  <span style="color: #e6db74;">'data1'</span>: np.random.randint(1, 10, 10),
                  <span style="color: #e6db74;">'data2'</span>: np.random.randint(1, 10, 10)})

log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#26681;&#25454; column &#25490;&#24207;&#65292;&#36755;&#20986;&#20854;&#26368;&#22823;&#30340; n &#34892;&#25968;&#25454;</span>
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">top</span>(df, n=2, column=<span style="color: #e6db74;">'data1'</span>):
    <span style="color: #f92672; font-weight: bold;">return</span> df.sort_values(by=column, ascending=<span style="color: #ae81ff;">False</span>)[:n]

log(<span style="color: #e6db74;">"df.groupby('key1').apply(top)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>).<span style="color: #a6e22e;">apply</span>(top))
<span style="color: #465457;"># </span><span style="color: #465457;">&#21487;&#20197;&#20256;&#36882;&#21442;&#25968;&#65306;df.groupby('key1').apply(top, n=3, column='data2')</span>
</pre>
</div>

<pre class="example">
=========================================== df ===========================================
  key1 key2  data1  data2
0    a  one      2      3
1    a  two      5      4
2    b  one      2      4
3    b  two      7      7
4    a  one      4      9
5    a  one      2      6
6    a  two      6      3
7    b  one      2      8
8    b  two      9      1
9    a  one      8      2
============================= df.groupby('key1').apply(top) ==============================
       key1 key2  data1  data2
key1
a    9    a  one      8      2
     6    a  two      6      3
b    8    b  two      9      1
     3    b  two      7      7
</pre>
</div>
</div>


<div id="outline-container-orgb20e452" class="outline-4">
<h4 id="orgb20e452"><span class="section-number-4">5.2.5</span> 禁用分组键(group_keys=False)</h4>
<div class="outline-text-4" id="text-5-2-5">
<p>
当返回结果集中不需要体现分组信息时，可以使用该参数。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key1'</span>: [<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>],
                    <span style="color: #e6db74;">'key2'</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'one'</span>],
                    <span style="color: #e6db74;">'data1'</span>: np.random.randint(1, 10, 10),
                    <span style="color: #e6db74;">'data2'</span>: np.random.randint(1, 10, 10)})

log(<span style="color: #e6db74;">"df"</span>, df)

<span style="color: #465457;"># </span><span style="color: #465457;">&#26681;&#25454; column &#25490;&#24207;&#65292;&#36755;&#20986;&#20854;&#26368;&#22823;&#30340; n &#34892;&#25968;&#25454;</span>
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">top</span>(df, n=2, column=<span style="color: #e6db74;">'data1'</span>):
    <span style="color: #f92672; font-weight: bold;">return</span> df.sort_values(by=column, ascending=<span style="color: #ae81ff;">False</span>)[:n]

log(<span style="color: #e6db74;">"df.groupby('key1').apply(top)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>).<span style="color: #a6e22e;">apply</span>(top))
log(<span style="color: #e6db74;">"df.groupby('key1', group_keys=False).apply(top)"</span>, df.groupby(<span style="color: #e6db74;">'key1'</span>, group_keys=<span style="color: #ae81ff;">False</span>).<span style="color: #a6e22e;">apply</span>(top))
</pre>
</div>

<pre class="example">
=========================================== df ===========================================
  key1 key2  data1  data2
0    a  one      8      9
1    a  two      4      1
2    b  one      2      6
3    b  two      5      6
4    a  one      6      5
5    a  one      4      8
6    a  two      7      2
7    b  one      6      9
8    b  two      7      1
9    a  one      3      5
============================= df.groupby('key1').apply(top) ==============================
       key1 key2  data1  data2
key1
a    0    a  one      8      9
     6    a  two      7      2
b    8    b  two      7      1
     7    b  one      6      9
==================== df.groupby('key1', group_keys=False).apply(top) =====================
  key1 key2  data1  data2
0    a  one      8      9
6    a  two      7      2
8    b  two      7      1
7    b  one      6      9
</pre>
</div>
</div>


<div id="outline-container-orgdbab16b" class="outline-4">
<h4 id="orgdbab16b"><span class="section-number-4">5.2.6</span> GroupBy.transform</h4>
<div class="outline-text-4" id="text-5-2-6">
<p>
<code>GroupBy.transform</code> 传递一个函数 <code>f(x)</code> ，
<code>x</code> 根据 GroupBy 对象的具体类型可以是 Series ，也可以是 DataFrame 。
</p>

<p>
<code>f(x)</code> 的返回值可以是标量（ <b>广播</b> 到各分组的数据中），也可以是与输入 <b>尺寸相同</b> 的对象。
</p>


<div class="figure">
<p><img src="img/pandas_transform.png" alt="pandas_transform.png">
</p>
</div>
</div>
</div>



<div id="outline-container-org7491191" class="outline-4">
<h4 id="org7491191"><span class="section-number-4">5.2.7</span> 时间分组重采样(resample)</h4>
<div class="outline-text-4" id="text-5-2-7">
<p>
对时间序列数据而言， <code>resample</code> 方法从语义上讲可以认为也是分组操作。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">N</span>=15
<span style="color: #fd971f;">times</span> = pd.date_range(<span style="color: #e6db74;">'2017-05-20 00:00'</span>, freq=<span style="color: #e6db74;">'1min'</span>, periods=N)
<span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'time'</span>: times,
                   <span style="color: #e6db74;">'value'</span>: np.arange(N)})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.set_index('time').resample('5min').count()"</span>, df.set_index(<span style="color: #e6db74;">'time'</span>).resample(<span style="color: #e6db74;">'5min'</span>).count())
</pre>
</div>

<pre class="example">
================================================ df ================================================
                  time  value
0  2017-05-20 00:00:00      0
1  2017-05-20 00:01:00      1
2  2017-05-20 00:02:00      2
3  2017-05-20 00:03:00      3
4  2017-05-20 00:04:00      4
5  2017-05-20 00:05:00      5
6  2017-05-20 00:06:00      6
7  2017-05-20 00:07:00      7
8  2017-05-20 00:08:00      8
9  2017-05-20 00:09:00      9
10 2017-05-20 00:10:00     10
11 2017-05-20 00:11:00     11
12 2017-05-20 00:12:00     12
13 2017-05-20 00:13:00     13
14 2017-05-20 00:14:00     14
========================== df.set_index('time').resample('5min').count() ===========================
                     value
time
2017-05-20 00:00:00      5
2017-05-20 00:05:00      5
2017-05-20 00:10:00      5
</pre>
</div>

<div id="outline-container-org7b53d24" class="outline-5">
<h5 id="org7b53d24"><span class="section-number-5">5.2.7.1</span> TimeGrouper 对象</h5>
<div class="outline-text-5" id="text-5-2-7-1">
<p>
使用 TimeGrouper 对象 <span class="underline">必须保证</span> 'time' 是 Series 或 DataFrame 的索引。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df2</span> = pd.DataFrame({<span style="color: #e6db74;">'time'</span>: times.repeat(3),
                   <span style="color: #e6db74;">'key'</span>: np.tile([<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>], N),
                   <span style="color: #e6db74;">'value'</span>: np.arange(N * 3.)})
log(<span style="color: #e6db74;">"df2.head()"</span>, df2.head(20))

<span style="color: #465457;"># </span><span style="color: #465457;">&#23545; 'key' &#21015;&#20570;&#26102;&#38388;&#37325;&#37319;&#26679;</span>
<span style="color: #fd971f;">time_key</span> = pd.Grouper(freq=<span style="color: #e6db74;">'5min'</span>)
log(<span style="color: #e6db74;">"time_key"</span>, time_key)
<span style="color: #fd971f;">resampled</span> = df2.set_index(<span style="color: #e6db74;">'time'</span>).groupby([<span style="color: #e6db74;">'key'</span>, time_key]).<span style="color: #a6e22e;">sum</span>()
log(<span style="color: #e6db74;">"resampled"</span>, resampled)
log(<span style="color: #e6db74;">"resampled.reset_index()"</span>, resampled.reset_index())
</pre>
</div>

<pre class="example">
============================================ df2.head() ============================================
                  time key  value
0  2017-05-20 00:00:00   a    0.0
1  2017-05-20 00:00:00   b    1.0
2  2017-05-20 00:00:00   c    2.0
3  2017-05-20 00:01:00   a    3.0
4  2017-05-20 00:01:00   b    4.0
5  2017-05-20 00:01:00   c    5.0
6  2017-05-20 00:02:00   a    6.0
7  2017-05-20 00:02:00   b    7.0
8  2017-05-20 00:02:00   c    8.0
9  2017-05-20 00:03:00   a    9.0
10 2017-05-20 00:03:00   b   10.0
11 2017-05-20 00:03:00   c   11.0
12 2017-05-20 00:04:00   a   12.0
13 2017-05-20 00:04:00   b   13.0
14 2017-05-20 00:04:00   c   14.0
15 2017-05-20 00:05:00   a   15.0
16 2017-05-20 00:05:00   b   16.0
17 2017-05-20 00:05:00   c   17.0
18 2017-05-20 00:06:00   a   18.0
19 2017-05-20 00:06:00   b   19.0
============================================= time_key =============================================
TimeGrouper(freq=&lt;5 * Minutes&gt;, axis=0, sort=True, closed='left', label='left', how='mean', convention='e', base=0)
============================================ resampled =============================================
                         value
key time
a   2017-05-20 00:00:00   30.0
    2017-05-20 00:05:00  105.0
    2017-05-20 00:10:00  180.0
b   2017-05-20 00:00:00   35.0
    2017-05-20 00:05:00  110.0
    2017-05-20 00:10:00  185.0
c   2017-05-20 00:00:00   40.0
    2017-05-20 00:05:00  115.0
    2017-05-20 00:10:00  190.0
===================================== resampled.reset_index() ======================================
  key                time  value
0   a 2017-05-20 00:00:00   30.0
1   a 2017-05-20 00:05:00  105.0
2   a 2017-05-20 00:10:00  180.0
3   b 2017-05-20 00:00:00   35.0
4   b 2017-05-20 00:05:00  110.0
5   b 2017-05-20 00:10:00  185.0
6   c 2017-05-20 00:00:00   40.0
7   c 2017-05-20 00:05:00  115.0
8   c 2017-05-20 00:10:00  190.0
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb208f97" class="outline-3">
<h3 id="orgb208f97"><span class="section-number-3">5.3</span> 透视表(pivot_table)</h3>
<div class="outline-text-3" id="text-5-3">
<p>
透视表是通过 <code>groupby</code> 以及使用分层索引的重塑操作实现的。
</p>

<p>
<b>当透视表结果为多个值的时候，默认返回平均值</b> ，即 <code>aggfunc</code> 默认值为 <code>mean</code> 。
</p>

<p>
<a href="https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/">pivot_table 和 pivot 区别</a>
</p>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'A'</span> : [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>] * 3,
                   <span style="color: #e6db74;">'B'</span> : [<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>, <span style="color: #e6db74;">'B'</span>, <span style="color: #e6db74;">'C'</span>, <span style="color: #e6db74;">'A'</span>] * 2,
                   <span style="color: #e6db74;">'C'</span> : [<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'bar'</span>] * 2,
                   <span style="color: #e6db74;">'D'</span> : <span style="color: #a6e22e;">range</span>(12),
                   <span style="color: #e6db74;">'E'</span> : <span style="color: #a6e22e;">range</span>(20, 32)})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'])"</span>, df.pivot_table([<span style="color: #e6db74;">'D'</span>, <span style="color: #e6db74;">'E'</span>], index=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>], columns=[<span style="color: #e6db74;">'C'</span>]))
log(<span style="color: #e6db74;">"df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True)"</span>, df.pivot_table([<span style="color: #e6db74;">'D'</span>, <span style="color: #e6db74;">'E'</span>], index=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>], columns=[<span style="color: #e6db74;">'C'</span>], margins=<span style="color: #ae81ff;">True</span>))
<span style="color: #465457;"># </span><span style="color: #465457;">&#35266;&#23519; (one, A, foo) &#30340; D &#20540;&#21464;&#21270;</span>
log(<span style="color: #e6db74;">"df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True, aggfunc=max)"</span>, df.pivot_table([<span style="color: #e6db74;">'D'</span>, <span style="color: #e6db74;">'E'</span>], index=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>], columns=[<span style="color: #e6db74;">'C'</span>], margins=<span style="color: #ae81ff;">True</span>, aggfunc=<span style="color: #a6e22e;">max</span>))
log(<span style="color: #e6db74;">"df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True, aggfunc=max, fill_value=0)"</span>, df.pivot_table([<span style="color: #e6db74;">'D'</span>, <span style="color: #e6db74;">'E'</span>], index=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>], columns=[<span style="color: #e6db74;">'C'</span>], margins=<span style="color: #ae81ff;">True</span>, aggfunc=<span style="color: #a6e22e;">max</span>, fill_value=0))
</pre>
</div>

<pre class="example">
=========================================== df ===========================================
        A  B    C   D   E
0     one  A  foo   0  20
1     one  A  foo   1  21
2     two  C  foo   2  22
3   three  B  bar   3  23
4     one  C  bar   4  24
5     one  A  bar   5  25
6     two  A  foo   6  26
7   three  A  foo   7  27
8     one  C  foo   8  28
9     one  B  bar   9  29
10    two  C  bar  10  30
11  three  A  bar  11  31
============== df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C']) ===============
            D          E
C         bar  foo   bar   foo
A     B
one   A   5.0  0.5  25.0  20.5
      B   9.0  NaN  29.0   NaN
      C   4.0  8.0  24.0  28.0
three A  11.0  7.0  31.0  27.0
      B   3.0  NaN  23.0   NaN
two   A   NaN  6.0   NaN  26.0
      C  10.0  2.0  30.0  22.0
======= df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True) ========
            D              E
C         bar  foo All   bar   foo All
A     B
one   A   5.0  0.5   2  25.0  20.5  22
      B   9.0  NaN   9  29.0   NaN  29
      C   4.0  8.0   6  24.0  28.0  26
three A  11.0  7.0   9  31.0  27.0  29
      B   3.0  NaN   3  23.0   NaN  23
two   A   NaN  6.0   6   NaN  26.0  26
      C  10.0  2.0   6  30.0  22.0  26
All       7.0  4.0   5  27.0  24.0  25
= df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True, aggfunc=max) =
            D              E
C         bar  foo All   bar   foo All
A     B
one   A   5.0  1.0   5  25.0  21.0  25
      B   9.0  NaN   9  29.0   NaN  29
      C   4.0  8.0   8  24.0  28.0  28
three A  11.0  7.0  11  31.0  27.0  31
      B   3.0  NaN   3  23.0   NaN  23
two   A   NaN  6.0   6   NaN  26.0  26
      C  10.0  2.0  10  30.0  22.0  30
All      11.0  8.0  11  31.0  28.0  31
 df.pivot_table(['D', 'E'], index=['A', 'B'], columns=['C'], margins=True, aggfunc=max, fill_value=0)
          D           E
C       bar foo All bar foo All
A     B
one   A   5   1   5  25  21  25
      B   9   0   9  29   0  29
      C   4   8   8  24  28  28
three A  11   7  11  31  27  31
      B   3   0   3  23   0  23
two   A   0   6   6   0  26  26
      C  10   2  10  30  22  30
All      11   8  11  31  28  31
</pre>
</div>
</div>


<div id="outline-container-orgdc82581" class="outline-3">
<h3 id="orgdc82581"><span class="section-number-3">5.4</span> 交叉表(cross_table)</h3>
<div class="outline-text-3" id="text-5-4">
<p>
交叉表是透视表的一个特殊情况， <span class="underline">计算的是分组中的频率</span> 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [
    (1, <span style="color: #e6db74;">'USA'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (2, <span style="color: #e6db74;">'Japan'</span>, <span style="color: #e6db74;">'Left-handed'</span>),
    (3, <span style="color: #e6db74;">'USA'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (4, <span style="color: #e6db74;">'Japan'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (5, <span style="color: #e6db74;">'Japan'</span>, <span style="color: #e6db74;">'Left-handed'</span>),
    (6, <span style="color: #e6db74;">'Japan'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (7, <span style="color: #e6db74;">'USA'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (8, <span style="color: #e6db74;">'USA'</span>, <span style="color: #e6db74;">'Left-handed'</span>),
    (9, <span style="color: #e6db74;">'Japan'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
    (10, <span style="color: #e6db74;">'USA'</span>, <span style="color: #e6db74;">'Right-handed'</span>),
]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=[<span style="color: #e6db74;">'Sample'</span>, <span style="color: #e6db74;">'Nationality'</span>, <span style="color: #e6db74;">'Handedness'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"pd.crosstab(df.Nationality, df.Handedness, margins=True)"</span>, pd.crosstab(df.Nationality, df.Handedness, margins=<span style="color: #ae81ff;">True</span>))
<span style="color: #465457;"># </span><span style="color: #465457;">&#31561;&#25928;&#20110;&#65306;</span>
log(<span style="color: #e6db74;">"df.pivot_table(index='Nationality', columns='Handedness', aggfunc='count', margins=True)"</span>, df.pivot_table(index=<span style="color: #e6db74;">'Nationality'</span>, columns=<span style="color: #e6db74;">'Handedness'</span>, aggfunc=<span style="color: #e6db74;">'count'</span>, margins=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
================================================ df ================================================
   Sample Nationality    Handedness
0       1         USA  Right-handed
1       2       Japan   Left-handed
2       3         USA  Right-handed
3       4       Japan  Right-handed
4       5       Japan   Left-handed
5       6       Japan  Right-handed
6       7         USA  Right-handed
7       8         USA   Left-handed
8       9       Japan  Right-handed
9      10         USA  Right-handed
===================== pd.crosstab(df.Nationality, df.Handedness, margins=True) =====================
Handedness   Left-handed  Right-handed  All
Nationality
Japan                  2             3    5
USA                    1             4    5
All                    3             7   10
===== df.pivot_table(index='Nationality', columns='Handedness', aggfunc='count', margins=True) =====
                 Sample
Handedness  Left-handed Right-handed All
Nationality
Japan                 2            3   5
USA                   1            4   5
All                   3            7  10
</pre>
</div>
</div>


<div id="outline-container-org745789b" class="outline-3">
<h3 id="org745789b"><span class="section-number-3">5.5</span> Categorial 类型数据</h3>
<div class="outline-text-3" id="text-5-5">
<p>
在<a href="#org05a02ee">使用 take 优化内存</a>的例子中，使用整数数组 (<code>values</code>) 的表达方式被称为 <span class="underline">categorical</span> 表示法，
<code>values</code> 被称为 <span class="underline">codes</span> ， <code>dim</code> 被称为 <span class="underline">categories</span> 。
</p>

<p>
在 Pandas 中使用 Categorial 数据类型可以获得更好的性能和内存利用率。
该数据类型内部就是使用 categorical 表示法。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">fruits</span> = [<span style="color: #e6db74;">'apple'</span>, <span style="color: #e6db74;">'orange'</span>, <span style="color: #e6db74;">'apple'</span>, <span style="color: #e6db74;">'apple'</span>] * 2
<span style="color: #fd971f;">N</span> = <span style="color: #a6e22e;">len</span>(fruits)
<span style="color: #fd971f;">df</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">'fruit'</span>: fruits,
        <span style="color: #e6db74;">'basket_id'</span>: np.arange(N),
        <span style="color: #e6db74;">'count'</span>: np.random.randint(3, 15, size=N),
        <span style="color: #e6db74;">'weight'</span>: np.random.uniform(0, 4, size=N)},
    columns=[<span style="color: #e6db74;">'basket_id'</span>, <span style="color: #e6db74;">'fruit'</span>, <span style="color: #e6db74;">'count'</span>, <span style="color: #e6db74;">'weight'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
================================================ df ================================================
   basket_id   fruit  count    weight
0          0   apple     13  1.775096
1          1  orange      9  3.515737
2          2   apple      5  3.543188
3          3   apple      7  3.285893
4          4   apple      4  1.591016
5          5  orange      9  2.825891
6          6   apple     14  1.447206
7          7   apple     14  3.464040
</pre>

<p>
将 fruit 列转换为 Categorical ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">fruit_cat</span> = df[<span style="color: #e6db74;">'fruit'</span>].astype(<span style="color: #e6db74;">'category'</span>)
log(<span style="color: #e6db74;">"fruit_cat"</span>, fruit_cat)

log(<span style="color: #e6db74;">"fruit_cat.values"</span>, fruit_cat.values)
log(<span style="color: #e6db74;">"type(fruit_cat.values)"</span>, <span style="color: #a6e22e;">type</span>(fruit_cat.values))

log(<span style="color: #e6db74;">"fruit_cat.values.categories"</span>, fruit_cat.values.categories)

log(<span style="color: #e6db74;">"fruit_cat.values.codes"</span>, fruit_cat.values.codes)
</pre>
</div>

<pre class="example">
============================================ fruit_cat =============================================
0     apple
1    orange
2     apple
3     apple
4     apple
5    orange
6     apple
7     apple
Name: fruit, dtype: category
Categories (2, object): [apple, orange]
========================================= fruit_cat.values =========================================
[apple, orange, apple, apple, apple, orange, apple, apple]
Categories (2, object): [apple, orange]
====================================== type(fruit_cat.values) ======================================
&lt;class 'pandas.core.arrays.categorical.Categorical'&gt;
=================================== fruit_cat.values.categories ====================================
Index(['apple', 'orange'], dtype='object')
====================================== fruit_cat.values.codes ======================================
[0 1 0 0 0 1 0 0]
</pre>

<p>
用 Categorical 对象直接替换原先的列：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'fruit'</span>] = df[<span style="color: #e6db74;">'fruit'</span>].astype(<span style="color: #e6db74;">'category'</span>)
</pre>
</div>
</div>


<div id="outline-container-orga3e1a15" class="outline-4">
<h4 id="orga3e1a15"><span class="section-number-4">5.5.1</span> 直接创建 Categorical 对象</h4>
<div class="outline-text-4" id="text-5-5-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">my_categories</span> = pd.Categorical([<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'baz'</span>, <span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>])
log(<span style="color: #e6db74;">"my_categories"</span>, my_categories)

<span style="color: #fd971f;">categories</span> = [<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'baz'</span>]
<span style="color: #fd971f;">codes</span>=[0,1,2,0,0,1]
<span style="color: #fd971f;">my_cats_2</span> = pd.Categorical.from_codes(codes, categories)
log(<span style="color: #e6db74;">"my_cats_2"</span>, my_cats_2)

</pre>
</div>

<pre class="example">
========================================== my_categories ===========================================
[foo, bar, baz, foo, bar]
Categories (3, object): [bar, baz, foo]
============================================ my_cats_2 =============================================
[foo, bar, baz, foo, foo, bar]
Categories (3, object): [foo, bar, baz]

</pre>
</div>
</div>


<div id="outline-container-org4a5eb17" class="outline-4">
<h4 id="org4a5eb17"><span class="section-number-4">5.5.2</span> Categorical 对象排序规则</h4>
<div class="outline-text-4" id="text-5-5-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">ordered_cat</span> = pd.Categorical.from_codes(codes, categories, ordered=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"ordered_cat"</span>, ordered_cat)
log(<span style="color: #e6db74;">"ordered_cat.sort_values()"</span>, ordered_cat.sort_values())

<span style="color: #465457;"># </span><span style="color: #465457;">&#23558;&#26080;&#24207;&#23545;&#35937;&#36716;&#25442;&#20026;&#26377;&#24207;</span>
log(<span style="color: #e6db74;">"my_cats_2.as_ordered()"</span>, my_cats_2.as_ordered())
</pre>
</div>

<pre class="example">
=========================================== ordered_cat ============================================
[foo, bar, baz, foo, foo, bar]
Categories (3, object): [foo &lt; bar &lt; baz]
==================================== ordered_cat.sort_values() =====================================
[foo, foo, foo, bar, bar, baz]
Categories (3, object): [foo &lt; bar &lt; baz]
====================================== my_cats_2.as_ordered() ======================================
[foo, bar, baz, foo, foo, bar]
Categories (3, object): [foo &lt; bar &lt; baz]

</pre>
</div>
</div>


<div id="outline-container-org2c55124" class="outline-4">
<h4 id="org2c55124"><span class="section-number-4">5.5.3</span> 使用 Categorical 对象进行分箱统计</h4>
<div class="outline-text-4" id="text-5-5-3">
<div class="org-src-container">
<pre class="src src-ipython">np.random.seed(12345)
<span style="color: #fd971f;">draws</span> = np.random.randn(1000)
log(<span style="color: #e6db74;">"draws[:5]"</span>, draws[:5])

<span style="color: #fd971f;">bins</span> = pd.qcut(draws, 4)
log(<span style="color: #e6db74;">"bins"</span>, bins)

<span style="color: #465457;"># </span><span style="color: #465457;">&#29992;&#26631;&#31614;&#26367;&#20195;&#21306;&#38388;&#65292;&#22686;&#21152;&#21487;&#35835;&#24615;</span>
<span style="color: #fd971f;">labelBins</span> = pd.qcut(draws, 4, labels=[<span style="color: #e6db74;">'Q1'</span>, <span style="color: #e6db74;">'Q2'</span>, <span style="color: #e6db74;">'Q3'</span>, <span style="color: #e6db74;">'Q4'</span>])
log(<span style="color: #e6db74;">"labelBins"</span>, labelBins)

<span style="color: #465457;"># </span><span style="color: #465457;">&#20351;&#29992; groupby &#25552;&#21462;&#32479;&#35745;&#20449;&#24687;</span>
<span style="color: #fd971f;">labelBinsSeries</span> = pd.Series(labelBins, name=<span style="color: #e6db74;">'quartile'</span>)
log(<span style="color: #e6db74;">"pd.Series(draws).groupby(labelBinsSeries).agg(['count', 'min', 'max']).reset_index()"</span>, pd.Series(draws).groupby(labelBinsSeries).agg([<span style="color: #e6db74;">'count'</span>, <span style="color: #e6db74;">'min'</span>, <span style="color: #e6db74;">'max'</span>]).reset_index())

</pre>
</div>

<pre class="example">
============================================ draws[:5] =============================================
[-0.20470766  0.47894334 -0.51943872 -0.5557303   1.96578057]
=============================================== bins ===============================================
[(-0.684, -0.0101], (-0.0101, 0.63], (-0.684, -0.0101], (-0.684, -0.0101], (0.63, 3.928], ..., (-0.0101, 0.63], (-0.684, -0.0101], (-2.9499999999999997, -0.684], (-0.0101, 0.63], (0.63, 3.928]]
Length: 1000
Categories (4, interval[float64]): [(-2.9499999999999997, -0.684] &lt; (-0.684, -0.0101] &lt; (-0.0101, 0.63] &lt; (0.63, 3.928]]
============================================ labelBins =============================================
[Q2, Q3, Q2, Q2, Q4, ..., Q3, Q2, Q1, Q3, Q4]
Length: 1000
Categories (4, object): [Q1 &lt; Q2 &lt; Q3 &lt; Q4]
======= pd.Series(draws).groupby(labelBinsSeries).agg(['count', 'min', 'max']).reset_index() =======
  quartile  count       min       max
0       Q1    250 -2.949343 -0.685484
1       Q2    250 -0.683066 -0.010115
2       Q3    250 -0.010032  0.628894
3       Q4    250  0.634238  3.927528
</pre>
</div>
</div>


<div id="outline-container-orgceb66ea" class="outline-4">
<h4 id="orgceb66ea"><span class="section-number-4">5.5.4</span> 使用 Categorical 对象的性能优势</h4>
<div class="outline-text-4" id="text-5-5-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">N</span> = 10000000
<span style="color: #fd971f;">labels</span> = pd.Series([<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'bar'</span>, <span style="color: #e6db74;">'baz'</span>, <span style="color: #e6db74;">'qux'</span>] * (N // 4))
<span style="color: #fd971f;">categories</span> = labels.astype(<span style="color: #e6db74;">'category'</span>)
log(<span style="color: #e6db74;">"labels.memory_usage()"</span>, labels.memory_usage())
log(<span style="color: #e6db74;">"categories.memory_usage()"</span>, categories.memory_usage())
</pre>
</div>

<pre class="example">
====================================== labels.memory_usage() =======================================
80000080
==================================== categories.memory_usage() =====================================
10000272

</pre>

<p>
内存性能的提升是以计算耗时换来的：
</p>

<div class="org-src-container">
<pre class="src src-ipython">%time labels.astype(<span style="color: #e6db74;">'category'</span>)
</pre>
</div>

<pre class="example">
CPU times: user 470 ms, sys: 50.2 ms, total: 521 ms
Wall time: 518 ms

</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org8ecbcde" class="outline-2">
<h2 id="org8ecbcde"><span class="section-number-2">6</span> 时间序列</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org4e52f7d" class="outline-3">
<h3 id="org4e52f7d"><span class="section-number-3">6.1</span> 时间选择</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org414d4cf" class="outline-4">
<h4 id="org414d4cf"><span class="section-number-4">6.1.1</span> 使用能解释为日期的字符串</h4>
<div class="outline-text-4" id="text-6-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #f92672; font-weight: bold;">from</span> datetime <span style="color: #f92672; font-weight: bold;">import</span> datetime
<span style="color: #fd971f;">dates</span> = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]
<span style="color: #fd971f;">ts</span> = pd.Series(np.random.randn(6), index=dates)
log(<span style="color: #e6db74;">"ts"</span>, ts)
</pre>
</div>

<pre class="example">
====================================== ts ======================================
2011-01-02    0.488675
2011-01-05   -0.178098
2011-01-07    2.122315
2011-01-08    0.061192
2011-01-10    0.884111
2011-01-12   -0.608506
dtype: float64

</pre>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"ts['1/10/2011']"</span>, ts[<span style="color: #e6db74;">'1/10/2011'</span>])
log(<span style="color: #e6db74;">"ts['20110110']"</span>, ts[<span style="color: #e6db74;">'20110110'</span>])
</pre>
</div>

<pre class="example">
=============================== ts['1/10/2011'] ================================
0.8841108212188903
================================ ts['20110110'] ================================
0.8841108212188903

</pre>
</div>
</div>


<div id="outline-container-org409ce9c" class="outline-4">
<h4 id="org409ce9c"><span class="section-number-4">6.1.2</span> 使用年份或月份选择数据切片</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">longer_ts</span> = pd.Series(np.random.randn(1000),
                      index=pd.date_range(<span style="color: #e6db74;">'1/1/2000'</span>, periods=1000))
log(<span style="color: #e6db74;">"longer_ts.head()"</span>, longer_ts.head())
</pre>
</div>

<pre class="example">
=============================== longer_ts.head() ===============================
2000-01-01   -0.072052
2000-01-02    0.544066
2000-01-03    0.323886
2000-01-04   -1.683325
2000-01-05    0.526860
Freq: D, dtype: float64

</pre>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"longer_ts['2001'].head()"</span>, longer_ts[<span style="color: #e6db74;">'2001'</span>].head())
log(<span style="color: #e6db74;">"longer_ts['2001-05'].head()"</span>, longer_ts[<span style="color: #e6db74;">'2001-05'</span>].head())
log(<span style="color: #e6db74;">"ts[datetime(2011, 1, 7):]"</span>, ts[datetime(2011, 1, 7):])
<span style="color: #465457;"># </span><span style="color: #465457;">&#21487;&#20197;&#20351;&#29992;&#19981;&#21253;&#21547;&#22312;&#26102;&#38388;&#24207;&#21015;&#20013;&#30340;&#26102;&#38388;&#25139;&#36827;&#34892;&#20999;&#29255;</span>
log(<span style="color: #e6db74;">"ts['1/6/2011':'1/11/2011']"</span>, ts[<span style="color: #e6db74;">'1/6/2011'</span>:<span style="color: #e6db74;">'1/11/2011'</span>])
</pre>
</div>

<pre class="example">
=========================== longer_ts['2001'].head() ===========================
2001-01-01   -0.171724
2001-01-02   -0.827840
2001-01-03    0.370548
2001-01-04   -0.674167
2001-01-05   -1.712340
Freq: D, dtype: float64
========================= longer_ts['2001-05'].head() ==========================
2001-05-01    0.251343
2001-05-02    1.624623
2001-05-03   -0.240567
2001-05-04    0.163052
2001-05-05   -0.586669
Freq: D, dtype: float64
========================== ts[datetime(2011, 1, 7):] ===========================
2011-01-07    2.122315
2011-01-08    0.061192
2011-01-10    0.884111
2011-01-12   -0.608506
dtype: float64
========================== ts['1/6/2011':'1/11/2011'] ==========================
2011-01-07    2.122315
2011-01-08    0.061192
2011-01-10    0.884111
dtype: float64
</pre>
</div>
</div>
</div>


<div id="outline-container-orge3f6438" class="outline-3">
<h3 id="orge3f6438"><span class="section-number-3">6.2</span> 日期范围，频率，偏移</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-orgfa856c7" class="outline-4">
<h4 id="orgfa856c7"><span class="section-number-4">6.2.1</span> 生成范围</h4>
<div class="outline-text-4" id="text-6-2-1">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"pd.date_range('2012-04-01', '2012-04-20')"</span>, pd.date_range(<span style="color: #e6db74;">'2012-04-01'</span>, <span style="color: #e6db74;">'2012-04-20'</span>))
log(<span style="color: #e6db74;">"pd.date_range(start='2012-04-01', periods=20)"</span>, pd.date_range(start=<span style="color: #e6db74;">'2012-04-01'</span>, periods=20))
</pre>
</div>

<pre class="example">
================== pd.date_range('2012-04-01', '2012-04-20') ===================
DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20'],
              dtype='datetime64[ns]', freq='D')
================ pd.date_range(start='2012-04-01', periods=20) =================
DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20'],
              dtype='datetime64[ns]', freq='D')
============= pd.date_range('2000-01-01', '2000-12-01', freq='BM') =============
DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-29', '2000-10-31', '2000-11-30'],
              dtype='datetime64[ns]', freq='BM')
</pre>
</div>
</div>


<div id="outline-container-orgb349c07" class="outline-4">
<h4 id="orgb349c07"><span class="section-number-4">6.2.2</span> 日期频率</h4>
<div class="outline-text-4" id="text-6-2-2">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"pd.date_range('2000-01-01', '2000-12-01', freq='BM')"</span>, pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, <span style="color: #e6db74;">'2000-12-01'</span>, freq=<span style="color: #e6db74;">'BM'</span>))
log(<span style="color: #e6db74;">"pd.date_range('2000-01-01', periods=10, freq='1h30min')"</span>, pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, periods=10, freq=<span style="color: #e6db74;">'1h30min'</span>))
</pre>
</div>

<pre class="example">
============= pd.date_range('2000-01-01', '2000-12-01', freq='BM') =============
DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-29', '2000-10-31', '2000-11-30'],
              dtype='datetime64[ns]', freq='BM')
=========== pd.date_range('2000-01-01', periods=10, freq='1h30min') ============
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 01:30:00',
               '2000-01-01 03:00:00', '2000-01-01 04:30:00',
               '2000-01-01 06:00:00', '2000-01-01 07:30:00',
               '2000-01-01 09:00:00', '2000-01-01 10:30:00',
               '2000-01-01 12:00:00', '2000-01-01 13:30:00'],
              dtype='datetime64[ns]', freq='90T')
</pre>
</div>

<div id="outline-container-org09ede7e" class="outline-5">
<h5 id="org09ede7e"><span class="section-number-5">6.2.2.1</span> 月中某星期</h5>
<div class="outline-text-5" id="text-6-2-2-1">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"list(pd.date_range('2012-01-01', '2012-06-01', freq='WOM-3FRI'))"</span>, <span style="color: #a6e22e;">list</span>(pd.date_range(<span style="color: #e6db74;">'2012-01-01'</span>, <span style="color: #e6db74;">'2012-06-01'</span>, freq=<span style="color: #e6db74;">'WOM-3FRI'</span>)))
</pre>
</div>

<pre class="example">
======= list(pd.date_range('2012-01-01', '2012-06-01', freq='WOM-3FRI')) =======
[Timestamp('2012-01-20 00:00:00', freq='WOM-3FRI'),
 Timestamp('2012-02-17 00:00:00', freq='WOM-3FRI'),
 Timestamp('2012-03-16 00:00:00', freq='WOM-3FRI'),
 Timestamp('2012-04-20 00:00:00', freq='WOM-3FRI'),
 Timestamp('2012-05-18 00:00:00', freq='WOM-3FRI')]

</pre>
</div>
</div>
</div>


<div id="outline-container-org5ee9a09" class="outline-4">
<h4 id="org5ee9a09"><span class="section-number-4">6.2.3</span> 日期偏移</h4>
<div class="outline-text-4" id="text-6-2-3">
</div>
<div id="outline-container-org093d5e1" class="outline-5">
<h5 id="org093d5e1"><span class="section-number-5">6.2.3.1</span> 推移数据不改变时间戳</h5>
<div class="outline-text-5" id="text-6-2-3-1">
<p>
Series 和 DataFrame 都有一个 <code>shift</code> 方法用于进行简单的前向或后向移位，而 <b>不改变索引</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">ts</span> = pd.Series(np.random.randn(4),
               index=pd.date_range(<span style="color: #e6db74;">'1/1/2000'</span>, periods=4, freq=<span style="color: #e6db74;">'M'</span>))
log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.shift(2)"</span>, ts.shift(2))
log(<span style="color: #e6db74;">"ts.shift(-2)"</span>, ts.shift(-2))
</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-31    2.001614
2000-02-29    1.385914
2000-03-31   -1.104685
2000-04-30    0.677098
Freq: M, dtype: float64
================================= ts.shift(2) ==================================
2000-01-31         NaN
2000-02-29         NaN
2000-03-31    2.001614
2000-04-30    1.385914
Freq: M, dtype: float64
================================= ts.shift(-2) =================================
2000-01-31   -1.104685
2000-02-29    0.677098
2000-03-31         NaN
2000-04-30         NaN
Freq: M, dtype: float64
</pre>

<p>
<code>shift</code> 常用来计算 <b>百分比变化</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.shift(1)"</span>, ts.shift(1))
log(<span style="color: #e6db74;">"ts / ts.shift(1) - 1"</span>, ts / ts.shift(1) - 1)
</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-31    2.001614
2000-02-29    1.385914
2000-03-31   -1.104685
2000-04-30    0.677098
Freq: M, dtype: float64
================================= ts.shift(1) ==================================
2000-01-31         NaN
2000-02-29    2.001614
2000-03-31    1.385914
2000-04-30   -1.104685
Freq: M, dtype: float64
============================= ts / ts.shift(1) - 1 =============================
2000-01-31         NaN
2000-02-29   -0.307602
2000-03-31   -1.797080
2000-04-30   -1.612933
Freq: M, dtype: float64
</pre>
</div>
</div>

<div id="outline-container-org85af320" class="outline-5">
<h5 id="org85af320"><span class="section-number-5">6.2.3.2</span> 推移数据不改变时间戳</h5>
<div class="outline-text-5" id="text-6-2-3-2">
<p>
传递一个频率参数
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.shift(2, freq='M')"</span>, ts.shift(2, freq=<span style="color: #e6db74;">'M'</span>))
log(<span style="color: #e6db74;">"ts.shift(3, freq='D')"</span>, ts.shift(3, freq=<span style="color: #e6db74;">'D'</span>))
log(<span style="color: #e6db74;">"ts.shift(1, freq='90T')"</span>, ts.shift(1, freq=<span style="color: #e6db74;">'90T'</span>))
</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-31    2.001614
2000-02-29    1.385914
2000-03-31   -1.104685
2000-04-30    0.677098
Freq: M, dtype: float64
============================ ts.shift(2, freq='M') =============================
2000-03-31    2.001614
2000-04-30    1.385914
2000-05-31   -1.104685
2000-06-30    0.677098
Freq: M, dtype: float64
============================ ts.shift(3, freq='D') =============================
2000-02-03    2.001614
2000-03-03    1.385914
2000-04-03   -1.104685
2000-05-03    0.677098
dtype: float64
=========================== ts.shift(1, freq='90T') ============================
2000-01-31 01:30:00    2.001614
2000-02-29 01:30:00    1.385914
2000-03-31 01:30:00   -1.104685
2000-04-30 01:30:00    0.677098
Freq: M, dtype: float64
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org0baa236" class="outline-3">
<h3 id="org0baa236"><span class="section-number-3">6.3</span> 重采样(resample)</h3>
<div class="outline-text-3" id="text-6-3">
<p>
<code>resample</code> 有和 <code>groupby</code> 相似的 API ：调用 <code>resample</code> 对数据分组，再使用聚合函数。
</p>
</div>

<div id="outline-container-org294fe02" class="outline-4">
<h4 id="org294fe02"><span class="section-number-4">6.3.1</span> 下采样</h4>
<div class="outline-text-4" id="text-6-3-1">
</div>
<div id="outline-container-orge5102d2" class="outline-5">
<h5 id="orge5102d2"><span class="section-number-5">6.3.1.1</span> 采样时间基数(base)</h5>
<div class="outline-text-5" id="text-6-3-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">rng</span> = pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, periods=12, freq=<span style="color: #e6db74;">'T'</span>)
<span style="color: #fd971f;">ts</span> = pd.Series(np.arange(12), index=rng)
log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.resample('5min', base=3).sum()"</span>, ts.resample(<span style="color: #e6db74;">'5min'</span>, base=3).<span style="color: #a6e22e;">sum</span>())
</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: T, dtype: int64
====================== ts.resample('5min', base=3).sum() =======================
1999-12-31 23:58:00     3
2000-01-01 00:03:00    25
2000-01-01 00:08:00    38
Freq: 5T, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-orgd29a3cf" class="outline-5">
<h5 id="orgd29a3cf"><span class="section-number-5">6.3.1.2</span> 半开区间</h5>
<div class="outline-text-5" id="text-6-3-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">rng</span> = pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, periods=12, freq=<span style="color: #e6db74;">'T'</span>)
<span style="color: #fd971f;">ts</span> = pd.Series(np.arange(12), index=rng)
log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.resample('5min').sum()"</span>, ts.resample(<span style="color: #e6db74;">'5min'</span>).<span style="color: #a6e22e;">sum</span>()) <span style="color: #465457;"># </span><span style="color: #465457;">close='left' : [left, right)</span>
log(<span style="color: #e6db74;">"ts.resample('5min', closed='right').sum()"</span>, ts.resample(<span style="color: #e6db74;">'5min'</span>, closed=<span style="color: #e6db74;">'right'</span>).<span style="color: #a6e22e;">sum</span>()) <span style="color: #465457;"># </span><span style="color: #465457;">(left, right]</span>

<span style="color: #465457;"># </span><span style="color: #465457;">&#40664;&#35748; index &#26159;&#20351;&#29992;&#24038;&#21306;&#38388;&#30340; label</span>
log(<span style="color: #e6db74;">"ts.resample('5min', closed='right', label='right', loffset='-1s').sum()"</span>,
    ts.resample(<span style="color: #e6db74;">'5min'</span>, closed=<span style="color: #e6db74;">'right'</span>, label=<span style="color: #e6db74;">'right'</span>, loffset=<span style="color: #e6db74;">'-1s'</span>).<span style="color: #a6e22e;">sum</span>()) <span style="color: #465457;"># </span><span style="color: #465457;">&#20063;&#21487;&#20351;&#29992; shift &#23454;&#29616;&#27492;&#21151;&#33021;</span>

</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: T, dtype: int64
========================== ts.resample('5min').sum() ===========================
2000-01-01 00:00:00    10
2000-01-01 00:05:00    35
2000-01-01 00:10:00    21
Freq: 5T, dtype: int64
================== ts.resample('5min', closed='right').sum() ===================
1999-12-31 23:55:00     0
2000-01-01 00:00:00    15
2000-01-01 00:05:00    40
2000-01-01 00:10:00    11
Freq: 5T, dtype: int64
=== ts.resample('5min', closed='right', label='right', loffset='-1s').sum() ====
1999-12-31 23:59:59     0
2000-01-01 00:04:59    15
2000-01-01 00:09:59    40
2000-01-01 00:14:59    11
Freq: 5T, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org2eb0592" class="outline-5">
<h5 id="org2eb0592"><span class="section-number-5">6.3.1.3</span> OHLC 重采样</h5>
<div class="outline-text-5" id="text-6-3-1-3">
<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"ts"</span>, ts)
log(<span style="color: #e6db74;">"ts.resample('5min').ohlc()"</span>, ts.resample(<span style="color: #e6db74;">'5min'</span>).ohlc())
log(<span style="color: #e6db74;">"ts.resample('5min', closed='right').ohlc()"</span>, ts.resample(<span style="color: #e6db74;">'5min'</span>, closed=<span style="color: #e6db74;">'right'</span>).ohlc())

</pre>
</div>

<pre class="example">
====================================== ts ======================================
2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: T, dtype: int64
========================== ts.resample('5min').ohlc() ==========================
                     open  high  low  close
2000-01-01 00:00:00     0     4    0      4
2000-01-01 00:05:00     5     9    5      9
2000-01-01 00:10:00    10    11   10     11
================== ts.resample('5min', closed='right').ohlc() ==================
                     open  high  low  close
1999-12-31 23:55:00     0     0    0      0
2000-01-01 00:00:00     1     5    1      5
2000-01-01 00:05:00     6    10    6     10
2000-01-01 00:10:00    11    11   11     11
</pre>
</div>
</div>


<div id="outline-container-org9d94ab2" class="outline-5">
<h5 id="org9d94ab2"><span class="section-number-5">6.3.1.4</span> 采样后对各列聚合(agg)</h5>
<div class="outline-text-5" id="text-6-3-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'time'</span>: pd.date_range(<span style="color: #e6db74;">'2000-01-01'</span>, periods=100, freq=<span style="color: #e6db74;">'1min'</span>),
    <span style="color: #e6db74;">'open'</span>: np.random.randn(100) + 10,
    <span style="color: #e6db74;">'close'</span>: np.random.randn(100) + 10,
    <span style="color: #e6db74;">'high'</span>: np.random.randn(100) + 12,
    <span style="color: #e6db74;">'low'</span>: np.random.randn(100) + 8,
}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">resampled</span> = df.resample(rule=<span style="color: #e6db74;">'5T'</span>, on=<span style="color: #e6db74;">'time'</span>).agg(
    {<span style="color: #e6db74;">'open'</span>: <span style="color: #e6db74;">'first'</span>,
     <span style="color: #e6db74;">'close'</span>: <span style="color: #e6db74;">'last'</span>,
     <span style="color: #e6db74;">'high'</span>: <span style="color: #e6db74;">'max'</span>,
     <span style="color: #e6db74;">'low'</span>: <span style="color: #e6db74;">'min'</span>})
log(<span style="color: #e6db74;">"aggregated after resampled"</span>, resampled.head())
</pre>
</div>

<pre class="example">
====================================== df ======================================
                  time       open      close       high        low
0  2000-01-01 00:00:00   9.146496   7.799578  11.566872   6.147550
1  2000-01-01 00:01:00  10.942898   9.102747  12.169999   6.921685
2  2000-01-01 00:02:00  11.233265  11.075704  11.652242   9.802494
3  2000-01-01 00:03:00  10.358937   9.731845  11.896843   8.311956
4  2000-01-01 00:04:00  10.267060  10.398771  12.488892   7.368275
5  2000-01-01 00:05:00   9.548366   8.764407  12.788982   5.971080
6  2000-01-01 00:06:00   9.519593   8.772265  11.671427   8.057322
7  2000-01-01 00:07:00  10.298557   9.803158  13.715465   8.899711
8  2000-01-01 00:08:00  12.245758   8.803445  10.832485   7.200835
9  2000-01-01 00:09:00  10.296126  10.564759  10.889865  10.642973
..                 ...        ...        ...        ...        ...
90 2000-01-01 01:30:00   9.939802   9.796771  11.179146   9.376557
91 2000-01-01 01:31:00  10.358026  11.978796  10.431962   7.741090
92 2000-01-01 01:32:00   8.650781  11.865760  10.669237   8.229553
93 2000-01-01 01:33:00   9.484083  11.292325  10.172697   9.119062
94 2000-01-01 01:34:00  10.070030   8.810089  11.381976   8.951942
95 2000-01-01 01:35:00  10.954768  10.365418  13.230260   8.477060
96 2000-01-01 01:36:00   9.680781  11.158734  11.163112   8.644006
97 2000-01-01 01:37:00   8.930861   8.888258  11.162988   7.966417
98 2000-01-01 01:38:00  10.486624   9.810581  10.677597   8.644281
99 2000-01-01 01:39:00  11.173694   9.248305  13.195259   8.077134

[100 rows x 5 columns]
========================== aggregated after resampled ==========================
                          open      close       high       low
time
2000-01-01 00:00:00   9.146496  10.398771  12.488892  6.147550
2000-01-01 00:05:00   9.548366  10.564759  13.715465  5.971080
2000-01-01 00:10:00  10.600710   9.367298  13.748761  7.213590
2000-01-01 00:15:00   9.727514  11.136785  13.202317  7.542435
2000-01-01 00:20:00  10.725193  10.636551  13.756371  6.362015
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e5cbb1" class="outline-4">
<h4 id="org0e5cbb1"><span class="section-number-4">6.3.2</span> 上采样与插值</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">frame</span> = pd.DataFrame(np.random.randn(2, 4),
                     index=pd.date_range(<span style="color: #e6db74;">'1/1/2000'</span>, periods=2, freq=<span style="color: #e6db74;">'W-WED'</span>),
                     columns=[<span style="color: #e6db74;">'Colorado'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'New York'</span>, <span style="color: #e6db74;">'Ohio'</span>])
log(<span style="color: #e6db74;">"frame"</span>, frame)
log(<span style="color: #e6db74;">"frame.resample('D').asfreq()"</span>, frame.resample(<span style="color: #e6db74;">'D'</span>).asfreq())
log(<span style="color: #e6db74;">"frame.resample('D').ffill()"</span>, frame.resample(<span style="color: #e6db74;">'D'</span>).ffill())
</pre>
</div>

<pre class="example">
==================================== frame =====================================
            Colorado     Texas  New York      Ohio
2000-01-05 -0.179199  0.929787 -0.046577  0.028099
2000-01-12 -0.196553  0.334500  0.171028  1.063931
========================= frame.resample('D').asfreq() =========================
            Colorado     Texas  New York      Ohio
2000-01-05 -0.179199  0.929787 -0.046577  0.028099
2000-01-06       NaN       NaN       NaN       NaN
2000-01-07       NaN       NaN       NaN       NaN
2000-01-08       NaN       NaN       NaN       NaN
2000-01-09       NaN       NaN       NaN       NaN
2000-01-10       NaN       NaN       NaN       NaN
2000-01-11       NaN       NaN       NaN       NaN
2000-01-12 -0.196553  0.334500  0.171028  1.063931
========================= frame.resample('D').ffill() ==========================
            Colorado     Texas  New York      Ohio
2000-01-05 -0.179199  0.929787 -0.046577  0.028099
2000-01-06 -0.179199  0.929787 -0.046577  0.028099
2000-01-07 -0.179199  0.929787 -0.046577  0.028099
2000-01-08 -0.179199  0.929787 -0.046577  0.028099
2000-01-09 -0.179199  0.929787 -0.046577  0.028099
2000-01-10 -0.179199  0.929787 -0.046577  0.028099
2000-01-11 -0.179199  0.929787 -0.046577  0.028099
2000-01-12 -0.196553  0.334500  0.171028  1.063931
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org52890b4" class="outline-2">
<h2 id="org52890b4"><span class="section-number-2">7</span> 移动窗口函数</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org27487af" class="outline-3">
<h3 id="org27487af"><span class="section-number-3">7.1</span> rolling</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orgf154868" class="outline-4">
<h4 id="orgf154868"><span class="section-number-4">7.1.1</span> 按长度确定窗口</h4>
<div class="outline-text-4" id="text-7-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(10))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.rolling(3).mean()"</span>, s.rolling(3).mean())
log(<span style="color: #e6db74;">"s.rolling(3, min_periods=2).mean()"</span>, s.rolling(3, min_periods=2).mean())
s.rolling(3).mean().plot()
plot()
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    0
1    1
2    2
3    3
4    4
5    5
6    6
7    7
8    8
9    9
dtype: int64
============================= s.rolling(3).mean() ==============================
0    NaN
1    NaN
2    1.0
3    2.0
4    3.0
5    4.0
6    5.0
7    6.0
8    7.0
9    8.0
dtype: float64
====================== s.rolling(3, min_periods=2).mean() ======================
0    NaN
1    0.5
2    1.0
3    2.0
4    3.0
5    4.0
6    5.0
7    6.0
8    7.0
9    8.0
dtype: float64
</pre>



<div class="figure">
<p><img src="img/fig_rolling.png" alt="fig_rolling.png">
</p>
</div>
</div>
</div>




<div id="outline-container-org98d683a" class="outline-4">
<h4 id="org98d683a"><span class="section-number-4">7.1.2</span> 按时间确定窗口</h4>
<div class="outline-text-4" id="text-7-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">close_px_all</span> = pd.read_csv(<span style="color: #e6db74;">'data/stock_px_2.csv'</span>, parse_dates=<span style="color: #ae81ff;">True</span>, index_col=0)
<span style="color: #fd971f;">close_px</span> = close_px_all[[<span style="color: #e6db74;">'AAPL'</span>, <span style="color: #e6db74;">'MSFT'</span>, <span style="color: #e6db74;">'XOM'</span>]]
log(<span style="color: #e6db74;">"close_px.head()"</span>, close_px.head())
log(<span style="color: #e6db74;">"close_px.rolling('20D').mean().head()"</span>, close_px.rolling(<span style="color: #e6db74;">'20D'</span>).mean().head()) <span style="color: #465457;"># </span><span style="color: #465457;">&#26080;&#38656;&#25351;&#23450; min_periods &#65311;</span>
</pre>
</div>

<pre class="example">
=============================== close_px.head() ================================
            AAPL   MSFT    XOM
2003-01-02  7.40  21.11  29.22
2003-01-03  7.45  21.14  29.24
2003-01-06  7.45  21.52  29.96
2003-01-07  7.43  21.93  28.95
2003-01-08  7.28  21.31  28.83
==================== close_px.rolling('20D').mean().head() =====================
                AAPL       MSFT        XOM
2003-01-02  7.400000  21.110000  29.220000
2003-01-03  7.425000  21.125000  29.230000
2003-01-06  7.433333  21.256667  29.473333
2003-01-07  7.432500  21.425000  29.342500
2003-01-08  7.402000  21.402000  29.240000
</pre>
</div>
</div>
</div>


<div id="outline-container-orgbea6cab" class="outline-3">
<h3 id="orgbea6cab"><span class="section-number-3">7.2</span> expanding</h3>
<div class="outline-text-3" id="text-7-2">
<p>
窗口从小到大增长，直到整个序列长度。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(10))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.expanding().mean()"</span>, s.expanding().mean())
s.plot()
plot()
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    0
1    1
2    2
3    3
4    4
5    5
6    6
7    7
8    8
9    9
dtype: int64
============================= s.expanding().mean() =============================
0    0.0
1    0.5
2    1.0
3    1.5
4    2.0
5    2.5
6    3.0
7    3.5
8    4.0
9    4.5
dtype: float64
</pre>


<div class="figure">
<p><img src="img/fig_expanding.png" alt="fig_expanding.png">
</p>
</div>
</div>
</div>




<div id="outline-container-org9317781" class="outline-3">
<h3 id="org9317781"><span class="section-number-3">7.3</span> ewm</h3>
<div class="outline-text-3" id="text-7-3">
<p>
通过 <code>span</code> 指定一个固定衰减因子，赋予 <b>最近观察值</b> 更多的权重。
</p>

<p>
<a href="https://blog.csdn.net/mzpmzk/article/details/80085929">传送门</a>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(10))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.rolling(3).mean()"</span>, s.rolling(3).mean())
log(<span style="color: #e6db74;">"s.ewm(span=3).mean()"</span>, s.ewm(span=3).mean())
log(<span style="color: #e6db74;">"s.ewm(span=5).mean()"</span>, s.ewm(span=5).mean())

</pre>
</div>

<pre class="example">
====================================== s =======================================
0    0
1    1
2    2
3    3
4    4
5    5
6    6
7    7
8    8
9    9
dtype: int64
============================= s.rolling(3).mean() ==============================
0    NaN
1    NaN
2    1.0
3    2.0
4    3.0
5    4.0
6    5.0
7    6.0
8    7.0
9    8.0
dtype: float64
============================= s.ewm(span=3).mean() =============================
0    0.000000
1    0.666667
2    1.428571
3    2.266667
4    3.161290
5    4.095238
6    5.055118
7    6.031373
8    7.017613
9    8.009775
dtype: float64
============================= s.ewm(span=5).mean() =============================
0    0.000000
1    0.600000
2    1.263158
3    1.984615
4    2.758294
5    3.577444
6    4.435163
7    5.324822
8    6.240363
9    7.176476
dtype: float64
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">aapl_px</span> = close_px.AAPL[<span style="color: #e6db74;">'2006'</span>:<span style="color: #e6db74;">'2007'</span>]
<span style="color: #fd971f;">ma30</span> = aapl_px.rolling(30, min_periods=20).mean()
<span style="color: #fd971f;">ma50</span> = aapl_px.rolling(30, min_periods=20).mean()
<span style="color: #fd971f;">ewma10</span> = aapl_px.ewm(span=10).mean()
<span style="color: #fd971f;">ewma30</span> = aapl_px.ewm(span=30).mean()
<span style="color: #fd971f;">ewma50</span> = aapl_px.ewm(span=50).mean()
<span style="color: #fd971f;">ewma100</span> = aapl_px.ewm(span=100).mean()
aapl_px.plot(label=<span style="color: #e6db74;">'aapl_px'</span>, style=<span style="color: #e6db74;">'k--'</span>)
ma30.plot(label=<span style="color: #e6db74;">'ma30'</span>)
ma50.plot(label=<span style="color: #e6db74;">'ma50'</span>)
ewma10.plot(label=<span style="color: #e6db74;">'ewma10'</span>)
ewma30.plot(label=<span style="color: #e6db74;">'ewma30'</span>)
ewma50.plot(label=<span style="color: #e6db74;">'ewma50'</span>)
ewma100.plot(label=<span style="color: #e6db74;">'ewma100'</span>)
plot()

</pre>
</div>


<div class="figure">
<p><img src="img/figbgl8w4.png" alt="figbgl8w4.png">
</p>
</div>
</div>
</div>

<div id="outline-container-org2f1004d" class="outline-3">
<h3 id="org2f1004d"><span class="section-number-3">7.4</span> 二元窗口函数</h3>
<div class="outline-text-3" id="text-7-4">
</div>
<div id="outline-container-org1f91c14" class="outline-4">
<h4 id="org1f91c14"><span class="section-number-4">7.4.1</span> corr</h4>
<div class="outline-text-4" id="text-7-4-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(10))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.corr(s)"</span>, s.corr(s))
log(<span style="color: #e6db74;">"s.rolling(3).corr(s)"</span>, s.rolling(3).corr(s))
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    0
1    1
2    2
3    3
4    4
5    5
6    6
7    7
8    8
9    9
dtype: int64
================================== s.corr(s) ===================================
0.9999999999999999
============================= s.rolling(3).corr(s) =============================
0    NaN
1    1.0
2    1.0
3    1.0
4    1.0
5    1.0
6    1.0
7    1.0
8    1.0
9    1.0
dtype: float64
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb1c9fb4" class="outline-2">
<h2 id="orgb1c9fb4"><span class="section-number-2">8</span> 实用方法</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org71410ab" class="outline-3">
<h3 id="org71410ab"><span class="section-number-3">8.1</span> 链式操作</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-orgd2f599d" class="outline-4">
<h4 id="orgd2f599d"><span class="section-number-4">8.1.1</span> DataFrame.assign</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
<code>assign</code> 方法是 <code>df[k] = v</code> 的链式表达方式。
</p>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df2</span> = df.copy()
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'k'</span>] = v
</pre>
</div>

<p>
等效于：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df2</span> = df.assign(k=v)
</pre>
</div>



<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = load_data()
<span style="color: #fd971f;">df2</span> = df[df[<span style="color: #e6db74;">'col2'</span>] &lt; 0]
<span style="color: #fd971f;">df2</span>[<span style="color: #e6db74;">'col1_demeaned'</span>] = df2.col1 - df2.col1.mean()
</pre>
</div>

<p>
等效于：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df2</span> = (load_data()
       [<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.col2 &lt; 0]
       .assign(col1_demeaned=<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.col1 - x.col1.mean()))
</pre>
</div>

<p>
这种方式就不需要引用中间变量 <code>df</code> 了。
</p>
</div>
</div>



<div id="outline-container-orgcdbf795" class="outline-4">
<h4 id="orgcdbf795"><span class="section-number-4">8.1.2</span> pd.pipe</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
当使用函数处理 Series 或 DataFrame ，处理结果也是 Series 或 DataFrame 类型时，
可以使用 <code>pipe</code> 完成链式操作：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">a</span> = f(df, arg1=v1)
<span style="color: #fd971f;">b</span> = g(a, v2, arg3=v3)
<span style="color: #fd971f;">c</span> = h(b, arg4=v4)
</pre>
</div>

<p>
等效于：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">result</span> = (df.pipe(f, arg1=v1)
          .pipe(g, v2, arg3=v3)
          .pipe(h, arg4=v4))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org21f9f22" class="outline-3">
<h3 id="org21f9f22"><span class="section-number-3">8.2</span> 查看 DataFrame 信息</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">close_px</span> = pd.read_csv(<span style="color: #e6db74;">'data/stock_px_2.csv'</span>, parse_dates=<span style="color: #ae81ff;">True</span>, index_col=0)
close_px.info()
</pre>
</div>

<pre class="example">
&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 2214 entries, 2003-01-02 to 2011-10-14
Data columns (total 4 columns):
AAPL    2214 non-null float64
MSFT    2214 non-null float64
XOM     2214 non-null float64
SPX     2214 non-null float64
dtypes: float64(4)
memory usage: 86.5 KB

</pre>
</div>
</div>


<div id="outline-container-org945eb9e" class="outline-3">
<h3 id="org945eb9e"><span class="section-number-3">8.3</span> 排序</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-orgde4b36e" class="outline-4">
<h4 id="orgde4b36e"><span class="section-number-4">8.3.1</span> 找出插入值应处位置(searchsorted)</h4>
<div class="outline-text-4" id="text-8-3-1">
<p>
<code>Series.searchsorted(value)</code>
</p>
</div>
</div>

<div id="outline-container-org188350d" class="outline-4">
<h4 id="org188350d"><span class="section-number-4">8.3.2</span> nlargest(n)/nsmallest(n)</h4>
</div>

<div id="outline-container-orgf060184" class="outline-4">
<h4 id="orgf060184"><span class="section-number-4">8.3.3</span> 排序并输出对应索引(Series.argsort)</h4>
<div class="outline-text-4" id="text-8-3-3">
<p>
序列中的元素从小到大排列，提取其对应的 index
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"np.array([1,4,3,-1,6,9]).argsort()"</span>, np.array([1,4,3,-1,6,9]).argsort())
log(<span style="color: #e6db74;">"pd.Series(np.array([1,4,3,-1,6,9])).argsort()"</span>, pd.Series(np.array([1,4,3,-1,6,9])).argsort())
</pre>
</div>

<pre class="example">
====================== np.array([1,4,3,-1,6,9]).argsort() ======================
[3 0 2 1 4 5]
================ pd.Series(np.array([1,4,3,-1,6,9])).argsort() =================
0    3
1    0
2    2
3    1
4    4
5    5
dtype: int64
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f75248" class="outline-3">
<h3 id="org9f75248"><span class="section-number-3">8.4</span> 列操作</h3>
<div class="outline-text-3" id="text-8-4">
</div>
<div id="outline-container-org399ab16" class="outline-4">
<h4 id="org399ab16"><span class="section-number-4">8.4.1</span> 数据增长值(diff)</h4>
<div class="outline-text-4" id="text-8-4-1">
<p>
用于计算数据之间的差值
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'open'</span> : pd.Series([1, 2, 3, 4], index=pd.date_range(<span style="color: #e6db74;">'2018-10-04'</span>, periods=4))
}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.assign(diff=df.open.diff(-1))"</span>, df.assign(diff=df.<span style="color: #a6e22e;">open</span>.diff(-1)))
log(<span style="color: #e6db74;">"df.assign(diff=df.open.diff(1))"</span>, df.assign(diff=df.<span style="color: #a6e22e;">open</span>.diff(1)))
</pre>
</div>

<pre class="example">
====================================== df ======================================
            open
2018-10-04     1
2018-10-05     2
2018-10-06     3
2018-10-07     4
======================= df.assign(diff=df.open.diff(-1)) =======================
            open  diff
2018-10-04     1  -1.0
2018-10-05     2  -1.0
2018-10-06     3  -1.0
2018-10-07     4   NaN
======================= df.assign(diff=df.open.diff(1)) ========================
            open  diff
2018-10-04     1   NaN
2018-10-05     2   1.0
2018-10-06     3   1.0
2018-10-07     4   1.0
</pre>
</div>
</div>

<div id="outline-container-org3c50753" class="outline-4">
<h4 id="org3c50753"><span class="section-number-4">8.4.2</span> 数据增长率(pct_change)</h4>
<div class="outline-text-4" id="text-8-4-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'open'</span> : pd.Series([1, 2, 3, 4], index=pd.date_range(<span style="color: #e6db74;">'2018-10-04'</span>, periods=4))
}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.assign(pct=df.open.pct_change(1))"</span>, df.assign(pct=df.<span style="color: #a6e22e;">open</span>.pct_change(1)))
</pre>
</div>

<pre class="example">
====================================== df ======================================
            open
2018-10-04     1
2018-10-05     2
2018-10-06     3
2018-10-07     4
===================== df.assign(pct=df.open.pct_change(1)) =====================
            open       pct
2018-10-04     1       NaN
2018-10-05     2  1.000000
2018-10-06     3  0.500000
2018-10-07     4  0.333333
</pre>
</div>
</div>


<div id="outline-container-org58a50a8" class="outline-4">
<h4 id="org58a50a8"><span class="section-number-4">8.4.3</span> 累加值(cumsum)</h4>
<div class="outline-text-4" id="text-8-4-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'open'</span> : pd.Series([1, 2, 3, 4], index=pd.date_range(<span style="color: #e6db74;">'2018-10-04'</span>, periods=4))
}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.open.cumsum()"</span>, df.<span style="color: #a6e22e;">open</span>.cumsum())
</pre>
</div>

<pre class="example">
====================================== df ======================================
            open
2018-10-04     1
2018-10-05     2
2018-10-06     3
2018-10-07     4
=============================== df.open.cumsum() ===============================
2018-10-04     1
2018-10-05     3
2018-10-06     6
2018-10-07    10
Freq: D, Name: open, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org68dd460" class="outline-4">
<h4 id="org68dd460"><span class="section-number-4">8.4.4</span> 资金曲线(cumprod)</h4>
<div class="outline-text-4" id="text-8-4-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {
    <span style="color: #e6db74;">'open'</span> : pd.Series([5, 5.2, 8.5, 8], index=pd.date_range(<span style="color: #e6db74;">'2018-10-04'</span>, periods=4))
}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'pct'</span>] = df.<span style="color: #a6e22e;">open</span>.pct_change(1)
log(<span style="color: #e6db74;">"(df['pct'] + 1.0).cumprod()"</span>, (df[<span style="color: #e6db74;">'pct'</span>] + 1.0).cumprod()) <span style="color: #465457;"># </span><span style="color: #465457;">&#20551;&#35774;&#21021;&#22987;&#36164;&#37329;&#20026; 1 &#20803;</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
            open
2018-10-04   5.0
2018-10-05   5.2
2018-10-06   8.5
2018-10-07   8.0
========================= (df['pct'] + 1.0).cumprod() ==========================
2018-10-04     NaN
2018-10-05    1.04
2018-10-06    1.70
2018-10-07    1.60
Freq: D, Name: pct, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-orgc6c3b97" class="outline-4">
<h4 id="orgc6c3b97"><span class="section-number-4">8.4.5</span> np.where</h4>
<div class="outline-text-4" id="text-8-4-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(10))
<span style="color: #fd971f;">s2</span> = np.where(s % 2 == 0, <span style="color: #e6db74;">'Even'</span>, <span style="color: #e6db74;">'Odd'</span>)
<span style="color: #fd971f;">s3</span> = np.where(s &gt; 5, <span style="color: #e6db74;">'Bigger'</span>, <span style="color: #e6db74;">'Smaller'</span>)
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s3"</span>, s3)
</pre>
</div>

<pre class="example">
====================================== s2 ======================================
['Even' 'Odd' 'Even' 'Odd' 'Even' 'Odd' 'Even' 'Odd' 'Even' 'Odd']
====================================== s3 ======================================
['Smaller' 'Smaller' 'Smaller' 'Smaller' 'Smaller' 'Smaller' 'Bigger'
 'Bigger' 'Bigger' 'Bigger']

</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>