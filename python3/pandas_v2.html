<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-09-23 Sun 22:08 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pandas</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/solarized/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf641453">1. 核心数据结构</a>
<ul>
<li><a href="#orgfffc1cc">1.1. 索引对象</a></li>
<li><a href="#org6bee70f">1.2. Panel</a></li>
<li><a href="#org37e6d99">1.3. Series</a>
<ul>
<li><a href="#orgc5122ee">1.3.1. 从 ndarray 创建</a></li>
<li><a href="#org537048c">1.3.2. 从字典创建</a></li>
<li><a href="#orgae7bf48">1.3.3. 从标量创建</a></li>
<li><a href="#orgf50a437">1.3.4. 赋值</a></li>
<li><a href="#org5781c31">1.3.5. 与标量相乘</a></li>
<li><a href="#org521c862">1.3.6. 应用数学函数</a></li>
<li><a href="#orgaaf9e92">1.3.7. 映射 (apply)</a></li>
<li><a href="#orgbbe3d80">1.3.8. 排序(sort_index/sort_values)</a></li>
<li><a href="#orge5dba11">1.3.9. 唯一值(unique)，计数(count)和成员(isin)</a></li>
<li><a href="#org3e9bc16">1.3.10. 排名(rank)</a></li>
<li><a href="#org05e3632">1.3.11. 在字典上下文中使用</a></li>
<li><a href="#org848bb9e">1.3.12. 检查缺失数据</a></li>
</ul>
</li>
<li><a href="#orgfb2e200">1.4. DataFrame</a>
<ul>
<li><a href="#org0ec02c6">1.4.1. 从字典创建</a></li>
<li><a href="#org74a559f">1.4.2. 从结构化数据列表创建</a></li>
<li><a href="#orgaa93676">1.4.3. 从字典列表创建</a></li>
<li><a href="#org5efb72c">1.4.4. 从元组字典创建</a></li>
<li><a href="#org93ba411">1.4.5. 从 Series 创建</a></li>
<li><a href="#org914ce25">1.4.6. 指定行列索引创建</a></li>
<li><a href="#org6502f6d">1.4.7. 转置</a></li>
<li><a href="#orgc769741">1.4.8. 算数运算填充</a></li>
<li><a href="#orga3397b7">1.4.9. 和 Series 之间的运算（广播机制）</a></li>
<li><a href="#org10237d3">1.4.10. 应用函数</a></li>
<li><a href="#org4d8ebe7">1.4.11. 行/列映射 (apply)</a></li>
<li><a href="#org60ceea8">1.4.12. 逐元素映射 (applymap)</a></li>
<li><a href="#orge01a14d">1.4.13. 排序(sort_index/sort_values)</a></li>
<li><a href="#org15dd8b9">1.4.14. 排名(rank)</a></li>
<li><a href="#org8a4962a">1.4.15. 转换为 ndarray 对象</a></li>
<li><a href="#org538917d">1.4.16. 统计</a></li>
<li><a href="#org23c6570">1.4.17. concat</a></li>
<li><a href="#orga0e2b4d">1.4.18. merge / join</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2ff6831">2. 索引</a>
<ul>
<li><a href="#orge2b05fb">2.1. Series</a>
<ul>
<li><a href="#orgad6fa5b">2.1.1. 设置对象自身和索引的 name 属性</a></li>
<li><a href="#org6d61c27">2.1.2. 获取值和索引</a></li>
<li><a href="#orgf7e8580">2.1.3. 索引对齐</a></li>
<li><a href="#orgbbe4cb2">2.1.4. 重建索引</a></li>
<li><a href="#org911af15">2.1.5. 删除索引</a></li>
<li><a href="#org72848db">2.1.6. 标签索引</a></li>
<li><a href="#orga629ac6">2.1.7. 布尔索引</a></li>
</ul>
</li>
<li><a href="#org0d99753">2.2. DataFrame</a>
<ul>
<li><a href="#orgbaf1db4">2.2.1. 设置行/列索引的 name 属性</a></li>
<li><a href="#org6f8009d">2.2.2. 重建索引</a></li>
<li><a href="#orge86207c">2.2.3. 索引对齐</a></li>
<li><a href="#org48c5266">2.2.4. 列赋值</a></li>
<li><a href="#org33ed27e">2.2.5. 删除行/列</a></li>
<li><a href="#orgf5dd3ef">2.2.6. 标签索引</a></li>
<li><a href="#orgcc56dc8">2.2.7. 正则索引</a></li>
<li><a href="#org3f8aa00">2.2.8. 整数索引</a></li>
<li><a href="#org21a3c4c">2.2.9. 布尔索引</a></li>
<li><a href="#org2b865c1">2.2.10. loc 索引</a></li>
<li><a href="#org72a2581">2.2.11. iloc 索引</a></li>
<li><a href="#org28b90e2">2.2.12. at 索引</a></li>
<li><a href="#org8a67fb5">2.2.13. 随机索引</a></li>
<li><a href="#orgd339796">2.2.14. 重命名行/列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6cfa420">3. 数据清洗</a>
<ul>
<li><a href="#orgea16ac5">3.1. 处理缺失值</a>
<ul>
<li><a href="#org968a5c9">3.1.1. 过滤缺失值(dropna)</a></li>
<li><a href="#org0571ff5">3.1.2. 补全缺失值(fillna)</a></li>
</ul>
</li>
<li><a href="#org5ff2848">3.2. 数据转换</a>
<ul>
<li><a href="#orgc1103a2">3.2.1. 删除重复值</a></li>
<li><a href="#org510e255">3.2.2. 使用函数或映射进行数据转换</a></li>
<li><a href="#org97de4cd">3.2.3. 替代值(replace)</a></li>
<li><a href="#orgc5ee588">3.2.4. 重命名索引</a></li>
<li><a href="#org63a8e1e">3.2.5. 离散化和分箱(cut/qcut)</a></li>
<li><a href="#orgf5fff9d">3.2.6. 检测异常值(any)</a></li>
<li><a href="#orgb29f2b1">3.2.7. 随机重排序</a></li>
<li><a href="#orgf8d1347">3.2.8. 指标矩阵(get_dummies)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc2fe49f">4. 数据规整：连接，联合，重塑</a>
<ul>
<li><a href="#org1163b80">4.1. 分层索引</a>
<ul>
<li><a href="#orgb7befed">4.1.1. 层级交换(swaplevel)与排序(sort_index)</a></li>
<li><a href="#org1d233f2">4.1.2. 列索引转为行索引 (set_index)</a></li>
<li><a href="#org006ce75">4.1.3. 行索引转为列索引 (reset_index)</a></li>
</ul>
</li>
<li><a href="#org9f26c40">4.2. 连接与合并(concat,merge,combine_first)</a>
<ul>
<li><a href="#org58b39dc">4.2.1. merge</a>
<ul>
<li><a href="#orgd5c7dfb">4.2.1.1. 基本用法</a></li>
<li><a href="#org1c9052e">4.2.1.2. 合并类型(inner,outer,left,right)</a></li>
<li><a href="#org389b927">4.2.1.3. 索引作为合并键</a></li>
<li><a href="#org0718619">4.2.1.4. join</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4263a9b">5. 附录</a>
<ul>
<li><a href="#org54ce1fd">5.1. reindex 方法的参数 </a></li>
<li><a href="#orgf27e61d">5.2. 索引对象常见方法和属性 </a></li>
<li><a href="#orgb3e9453">5.3. 算数方法 </a></li>
<li><a href="#orgc609f62">5.4. 打破平级关系方法 </a></li>
<li><a href="#orgdb3be59">5.5. fillna 函数参数 </a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf641453">1. 核心数据结构</a>
<ul>
<li><a href="#orgfffc1cc">1.1. 索引对象</a></li>
<li><a href="#org6bee70f">1.2. Panel</a></li>
<li><a href="#org37e6d99">1.3. Series</a>
<ul>
<li><a href="#orgc5122ee">1.3.1. 从 ndarray 创建</a></li>
<li><a href="#org537048c">1.3.2. 从字典创建</a></li>
<li><a href="#orgae7bf48">1.3.3. 从标量创建</a></li>
<li><a href="#orgf50a437">1.3.4. 赋值</a></li>
<li><a href="#org5781c31">1.3.5. 与标量相乘</a></li>
<li><a href="#org521c862">1.3.6. 应用数学函数</a></li>
<li><a href="#orgaaf9e92">1.3.7. 映射 (apply)</a></li>
<li><a href="#orgbbe3d80">1.3.8. 排序(sort_index/sort_values)</a></li>
<li><a href="#orge5dba11">1.3.9. 唯一值(unique)，计数(count)和成员(isin)</a></li>
<li><a href="#org3e9bc16">1.3.10. 排名(rank)</a></li>
<li><a href="#org05e3632">1.3.11. 在字典上下文中使用</a></li>
<li><a href="#org848bb9e">1.3.12. 检查缺失数据</a></li>
</ul>
</li>
<li><a href="#orgfb2e200">1.4. DataFrame</a>
<ul>
<li><a href="#org0ec02c6">1.4.1. 从字典创建</a></li>
<li><a href="#org74a559f">1.4.2. 从结构化数据列表创建</a></li>
<li><a href="#orgaa93676">1.4.3. 从字典列表创建</a></li>
<li><a href="#org5efb72c">1.4.4. 从元组字典创建</a></li>
<li><a href="#org93ba411">1.4.5. 从 Series 创建</a></li>
<li><a href="#org914ce25">1.4.6. 指定行列索引创建</a></li>
<li><a href="#org6502f6d">1.4.7. 转置</a></li>
<li><a href="#orgc769741">1.4.8. 算数运算填充</a></li>
<li><a href="#orga3397b7">1.4.9. 和 Series 之间的运算（广播机制）</a></li>
<li><a href="#org10237d3">1.4.10. 应用函数</a></li>
<li><a href="#org4d8ebe7">1.4.11. 行/列映射 (apply)</a></li>
<li><a href="#org60ceea8">1.4.12. 逐元素映射 (applymap)</a></li>
<li><a href="#orge01a14d">1.4.13. 排序(sort_index/sort_values)</a></li>
<li><a href="#org15dd8b9">1.4.14. 排名(rank)</a></li>
<li><a href="#org8a4962a">1.4.15. 转换为 ndarray 对象</a></li>
<li><a href="#org538917d">1.4.16. 统计</a></li>
<li><a href="#org23c6570">1.4.17. concat</a></li>
<li><a href="#orga0e2b4d">1.4.18. merge / join</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2ff6831">2. 索引</a>
<ul>
<li><a href="#orge2b05fb">2.1. Series</a>
<ul>
<li><a href="#orgad6fa5b">2.1.1. 设置对象自身和索引的 name 属性</a></li>
<li><a href="#org6d61c27">2.1.2. 获取值和索引</a></li>
<li><a href="#orgf7e8580">2.1.3. 索引对齐</a></li>
<li><a href="#orgbbe4cb2">2.1.4. 重建索引</a></li>
<li><a href="#org911af15">2.1.5. 删除索引</a></li>
<li><a href="#org72848db">2.1.6. 标签索引</a></li>
<li><a href="#orga629ac6">2.1.7. 布尔索引</a></li>
</ul>
</li>
<li><a href="#org0d99753">2.2. DataFrame</a>
<ul>
<li><a href="#orgbaf1db4">2.2.1. 设置行/列索引的 name 属性</a></li>
<li><a href="#org6f8009d">2.2.2. 重建索引</a></li>
<li><a href="#orge86207c">2.2.3. 索引对齐</a></li>
<li><a href="#org48c5266">2.2.4. 列赋值</a></li>
<li><a href="#org33ed27e">2.2.5. 删除行/列</a></li>
<li><a href="#orgf5dd3ef">2.2.6. 标签索引</a></li>
<li><a href="#orgcc56dc8">2.2.7. 正则索引</a></li>
<li><a href="#org3f8aa00">2.2.8. 整数索引</a></li>
<li><a href="#org21a3c4c">2.2.9. 布尔索引</a></li>
<li><a href="#org2b865c1">2.2.10. loc 索引</a></li>
<li><a href="#org72a2581">2.2.11. iloc 索引</a></li>
<li><a href="#org28b90e2">2.2.12. at 索引</a></li>
<li><a href="#org8a67fb5">2.2.13. 随机索引</a></li>
<li><a href="#orgd339796">2.2.14. 重命名行/列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6cfa420">3. 数据清洗</a>
<ul>
<li><a href="#orgea16ac5">3.1. 处理缺失值</a>
<ul>
<li><a href="#org968a5c9">3.1.1. 过滤缺失值(dropna)</a></li>
<li><a href="#org0571ff5">3.1.2. 补全缺失值(fillna)</a></li>
</ul>
</li>
<li><a href="#org5ff2848">3.2. 数据转换</a>
<ul>
<li><a href="#orgc1103a2">3.2.1. 删除重复值</a></li>
<li><a href="#org510e255">3.2.2. 使用函数或映射进行数据转换</a></li>
<li><a href="#org97de4cd">3.2.3. 替代值(replace)</a></li>
<li><a href="#orgc5ee588">3.2.4. 重命名索引</a></li>
<li><a href="#org63a8e1e">3.2.5. 离散化和分箱(cut/qcut)</a></li>
<li><a href="#orgf5fff9d">3.2.6. 检测异常值(any)</a></li>
<li><a href="#orgb29f2b1">3.2.7. 随机重排序</a></li>
<li><a href="#orgf8d1347">3.2.8. 指标矩阵(get_dummies)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc2fe49f">4. 数据规整：连接，联合，重塑</a>
<ul>
<li><a href="#org1163b80">4.1. 分层索引</a>
<ul>
<li><a href="#orgb7befed">4.1.1. 层级交换(swaplevel)与排序(sort_index)</a></li>
<li><a href="#org1d233f2">4.1.2. 列索引转为行索引 (set_index)</a></li>
<li><a href="#org006ce75">4.1.3. 行索引转为列索引 (reset_index)</a></li>
</ul>
</li>
<li><a href="#org9f26c40">4.2. 连接与合并(concat,merge,combine_first)</a>
<ul>
<li><a href="#org58b39dc">4.2.1. merge</a>
<ul>
<li><a href="#orgd5c7dfb">4.2.1.1. 基本用法</a></li>
<li><a href="#org1c9052e">4.2.1.2. 合并类型(inner,outer,left,right)</a></li>
<li><a href="#org389b927">4.2.1.3. 索引作为合并键</a></li>
<li><a href="#org0718619">4.2.1.4. join</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4263a9b">5. 附录</a>
<ul>
<li><a href="#org54ce1fd">5.1. reindex 方法的参数 </a></li>
<li><a href="#orgf27e61d">5.2. 索引对象常见方法和属性 </a></li>
<li><a href="#orgb3e9453">5.3. 算数方法 </a></li>
<li><a href="#orgc609f62">5.4. 打破平级关系方法 </a></li>
<li><a href="#orgdb3be59">5.5. fillna 函数参数 </a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Author</td>
<td class="org-left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">2018-09-23 22:08:01</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgf641453" class="outline-2">
<h2 id="orgf641453"><span class="section-number-2">1</span> 核心数据结构</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgfffc1cc" class="outline-3">
<h3 id="orgfffc1cc"><span class="section-number-3">1.1</span> 索引对象</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Pandas 中的索引对象适用于存储标签和其他元数据的。
</p>

<p>
索引对象是不可变的。
</p>

<p>
<a href="#org218f9fa">常见方法和属性</a>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(3), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abc'</span>))
<span style="color: #fd971f;">index</span> = s.index
log(<span style="color: #e6db74;">"index"</span>, index)
log(<span style="color: #e6db74;">"index[1:]"</span>, index[1:])
<span style="color: #f92672; font-weight: bold;">try</span>:
    <span style="color: #fd971f;">index</span>[1] = <span style="color: #e6db74;">'d'</span> <span style="color: #465457;"># </span><span style="color: #465457;">TypeError</span>
<span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">Exception</span> <span style="color: #f92672; font-weight: bold;">as</span> e:
    log(<span style="color: #e6db74;">"TypeError"</span>, e)
</pre>
</div>

<pre class="example">
==================================== index =====================================
Index(['a', 'b', 'c'], dtype='object')
================================== index[1:] ===================================
Index(['b', 'c'], dtype='object')
================================== TypeError ===================================
Index does not support mutable operations

</pre>
</div>
</div>




<div id="outline-container-org6bee70f" class="outline-3">
<h3 id="org6bee70f"><span class="section-number-3">1.2</span> Panel</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Panel 是三维带标签的数组。
</p>

<p>
Panel 由三个标签组成：
</p>

<dl class="org-dl">
<dt>items</dt><dd>坐标轴 0 ，索引对应的元素是一个 DataFrame</dd>
<dt>major_axis</dt><dd>坐标轴 1 , DataFrame 里的行标签</dd>
<dt>minor_axis</dt><dd>坐标轴 2 , DataFrame 里的列标签</dd>
</dl>
</div>
</div>



<div id="outline-container-org37e6d99" class="outline-3">
<h3 id="org37e6d99"><span class="section-number-3">1.3</span> Series</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Series 是一维带标签的数组，数组里可以放任意的数据（整数，浮点数，字符串，Python Object）。
</p>

<p>
其基本的创建函数是： <code>pd.Series(data, index=index)</code>
</p>

<p>
其中 index 是一个列表，用来作为数据的标签。data 可以是不同的数据类型：
</p>

<ul class="org-ul">
<li>Python 字典</li>
<li>ndarray 对象</li>
<li>一个标量值，如 5</li>
</ul>
</div>


<div id="outline-container-orgc5122ee" class="outline-4">
<h4 id="orgc5122ee"><span class="section-number-4">1.3.1</span> 从 ndarray 创建</h4>
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
<span style="color: #fd971f;">s2</span> = pd.Series(np.random.randn(5))
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s2.index"</span>, s2.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a   -0.701251
b    1.857044
c   -0.775307
d    0.652000
e    1.178334
dtype: float64
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s2 ======================================
0    0.393573
1   -0.042283
2    0.557877
3    2.094997
4    0.671984
dtype: float64
=================================== s2.index ===================================
RangeIndex(start=0, stop=5, step=1)
</pre>
</div>
</div>


<div id="outline-container-org537048c" class="outline-4">
<h4 id="org537048c"><span class="section-number-4">1.3.2</span> 从字典创建</h4>
<div class="outline-text-4" id="text-1-3-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'a'</span> : 0., <span style="color: #e6db74;">'b'</span> : 1., <span style="color: #e6db74;">'d'</span> : 3}
<span style="color: #fd971f;">s</span> = pd.Series(d, index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    NaN
d    3.0
dtype: float64

</pre>
</div>
</div>


<div id="outline-container-orgae7bf48" class="outline-4">
<h4 id="orgae7bf48"><span class="section-number-4">1.3.3</span> 从标量创建</h4>
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(3, index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    3
b    3
c    3
d    3
e    3
dtype: int64

</pre>
</div>
</div>


<div id="outline-container-orgf50a437" class="outline-4">
<h4 id="orgf50a437"><span class="section-number-4">1.3.4</span> 赋值</h4>
<div class="outline-text-4" id="text-1-3-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
<span style="color: #fd971f;">s</span>[<span style="color: #e6db74;">'b'</span>:<span style="color: #e6db74;">'a'</span>] = 5
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
d    4
b    7
a   -5
c    3
dtype: int64
====================================== s =======================================
d    4
b    5
a    5
c    3
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org5781c31" class="outline-4">
<h4 id="org5781c31"><span class="section-number-4">1.3.5</span> 与标量相乘</h4>
<div class="outline-text-4" id="text-1-3-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s * 2"</span>, s * 2)
</pre>
</div>

<pre class="example">
==================================== s * 2 =====================================
d     8
b    14
a   -10
c     6
dtype: int64

</pre>
</div>
</div>



<div id="outline-container-org521c862" class="outline-4">
<h4 id="org521c862"><span class="section-number-4">1.3.6</span> 应用数学函数</h4>
<div class="outline-text-4" id="text-1-3-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"np.exp(s)"</span>, np.exp(s))
</pre>
</div>

<pre class="example">
================================== np.exp(s) ===================================
d      54.598150
b    1096.633158
a       0.006738
c      20.085537
dtype: float64

</pre>
</div>
</div>


<div id="outline-container-orgaaf9e92" class="outline-4">
<h4 id="orgaaf9e92"><span class="section-number-4">1.3.7</span> 映射 (apply)</h4>
<div class="outline-text-4" id="text-1-3-7">
<p>
<code>s.apply(value_to_value_func) -&gt; Series</code>
</p>
</div>
</div>


<div id="outline-container-orgbbe3d80" class="outline-4">
<h4 id="orgbbe3d80"><span class="section-number-4">1.3.8</span> 排序(sort_index/sort_values)</h4>
<div class="outline-text-4" id="text-1-3-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">range</span>(4), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'dabc'</span>))
log(<span style="color: #e6db74;">"s.sort_index()"</span>, s.sort_index())
log(<span style="color: #e6db74;">"s.sort_values()"</span>, s.sort_values())
</pre>
</div>

<pre class="example">
================================ s.sort_index() ================================
a    1
b    2
c    3
d    0
dtype: int64
=============================== s.sort_values() ================================
d    0
a    1
b    2
c    3
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-orge5dba11" class="outline-4">
<h4 id="orge5dba11"><span class="section-number-4">1.3.9</span> 唯一值(unique)，计数(count)和成员(isin)</h4>
<div class="outline-text-4" id="text-1-3-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'cadaabbcc'</span>))
log(<span style="color: #e6db74;">"s.unique()"</span>, s.unique())
log(<span style="color: #e6db74;">"s.value_counts()"</span>, s.value_counts())
log(<span style="color: #e6db74;">"s.isin(['b', 'c'])"</span>, s.isin([<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e9bc16" class="outline-4">
<h4 id="org3e9bc16"><span class="section-number-4">1.3.10</span> 排名(rank)</h4>
<div class="outline-text-4" id="text-1-3-10">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([7, -5, 7, 4, 2, 0, 4])
log(<span style="color: #e6db74;">"s.rank()"</span>, s.rank())
log(<span style="color: #e6db74;">"s.rank(method='first')"</span>, s.rank(method=<span style="color: #e6db74;">'first'</span>))
log(<span style="color: #e6db74;">"s.rank(ascending=False, method='max')"</span>, s.rank(ascending=<span style="color: #ae81ff;">False</span>, method=<span style="color: #e6db74;">'max'</span>))

</pre>
</div>

<pre class="example">
=================================== s.rank() ===================================
0    6.5
1    1.0
2    6.5
3    4.5
4    3.0
5    2.0
6    4.5
dtype: float64
============================ s.rank(method='first') ============================
0    6.0
1    1.0
2    7.0
3    4.0
4    3.0
5    2.0
6    5.0
dtype: float64
==================== s.rank(ascending=False, method='max') =====================
0    2.0
1    7.0
2    2.0
3    4.0
4    5.0
5    6.0
6    4.0
dtype: float64
</pre>

<p>
<a href="#orgab35b6d">打破平级关系方法列表</a>
</p>
</div>
</div>


<div id="outline-container-org05e3632" class="outline-4">
<h4 id="org05e3632"><span class="section-number-4">1.3.11</span> 在字典上下文中使用</h4>
<div class="outline-text-4" id="text-1-3-11">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"'b' in s"</span>, <span style="color: #e6db74;">'b'</span> <span style="color: #f92672; font-weight: bold;">in</span> s)
log(<span style="color: #e6db74;">"'e' in s"</span>, <span style="color: #e6db74;">'e'</span> <span style="color: #f92672; font-weight: bold;">in</span> s)
log(<span style="color: #e6db74;">"7 in s"</span>, 7 <span style="color: #f92672; font-weight: bold;">in</span> s)
</pre>
</div>

<pre class="example">
=================================== 'b' in s ===================================
True
=================================== 'e' in s ===================================
False
==================================== 7 in s ====================================
False

</pre>
</div>
</div>


<div id="outline-container-org848bb9e" class="outline-4">
<h4 id="org848bb9e"><span class="section-number-4">1.3.12</span> 检查缺失数据</h4>
<div class="outline-text-4" id="text-1-3-12">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Ohio'</span>: 35000, <span style="color: #e6db74;">'Texas'</span>: 71000, <span style="color: #e6db74;">'Oregon'</span>: 16000, <span style="color: #e6db74;">'Utah'</span>: 5000}
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'California'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Oregon'</span>, <span style="color: #e6db74;">'Texas'</span>]
<span style="color: #fd971f;">s</span> = pd.Series(data, index=states)
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.isnull()"</span>, s.isnull())
log(<span style="color: #e6db74;">"s.notnull()"</span>, s.notnull())
</pre>
</div>

<pre class="example">
====================================== s =======================================
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
================================== s.isnull() ==================================
California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
================================= s.notnull() ==================================
California    False
Ohio           True
Oregon         True
Texas          True
dtype: bool
</pre>
</div>
</div>
</div>





<div id="outline-container-orgfb2e200" class="outline-3">
<h3 id="orgfb2e200"><span class="section-number-3">1.4</span> DataFrame</h3>
<div class="outline-text-3" id="text-1-4">
<p>
DataFrame 是 <b>二维带行索引和列索引的矩阵</b> 。
</p>

<p>
可以把 DataFrame 想象成一个包含 <span class="underline">已排序的列</span> 的集合。
</p>

<p>
创建 DataFrame 的基本格式是：
</p>

<div class="org-src-container">
<pre class="src src-ipython">pd.DataFrame(data, index=index, columns=columns)
</pre>
</div>

<p>
其中 index 是行标签，=columns= 是列标签，=data= 可以是下面的数据：
</p>

<ul class="org-ul">
<li>由一维 numpy 数组，list，Series 构成的字典</li>
<li>二维 numpy 数组</li>
<li>一个 Series</li>
<li>另外的 DataFrame 对象</li>
</ul>
</div>

<div id="outline-container-org0ec02c6" class="outline-4">
<h4 id="org0ec02c6"><span class="section-number-4">1.4.1</span> 从字典创建</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
<code>key</code> 为 DataFrame 的列； <code>value</code> 为对应列下的值
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'one'</span> : pd.Series([1, 2, 3], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>]),
     <span style="color: #e6db74;">'two'</span> : pd.Series([1, 2, 3, 4], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])}

log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['d', 'b', 'a'])"</span>, pd.DataFrame(d, index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three'])"</span>,
    pd.DataFrame(d, index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>], columns=[<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
==================== pd.DataFrame(d, index=['d', 'b', 'a']) ====================
   one  two
d  NaN    4
b  2.0    2
a  1.0    1
======= pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three']) =======
   two three
d    4   NaN
b    2   NaN
a    1   NaN
</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {<span style="color: #e6db74;">'one'</span> : [1, 2, 3, 4],
     <span style="color: #e6db74;">'two'</span> : [21, 22, 23, 24]}

log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #e6db74;">"pd.DataFrame(d, index=['a', 'b', 'c', 'd'])"</span>, pd.DataFrame(d, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
0    1   21
1    2   22
2    3   23
3    4   24
================= pd.DataFrame(d, index=['a', 'b', 'c', 'd']) ==================
   one  two
a    1   21
b    2   22
c    3   23
d    4   24
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
                  <span style="color: #e6db74;">'A'</span>: 1,
                  <span style="color: #e6db74;">'B'</span>: pd.Timestamp(<span style="color: #e6db74;">'20160301'</span>),
                  <span style="color: #e6db74;">'C'</span>: <span style="color: #a6e22e;">range</span>(4),
                  <span style="color: #e6db74;">'D'</span>: np.arange(5, 9),
                  <span style="color: #e6db74;">'E'</span>: <span style="color: #e6db74;">'text'</span>,
                  <span style="color: #e6db74;">'F'</span>: [<span style="color: #e6db74;">'AA'</span>, <span style="color: #e6db74;">'BB'</span>, <span style="color: #e6db74;">'CC'</span>, <span style="color: #e6db74;">'DD'</span>]})
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD

</pre>
</div>
</div>


<div id="outline-container-org74a559f" class="outline-4">
<h4 id="org74a559f"><span class="section-number-4">1.4.2</span> 从结构化数据列表创建</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [(1, 2.2, <span style="color: #e6db74;">'Hello'</span>), (2, 3., <span style="color: #e6db74;">"World"</span>)]

log(<span style="color: #e6db74;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #e6db74;">"pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #e6db74;">'first'</span>, <span style="color: #e6db74;">'second'</span>], columns=[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>, <span style="color: #e6db74;">'C'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   0    1      2
0  1  2.2  Hello
1  2  3.0  World
==== pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C']) ====
        A    B      C
first   1  2.2  Hello
second  2  3.0  World

</pre>
</div>
</div>


<div id="outline-container-orgaa93676" class="outline-4">
<h4 id="orgaa93676"><span class="section-number-4">1.4.3</span> 从字典列表创建</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = [{<span style="color: #e6db74;">'a'</span>: 1, <span style="color: #e6db74;">'b'</span>: 2}, {<span style="color: #e6db74;">'a'</span>: 5, <span style="color: #e6db74;">'b'</span>: 10, <span style="color: #e6db74;">'c'</span>: 20}]

log(<span style="color: #e6db74;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #e6db74;">"pd.DataFrame(data, index=['first', 'second'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #e6db74;">'first'</span>, <span style="color: #e6db74;">'second'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(data, columns=['a', 'b'])"</span>,
    pd.DataFrame(data, columns=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>]))

</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   a   b     c
0  1   2   NaN
1  5  10  20.0
================ pd.DataFrame(data, index=['first', 'second']) =================
        a   b     c
first   1   2   NaN
second  5  10  20.0
==================== pd.DataFrame(data, columns=['a', 'b']) ====================
   a   b
0  1   2
1  5  10
</pre>
</div>
</div>




<div id="outline-container-org5efb72c" class="outline-4">
<h4 id="org5efb72c"><span class="section-number-4">1.4.4</span> 从元组字典创建</h4>
<div class="outline-text-4" id="text-1-4-4">
<p>
实际应用中，会通过数据清洗的方式，把数据整理成方便 Pandas 导入且可读性好的格式。
然后再通过 <b>reindex/groupby</b> 等方式转换成复杂数据结构。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">d</span> = {(<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 1, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 2},
     (<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 3, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 4},
     (<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 5, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 6},
     (<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'C'</span>): 7, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 8},
     (<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>): {(<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'D'</span>): 9, (<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'B'</span>): 10}}

<span style="color: #465457;"># </span><span style="color: #465457;">&#22810;&#32423;&#26631;&#31614;</span>
log(<span style="color: #e6db74;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
       a              b
       b    a    c    a     b
A B  1.0  4.0  5.0  8.0  10.0
  C  2.0  3.0  6.0  7.0   NaN
  D  NaN  NaN  NaN  NaN   9.0

</pre>
</div>
</div>



<div id="outline-container-org93ba411" class="outline-4">
<h4 id="org93ba411"><span class="section-number-4">1.4.5</span> 从 Series 创建</h4>
<div class="outline-text-4" id="text-1-4-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"pd.DataFrame(s)"</span>, pd.DataFrame(s))
log(<span style="color: #e6db74;">"pd.DataFrame(s, index=['a', 'c', 'd'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
log(<span style="color: #e6db74;">"pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>], columns=[<span style="color: #e6db74;">'A'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(s) ================================
          0
a  1.052429
b -0.183841
c -0.567050
d -0.946448
e -0.245539
==================== pd.DataFrame(s, index=['a', 'c', 'd']) ====================
          0
a  1.052429
c -0.567050
d -0.946448
============ pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A']) =============
          A
a  1.052429
c -0.567050
d -0.946448
</pre>
</div>
</div>



<div id="outline-container-org914ce25" class="outline-4">
<h4 id="org914ce25"><span class="section-number-4">1.4.6</span> 指定行列索引创建</h4>
<div class="outline-text-4" id="text-1-4-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">dates</span> = pd.date_range(<span style="color: #e6db74;">'20160301'</span>, periods=6)
log(<span style="color: #e6db74;">"dates"</span>, dates)

<span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCD'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.048170  1.536653  0.286190 -0.105748
2016-03-02  0.212721 -0.019064 -0.235831 -0.123454
2016-03-03 -0.465780  0.908629  0.148821  0.736669
2016-03-04  1.020257  1.094551  0.508659  0.018455
2016-03-05 -0.065958  0.437436 -1.026936  0.028647
2016-03-06 -0.055553  0.853023 -0.155418  0.160215
</pre>
</div>
</div>



<div id="outline-container-org6502f6d" class="outline-4">
<h4 id="org6502f6d"><span class="section-number-4">1.4.7</span> 转置</h4>
<div class="outline-text-4" id="text-1-4-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Nevada'</span>: {2001: 2.4, 2002: 2.9},
        <span style="color: #e6db74;">'Ohio'</span>: {2001: 1.5, 2001: 1.7, 2002: 3.6}}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.T"</span>, df.T)
</pre>
</div>

<pre class="example">
====================================== df ======================================
      Nevada  Ohio
2001     2.4   1.7
2002     2.9   3.6
===================================== df.T =====================================
        2001  2002
Nevada   2.4   2.9
Ohio     1.7   3.6

</pre>
</div>
</div>



<div id="outline-container-orgc769741" class="outline-4">
<h4 id="orgc769741"><span class="section-number-4">1.4.8</span> 算数运算填充</h4>
<div class="outline-text-4" id="text-1-4-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.arange(12.).reshape((3, 4)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcd'</span>))

<span style="color: #fd971f;">df2</span> = pd.DataFrame(np.arange(20.).reshape((4, 5)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df1 + df2"</span>, df1 + df2)
log(<span style="color: #e6db74;">"df1.add(df2, fill_value=0)"</span>, df1.add(df2, fill_value=0))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
     a    b     c     d
0  0.0  1.0   2.0   3.0
1  4.0  5.0   6.0   7.0
2  8.0  9.0  10.0  11.0
===================================== df2 ======================================
      a     b     c     d     e
0   0.0   1.0   2.0   3.0   4.0
1   5.0   6.0   7.0   8.0   9.0
2  10.0  11.0  12.0  13.0  14.0
3  15.0  16.0  17.0  18.0  19.0
================================== df1 + df2 ===================================
      a     b     c     d   e
0   0.0   2.0   4.0   6.0 NaN
1   9.0  11.0  13.0  15.0 NaN
2  18.0  20.0  22.0  24.0 NaN
3   NaN   NaN   NaN   NaN NaN
========================== df1.add(df2, fill_value=0) ==========================
      a     b     c     d     e
0   0.0   2.0   4.0   6.0   4.0
1   9.0  11.0  13.0  15.0   9.0
2  18.0  20.0  22.0  24.0  14.0
3  15.0  16.0  17.0  18.0  19.0
</pre>
</div>
</div>



<div id="outline-container-orga3397b7" class="outline-4">
<h4 id="orga3397b7"><span class="section-number-4">1.4.9</span> 和 Series 之间的运算（广播机制）</h4>
<div class="outline-text-4" id="text-1-4-9">
<p>
默认会将 Series 的索引与 DataFrame 的列进行匹配，并广播到各行：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12.).reshape((4, 3)),
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bde'</span>),
                  index=[<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Oregon'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">s</span> = df.iloc[0]
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"df - s"</span>, df - s)
<span style="color: #fd971f;">s2</span> = pd.Series(<span style="color: #a6e22e;">range</span>(3), index=[<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'e'</span>, <span style="color: #e6db74;">'f'</span>])
log(<span style="color: #e6db74;">"df + s2"</span>, df + s2)
</pre>
</div>

<pre class="example">
====================================== df ======================================
          b     d     e
Utah    0.0   1.0   2.0
Ohio    3.0   4.0   5.0
Texas   6.0   7.0   8.0
Oregon  9.0  10.0  11.0
====================================== s =======================================
b    0.0
d    1.0
e    2.0
Name: Utah, dtype: float64
==================================== df - s ====================================
          b    d    e
Utah    0.0  0.0  0.0
Ohio    3.0  3.0  3.0
Texas   6.0  6.0  6.0
Oregon  9.0  9.0  9.0
=================================== df + s2 ====================================
          b   d     e   f
Utah    0.0 NaN   3.0 NaN
Ohio    3.0 NaN   6.0 NaN
Texas   6.0 NaN   9.0 NaN
Oregon  9.0 NaN  12.0 NaN
</pre>

<p>
如果想在列上广播，在行上匹配，必须使用<a href="#org436a213">算数方法</a>中的一种：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s3</span> = df[<span style="color: #e6db74;">'d'</span>]
log(<span style="color: #e6db74;">"df.sub(s3, axis='index')"</span>, df.sub(s3, axis=<span style="color: #e6db74;">'index'</span>))
</pre>
</div>

<pre class="example">
=========================== df.sub(s3, axis='index') ===========================
          b    d    e
Utah   -1.0  0.0  1.0
Ohio   -1.0  0.0  1.0
Texas  -1.0  0.0  1.0
Oregon -1.0  0.0  1.0

</pre>
</div>
</div>


<div id="outline-container-org10237d3" class="outline-4">
<h4 id="org10237d3"><span class="section-number-4">1.4.10</span> 应用函数</h4>
<div class="outline-text-4" id="text-1-4-10">
<p>
从本质上讲，DataFrame 内部用的数据结构就是 numpy 的 ndarray 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"np.exp(df)"</span>, np.exp(df))
log(<span style="color: #e6db74;">"np.sin(df)"</span>, np.sin(df))
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
0  0.384419 -0.261265 -0.776319 -1.083965
1 -0.280943  1.203641  0.392169 -2.484636
2  1.101764  0.041095  1.075932  0.543424
3  0.472131  0.070010 -0.199482 -0.140922
4 -0.479721  0.281841  1.163404  0.694684
5 -0.464032 -1.058426 -0.692909  0.244612
6  1.082909  1.101045 -1.151583 -1.061644
7  0.533688 -1.130648 -0.350829  1.444129
8 -0.019973  1.649555  1.037025  0.059973
9 -0.337814 -2.070719  1.277318 -0.913099
================================== np.exp(df) ==================================
        one       two     three      four
0  1.468760  0.770077  0.460097  0.338252
1  0.755072  3.332227  1.480187  0.083356
2  3.009471  1.041951  2.932725  1.721893
3  1.603407  1.072519  0.819155  0.868557
4  0.618956  1.325568  3.200812  2.003075
5  0.628743  0.347002  0.500119  1.277125
6  2.953258  3.007307  0.316136  0.345887
7  1.705209  0.322824  0.704104  4.238160
8  0.980226  5.204665  2.820814  1.061808
9  0.713328  0.126095  3.587005  0.401279
================================== np.sin(df) ==================================
        one       two     three      four
0  0.375020 -0.258303 -0.700658 -0.883820
1 -0.277262  0.933352  0.382193 -0.610710
2  0.892006  0.041083  0.880033  0.517070
3  0.454785  0.069953 -0.198162 -0.140456
4 -0.461532  0.278124  0.918157  0.640142
5 -0.447558 -0.871585 -0.638778  0.242180
6  0.883325  0.891681 -0.913410 -0.873158
7  0.508712 -0.904688 -0.343677  0.991988
8 -0.019971  0.996900  0.860895  0.059937
9 -0.331425 -0.877620  0.957243 -0.791402
</pre>
</div>
</div>


<div id="outline-container-org4d8ebe7" class="outline-4">
<h4 id="org4d8ebe7"><span class="section-number-4">1.4.11</span> 行/列映射 (apply)</h4>
<div class="outline-text-4" id="text-1-4-11">
<p>
<code>df.apply(series_to_series_func) -&gt; DataFrame</code>
</p>

<p>
<code>df.apply(series_to_value_func) -&gt; Series</code>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape(4, 3),
                  index=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABC'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.apply(lambda x: x.max() - x.min())"</span>, df.<span style="color: #a6e22e;">apply</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.<span style="color: #a6e22e;">max</span>() - x.<span style="color: #a6e22e;">min</span>()))
log(<span style="color: #e6db74;">"df.apply(lambda x: x.max() - x.min(), axis=1)"</span>, df.<span style="color: #a6e22e;">apply</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x.<span style="color: #a6e22e;">max</span>() - x.<span style="color: #a6e22e;">min</span>(), axis=1))
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">min_max</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> pd.Series([x.<span style="color: #a6e22e;">min</span>(), x.<span style="color: #a6e22e;">max</span>()], index=[<span style="color: #e6db74;">'min'</span>, <span style="color: #e6db74;">'max'</span>])
log(<span style="color: #e6db74;">"df.apply(min_max, axis=1)"</span>, df.<span style="color: #a6e22e;">apply</span>(min_max, axis=1))
</pre>
</div>

<pre class="example">
====================================== df ======================================
       A   B   C
one    0   1   2
two    3   4   5
three  6   7   8
four   9  10  11
==================== df.apply(lambda x: x.max() - x.min()) =====================
A    9
B    9
C    9
dtype: int64
================ df.apply(lambda x: x.max() - x.min(), axis=1) =================
one      2
two      2
three    2
four     2
dtype: int64
========================== df.apply(min_max, axis=1) ===========================
       min  max
one      0    2
two      3    5
three    6    8
four     9   11
</pre>
</div>
</div>


<div id="outline-container-org60ceea8" class="outline-4">
<h4 id="org60ceea8"><span class="section-number-4">1.4.12</span> 逐元素映射 (applymap)</h4>
<div class="outline-text-4" id="text-1-4-12">
<p>
<code>df.applymap(value_to_value_func) -&gt; DataFrame</code>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(4, 3),
                  index=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABC'</span>))

log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.applymap(lambda x: '{0:.03f}'.format(x))"</span>, df.applymap(<span style="color: #f92672; font-weight: bold;">lambda</span> x: <span style="color: #e6db74;">'{0:.03f}'</span>.<span style="color: #a6e22e;">format</span>(x)))
</pre>
</div>
</div>
</div>


<div id="outline-container-orge01a14d" class="outline-4">
<h4 id="orge01a14d"><span class="section-number-4">1.4.13</span> 排序(sort_index/sort_values)</h4>
<div class="outline-text-4" id="text-1-4-13">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(8).reshape((2, 4)),
                  index=[<span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'one'</span>],
                  columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'dabc'</span>))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.sort_index()"</span>, df.sort_index())
log(<span style="color: #e6db74;">"df.sort_index(axis=1)"</span>, df.sort_index(axis=1))
log(<span style="color: #e6db74;">"df.sort_values(by='a')"</span>, df.sort_values(by=<span style="color: #e6db74;">'a'</span>))
log(<span style="color: #e6db74;">"df.sort_values(by=['a', 'b'])"</span>, df.sort_values(by=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
=============================== df.sort_index() ================================
       d  a  b  c
one    4  5  6  7
three  0  1  2  3
============================ df.sort_index(axis=1) =============================
       a  b  c  d
three  1  2  3  0
one    5  6  7  4
============================ df.sort_values(by='a') ============================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
======================== df.sort_values(by=['a', 'b']) =========================
       d  a  b  c
three  0  1  2  3
one    4  5  6  7
</pre>
</div>
</div>


<div id="outline-container-org15dd8b9" class="outline-4">
<h4 id="org15dd8b9"><span class="section-number-4">1.4.14</span> 排名(rank)</h4>
<div class="outline-text-4" id="text-1-4-14">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'b'</span>: [4.3, 7, -3, 2], <span style="color: #e6db74;">'a'</span>: [0, 1, 0, 1], <span style="color: #e6db74;">'c'</span>: [-2, 5, 8, -2.5]})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.rank(axis='columns')"</span>, df.rank(axis=<span style="color: #e6db74;">'columns'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
     b  a    c
0  4.3  0 -2.0
1  7.0  1  5.0
2 -3.0  0  8.0
3  2.0  1 -2.5
=========================== df.rank(axis='columns') ============================
     b    a    c
0  3.0  2.0  1.0
1  3.0  1.0  2.0
2  1.0  2.0  3.0
3  3.0  2.0  1.0
</pre>


<p>
打破平级关系方法列表
</p>
</div>
</div>


<div id="outline-container-org8a4962a" class="outline-4">
<h4 id="org8a4962a"><span class="section-number-4">1.4.15</span> 转换为 ndarray 对象</h4>
<div class="outline-text-4" id="text-1-4-15">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
<span style="color: #fd971f;">ary</span> = np.asarray(df)
log(<span style="color: #e6db74;">"ary"</span>, ary)
log(<span style="color: #e6db74;">"ary == df.values"</span>, ary == df.values)
log(<span style="color: #e6db74;">"ary == df"</span>, ary == df)
</pre>
</div>

<pre class="example">
===================================== ary ======================================
[[ 2.04624678 -0.6312282   0.67979273 -0.44172316]
 [-0.86094589  1.94346553 -2.14098712 -0.59540524]
 [-0.15020567  0.89921316  1.57976154  1.28561354]
 [ 0.36556931  0.74106876 -1.11107492 -0.0127461 ]
 [ 1.0701633  -1.33064105  0.21082171  2.11969444]
 [-1.40825621  0.77820317  0.28563787 -0.00318099]
 [-0.41136998  0.73250492  1.42237664 -1.03227235]
 [-0.05801189  0.2636244  -1.40155875 -1.28585849]
 [-1.00331627  0.53425829 -0.37204681  0.34346003]
 [-0.39496311 -1.61744328 -0.95510468 -0.5185989 ]]
=============================== ary == df.values ===============================
[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
================================== ary == df ===================================
    one   two  three  four
0  True  True   True  True
1  True  True   True  True
2  True  True   True  True
3  True  True   True  True
4  True  True   True  True
5  True  True   True  True
6  True  True   True  True
7  True  True   True  True
8  True  True   True  True
9  True  True   True  True
</pre>
</div>
</div>



<div id="outline-container-org538917d" class="outline-4">
<h4 id="org538917d"><span class="section-number-4">1.4.16</span> 统计</h4>
<div class="outline-text-4" id="text-1-4-16">
<ul class="org-ul">
<li>count
非 NA 值个数</li>
<li>describe
计算 Series 或 DataFrame 各列的汇总统计集合</li>
<li>min, max</li>
<li>argmin, argmax
最大最小值所在索引位置（整数）</li>
<li>idxmin, idxmax
最大最小值所在索引标签</li>
<li>quantile
计算样本从 0 到 1 间的分位数</li>
<li>sum</li>
<li>mean</li>
<li>median</li>
<li>mad
平均值的平均绝对偏差</li>
<li>mod
频繁统计</li>
<li>prod
所有值的积</li>
<li>var
样本方差</li>
<li>std
标准差</li>
<li>skew
样本偏度（第三时刻）值</li>
<li>kurt
样本峰度（第四时刻）值</li>
<li>cumsum
累计值</li>
<li>cummin, cummax</li>
<li>cumprod</li>
<li>diff
计算第一个算术差值（对时间序列有用）</li>
<li>pct_change
计算百分比</li>
</ul>
</div>
</div>


<div id="outline-container-org23c6570" class="outline-4">
<h4 id="org23c6570"><span class="section-number-4">1.4.17</span> concat</h4>
<div class="outline-text-4" id="text-1-4-17">

<div class="figure">
<p><img src="img/pandas_concat.png" alt="pandas_concat.png">
</p>
</div>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">origin_df</span> = pd.DataFrame(np.random.randn(10, 4), columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCD'</span>))
<span style="color: #fd971f;">concatted</span> = pd.concat([origin_df.iloc[:3],
                       origin_df.iloc[3:7],
                       origin_df.iloc[7:]])
log(<span style="color: #e6db74;">"origin_df"</span>, origin_df)
log(<span style="color: #e6db74;">"concatted"</span>, concatted) <span style="color: #465457;"># </span><span style="color: #465457;">(concatted == origin_df).all().all(): True</span>
</pre>
</div>

<pre class="example">
================================== origin_df ===================================
          A         B         C         D
0  0.755595  1.036145 -0.857988  0.229536
1  0.337109 -1.703817  0.533003  2.126698
2  0.155211 -1.056213  0.828939  2.576655
3  1.091366 -0.716061  1.995065  0.031306
4 -0.541699 -0.593141 -0.620846 -0.837288
5  0.914868  0.855716 -0.560497  0.435672
6 -0.918672 -0.645815 -0.252298 -0.276985
7  0.472277  1.547128 -2.137729 -0.090565
8  0.219269 -0.417487  0.324093  0.262393
9 -1.435991 -1.543388  0.403208 -0.268907
================================== concatted ===================================
          A         B         C         D
0  0.755595  1.036145 -0.857988  0.229536
1  0.337109 -1.703817  0.533003  2.126698
2  0.155211 -1.056213  0.828939  2.576655
3  1.091366 -0.716061  1.995065  0.031306
4 -0.541699 -0.593141 -0.620846 -0.837288
5  0.914868  0.855716 -0.560497  0.435672
6 -0.918672 -0.645815 -0.252298 -0.276985
7  0.472277  1.547128 -2.137729 -0.090565
8  0.219269 -0.417487  0.324093  0.262393
9 -1.435991 -1.543388  0.403208 -0.268907
</pre>
</div>
</div>


<div id="outline-container-orga0e2b4d" class="outline-4">
<h4 id="orga0e2b4d"><span class="section-number-4">1.4.18</span> merge / join</h4>
<div class="outline-text-4" id="text-1-4-18">
<p>
原理：( <code>join</code> 底层仍然是使用 <code>merge</code> )
</p>


<div class="figure">
<p><img src="img/pandas_merge.png" alt="pandas_merge.png">
</p>
</div>


<div class="figure">
<p><img src="img/pandas_merge2.png" alt="pandas_merge2.png">
</p>
</div>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left</span> = pd.DataFrame({<span style="color: #e6db74;">'key'</span>: [<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'foo'</span>], <span style="color: #e6db74;">'lval'</span>: [1, 2]})
<span style="color: #fd971f;">right</span> = pd.DataFrame({<span style="color: #e6db74;">'key'</span>: [<span style="color: #e6db74;">'foo'</span>, <span style="color: #e6db74;">'foo'</span>], <span style="color: #e6db74;">'rval'</span>: [4, 5]})

<span style="color: #465457;"># </span><span style="color: #465457;">SELECT * FROM left INNER JOIN right ON left.key = right.key;</span>
<span style="color: #fd971f;">merged</span> = pd.merge(left, right, on=<span style="color: #e6db74;">'key'</span>)
log(<span style="color: #e6db74;">"left"</span>, left)
log(<span style="color: #e6db74;">"right"</span>, right)
log(<span style="color: #e6db74;">"merged"</span>, merged)
</pre>
</div>

<pre class="example">
===================================== left =====================================
   key  lval
0  foo     1
1  foo     2
==================================== right =====================================
   key  rval
0  foo     4
1  foo     5
==================================== merged ====================================
   key  lval  rval
0  foo     1     4
1  foo     1     5
2  foo     2     4
3  foo     2     5
</pre>
</div>
</div>
</div>
</div>






<div id="outline-container-org2ff6831" class="outline-2">
<h2 id="org2ff6831"><span class="section-number-2">2</span> 索引</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orge2b05fb" class="outline-3">
<h3 id="orge2b05fb"><span class="section-number-3">2.1</span> Series</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgad6fa5b" class="outline-4">
<h4 id="orgad6fa5b"><span class="section-number-4">2.1.1</span> 设置对象自身和索引的 name 属性</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Ohio'</span>: 35000, <span style="color: #e6db74;">'Texas'</span>: 71000, <span style="color: #e6db74;">'Oregon'</span>: 16000, <span style="color: #e6db74;">'Utah'</span>: 5000}
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'California'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Oregon'</span>, <span style="color: #e6db74;">'Texas'</span>]
<span style="color: #fd971f;">s</span> = pd.Series(data, index=states)
<span style="color: #fd971f;">s.name</span> = <span style="color: #e6db74;">'population'</span>
<span style="color: #fd971f;">s.index.name</span> = <span style="color: #e6db74;">'state'</span>
log(<span style="color: #e6db74;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
state
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
Name: population, dtype: float64

</pre>
</div>
</div>


<div id="outline-container-org6d61c27" class="outline-4">
<h4 id="org6d61c27"><span class="section-number-4">2.1.2</span> 获取值和索引</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.values"</span>, s.values)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.007460
b   -0.346364
c   -1.524387
d   -0.389066
e    0.464790
dtype: float64
=================================== s.values ===================================
[ 0.00745967 -0.34636371 -1.52438655 -0.38906608  0.46479046]
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
</pre>
</div>
</div>


<div id="outline-container-orgf7e8580" class="outline-4">
<h4 id="orgf7e8580"><span class="section-number-4">2.1.3</span> 索引对齐</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
相同索引值才进行操作
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s1</span> = pd.Series(np.random.randint(3, size=3), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'e'</span>])
<span style="color: #fd971f;">s2</span> = pd.Series(np.random.randint(3, size=3), index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>])
log(<span style="color: #e6db74;">"s1"</span>, s1)
log(<span style="color: #e6db74;">"s2"</span>, s2)
log(<span style="color: #e6db74;">"s1 + s2"</span>, s1 + s2)
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a    1
c    0
e    1
dtype: int64
====================================== s2 ======================================
a    1
d    1
e    0
dtype: int64
=================================== s1 + s2 ====================================
a    2.0
c    NaN
d    NaN
e    1.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-orgbbe4cb2" class="outline-4">
<h4 id="orgbbe4cb2"><span class="section-number-4">2.1.4</span> 重建索引</h4>
<div class="outline-text-4" id="text-2-1-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4.5, 7.2, -5.3, 3.6], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.reindex(['a', 'b', 'c', 'd', 'e'])"</span>, s.reindex([<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'e'</span>]))
</pre>
</div>

<pre class="example">
====================================== s =======================================
d    4.5
b    7.2
a   -5.3
c    3.6
dtype: float64
===================== s.reindex(['a', 'b', 'c', 'd', 'e']) =====================
a   -5.3
b    7.2
c    3.6
d    4.5
e    NaN
dtype: float64
</pre>

<p>
重建索引时插值: (<a href="#orgcc957c5">reindex 方法的参数</a>)
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([<span style="color: #e6db74;">'blue'</span>, <span style="color: #e6db74;">'purple'</span>, <span style="color: #e6db74;">'yellow'</span>], index=[0, 2, 4])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.reindex(range(6), method='ffill')"</span>, s.reindex(<span style="color: #a6e22e;">range</span>(6), method=<span style="color: #e6db74;">'ffill'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
0      blue
2    purple
4    yellow
dtype: object
===================== s.reindex(range(6), method='ffill') ======================
0      blue
1      blue
2    purple
3    purple
4    yellow
5    yellow
dtype: object
</pre>
</div>
</div>



<div id="outline-container-org911af15" class="outline-4">
<h4 id="org911af15"><span class="section-number-4">2.1.5</span> 删除索引</h4>
<div class="outline-text-4" id="text-2-1-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.arange(5.), index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abcde'</span>))
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.drop('c')"</span>, s.drop(<span style="color: #e6db74;">'c'</span>))
log(<span style="color: #e6db74;">"s.drop(['d', 'c'])"</span>, s.drop([<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'c'</span>]))
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    2.0
d    3.0
e    4.0
dtype: float64
================================= s.drop('c') ==================================
a    0.0
b    1.0
d    3.0
e    4.0
dtype: float64
============================== s.drop(['d', 'c']) ==============================
a    0.0
b    1.0
e    4.0
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-org72848db" class="outline-4">
<h4 id="org72848db"><span class="section-number-4">2.1.6</span> 标签索引</h4>
<div class="outline-text-4" id="text-2-1-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s['a']"</span>, s[<span style="color: #e6db74;">'a'</span>])
<span style="color: #fd971f;">s</span>[<span style="color: #e6db74;">'d'</span>] = 6
log(<span style="color: #e6db74;">"s[['c', 'a', 'd']]"</span>, s[[<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'d'</span>]])
log(<span style="color: #e6db74;">"s['b' : 'c']"</span>, s[<span style="color: #e6db74;">'b'</span> : <span style="color: #e6db74;">'c'</span>])

</pre>
</div>

<pre class="example">
====================================== s =======================================
a    4
b    7
c   -5
d    3
dtype: int64
==================================== s['a'] ====================================
4
============================== s[['c', 'a', 'd']] ==============================
c   -5
a    4
d    6
dtype: int64
================================= s['b' : 'c'] =================================
b    7
c   -5
dtype: int64
</pre>
</div>
</div>




<div id="outline-container-orga629ac6" class="outline-4">
<h4 id="orga629ac6"><span class="section-number-4">2.1.7</span> 布尔索引</h4>
<div class="outline-text-4" id="text-2-1-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([4, 7, -5, 3], index=[<span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s[s &gt; 0]"</span>, s[s &gt; 0])
</pre>
</div>

<pre class="example">
=================================== s[s &gt; 0] ===================================
d    4
b    7
c    3
dtype: int64

</pre>
</div>
</div>
</div>






<div id="outline-container-org0d99753" class="outline-3">
<h3 id="org0d99753"><span class="section-number-3">2.2</span> DataFrame</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orgbaf1db4" class="outline-4">
<h4 id="orgbaf1db4"><span class="section-number-4">2.2.1</span> 设置行/列索引的 name 属性</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'Nevada'</span>: {2001: 2.4, 2002: 2.9},
        <span style="color: #e6db74;">'Ohio'</span>: {2001: 1.5, 2001: 1.7, 2002: 3.6}}
<span style="color: #fd971f;">df</span> = pd.DataFrame(data)
<span style="color: #fd971f;">df.index.name</span> = <span style="color: #e6db74;">'year'</span>
<span style="color: #fd971f;">df.columns.name</span> = <span style="color: #e6db74;">'state'</span>
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
state  Nevada  Ohio
year
2001      2.4   1.7
2002      2.9   3.6

</pre>
</div>
</div>


<div id="outline-container-org6f8009d" class="outline-4">
<h4 id="org6f8009d"><span class="section-number-4">2.2.2</span> 重建索引</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
在 DataFrame 中， <code>reindex</code> 可以改变行索引，列索引，也可以同时改变两者。
</p>

<p>
<code>fill method</code> 只对行重新索引有效，不适用列。
</p>

<p>
<a href="#orgcc957c5">reindex 方法的参数</a>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(9).reshape((3,3)),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'acd'</span>),
                  columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'California'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#37325;&#24314;&#34892;&#32034;&#24341;</span>
log(<span style="color: #e6db74;">"df.reindex(['a', 'b', 'c', 'd'])"</span>, df.reindex([<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
<span style="color: #465457;"># </span><span style="color: #465457;">&#37325;&#24314;&#21015;&#32034;&#24341;</span>
<span style="color: #fd971f;">states</span> = [<span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'California'</span>]
log(<span style="color: #e6db74;">"df.reindex(columns=states)"</span>, df.reindex(columns=states))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   Ohio  Texas  California
a     0      1           2
c     3      4           5
d     6      7           8
======================= df.reindex(['a', 'b', 'c', 'd']) =======================
   Ohio  Texas  California
a   0.0    1.0         2.0
b   NaN    NaN         NaN
c   3.0    4.0         5.0
d   6.0    7.0         8.0
========================== df.reindex(columns=states) ==========================
   Texas  Utah  California
a      1   NaN           2
c      4   NaN           5
d      7   NaN           8
</pre>
</div>
</div>


<div id="outline-container-orge86207c" class="outline-4">
<h4 id="orge86207c"><span class="section-number-4">2.2.3</span> 索引对齐</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
DataFrame 在进行数据计算时， <b>会自动按行和列进行数据对齐</b> 。
最终的计算结果会合并两个 DataFrame 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame(np.arange(9.).reshape((3, 3)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcd'</span>),
                   index=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Colorado'</span>])

<span style="color: #fd971f;">df2</span> = pd.DataFrame(np.arange(12.).reshape((4, 3)),
                   columns=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bde'</span>),
                   index=[<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Texas'</span>, <span style="color: #e6db74;">'Oregon'</span>])

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df1 + df2"</span>, df1 + df2)
</pre>
</div>
</div>
</div>


<div id="outline-container-org48c5266" class="outline-4">
<h4 id="org48c5266"><span class="section-number-4">2.2.4</span> 列赋值</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
当将列表或数组赋值给一个列时，长度必须和 DataFrame 的长度相匹配。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns, index=index)
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'debt'</span>] = 16.5 <span style="color: #465457;"># </span><span style="color: #465457;">&#26631;&#37327;&#36171;&#20540;</span>
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'income'</span>] = np.arange(6.) <span style="color: #465457;"># </span><span style="color: #465457;">&#25968;&#32452;&#36171;&#20540;</span>
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       year   state  pop  debt  income
one    2000    Ohio  1.5  16.5     0.0
two    2001    Ohio  1.7  16.5     1.0
three  2002    Ohio  3.6  16.5     2.0
four   2001  Nevada  2.4  16.5     3.0
five   2002  Nevada  2.9  16.5     4.0
six    2003  Nevada  3.2  16.5     5.0

</pre>


<p>
将 Series 赋值给一列时，Series 的索引会按照 DataFrame 的索引重新排列。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">val</span> = pd.Series([-1.2, -1.5, -1.7], index=[<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>])
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'debt'</span>] = val
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       year   state  pop  debt  income
one    2000    Ohio  1.5   NaN     0.0
two    2001    Ohio  1.7  -1.2     1.0
three  2002    Ohio  3.6   NaN     2.0
four   2001  Nevada  2.4  -1.5     3.0
five   2002  Nevada  2.9  -1.7     4.0
six    2003  Nevada  3.2   NaN     5.0

</pre>
</div>
</div>



<div id="outline-container-org33ed27e" class="outline-4">
<h4 id="org33ed27e"><span class="section-number-4">2.2.5</span> 删除行/列</h4>
<div class="outline-text-4" id="text-2-2-5">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns, index=index)
<span style="color: #f92672; font-weight: bold;">del</span> df[<span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">yearSeries</span> = df.pop(<span style="color: #e6db74;">'year'</span>)
df.drop(<span style="color: #e6db74;">'state'</span>, axis=<span style="color: #e6db74;">'columns'</span>, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
Empty DataFrame
Columns: []
Index: [one, two, three, four, five, six]

</pre>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.drop('Colorado')"</span>, df.drop(<span style="color: #e6db74;">'Colorado'</span>)) <span style="color: #465457;"># </span><span style="color: #465457;">&#21024;&#38500;&#34892;</span>
log(<span style="color: #e6db74;">"df.drop('two', axis='columns')"</span>, df.drop(<span style="color: #e6db74;">'two'</span>, axis=<span style="color: #e6db74;">'columns'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df.drop('Colorado') ==============================
          one  two  three  four
Ohio        0    1      2     3
Utah        8    9     10    11
New York   12   13     14    15
======================== df.drop('two', axis='columns') ========================
          one  three  four
Ohio        0      2     3
Colorado    4      6     7
Utah        8     10    11
New York   12     14    15
</pre>
</div>
</div>



<div id="outline-container-orgf5dd3ef" class="outline-4">
<h4 id="orgf5dd3ef"><span class="section-number-4">2.2.6</span> 标签索引</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
从 DataFrame 中玄虚的列是数据的 <span class="underline">视图</span> ，而不是拷贝。
如果需要复制，应当显式地使用 Series 的 <code>copy</code> 方法。
</p>

<p>
返回的 Series 与原 DataFrame 有相同的索引，且 Series 的 <code>name</code> 属性也会被合理地设置。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = {<span style="color: #e6db74;">'state'</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">'year'</span>: [2000, 2001, 2002, 2001, 2002, 2003],
        <span style="color: #e6db74;">'pop'</span>: [1.5, 1.7, 3.6, 2.4, 2.9, 3.2]}
<span style="color: #fd971f;">columns</span> = [<span style="color: #e6db74;">'year'</span>, <span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]
<span style="color: #fd971f;">df</span> = pd.DataFrame(data, columns=columns)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df['state']"</span>, df[<span style="color: #e6db74;">'state'</span>])
log(<span style="color: #e6db74;">"df.year"</span>, df.year)
log(<span style="color: #e6db74;">"df[['state', 'pop']]"</span>, df[[<span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'pop'</span>]])
</pre>
</div>

<pre class="example">
====================================== df ======================================
   year   state  pop
0  2000    Ohio  1.5
1  2001    Ohio  1.7
2  2002    Ohio  3.6
3  2001  Nevada  2.4
4  2002  Nevada  2.9
5  2003  Nevada  3.2
================================= df['state'] ==================================
0      Ohio
1      Ohio
2      Ohio
3    Nevada
4    Nevada
5    Nevada
Name: state, dtype: object
=================================== df.year ====================================
0    2000
1    2001
2    2002
3    2001
4    2002
5    2003
Name: year, dtype: int64
============================= df[['state', 'pop']] =============================
    state  pop
0    Ohio  1.5
1    Ohio  1.7
2    Ohio  3.6
3  Nevada  2.4
4  Nevada  2.9
5  Nevada  3.2
</pre>
</div>
</div>


<div id="outline-container-orgcc56dc8" class="outline-4">
<h4 id="orgcc56dc8"><span class="section-number-4">2.2.7</span> 正则索引</h4>
<div class="outline-text-4" id="text-2-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.filter(regex=r'^t.*$')"</span>, df.<span style="color: #a6e22e;">filter</span>(regex=r<span style="color: #e6db74;">'^t.*$'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.266558  0.390929  0.381822 -0.662022
B  0.947612  1.492351  1.824414 -0.682042
C  0.920167 -0.387809 -1.606654 -0.692762
D -0.491672  0.135303  1.653127  0.036277
E -0.922068  0.128126 -1.823203  0.054199
F -0.023060 -0.725380  0.062327 -0.608580
========================== df.filter(regex=r'^t.*$') ===========================
        two     three
A  0.390929  0.381822
B  1.492351  1.824414
C -0.387809 -1.606654
D  0.135303  1.653127
E  0.128126 -1.823203
F -0.725380  0.062327
</pre>
</div>
</div>


<div id="outline-container-org3f8aa00" class="outline-4">
<h4 id="org3f8aa00"><span class="section-number-4">2.2.8</span> 整数索引</h4>
<div class="outline-text-4" id="text-2-2-8">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df[:2]"</span>, df[:2])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
==================================== df[:2] ====================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
</pre>
</div>
</div>


<div id="outline-container-org21a3c4c" class="outline-4">
<h4 id="org21a3c4c"><span class="section-number-4">2.2.9</span> 布尔索引</h4>
<div class="outline-text-4" id="text-2-2-9">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df[df['three'] &gt; 5]"</span>, df[df[<span style="color: #e6db74;">'three'</span>] &gt; 5])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df[df['three'] &gt; 5] ==============================
          one  two  three  four
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
</pre>
</div>
</div>


<div id="outline-container-org2b865c1" class="outline-4">
<h4 id="org2b865c1"><span class="section-number-4">2.2.10</span> loc 索引</h4>
<div class="outline-text-4" id="text-2-2-10">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.loc['Colorado', ['two', 'three']]"</span>, df.loc[<span style="color: #e6db74;">'Colorado'</span>, [<span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>]])
log(<span style="color: #e6db74;">"df.loc[:'Utah', 'two']"</span>, df.loc[:<span style="color: #e6db74;">'Utah'</span>, <span style="color: #e6db74;">'two'</span>])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
===================== df.loc['Colorado', ['two', 'three']] =====================
two      5
three    6
Name: Colorado, dtype: int64
============================ df.loc[:'Utah', 'two'] ============================
Ohio        1
Colorado    5
Utah        9
Name: two, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org72a2581" class="outline-4">
<h4 id="org72a2581"><span class="section-number-4">2.2.11</span> iloc 索引</h4>
<div class="outline-text-4" id="text-2-2-11">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.iloc[2, [3, 0, 1]]"</span>, df.iloc[2, [3, 0, 1]])
log(<span style="color: #e6db74;">"df.iloc[[1, 2], [3, 0, 1]]"</span>, df.iloc[[1, 2], [3, 0, 1]])
log(<span style="color: #e6db74;">"df.iloc[:, :3][df.three &gt; 5]"</span>, df.iloc[:, :3][df.three &gt; 5])
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================ df.iloc[2, [3, 0, 1]] =============================
four    11
one      8
two      9
Name: Utah, dtype: int64
========================== df.iloc[[1, 2], [3, 0, 1]] ==========================
          four  one  two
Colorado     7    4    5
Utah        11    8    9
========================= df.iloc[:, :3][df.three &gt; 5] =========================
          one  two  three
Colorado    4    5      6
Utah        8    9     10
New York   12   13     14
</pre>
</div>
</div>


<div id="outline-container-org28b90e2" class="outline-4">
<h4 id="org28b90e2"><span class="section-number-4">2.2.12</span> at 索引</h4>
<div class="outline-text-4" id="text-2-2-12">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.at['A', 'one']"</span>, df.at[<span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'one'</span>])
</pre>
</div>
</div>
</div>


<div id="outline-container-org8a67fb5" class="outline-4">
<h4 id="org8a67fb5"><span class="section-number-4">2.2.13</span> 随机索引</h4>
<div class="outline-text-4" id="text-2-2-13">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(16).reshape((4, 4)),
                  index=[<span style="color: #e6db74;">"Ohio"</span>, <span style="color: #e6db74;">"Colorado"</span>, <span style="color: #e6db74;">"Utah"</span>, <span style="color: #e6db74;">"New York"</span>],
                  columns=[<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>, <span style="color: #e6db74;">"four"</span>])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.sample(frac=0.5)"</span>, df.sample(frac=0.5))  <span style="color: #465457;"># </span><span style="color: #465457;">Randomly</span>
log(<span style="color: #e6db74;">"df.sample(n=3)"</span>, df.sample(n=3))  <span style="color: #465457;"># </span><span style="color: #465457;">Randomly</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
          one  two  three  four
Ohio        0    1      2     3
Colorado    4    5      6     7
Utah        8    9     10    11
New York   12   13     14    15
============================= df.sample(frac=0.5) ==============================
          one  two  three  four
Ohio        0    1      2     3
New York   12   13     14    15
================================ df.sample(n=3) ================================
          one  two  three  four
Colorado    4    5      6     7
Ohio        0    1      2     3
Utah        8    9     10    11
</pre>
</div>
</div>


<div id="outline-container-orgd339796" class="outline-4">
<h4 id="orgd339796"><span class="section-number-4">2.2.14</span> 重命名行/列</h4>
<div class="outline-text-4" id="text-2-2-14">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ABCDEF'</span>),
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])
log(<span style="color: #e6db74;">"origin df"</span>, df)
df.rename(columns={<span style="color: #e6db74;">'three'</span>: <span style="color: #e6db74;">'san'</span>}, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df (column index renamed)"</span>, df)
df.rename(index={<span style="color: #e6db74;">'C'</span>: <span style="color: #e6db74;">'ccc'</span>}, inplace=<span style="color: #ae81ff;">True</span>)
log(<span style="color: #e6db74;">"df (index renamed)"</span>, df)
</pre>
</div>

<pre class="example">
================================== origin df ===================================
        one       two     three      four
A -1.293186 -1.303202 -0.434815  1.157079
B  0.559491  1.651170  1.130642  0.372430
C  0.087382  0.948737  0.103419 -0.364204
D  0.363415  0.463077 -1.130338 -1.252423
E -0.570689 -1.141226  0.144087 -0.297187
F  1.028409  1.627355 -1.264463 -0.109870
========================== df (column index renamed) ===========================
        one       two       san      four
A -1.293186 -1.303202 -0.434815  1.157079
B  0.559491  1.651170  1.130642  0.372430
C  0.087382  0.948737  0.103419 -0.364204
D  0.363415  0.463077 -1.130338 -1.252423
E -0.570689 -1.141226  0.144087 -0.297187
F  1.028409  1.627355 -1.264463 -0.109870
============================== df (index renamed) ==============================
          one       two       san      four
A   -1.293186 -1.303202 -0.434815  1.157079
B    0.559491  1.651170  1.130642  0.372430
ccc  0.087382  0.948737  0.103419 -0.364204
D    0.363415  0.463077 -1.130338 -1.252423
E   -0.570689 -1.141226  0.144087 -0.297187
F    1.028409  1.627355 -1.264463 -0.109870
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org6cfa420" class="outline-2">
<h2 id="org6cfa420"><span class="section-number-2">3</span> 数据清洗</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgea16ac5" class="outline-3">
<h3 id="orgea16ac5"><span class="section-number-3">3.1</span> 处理缺失值</h3>
<div class="outline-text-3" id="text-3-1">
<p>
pandas 对象的所有统计信息默认情况下是 <span class="underline">排除</span> 缺失值的。
</p>

<p>
Python 内建的 None 值也被当做 NA 处理。
</p>


<div class="figure">
<p><img src="img/pandas_nan.png" alt="pandas_nan.png">
</p>
</div>
</div>

<div id="outline-container-org968a5c9" class="outline-4">
<h4 id="org968a5c9"><span class="section-number-4">3.1.1</span> 过滤缺失值(dropna)</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([1, np.nan, 3.5, np.nan, 7])
log(<span style="color: #e6db74;">"s.dropna()"</span>, s.dropna()) <span style="color: #465457;"># </span><span style="color: #465457;">&#31561;&#20215;&#20110; s[s.notnull()]</span>
</pre>
</div>

<pre class="example">
================================== s.dropna() ==================================
0    1.0
2    3.5
4    7.0
dtype: float64

</pre>


<p>
当处理 DataFrame 对象时， <code>dropna</code> <b>默认情况下删除包含缺失值的行</b> ：
（使用 <code>axis = 1</code> 删除列）
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame([
    [1, 6.5, 3],
    [1, np.nan, np.nan],
    [np.nan, np.nan, np.nan],
    [np.nan, 6.5, 3]
])
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.dropna()"</span>, df.dropna())
</pre>
</div>

<pre class="example">
====================================== df ======================================
     0    1    2
0  1.0  6.5  3.0
1  1.0  NaN  NaN
2  NaN  NaN  NaN
3  NaN  6.5  3.0
================================= df.dropna() ==================================
     0    1    2
0  1.0  6.5  3.0

</pre>


<p>
当传入 <code>how = 'all'</code> 时， <b>删除所有值均为 NA 的那些行</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.dropna(how='all')"</span>, df.dropna(how=<span style="color: #e6db74;">'all'</span>))
</pre>
</div>

<p>
使用 <code>thresh</code> 参数来保留 <b>包含一定数量观察值</b> 的行：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(7, 3))
<span style="color: #fd971f;">df.iloc</span>[:4, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[:2, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.dropna()"</span>, df.dropna())
log(<span style="color: #e6db74;">"df.dropna(thresh=2)"</span>, df.dropna(thresh=2))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0 -0.215937       NaN       NaN
1 -1.358234       NaN       NaN
2  0.331335       NaN -0.901148
3 -0.466495       NaN  2.392151
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
================================= df.dropna() ==================================
          0         1         2
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
============================= df.dropna(thresh=2) ==============================
          0         1         2
2  0.331335       NaN -0.901148
3 -0.466495       NaN  2.392151
4 -0.178190  0.446226  0.710607
5 -0.446093 -0.317979 -0.601814
6  0.550952  1.036072 -1.812287
</pre>
</div>
</div>

<div id="outline-container-org0571ff5" class="outline-4">
<h4 id="org0571ff5"><span class="section-number-4">3.1.2</span> 补全缺失值(fillna)</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(7, 3))
<span style="color: #fd971f;">df.iloc</span>[:4, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[:2, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.fillna(0)"</span>, df.fillna(0))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0  0.997841       NaN       NaN
1 -0.554321       NaN       NaN
2 -0.804640       NaN  0.838684
3  0.666262       NaN -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991
================================= df.fillna(0) =================================
          0         1         2
0  0.997841  0.000000  0.000000
1 -0.554321  0.000000  0.000000
2 -0.804640  0.000000  0.838684
3  0.666262  0.000000 -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991
</pre>

<p>
调用 <code>fillna</code> 时使用字典，可以 <b>为不同列设定不同的填充值</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.fillna({1: 0.5, 2: 0})"</span>, df.fillna({1: 0.5, 2: 0}))
</pre>
</div>

<pre class="example">
========================== df.fillna({1: 0.5, 2: 0}) ===========================
          0         1         2
0  0.997841  0.500000  0.000000
1 -0.554321  0.500000  0.000000
2 -0.804640  0.500000  0.838684
3  0.666262  0.500000 -1.009344
4  0.049296 -0.091335 -0.724490
5  0.172516 -0.255515  0.760672
6  3.210886  1.221200  0.913991

</pre>

<p>
使用 <b>插值方法</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(6, 3))
<span style="color: #fd971f;">df.iloc</span>[2:, 1] = np.nan
<span style="color: #fd971f;">df.iloc</span>[4:, 2] = np.nan
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.fillna(method='ffill')"</span>, df.fillna(method=<span style="color: #e6db74;">'ffill'</span>))
log(<span style="color: #e6db74;">"df.fillna(method='ffill', limit=2)"</span>, df.fillna(method=<span style="color: #e6db74;">'ffill'</span>, limit=2))
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125       NaN -1.686062
3 -0.411193       NaN -0.738710
4 -0.038864       NaN       NaN
5 -0.561398       NaN       NaN
========================== df.fillna(method='ffill') ===========================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125  0.912126 -1.686062
3 -0.411193  0.912126 -0.738710
4 -0.038864  0.912126 -0.738710
5 -0.561398  0.912126 -0.738710
====================== df.fillna(method='ffill', limit=2) ======================
          0         1         2
0  0.663103  0.176675 -1.293323
1 -0.108963  0.912126  0.806356
2  0.215125  0.912126 -1.686062
3 -0.411193  0.912126 -0.738710
4 -0.038864       NaN -0.738710
5 -0.561398       NaN -0.738710
</pre>


<p>
<a href="#orga16d1eb">fillna 函数参数</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org5ff2848" class="outline-3">
<h3 id="org5ff2848"><span class="section-number-3">3.2</span> 数据转换</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-orgc1103a2" class="outline-4">
<h4 id="orgc1103a2"><span class="section-number-4">3.2.1</span> 删除重复值</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"k1"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>] * 3 + [<span style="color: #e6db74;">'two'</span>],
        <span style="color: #e6db74;">"k2"</span>: [1, 1, 2, 3, 3, 4, 4]
    }
)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.duplicated()"</span>, df.duplicated())
</pre>
</div>

<pre class="example">
====================================== df ======================================
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4
6  two   4
=============================== df.duplicated() ================================
0    False
1    False
2    False
3    False
4    False
5    False
6     True
dtype: bool
</pre>

<p>
<code>drop_duplicates</code> 返回的是 DataFrame ，内容是 <code>duplicated</code> 返回 Series 中为 False 的部分：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.drop_duplicates()"</span>, df.drop_duplicates())
</pre>
</div>

<pre class="example">
============================= df.drop_duplicates() =============================
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4

</pre>

<p>
<b>基于某列</b> 去除重复值：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'v1'</span>] = <span style="color: #a6e22e;">range</span>(7)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.drop_duplicates(['k1'])"</span>, df.drop_duplicates([<span style="color: #e6db74;">'k1'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
    k1  k2  v1
0  one   1   0
1  two   1   1
2  one   2   2
3  two   3   3
4  one   3   4
5  two   4   5
6  two   4   6
========================== df.drop_duplicates(['k1']) ==========================
    k1  k2  v1
0  one   1   0
1  two   1   1
</pre>

<p>
<code>drop_duplicates</code> 默认保留第一个观测值，传入参数 <code>keep = 'last'</code> 将返回最后一个：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.drop_duplicates(['k1', 'k2'], keep='last')"</span>, df.drop_duplicates([<span style="color: #e6db74;">'k1'</span>, <span style="color: #e6db74;">'k2'</span>], keep=<span style="color: #e6db74;">'last'</span>))
</pre>
</div>

<pre class="example">
================ df.drop_duplicates(['k1', 'k2'], keep='last') =================
    k1  k2  v1
0  one   1   0
1  two   1   1
2  one   2   2
3  two   3   3
4  one   3   4
6  two   4   6

</pre>
</div>
</div>

<div id="outline-container-org510e255" class="outline-4">
<h4 id="org510e255"><span class="section-number-4">3.2.2</span> 使用函数或映射进行数据转换</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-ipython">  <span style="color: #fd971f;">df</span> = pd.DataFrame(
      {
          <span style="color: #e6db74;">"food"</span>: [<span style="color: #e6db74;">'bacon'</span>,
                   <span style="color: #e6db74;">'pulled pork'</span>,
                   <span style="color: #e6db74;">'bacon'</span>,
                   <span style="color: #e6db74;">'Pastrami'</span>,
                   <span style="color: #e6db74;">'corned beef'</span>,
                   <span style="color: #e6db74;">'Bacon'</span>,
                   <span style="color: #e6db74;">'pastrami'</span>,
                   <span style="color: #e6db74;">'honey ham'</span>,
                   <span style="color: #e6db74;">'nova lox'</span>],
          <span style="color: #e6db74;">"ounces"</span>: [4, 3, 12, 6, 7.5, 8, 3, 5, 6]
      }
  )

  <span style="color: #fd971f;">meat_to_animal</span> = {
      <span style="color: #e6db74;">"bacon"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"pulled pork"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"pastrami"</span>: <span style="color: #e6db74;">'cow'</span>,
      <span style="color: #e6db74;">"corned beef"</span>: <span style="color: #e6db74;">'cow'</span>,
      <span style="color: #e6db74;">"honey ham"</span>: <span style="color: #e6db74;">'pig'</span>,
      <span style="color: #e6db74;">"nova lox"</span>: <span style="color: #e6db74;">'salmon'</span>
  }

log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#23558;&#20540;&#36716;&#25442;&#20026;&#23567;&#20889;</span>
<span style="color: #fd971f;">lowercased</span> = df[<span style="color: #e6db74;">'food'</span>].<span style="color: #a6e22e;">str</span>.lower()
log(<span style="color: #e6db74;">"lowercased"</span>, lowercased)
<span style="color: #fd971f;">df</span>[<span style="color: #e6db74;">'animal'</span>] = lowercased.<span style="color: #a6e22e;">map</span>(meat_to_animal)
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #465457;"># </span><span style="color: #465457;">&#20063;&#21487;&#20197; data['food'].map(lambda x: meat_to_animal[x.lower()])</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
          food  ounces
0        bacon     4.0
1  pulled pork     3.0
2        bacon    12.0
3     Pastrami     6.0
4  corned beef     7.5
5        Bacon     8.0
6     pastrami     3.0
7    honey ham     5.0
8     nova lox     6.0
================================== lowercased ==================================
0          bacon
1    pulled pork
2          bacon
3       pastrami
4    corned beef
5          bacon
6       pastrami
7      honey ham
8       nova lox
Name: food, dtype: object
====================================== df ======================================
          food  ounces  animal
0        bacon     4.0     pig
1  pulled pork     3.0     pig
2        bacon    12.0     pig
3     Pastrami     6.0     cow
4  corned beef     7.5     cow
5        Bacon     8.0     pig
6     pastrami     3.0     cow
7    honey ham     5.0     pig
8     nova lox     6.0  salmon
</pre>
</div>
</div>

<div id="outline-container-org97de4cd" class="outline-4">
<h4 id="org97de4cd"><span class="section-number-4">3.2.3</span> 替代值(replace)</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
使用 <code>fillna()</code> 是通用值替换的特殊案例。
</p>

<p>
使用 <code>map()</code> 可以用来修改一个数据中的值，但是 <code>replace()</code> 提供了 <b>更为简单</b> 的实现。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series([1, -999, 2, -999, -1000, 3])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.replace(-999, np.nan)"</span>, s.replace(-999, np.nan))
</pre>
</div>

<pre class="example">
====================================== s =======================================
0       1
1    -999
2       2
3    -999
4   -1000
5       3
dtype: int64
=========================== s.replace(-999, np.nan) ============================
0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
</pre>

<p>
如果想要 <b>一次替代多个值</b> ，可以传入一个列表：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s.replace([-999, -1000], np.nan)"</span>, s.replace([-999, -1000], np.nan))
</pre>
</div>

<pre class="example">
======================= s.replace([-999, -1000], np.nan) =======================
0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64

</pre>

<p>
<b>将不同的值替换为不同的值</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s.replace([-999, -1000], [np.nan, 0])"</span>, s.replace([-999, -1000], [np.nan, 0]))
log(<span style="color: #e6db74;">"s.replace({-999: np.nan, -1000: 0})"</span>, s.replace({-999: np.nan, -1000: 0}))
</pre>
</div>

<pre class="example">
==================== s.replace([-999, -1000], [np.nan, 0]) =====================
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
===================== s.replace({-999: np.nan, -1000: 0}) ======================
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-orgc5ee588" class="outline-4">
<h4 id="orgc5ee588"><span class="section-number-4">3.2.4</span> 重命名索引</h4>
<div class="outline-text-4" id="text-3-2-4">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape((3,4)),
                  index=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Colorado'</span>, <span style="color: #e6db74;">'New York'</span>],
                  columns=[<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>])

<span style="color: #fd971f;">df.index</span> = df.index.<span style="color: #a6e22e;">map</span>(<span style="color: #f92672; font-weight: bold;">lambda</span> x: x[:4].upper())
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.rename(index=str.title, columns=str.upper)"</span>, df.rename(index=<span style="color: #a6e22e;">str</span>.title, columns=<span style="color: #a6e22e;">str</span>.upper))
log(<span style="color: #e6db74;">"df.rename(index={'OHIO': 'INDIANA'}, columns={'three': 'peekaboo'})"</span>, df.rename(index={<span style="color: #e6db74;">'OHIO'</span>: <span style="color: #e6db74;">'INDIANA'</span>}, columns={<span style="color: #e6db74;">'three'</span>: <span style="color: #e6db74;">'peekaboo'</span>}))
</pre>
</div>

<pre class="example">
====================================== df ======================================
      one  two  three  four
OHIO    0    1      2     3
COLO    4    5      6     7
NEW     8    9     10    11
================ df.rename(index=str.title, columns=str.upper) =================
      ONE  TWO  THREE  FOUR
Ohio    0    1      2     3
Colo    4    5      6     7
New     8    9     10    11
===== df.rename(index={'OHIO': 'INDIANA'}, columns={'three': 'peekaboo'}) ======
         one  two  peekaboo  four
INDIANA    0    1         2     3
COLO       4    5         6     7
NEW        8    9        10    11
</pre>
</div>
</div>


<div id="outline-container-org63a8e1e" class="outline-4">
<h4 id="org63a8e1e"><span class="section-number-4">3.2.5</span> 离散化和分箱(cut/qcut)</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
连续值经常需要离散化，或者分离成 <span class="underline">箱子</span> 进行分析。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">ages</span> = [20, 22, 25, 27, 21, 23, 37, 31, 61, 45, 41, 32]
<span style="color: #fd971f;">bins</span> = [18, 25, 35, 60, 100]
<span style="color: #fd971f;">cats</span> = pd.cut(ages, bins)
log(<span style="color: #e6db74;">"cats"</span>, cats)
log(<span style="color: #e6db74;">"cats.codes"</span>, cats.codes)
log(<span style="color: #e6db74;">"cats.categories"</span>, cats.categories)
log(<span style="color: #e6db74;">"cats.value_counts()"</span>, cats.value_counts())
</pre>
</div>

<pre class="example">
===================================== cats =====================================
[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
Length: 12
Categories (4, interval[int64]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
================================== cats.codes ==================================
[0 0 0 1 0 0 2 1 3 2 2 1]
=============================== cats.categories ================================
IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]]
              closed='right',
              dtype='interval[int64]')
============================= cats.value_counts() ==============================
(18, 25]     5
(25, 35]     3
(35, 60]     3
(60, 100]    1
dtype: int64
</pre>

<p>
通过传递 <code>right = False</code> 来改变区间哪一边是封闭的。
</p>

<p>
<b>自定义箱名</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">group_names</span> = [<span style="color: #e6db74;">'Youth'</span>, <span style="color: #e6db74;">'YoungAdult'</span>, <span style="color: #e6db74;">'MiddleAged'</span>, <span style="color: #e6db74;">'Senior'</span>]
log(<span style="color: #e6db74;">"pd.cut(ages, bins, labels=group_names)"</span>, pd.cut(ages, bins, labels=group_names))
</pre>
</div>

<pre class="example">
==================== pd.cut(ages, bins, labels=group_names) ====================
[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]
Length: 12
Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]

</pre>

<p>
若 <b>使用分箱的个数代替箱边</b> ， pandas 将根据数据中的最小值和最大值计算出等长的箱：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = np.random.rand(20)
<span style="color: #465457;"># </span><span style="color: #465457;">precision &#34920;&#31034;&#23558;&#21313;&#36827;&#21046;&#31934;&#24230;&#38480;&#21046;&#22312;&#20004;&#20301;</span>
log(<span style="color: #e6db74;">"pd.cut(data, 4, precision=2)"</span>, pd.cut(data, 4, precision=2))
</pre>
</div>

<pre class="example">
========================= pd.cut(data, 4, precision=2) =========================
[(0.5, 0.73], (0.5, 0.73], (0.73, 0.97], (0.26, 0.5], (0.024, 0.26], ..., (0.024, 0.26], (0.26, 0.5], (0.73, 0.97], (0.5, 0.73], (0.73, 0.97]]
Length: 20
Categories (4, interval[float64]): [(0.024, 0.26] &lt; (0.26, 0.5] &lt; (0.5, 0.73] &lt; (0.73, 0.97]]

</pre>

<p>
使用 <code>cut</code> 通常不会使每个箱具有相同的数据量。
<code>qcut</code> 基于样本分位数进行分箱，可以获得 <b>等长的箱</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">data</span> = np.random.randn(1000)
<span style="color: #fd971f;">qcats</span> = pd.qcut(data, 4)
log(<span style="color: #e6db74;">"qcats.value_counts()"</span>, qcats.value_counts())
</pre>
</div>

<pre class="example">
============================= qcats.value_counts() =============================
(-3.532, -0.671]    250
(-0.671, 0.0582]    250
(0.0582, 0.744]     250
(0.744, 3.077]      250
dtype: int64

</pre>


<p>
<b>自定义分位数</b> ：(0 和 1 之间的数字)
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">qcuts</span> = pd.qcut(data, [0, 0.1, 0.5, 0.9, 1])
log(<span style="color: #e6db74;">"qcuts.value_counts()"</span>, qcuts.value_counts())
</pre>
</div>

<pre class="example">
============================= qcuts.value_counts() =============================
(-3.532, -1.302]    100
(-1.302, 0.0582]    400
(0.0582, 1.374]     400
(1.374, 3.077]      100
dtype: int64

</pre>
</div>
</div>


<div id="outline-container-orgf5fff9d" class="outline-4">
<h4 id="orgf5fff9d"><span class="section-number-4">3.2.6</span> 检测异常值(any)</h4>
<div class="outline-text-4" id="text-3-2-6">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.random.randn(5, 4))
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"np.abs(df) &gt; 1"</span>, np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1)
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any()"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>())
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any(axis=1)"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>(axis=1))
log(<span style="color: #e6db74;">"(np.abs(df) &gt; 1).any().any()"</span>, (np.<span style="color: #a6e22e;">abs</span>(df) &gt; 1).<span style="color: #a6e22e;">any</span>().<span style="color: #a6e22e;">any</span>())
</pre>
</div>

<pre class="example">
====================================== df ======================================
          0         1         2         3
0  0.634347 -0.504562  0.337217  0.191453
1 -0.378714 -1.212778 -0.194362 -2.113623
2 -1.422029  0.532520 -0.348306  0.059880
3 -1.184722 -0.297884 -0.620028  0.378589
4  0.846286 -0.714991 -0.127334 -0.089754
================================ np.abs(df) &gt; 1 ================================
       0      1      2      3
0  False  False  False  False
1  False   True  False   True
2   True  False  False  False
3   True  False  False  False
4  False  False  False  False
============================ (np.abs(df) &gt; 1).any() ============================
0     True
1     True
2    False
3     True
dtype: bool
========================= (np.abs(df) &gt; 1).any(axis=1) =========================
0    False
1     True
2     True
3     True
4    False
dtype: bool
========================= (np.abs(df) &gt; 1).any().any() =========================
True
</pre>
</div>
</div>


<div id="outline-container-orgb29f2b1" class="outline-4">
<h4 id="orgb29f2b1"><span class="section-number-4">3.2.7</span> 随机重排序</h4>
<div class="outline-text-4" id="text-3-2-7">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(5*4).reshape((5, 4)))
<span style="color: #fd971f;">sampler</span> = np.random.permutation(5)
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"sampler"</span>, sampler)
log(<span style="color: #e6db74;">"df.take(sampler)"</span>, df.take(sampler)) <span style="color: #465457;"># </span><span style="color: #465457;">&#21644; iloc &#31867;&#20284;</span>

log(<span style="color: #e6db74;">"df.sample(3)"</span>, df.sample(3))
log(<span style="color: #e6db74;">"df.sample(3, replace=True)"</span>, df.sample(3, replace=<span style="color: #ae81ff;">True</span>)) <span style="color: #465457;"># </span><span style="color: #465457;">&#20801;&#35768;&#26377;&#37325;&#22797;</span>
</pre>
</div>

<pre class="example">
====================================== df ======================================
    0   1   2   3
0   0   1   2   3
1   4   5   6   7
2   8   9  10  11
3  12  13  14  15
4  16  17  18  19
=================================== sampler ====================================
[2 3 0 1 4]
=============================== df.take(sampler) ===============================
    0   1   2   3
2   8   9  10  11
3  12  13  14  15
0   0   1   2   3
1   4   5   6   7
4  16  17  18  19
================================= df.sample(3) =================================
   0  1   2   3
2  8  9  10  11
0  0  1   2   3
1  4  5   6   7
========================== df.sample(3, replace=True) ==========================
    0   1   2   3
3  12  13  14  15
3  12  13  14  15
0   0   1   2   3
</pre>
</div>
</div>



<div id="outline-container-orgf8d1347" class="outline-4">
<h4 id="orgf8d1347"><span class="section-number-4">3.2.8</span> 指标矩阵(get_dummies)</h4>
<div class="outline-text-4" id="text-3-2-8">
<p>
如果一列有 k 个不同的值，可以衍生一个k 列的，值为 0 或 1 的矩阵。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({<span style="color: #e6db74;">'key'</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacab'</span>), <span style="color: #e6db74;">'data'</span>: <span style="color: #a6e22e;">range</span>(6)})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"pd.get_dummies(df['key'])"</span>, pd.get_dummies(df[<span style="color: #e6db74;">'key'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
  key  data
0   b     0
1   b     1
2   a     2
3   c     3
4   a     4
5   b     5
========================== pd.get_dummies(df['key']) ===========================
   a  b  c
0  0  1  0
1  0  1  0
2  1  0  0
3  0  0  1
4  1  0  0
5  0  1  0
</pre>

<p>
添加前缀：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">dummies</span> = pd.get_dummies(df[<span style="color: #e6db74;">'key'</span>], prefix=<span style="color: #e6db74;">'key'</span>)
log(<span style="color: #e6db74;">"dummies"</span>, dummies)
<span style="color: #fd971f;">df_with_dummies</span> = df[[<span style="color: #e6db74;">'data'</span>]].join(dummies)
log(<span style="color: #e6db74;">"df_with_dummies"</span>, df_with_dummies)
</pre>
</div>

<pre class="example">
=================================== dummies ====================================
   key_a  key_b  key_c
0      0      1      0
1      0      1      0
2      1      0      0
3      0      0      1
4      1      0      0
5      0      1      0
=============================== df_with_dummies ================================
   data  key_a  key_b  key_c
0     0      0      1      0
1     1      0      1      0
2     2      1      0      0
3     3      0      0      1
4     4      1      0      0
5     5      0      1      0
</pre>

<p>
<code>get_dummies</code> 与 <code>cut</code> 等离散化函数结合使用是 <b>统计操作中一个有用的方法</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython">np.random.seed(12345)
<span style="color: #fd971f;">values</span> = np.random.rand(10)
log(<span style="color: #e6db74;">"values"</span>, values)
<span style="color: #fd971f;">bins</span> = [0, 0.2, 0.4, 0.6, 0.8, 1]
log(<span style="color: #e6db74;">"pd.get_dummies(pd.cut(values, bins))"</span>, pd.get_dummies(pd.cut(values, bins)))
</pre>
</div>

<pre class="example">
==================================== values ====================================
[0.92961609 0.31637555 0.18391881 0.20456028 0.56772503 0.5955447
 0.96451452 0.6531771  0.74890664 0.65356987]
===================== pd.get_dummies(pd.cut(values, bins)) =====================
   (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]
0           0           0           0           0           1
1           0           1           0           0           0
2           1           0           0           0           0
3           0           1           0           0           0
4           0           0           1           0           0
5           0           0           1           0           0
6           0           0           0           0           1
7           0           0           0           1           0
8           0           0           0           1           0
9           0           0           0           1           0
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgc2fe49f" class="outline-2">
<h2 id="orgc2fe49f"><span class="section-number-2">4</span> 数据规整：连接，联合，重塑</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org1163b80" class="outline-3">
<h3 id="org1163b80"><span class="section-number-3">4.1</span> 分层索引</h3>
<div class="outline-text-3" id="text-4-1">
<p>
分层索引提供了一种在 <b>低维度的形式中处理高维度数据</b> 的方式。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">s</span> = pd.Series(np.random.randn(9),
              index=[[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>, <span style="color: #e6db74;">'d'</span>],
                     [1, 2, 3, 1, 3, 1, 2, 2, 3]])
log(<span style="color: #e6db74;">"s"</span>, s)
log(<span style="color: #e6db74;">"s.index"</span>, s.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a  1    1.007189
   2   -1.296221
   3    0.274992
b  1    0.228913
   3    1.352917
c  1    0.886429
   2   -2.001637
d  2   -0.371843
   3    1.669025
dtype: float64
=================================== s.index ====================================
MultiIndex(levels=[['a', 'b', 'c', 'd'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 2, 0, 1, 1, 2]])
</pre>

<p>
选取数据子集：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"s['b']"</span>, s[<span style="color: #e6db74;">'b'</span>])
log(<span style="color: #e6db74;">"s['b':'c']"</span>, s[<span style="color: #e6db74;">'b'</span>:<span style="color: #e6db74;">'c'</span>])
log(<span style="color: #e6db74;">"s.loc[['b', 'd']]"</span>, s.loc[[<span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'d'</span>]])
<span style="color: #465457;"># </span><span style="color: #465457;">&#36873;&#25321;&#20869;&#37096;&#23618;&#32423;</span>
log(<span style="color: #e6db74;">"s.loc[:, 2]"</span>, s.loc[:, 2])
</pre>
</div>

<pre class="example">
==================================== s['b'] ====================================
1    0.228913
3    1.352917
dtype: float64
================================== s['b':'c'] ==================================
b  1    0.228913
   3    1.352917
c  1    0.886429
   2   -2.001637
dtype: float64
============================== s.loc[['b', 'd']] ===============================
b  1    0.228913
   3    1.352917
d  2   -0.371843
   3    1.669025
dtype: float64
================================= s.loc[:, 2] ==================================
a   -1.296221
c   -2.001637
d   -0.371843
dtype: float64
</pre>
</div>

<div id="outline-container-orgb7befed" class="outline-4">
<h4 id="orgb7befed"><span class="section-number-4">4.1.1</span> 层级交换(swaplevel)与排序(sort_index)</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
<code>swaplevel</code> 接收两个层级序号或层级名称，返回一个进行了层级变更的新对象， <span class="underline">数据是不变的</span> 。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame(np.arange(12).reshape((4, 3)),
                  index=[[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>, <span style="color: #e6db74;">'b'</span>], [1, 2, 1, 2]],
                  columns=[[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Colorado'</span>], [<span style="color: #e6db74;">'Green'</span>, <span style="color: #e6db74;">'Red'</span>, <span style="color: #e6db74;">'Green'</span>]]
)
<span style="color: #fd971f;">df.index.names</span> = [<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>]
<span style="color: #fd971f;">df.columns.names</span> = [<span style="color: #e6db74;">'state'</span>, <span style="color: #e6db74;">'color'</span>]
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.swaplevel('key1', 'key2')"</span>, df.swaplevel(<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>))
</pre>
</div>

<pre class="example">
====================================== df ======================================
state      Ohio     Colorado
color     Green Red    Green
key1 key2
a    1        0   1        2
     2        3   4        5
b    1        6   7        8
     2        9  10       11
========================= df.swaplevel('key1', 'key2') =========================
state      Ohio     Colorado
color     Green Red    Green
key2 key1
1    a        0   1        2
2    a        3   4        5
1    b        6   7        8
2    b        9  10       11
</pre>

<p>
<code>sort_index</code> 只能在单一层级上对数据进行排序。
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.sort_index(level=1)"</span>, df.sort_index(level=1))
log(<span style="color: #e6db74;">"df.swaplevel(0, 1).sort_index(level=0)"</span>, df.swaplevel(0, 1).sort_index(level=0))

</pre>
</div>

<pre class="example">
============================ df.sort_index(level=1) ============================
state      Ohio     Colorado
color     Green Red    Green
key1 key2
a    1        0   1        2
b    1        6   7        8
a    2        3   4        5
b    2        9  10       11
==================== df.swaplevel(0, 1).sort_index(level=0) ====================
state      Ohio     Colorado
color     Green Red    Green
key2 key1
1    a        0   1        2
     b        6   7        8
2    a        3   4        5
     b        9  10       11
</pre>


<p>
<b>如果索引按照字典顺序从最外层开始排序，则数据选择性能会更好</b>
</p>
</div>
</div>


<div id="outline-container-org1d233f2" class="outline-4">
<h4 id="org1d233f2"><span class="section-number-4">4.1.2</span> 列索引转为行索引 (set_index)</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
    <span style="color: #e6db74;">"a"</span>: <span style="color: #a6e22e;">range</span>(7),
    <span style="color: #e6db74;">"b"</span>: <span style="color: #a6e22e;">range</span>(7, 0, -1),
    <span style="color: #e6db74;">"c"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>],
    <span style="color: #e6db74;">"d"</span>: [0, 1, 2, 0, 1, 2, 3]
})
log(<span style="color: #e6db74;">"df"</span>, df)
log(<span style="color: #e6db74;">"df.set_index(['c', 'd'])"</span>, df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>]))
</pre>
</div>

<pre class="example">
====================================== df ======================================
   a  b    c  d
0  0  7  one  0
1  1  6  one  1
2  2  5  one  2
3  3  4  two  0
4  4  3  two  1
5  5  2  two  2
6  6  1  two  3
=========================== df.set_index(['c', 'd']) ===========================
       a  b
c   d
one 0  0  7
    1  1  6
    2  2  5
two 0  3  4
    1  4  3
    2  5  2
    3  6  1
</pre>

<p>
默认情况下，用过行索引的列会从 DataFrame 中删除，也可以选择留下：
</p>

<div class="org-src-container">
<pre class="src src-ipython">log(<span style="color: #e6db74;">"df.set_index(['c', 'd'], drop=False)"</span>, df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>], drop=<span style="color: #ae81ff;">False</span>))
</pre>
</div>

<pre class="example">
===================== df.set_index(['c', 'd'], drop=False) =====================
       a  b    c  d
c   d
one 0  0  7  one  0
    1  1  6  one  1
    2  2  5  one  2
two 0  3  4  two  0
    1  4  3  two  1
    2  5  2  two  2
    3  6  1  two  3
</pre>
</div>
</div>


<div id="outline-container-org006ce75" class="outline-4">
<h4 id="org006ce75"><span class="section-number-4">4.1.3</span> 行索引转为列索引 (reset_index)</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
<code>reset_index</code> 是 <code>set_index</code> 的 <b>反操作</b> ，分层索引的行索引层级会被移动为列索引。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df</span> = pd.DataFrame({
    <span style="color: #e6db74;">"a"</span>: <span style="color: #a6e22e;">range</span>(7),
    <span style="color: #e6db74;">"b"</span>: <span style="color: #a6e22e;">range</span>(7, 0, -1),
    <span style="color: #e6db74;">"c"</span>: [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'two'</span>],
    <span style="color: #e6db74;">"d"</span>: [0, 1, 2, 0, 1, 2, 3]
})
log(<span style="color: #e6db74;">"df"</span>, df)
<span style="color: #fd971f;">df2</span> = df.set_index([<span style="color: #e6db74;">'c'</span>, <span style="color: #e6db74;">'d'</span>])
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"df2.reset_index()"</span>, df2.reset_index())
</pre>
</div>

<pre class="example">
====================================== df ======================================
   a  b    c  d
0  0  7  one  0
1  1  6  one  1
2  2  5  one  2
3  3  4  two  0
4  4  3  two  1
5  5  2  two  2
6  6  1  two  3
===================================== df2 ======================================
       a  b
c   d
one 0  0  7
    1  1  6
    2  2  5
two 0  3  4
    1  4  3
    2  5  2
    3  6  1
============================== df2.reset_index() ===============================
     c  d  a  b
0  one  0  0  7
1  one  1  1  6
2  one  2  2  5
3  two  0  3  4
4  two  1  4  3
5  two  2  5  2
6  two  3  6  1
</pre>
</div>
</div>
</div>


<div id="outline-container-org9f26c40" class="outline-3">
<h3 id="org9f26c40"><span class="section-number-3">4.2</span> 连接与合并(concat,merge,combine_first)</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org58b39dc" class="outline-4">
<h4 id="org58b39dc"><span class="section-number-4">4.2.1</span> merge</h4>
<div class="outline-text-4" id="text-4-2-1">
</div>
<div id="outline-container-orgd5c7dfb" class="outline-5">
<h5 id="orgd5c7dfb"><span class="section-number-5">4.2.1.1</span> 基本用法</h5>
<div class="outline-text-5" id="text-4-2-1-1">
<p>
合并或连接操作是通过一个或多个键，连接行来联合数据集。
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacaab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(7)
})

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(3)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2)"</span>, pd.merge(df1, df2))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
  key  data1
0   b      0
1   b      1
2   a      2
3   c      3
4   a      4
5   a      5
6   b      6
===================================== df2 ======================================
  key  data2
0   a      0
1   b      1
2   d      2
============================== pd.merge(df1, df2) ==============================
  key  data1  data2
0   b      0      1
1   b      1      1
2   b      6      1
3   a      2      0
4   a      4      0
5   a      5      0
</pre>

<p>
若没有指定在哪一列上进行连接，即没有指定连接的键信息， <code>merge</code> 会自动将 <b>重叠列名作为连接键</b> 。
</p>

<p>
显示指定连接键才是好的做法：
</p>

<div class="org-src-container">
<pre class="src src-ipython">pd.merge(df1, df2, on=<span style="color: #e6db74;">'key'</span>)
</pre>
</div>

<p>
如果每个对象的列名是不同的，可以分别为它们指定列名：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"lkey"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacaab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(7)
})

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"rkey"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(3)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2, left_on='lkey', right_on='rkey')"</span>, pd.merge(df1, df2, left_on=<span style="color: #e6db74;">'lkey'</span>, right_on=<span style="color: #e6db74;">'rkey'</span>))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
  lkey  data1
0    b      0
1    b      1
2    a      2
3    c      3
4    a      4
5    a      5
6    b      6
===================================== df2 ======================================
  rkey  data2
0    a      0
1    b      1
2    d      2
============= pd.merge(df1, df2, left_on='lkey', right_on='rkey') ==============
  lkey  data1 rkey  data2
0    b      0    b      1
1    b      1    b      1
2    b      6    b      1
3    a      2    a      0
4    a      4    a      0
5    a      5    a      0
</pre>
</div>
</div>

<div id="outline-container-org1c9052e" class="outline-5">
<h5 id="org1c9052e"><span class="section-number-5">4.2.1.2</span> 合并类型(inner,outer,left,right)</h5>
<div class="outline-text-5" id="text-4-2-1-2">
<p>
默认情况下， <code>merge</code> 做的是内连接。
</p>

<p>
<b>多对多的连接是行的笛卡尔积</b> ：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">df1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bbacab'</span>),
    <span style="color: #e6db74;">"data1"</span>: <span style="color: #a6e22e;">range</span>(6)
})
<span style="color: #fd971f;">df1.index</span> = [<span style="color: #e6db74;">'one'</span>, <span style="color: #e6db74;">'two'</span>, <span style="color: #e6db74;">'three'</span>, <span style="color: #e6db74;">'four'</span>, <span style="color: #e6db74;">'five'</span>, <span style="color: #e6db74;">'six'</span>]

<span style="color: #fd971f;">df2</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ababd'</span>),
    <span style="color: #e6db74;">"data2"</span>: <span style="color: #a6e22e;">range</span>(5)
})

log(<span style="color: #e6db74;">"df1"</span>, df1)
log(<span style="color: #e6db74;">"df2"</span>, df2)
log(<span style="color: #e6db74;">"pd.merge(df1, df2, on='key', how='left')"</span>, pd.merge(df1, df2, on=<span style="color: #e6db74;">'key'</span>, how=<span style="color: #e6db74;">'left'</span>))
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
      key  data1
one     b      0
two     b      1
three   a      2
four    c      3
five    a      4
six     b      5
===================================== df2 ======================================
  key  data2
0   a      0
1   b      1
2   a      2
3   b      3
4   d      4
=================== pd.merge(df1, df2, on='key', how='left') ===================
   key  data1  data2
0    b      0    1.0
1    b      0    3.0
2    b      1    1.0
3    b      1    3.0
4    a      2    0.0
5    a      2    2.0
6    c      3    NaN
7    a      4    0.0
8    a      4    2.0
9    b      5    1.0
10   b      5    3.0
</pre>

<p>
<span class="underline">如上例所示，进行列-列连接时，索引对象会被丢弃。</span>
</p>
</div>
</div>



<div id="outline-container-org389b927" class="outline-5">
<h5 id="org389b927"><span class="section-number-5">4.2.1.3</span> 索引作为合并键</h5>
<div class="outline-text-5" id="text-4-2-1-3">
<div class="org-src-container">
<pre class="src src-ipython">  <span style="color: #fd971f;">left1</span> = pd.DataFrame({
      <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abaabc'</span>),
      <span style="color: #e6db74;">"value"</span>: <span style="color: #a6e22e;">range</span>(6)
  })

  <span style="color: #fd971f;">right1</span> = pd.DataFrame({
      <span style="color: #e6db74;">"group_val"</span>: [3.5, 7]
  }, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>])

log(<span style="color: #e6db74;">"left1"</span>, left1)
log(<span style="color: #e6db74;">"right1"</span>, right1)
log(<span style="color: #e6db74;">"pd.merge(left1, right1, left_on='key', right_index=True)"</span>, pd.merge(left1, right1, left_on=<span style="color: #e6db74;">'key'</span>, right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== left1 =====================================
  key  value
0   a      0
1   b      1
2   a      2
3   a      3
4   b      4
5   c      5
==================================== right1 ====================================
   group_val
a        3.5
b        7.0
=========== pd.merge(left1, right1, left_on='key', right_index=True) ===========
  key  value  group_val
0   a      0        3.5
2   a      2        3.5
3   a      3        3.5
1   b      1        7.0
4   b      4        7.0
</pre>

<p>
多层索引的情况下，在索引上的连接是一个隐式的多键合并，
<b>必须以列表的方式指明合并所需的多个列：</b>
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">lefth</span> = pd.DataFrame(
    {
        <span style="color: #e6db74;">"key1"</span>: [<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>],
        <span style="color: #e6db74;">"key2"</span>: [2000, 2001, 2002, 2001, 2002],
        <span style="color: #e6db74;">"data"</span>: np.arange(5)
    }
)

<span style="color: #fd971f;">righth</span> = pd.DataFrame(np.arange(12).reshape((6, 2)),
                      index=[
                          [<span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Nevada'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Ohio'</span>],
                          [2001, 2000, 2000, 2000, 2001, 2002]
                      ],
                      columns=[<span style="color: #e6db74;">'event1'</span>, <span style="color: #e6db74;">'event2'</span>]
)

log(<span style="color: #e6db74;">"lefth"</span>, lefth)
log(<span style="color: #e6db74;">"righth"</span>, righth)
log(<span style="color: #e6db74;">"pd.merge(lefth, righth, left_on=['key1', 'key2'], right_index=True)"</span>, pd.merge(lefth, righth, left_on=[<span style="color: #e6db74;">'key1'</span>, <span style="color: #e6db74;">'key2'</span>], right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== lefth =====================================
     key1  key2  data
0    Ohio  2000     0
1    Ohio  2001     1
2    Ohio  2002     2
3  Nevada  2001     3
4  Nevada  2002     4
==================================== righth ====================================
             event1  event2
Nevada 2001       0       1
       2000       2       3
Ohio   2000       4       5
       2000       6       7
       2001       8       9
       2002      10      11
===== pd.merge(lefth, righth, left_on=['key1', 'key2'], right_index=True) ======
     key1  key2  data  event1  event2
0    Ohio  2000     0       4       5
0    Ohio  2000     0       6       7
1    Ohio  2001     1       8       9
2    Ohio  2002     2      10      11
3  Nevada  2001     3       0       1
</pre>

<p>
两边都使用索引合并：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)

<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)

log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"pd.merge(left2, right2, how='outer', left_index=True, right_index=True)"</span>, pd.merge(left2, right2, how=<span style="color: #e6db74;">'outer'</span>, left_index=<span style="color: #ae81ff;">True</span>, right_index=<span style="color: #ae81ff;">True</span>))
</pre>
</div>

<pre class="example">
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
=== pd.merge(left2, right2, how='outer', left_index=True, right_index=True) ====
   Ohio  Nevada  Missouri  Alabama
a   1.0     2.0       NaN      NaN
b   NaN     NaN       7.0      8.0
c   3.0     4.0       9.0     10.0
d   NaN     NaN      11.0     12.0
e   5.0     6.0      13.0     14.0
</pre>
</div>
</div>


<div id="outline-container-org0718619" class="outline-5">
<h5 id="org0718619"><span class="section-number-5">4.2.1.4</span> join</h5>
<div class="outline-text-5" id="text-4-2-1-4">
<p>
DataFrame 有一个方便的 <code>join</code> 方法，用于 <b>按照索引合并</b> 。(_默认是左连接_)
</p>

<p>
之前的例子中，可以这样写：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)

<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)

log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"left2.join(right2, how='outer')"</span>, left2.join(right2, how=<span style="color: #e6db74;">'outer'</span>))
</pre>
</div>

<pre class="example">
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
======================= left2.join(right2, how='outer') ========================
   Ohio  Nevada  Missouri  Alabama
a   1.0     2.0       NaN      NaN
b   NaN     NaN       7.0      8.0
c   3.0     4.0       9.0     10.0
d   NaN     NaN      11.0     12.0
e   5.0     6.0      13.0     14.0
</pre>

<p>
<code>join</code> 也支持使用连接键：
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">left1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"key"</span>: <span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'abaabc'</span>),
    <span style="color: #e6db74;">"value"</span>: <span style="color: #a6e22e;">range</span>(6)
})

<span style="color: #fd971f;">right1</span> = pd.DataFrame({
    <span style="color: #e6db74;">"group_val"</span>: [3.5, 7]
}, index=[<span style="color: #e6db74;">'a'</span>, <span style="color: #e6db74;">'b'</span>])

log(<span style="color: #e6db74;">"left1"</span>, left1)
log(<span style="color: #e6db74;">"right1"</span>, right1)
log(<span style="color: #e6db74;">"left1.join(right1, on='key')"</span>, left1.join(right1, on=<span style="color: #e6db74;">'key'</span>))
</pre>
</div>

<pre class="example">
==================================== left1 =====================================
  key  value
0   a      0
1   b      1
2   a      2
3   a      3
4   b      4
5   c      5
==================================== right1 ====================================
   group_val
a        3.5
b        7.0
========================= left1.join(right1, on='key') =========================
  key  value  group_val
0   a      0        3.5
1   b      1        7.0
2   a      2        3.5
3   a      3        3.5
4   b      4        7.0
5   c      5        NaN
</pre>


<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #fd971f;">another</span> = pd.DataFrame(
    [[7, 8], [9, 10], [11, 12], [16, 17]],
    index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'acef'</span>),
    columns=[<span style="color: #e6db74;">'New York'</span>, <span style="color: #e6db74;">'Oregon'</span>]
)
<span style="color: #fd971f;">left2</span> = pd.DataFrame([[1, 2], [3, 4], [5, 6]],
                     index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'ace'</span>),
                     columns=[<span style="color: #e6db74;">'Ohio'</span>, <span style="color: #e6db74;">'Nevada'</span>]
)
<span style="color: #fd971f;">right2</span> = pd.DataFrame([[7, 8], [9, 10], [11, 12], [13, 14]],
                      index=<span style="color: #a6e22e;">list</span>(<span style="color: #e6db74;">'bcde'</span>),
                      columns=[<span style="color: #e6db74;">'Missouri'</span>, <span style="color: #e6db74;">'Alabama'</span>]
)
log(<span style="color: #e6db74;">"another"</span>, another)
log(<span style="color: #e6db74;">"left2"</span>, left2)
log(<span style="color: #e6db74;">"right2"</span>, right2)
log(<span style="color: #e6db74;">"left2.join([right2, another])"</span>, left2.join([right2, another]))
</pre>
</div>

<pre class="example">
=================================== another ====================================
   New York  Oregon
a         7       8
c         9      10
e        11      12
f        16      17
==================================== left2 =====================================
   Ohio  Nevada
a     1       2
c     3       4
e     5       6
==================================== right2 ====================================
   Missouri  Alabama
b         7        8
c         9       10
d        11       12
e        13       14
======================== left2.join([right2, another]) =========================
   Ohio  Nevada  Missouri  Alabama  New York  Oregon
a     1       2       NaN      NaN         7       8
c     3       4       9.0     10.0         9      10
e     5       6      13.0     14.0        11      12
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org4263a9b" class="outline-2">
<h2 id="org4263a9b"><span class="section-number-2">5</span> 附录</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org54ce1fd" class="outline-3">
<h3 id="org54ce1fd"><span class="section-number-3">5.1</span> reindex 方法的参数 <a id="orgcc957c5"></a></h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li><p>
method
</p>

<p>
插值方式， <code>ffill</code> 为前向填充， <code>bfill</code> 是后向填充
</p></li>

<li>fill_value</li>

<li><p>
limit
</p>

<p>
前向或后向填充时，所需填充的最大尺寸间隙（以元素数量）
</p></li>

<li><p>
tolerance
</p>

<p>
前向或后向填充时，所需填充的不精确匹配下的最大尺寸间隙（以绝对数字距离）
</p></li>

<li><p>
level
</p>

<p>
匹配 MultiIndex 级别的简单索引；否则选择子集
</p></li>

<li><p>
copy
</p>

<p>
如果为 <code>True</code> ，即使新索引等于旧索引，也总是复制底层数据；
如果是 <code>False</code> ，则在索引相同时不复制数据
</p></li>
</ul>
</div>
</div>


<div id="outline-container-orgf27e61d" class="outline-3">
<h3 id="orgf27e61d"><span class="section-number-3">5.2</span> 索引对象常见方法和属性 <a id="org218f9fa"></a></h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>append</li>
<li>difference</li>
<li>intersection</li>
<li>union</li>
<li>isin</li>
<li>delete</li>
<li>drop</li>
<li>insert</li>
<li>is_monotonic</li>
<li>is_unique</li>
<li>unique</li>
</ul>
</div>
</div>


<div id="outline-container-orgb3e9453" class="outline-3">
<h3 id="orgb3e9453"><span class="section-number-3">5.3</span> 算数方法 <a id="org436a213"></a></h3>
<div class="outline-text-3" id="text-5-3">
<dl class="org-dl">
<dt>add, radd</dt><dd>+</dd>
<dt>sub, rsub</dt><dd>-</dd>
<dt>div, rdiv</dt><dd>/</dd>
<dt>floordiv, rfloordiv</dt><dd>//</dd>
<dt>mul, rmul</dt><dd>*</dd>
<dt>pow, rpow</dt><dd>**</dd>
</dl>
</div>
</div>


<div id="outline-container-orgc609f62" class="outline-3">
<h3 id="orgc609f62"><span class="section-number-3">5.4</span> 打破平级关系方法 <a id="orgab35b6d"></a></h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>average</li>
<li>min</li>
<li>max</li>
<li>first</li>
<li>dense</li>
</ul>
</div>
</div>

<div id="outline-container-orgdb3be59" class="outline-3">
<h3 id="orgdb3be59"><span class="section-number-3">5.5</span> fillna 函数参数 <a id="orga16d1eb"></a></h3>
<div class="outline-text-3" id="text-5-5">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">参数</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">value</td>
<td class="org-left">标量值或字典型对象，用于填充缺失值</td>
</tr>

<tr>
<td class="org-left">method</td>
<td class="org-left">插值方法，如果没有其他参数，默认是 ffill</td>
</tr>

<tr>
<td class="org-left">axis</td>
<td class="org-left">需要填充的轴，默认 axis=0</td>
</tr>

<tr>
<td class="org-left">inplace</td>
<td class="org-left">原地修改</td>
</tr>

<tr>
<td class="org-left">limit</td>
<td class="org-left">用于前向或后向填充时最大的填充范围</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</body>
</html>