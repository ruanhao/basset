<!DOCTYPE html>
<html>
<head>
<title>Pandas</title>
<!-- 2018-02-19 Mon 21:31 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Series</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. 创建</a>
<ul>
<li><a href="#sec-1-1-1-1">1.1.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-1-1-2">1.1.1.2. 从字典创建</a></li>
<li><a href="#sec-1-1-1-3">1.1.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-1-2">1.1.2. 特性</a>
<ul>
<li><a href="#sec-1-1-2-1">1.1.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-1-2-2">1.1.2.2. 类字典对象</a></li>
<li><a href="#sec-1-1-2-3">1.1.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. DataFrame</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从字典创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-2-1-4">1.2.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-2-1-5">1.2.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-2-1-6">1.2.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 数据操作</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 列赋值</a></li>
<li><a href="#sec-1-2-2-4">1.2.2.4. 列删除</a></li>
<li><a href="#sec-1-2-2-5">1.2.2.5. 增加列</a>
<ul>
<li><a href="#sec-1-2-2-5-1">1.2.2.5.1. 添加到最后</a></li>
<li><a href="#sec-1-2-2-5-2">1.2.2.5.2. 指定位置添加</a></li>
<li><a href="#sec-1-2-2-5-3">1.2.2.5.3. assign()</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2-6">1.2.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-2-2-7">1.2.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-8">1.2.2.8. 行删除</a></li>
<li><a href="#sec-1-2-2-9">1.2.2.9. 行与列选择</a></li>
<li><a href="#sec-1-2-2-10">1.2.2.10. 选择指定坐标</a></li>
<li><a href="#sec-1-2-2-11">1.2.2.11. 数据对齐</a></li>
<li><a href="#sec-1-2-2-12">1.2.2.12. 使用 numpy 函数</a>
<ul>
<li><a href="#sec-1-2-2-12-1">1.2.2.12.1. DataFrame 转换为 ndarray 对象</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Panel</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-1-0-1">3.1.1.0.1. 填充默认值</a></li>
<li><a href="#sec-3-1-1-0-2">3.1.1.0.2. 往前填充</a></li>
<li><a href="#sec-3-1-1-0-3">3.1.1.0.3. 往后填充</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-2-0-1">3.1.2.0.1. 对行重新索引</a>
<ul>
<li><a href="#sec-3-1-2-0-1-1">3.1.2.0.1.1. 向前填充</a></li>
</ul>
</li>
<li><a href="#sec-3-1-2-0-2">3.1.2.0.2. 对列重新索引</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a>
<ul>
<li><a href="#sec-3-4-3-6-1">3.4.3.6.1. 列转换为索引</a></li>
<li><a href="#sec-3-4-3-6-2">3.4.3.6.2. 还原</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. concat</a></li>
<li><a href="#sec-6-2">6.2. merge</a></li>
<li><a href="#sec-6-3">6.3. append</a></li>
<li><a href="#sec-6-4">6.4. 数据整形</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-4-2">6.4.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-4-3">6.4.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. describe</a></li>
<li><a href="#sec-7-2">7.2. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Series</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. 创建</a>
<ul>
<li><a href="#sec-1-1-1-1">1.1.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-1-1-2">1.1.1.2. 从字典创建</a></li>
<li><a href="#sec-1-1-1-3">1.1.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-1-2">1.1.2. 特性</a>
<ul>
<li><a href="#sec-1-1-2-1">1.1.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-1-2-2">1.1.2.2. 类字典对象</a></li>
<li><a href="#sec-1-1-2-3">1.1.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. DataFrame</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从字典创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-2-1-4">1.2.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-2-1-5">1.2.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-2-1-6">1.2.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 数据操作</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 列赋值</a></li>
<li><a href="#sec-1-2-2-4">1.2.2.4. 列删除</a></li>
<li><a href="#sec-1-2-2-5">1.2.2.5. 增加列</a></li>
<li><a href="#sec-1-2-2-6">1.2.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-2-2-7">1.2.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-8">1.2.2.8. 行删除</a></li>
<li><a href="#sec-1-2-2-9">1.2.2.9. 行与列选择</a></li>
<li><a href="#sec-1-2-2-10">1.2.2.10. 选择指定坐标</a></li>
<li><a href="#sec-1-2-2-11">1.2.2.11. 数据对齐</a></li>
<li><a href="#sec-1-2-2-12">1.2.2.12. 使用 numpy 函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Panel</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a></li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. concat</a></li>
<li><a href="#sec-6-2">6.2. merge</a></li>
<li><a href="#sec-6-3">6.3. append</a></li>
<li><a href="#sec-6-4">6.4. 数据整形</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-4-2">6.4.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-4-3">6.4.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. describe</a></li>
<li><a href="#sec-7-2">7.2. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Author</td>
<td class="left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="left">Date</td>
<td class="left">2018-02-19 21:30:16</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 核心数据结构</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Series</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Series 是一维带标签的数组，数组里可以放任意的数据（整数，浮点数，字符串，Python Object）。
</p>

<p>
其基本的创建函数是： <code>pd.Series(data, index=index)</code>
</p>

<p>
其中 index 是一个列表，用来作为数据的标签。data 可以是不同的数据类型：
</p>

<ul class="org-ul">
<li>Python 字典
</li>
<li>ndarray 对象
</li>
<li>一个标量值，如 5
</li>
</ul>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-1-1">
</div><div id="outline-container-sec-1-1-1-1" class="outline-5">
<h5 id="sec-1-1-1-1"><span class="section-number-5">1.1.1.1</span> 从 ndarray 创建</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(5))
log(<span style="color: #ff4ea3;">"s2"</span>, s2)
log(<span style="color: #ff4ea3;">"s2.index"</span>, s2.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.555441
b    1.257449
c    1.894236
d    0.025625
e   -0.581904
dtype: float64
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s2 ======================================
0   -0.683118
1   -0.016093
2    0.285070
3   -0.011478
4   -0.336069
dtype: float64
=================================== s2.index ===================================
RangeIndex(start=0, stop=5, step=1)
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-1-2" class="outline-5">
<h5 id="sec-1-1-1-2"><span class="section-number-5">1.1.1.2</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'a'</span> : 0., <span style="color: #ff4ea3;">'b'</span> : 1., <span style="color: #ff4ea3;">'d'</span> : 3}
<span style="color: #ff8700;">s</span> = pd.Series(d, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcd'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    NaN
d    3.0
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-1-3" class="outline-5">
<h5 id="sec-1-1-1-3"><span class="section-number-5">1.1.1.3</span> 从标量创建</h5>
<div class="outline-text-5" id="text-1-1-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(3, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    3
b    3
c    3
d    3
e    3
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> 特性</h4>
<div class="outline-text-4" id="text-1-1-2">
</div><div id="outline-container-sec-1-1-2-1" class="outline-5">
<h5 id="sec-1-1-2-1"><span class="section-number-5">1.1.2.1</span> 类 ndarray 对象</h5>
<div class="outline-text-5" id="text-1-1-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5))

log(<span style="color: #ff4ea3;">"s[0]"</span>, s[0])
log(<span style="color: #ff4ea3;">"s[:3]"</span>, s[:3])
log(<span style="color: #ff4ea3;">"s[[1, 3, 4]]"</span>, s[[1, 3, 4]])
log(<span style="color: #ff4ea3;">"np.exp(s)"</span>, np.exp(s))
log(<span style="color: #ff4ea3;">"np.sin(s)"</span>, np.sin(s))
</pre>
</div>

<pre class="example">
===================================== s[0] =====================================
-0.11740443228560034
==================================== s[:3] =====================================
0   -0.117404
1   -0.649348
2    0.497353
dtype: float64
================================= s[[1, 3, 4]] =================================
1   -0.649348
3    0.176836
4   -1.416386
dtype: float64
================================== np.exp(s) ===================================
0    0.889225
1    0.522386
2    1.644364
3    1.193435
4    0.242589
dtype: float64
================================== np.sin(s) ===================================
0   -0.117135
1   -0.604668
2    0.477101
3    0.175915
4   -0.988102
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-1-2-2" class="outline-5">
<h5 id="sec-1-1-2-2"><span class="section-number-5">1.1.2.2</span> 类字典对象</h5>
<div class="outline-text-5" id="text-1-1-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s</span>[<span style="color: #ff4ea3;">'e'</span>] = 5
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"'e' in s"</span>, <span style="color: #ff4ea3;">'e'</span> <span style="color: #a1db00;">in</span> s)
log(<span style="color: #ff4ea3;">"s.get('f', np.nan)"</span>, s.get(<span style="color: #ff4ea3;">'f'</span>, np.nan))
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    1.806573
b   -1.027218
c   -0.349960
d    1.832929
e    5.000000
dtype: float64
=================================== 'e' in s ===================================
True
============================== s.get('f', np.nan) ==============================
nan
</pre>
</div>
</div>


<div id="outline-container-sec-1-1-2-3" class="outline-5">
<h5 id="sec-1-1-2-3"><span class="section-number-5">1.1.2.3</span> 标签对齐</h5>
<div class="outline-text-5" id="text-1-1-2-3">
<p>
相同索引值才进行操作
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s1</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])

log(<span style="color: #ff4ea3;">"s1"</span>, s1)
log(<span style="color: #ff4ea3;">"s2"</span>, s2)


log(<span style="color: #ff4ea3;">"s1 + s2"</span>, s1 + s2)
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a   -3.040642
c   -0.477979
e    0.539557
dtype: float64
====================================== s2 ======================================
a   -1.359746
d    0.311640
e    1.155545
dtype: float64
=================================== s1 + s2 ====================================
a   -4.400388
c         NaN
d         NaN
e    1.695101
dtype: float64
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> DataFrame</h3>
<div class="outline-text-3" id="text-1-2">
<p>
DataFrame 是 <b>二维带行标签和列标签的数组</b> 。
</p>

<p>
可以把 DataFrame 想象成一个 Excel 表格或一个 SQL 数据库的表格，还可以想象成是一个 Series 对象字典。
</p>

<p>
它是 Pandas 里最常用的数据结构。
</p>

<p>
创建 DataFrame 的基本格式是：
</p>

<div class="org-src-container">

<pre class="src src-ipython">pd.DataFrame(data, index=index, columns=columns)
</pre>
</div>

<p>
其中 index 是行标签，columns 是列标签，data 可以是下面的数据：
</p>

<ul class="org-ul">
<li>由一维 numpy 数组，list，Series 构成的字典
</li>
<li>二维 numpy 数组
</li>
<li>一个 Series
</li>
<li>另外的 DataFrame 对象
</li>
</ul>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-2-1">
</div><div id="outline-container-sec-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1"><span class="section-number-5">1.2.1.1</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-2-1-1">
<p>
key 为 DataFrame 的列；value 为对应列下的值
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : pd.Series([1, 2, 3], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]),
     <span style="color: #ff4ea3;">'two'</span> : pd.Series([1, 2, 3, 4], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>], columns=[<span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
==================== pd.DataFrame(d, index=['d', 'b', 'a']) ====================
   one  two
d  NaN    4
b  2.0    2
a  1.0    1
======= pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three']) =======
   two three
d    4   NaN
b    2   NaN
a    1   NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : [1, 2, 3, 4],
     <span style="color: #ff4ea3;">'two'</span> : [21, 22, 23, 24]}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['a', 'b', 'c', 'd'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
0    1   21
1    2   22
2    3   23
3    4   24
================= pd.DataFrame(d, index=['a', 'b', 'c', 'd']) ==================
   one  two
a    1   21
b    2   22
c    3   23
d    4   24
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
                  <span style="color: #ff4ea3;">'A'</span>: 1,
                  <span style="color: #ff4ea3;">'B'</span>: pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>),
                  <span style="color: #ff4ea3;">'C'</span>: <span style="color: #d18aff;">range</span>(4),
                  <span style="color: #ff4ea3;">'D'</span>: np.arange(5, 9),
                  <span style="color: #ff4ea3;">'E'</span>: <span style="color: #ff4ea3;">'text'</span>,
                  <span style="color: #ff4ea3;">'F'</span>: [<span style="color: #ff4ea3;">'AA'</span>, <span style="color: #ff4ea3;">'BB'</span>, <span style="color: #ff4ea3;">'CC'</span>, <span style="color: #ff4ea3;">'DD'</span>]})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2"><span class="section-number-5">1.2.1.2</span> 从结构化数据列表创建</h5>
<div class="outline-text-5" id="text-1-2-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [(1, 2.2, <span style="color: #ff4ea3;">'Hello'</span>), (2, 3., <span style="color: #ff4ea3;">"World"</span>)]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   0    1      2
0  1  2.2  Hello
1  2  3.0  World
==== pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C']) ====
        A    B      C
first   1  2.2  Hello
second  2  3.0  World
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3"><span class="section-number-5">1.2.1.3</span> 从字典列表创建</h5>
<div class="outline-text-5" id="text-1-2-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [{<span style="color: #ff4ea3;">'a'</span>: 1, <span style="color: #ff4ea3;">'b'</span>: 2}, {<span style="color: #ff4ea3;">'a'</span>: 5, <span style="color: #ff4ea3;">'b'</span>: 10, <span style="color: #ff4ea3;">'c'</span>: 20}]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, columns=['a', 'b'])"</span>,
    pd.DataFrame(data, columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   a   b     c
0  1   2   NaN
1  5  10  20.0
================ pd.DataFrame(data, index=['first', 'second']) =================
        a   b     c
first   1   2   NaN
second  5  10  20.0
==================== pd.DataFrame(data, columns=['a', 'b']) ====================
   a   b
0  1   2
1  5  10
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-4" class="outline-5">
<h5 id="sec-1-2-1-4"><span class="section-number-5">1.2.1.4</span> 从元组字典创建</h5>
<div class="outline-text-5" id="text-1-2-1-4">
<p>
实际应用中，会通过数据清洗的方式，把数据整理成方便 Pandas 导入且可读性好的格式。
然后再通过 <b>reindex/groupby</b> 等方式转换成复杂数据结构。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {(<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 1, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 2},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 3, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 4},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 5, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 6},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 7, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 8},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'D'</span>): 9, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 10}}

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#22810;&#32423;&#26631;&#31614;</span>
log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
       a              b
       a    b    c    a     b
A B  4.0  1.0  5.0  8.0  10.0
  C  3.0  2.0  6.0  7.0   NaN
  D  NaN  NaN  NaN  NaN   9.0
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-5" class="outline-5">
<h5 id="sec-1-2-1-5"><span class="section-number-5">1.2.1.5</span> 从 Series 创建</h5>
<div class="outline-text-5" id="text-1-2-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"pd.DataFrame(s)"</span>, pd.DataFrame(s))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(s) ================================
          0
a  1.184457
b -0.475211
c -1.733642
d  0.974882
e -0.742812
==================== pd.DataFrame(s, index=['a', 'c', 'd']) ====================
          0
a  1.184457
c -1.733642
d  0.974882
============ pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A']) =============
          A
a  1.184457
c -1.733642
d  0.974882
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-6" class="outline-5">
<h5 id="sec-1-2-1-6"><span class="section-number-5">1.2.1.6</span> 指定行列索引创建</h5>
<div class="outline-text-5" id="text-1-2-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
log(<span style="color: #ff4ea3;">"dates"</span>, dates)

<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01 -1.652503  0.386177  1.384397 -0.215212
2016-03-02  0.716722 -3.160831  0.445522  2.034426
2016-03-03 -0.598482 -1.217330  1.181348 -0.964243
2016-03-04  1.019393  2.161591 -0.054007  0.387970
2016-03-05 -0.316459 -0.408254 -1.333909 -0.828735
2016-03-06  1.451282  0.923337 -0.897306 -0.735216
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> 数据操作</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEF'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.263020 -1.825336 -0.601191 -0.377694
B -0.245132 -1.826504  0.351362 -1.625722
C -0.155116  1.030553 -0.053905 -0.061975
D -1.340134  1.446618 -1.025910 -0.048486
E  1.139238 -0.079725 -0.330717  0.465356
F  1.830097 -1.443329 -0.222024  1.389607
</pre>
</div>

<div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1"><span class="section-number-5">1.2.2.1</span> 列选择(Series)</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['one']"</span>, df[<span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.one"</span>, df.one)
</pre>
</div>

<pre class="example">
================================== df['one'] ===================================
A    0.263020
B   -0.245132
C   -0.155116
D   -1.340134
E    1.139238
F    1.830097
Name: one, dtype: float64
==================================== df.one ====================================
A    0.263020
B   -0.245132
C   -0.155116
D   -1.340134
E    1.139238
F    1.830097
Name: one, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2"><span class="section-number-5">1.2.2.2</span> 列选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc[:, ['one', 'two']]"</span>, df.loc[:, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[:, 0:1]"</span>, df.iloc[:, 0:1])
</pre>
</div>

<pre class="example">
========================== df.loc[:, ['one', 'two']] ===========================
        one       two
A  0.263020 -1.825336
B -0.245132 -1.826504
C -0.155116  1.030553
D -1.340134  1.446618
E  1.139238 -0.079725
F  1.830097 -1.443329
=============================== df.iloc[:, 0:1] ================================
        one
A  0.263020
B -0.245132
C -0.155116
D -1.340134
E  1.139238
F  1.830097
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3"><span class="section-number-5">1.2.2.3</span> 列赋值</h5>
<div class="outline-text-5" id="text-1-2-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'three'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] + df[<span style="color: #ff4ea3;">'two'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.263020 -1.825336 -1.562316 -0.377694
B -0.245132 -1.826504 -2.071636 -1.625722
C -0.155116  1.030553  0.875437 -0.061975
D -1.340134  1.446618  0.106484 -0.048486
E  1.139238 -0.079725  1.059513  0.465356
F  1.830097 -1.443329  0.386769  1.389607
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-4" class="outline-5">
<h5 id="sec-1-2-2-4"><span class="section-number-5">1.2.2.4</span> 列删除</h5>
<div class="outline-text-5" id="text-1-2-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">del</span> df[<span style="color: #ff4ea3;">'three'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two      four
A  0.263020 -1.825336 -0.377694
B -0.245132 -1.826504 -1.625722
C -0.155116  1.030553 -0.061975
D -1.340134  1.446618 -0.048486
E  1.139238 -0.079725  0.465356
F  1.830097 -1.443329  1.389607
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = df.pop(<span style="color: #ff4ea3;">'four'</span>)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A   -0.377694
B   -1.625722
C   -0.061975
D   -0.048486
E    0.465356
F    1.389607
Name: four, dtype: float64
====================================== df ======================================
        one       two
A  0.263020 -1.825336
B -0.245132 -1.826504
C -0.155116  1.030553
D -1.340134  1.446618
E  1.139238 -0.079725
F  1.830097 -1.443329
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop([<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">df &#19981;&#21464;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
Empty DataFrame
Columns: []
Index: [A, B, C, D, E, F]
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-5" class="outline-5">
<h5 id="sec-1-2-2-5"><span class="section-number-5">1.2.2.5</span> 增加列</h5>
<div class="outline-text-5" id="text-1-2-2-5">
</div><div id="outline-container-sec-1-2-2-5-1" class="outline-6">
<h6 id="sec-1-2-2-5-1"><span class="section-number-6">1.2.2.5.1</span> 添加到最后</h6>
<div class="outline-text-6" id="text-1-2-2-5-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'flag'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] &gt; 0
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'five'</span>] = 5
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'one_trunc'</span>] = df[<span style="color: #ff4ea3;">'one'</span>][:2]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two   flag  five  one_trunc
A  0.263020 -1.825336   True     5   0.263020
B -0.245132 -1.826504  False     5  -0.245132
C -0.155116  1.030553  False     5        NaN
D -1.340134  1.446618  False     5        NaN
E  1.139238 -0.079725   True     5        NaN
F  1.830097 -1.443329   True     5        NaN
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-5-2" class="outline-6">
<h6 id="sec-1-2-2-5-2"><span class="section-number-6">1.2.2.5.2</span> 指定位置添加</h6>
<div class="outline-text-6" id="text-1-2-2-5-2">
<div class="org-src-container">

<pre class="src src-ipython">df.insert(1, <span style="color: #ff4ea3;">'bar'</span>, df.one + df.two)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.263020 -1.562316 -1.825336   True     5   0.263020
B -0.245132 -2.071636 -1.826504  False     5  -0.245132
C -0.155116  0.875437  1.030553  False     5        NaN
D -1.340134  0.106484  1.446618  False     5        NaN
E  1.139238  1.059513 -0.079725   True     5        NaN
F  1.830097  0.386769 -1.443329   True     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-5-3" class="outline-6">
<h6 id="sec-1-2-2-5-3"><span class="section-number-6">1.2.2.5.3</span> assign()</h6>
<div class="outline-text-6" id="text-1-2-2-5-3">
<p>
assign 方法并不会 inplace 地改变原来的 dataframe ，
该方法的 <b>优势</b> 在于可以对 dataframe 对象使用链式操作。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.assign(Ratio=df.one/df.two)
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
        one       bar       two   flag  five  one_trunc      Ratio
A  0.263020 -1.562316 -1.825336   True     5   0.263020  -0.144094
B -0.245132 -2.071636 -1.826504  False     5  -0.245132   0.134208
C -0.155116  0.875437  1.030553  False     5        NaN  -0.150518
D -1.340134  0.106484  1.446618  False     5        NaN  -0.926391
E  1.139238  1.059513 -0.079725   True     5        NaN -14.289548
F  1.830097  0.386769 -1.443329   True     5        NaN  -1.267970
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.263020 -1.562316 -1.825336   True     5   0.263020
B -0.245132 -2.071636 -1.826504  False     5  -0.245132
C -0.155116  0.875437  1.030553  False     5        NaN
D -1.340134  0.106484  1.446618  False     5        NaN
E  1.139238  1.059513 -0.079725   True     5        NaN
F  1.830097  0.386769 -1.443329   True     5        NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.assign(Ratio=lambda x: x.one - x.two)"</span>,
    df.assign(Ratio=<span style="color: #a1db00;">lambda</span> x: x.one - x.two))

log(<span style="color: #ff4ea3;">"df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar)"</span>,
    df.assign(ABRatio=df.one/df.two).assign(BarValue=<span style="color: #a1db00;">lambda</span> x: x.ABRatio*x.bar))
</pre>
</div>

<pre class="example">
=================== df.assign(Ratio=lambda x: x.one - x.two) ===================
        one       bar       two   flag  five  one_trunc     Ratio
A  0.263020 -1.562316 -1.825336   True     5   0.263020  2.088356
B -0.245132 -2.071636 -1.826504  False     5  -0.245132  1.581373
C -0.155116  0.875437  1.030553  False     5        NaN -1.185670
D -1.340134  0.106484  1.446618  False     5        NaN -2.786752
E  1.139238  1.059513 -0.079725   True     5        NaN  1.218963
F  1.830097  0.386769 -1.443329   True     5        NaN  3.273426
= df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar) ==
        one       bar       two   flag  five  one_trunc    ABRatio   BarValue
A  0.263020 -1.562316 -1.825336   True     5   0.263020  -0.144094   0.225120
B -0.245132 -2.071636 -1.826504  False     5  -0.245132   0.134208  -0.278031
C -0.155116  0.875437  1.030553  False     5        NaN  -0.150518  -0.131769
D -1.340134  0.106484  1.446618  False     5        NaN  -0.926391  -0.098646
E  1.139238  1.059513 -0.079725   True     5        NaN -14.289548 -15.139956
F  1.830097  0.386769 -1.443329   True     5        NaN  -1.267970  -0.490411
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2-6" class="outline-5">
<h5 id="sec-1-2-2-6"><span class="section-number-5">1.2.2.6</span> 行选择(Series)</h5>
<div class="outline-text-5" id="text-1-2-2-6">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#26631;&#31614;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df.iloc[0]"</span>, df.iloc[0])    <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#20301;&#32622;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
================================= df.loc['A'] ==================================
one          0.26302
bar         -1.56232
two         -1.82534
flag            True
five               5
one_trunc    0.26302
Name: A, dtype: object
================================== df.iloc[0] ==================================
one          0.26302
bar         -1.56232
two         -1.82534
flag            True
five               5
one_trunc    0.26302
Name: A, dtype: object
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-7" class="outline-5">
<h5 id="sec-1-2-2-7"><span class="section-number-5">1.2.2.7</span> 行选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-2-2-7">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df[2:4]"</span>, df[2:4])
log(<span style="color: #ff4ea3;">"df['A':'C']"</span>, df[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[2:4]"</span>, df.iloc[2:4])         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25928;&#29575;&#39640;</span>
log(<span style="color: #ff4ea3;">"df[df.one &gt; 0.5]"</span>, df[df.one &gt; 0.5])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[df &gt; 0]"</span>, df[df &gt; 0])             <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[[False, True, True, False, True, False]]"</span>,
    df[[<span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>]])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
=================================== df[2:4] ====================================
        one       bar       two   flag  five  one_trunc
C -0.155116  0.875437  1.030553  False     5        NaN
D -1.340134  0.106484  1.446618  False     5        NaN
================================= df['A':'C'] ==================================
        one       bar       two   flag  five  one_trunc
A  0.263020 -1.562316 -1.825336   True     5   0.263020
B -0.245132 -2.071636 -1.826504  False     5  -0.245132
C -0.155116  0.875437  1.030553  False     5        NaN
================================= df.iloc[2:4] =================================
        one       bar       two   flag  five  one_trunc
C -0.155116  0.875437  1.030553  False     5        NaN
D -1.340134  0.106484  1.446618  False     5        NaN
=============================== df[df.one &gt; 0.5] ===============================
        one       bar       two  flag  five  one_trunc
E  1.139238  1.059513 -0.079725  True     5        NaN
F  1.830097  0.386769 -1.443329  True     5        NaN
================================== df[df &gt; 0] ==================================
        one       bar       two  flag  five  one_trunc
A  0.263020       NaN       NaN   1.0     5    0.26302
B       NaN       NaN       NaN   NaN     5        NaN
C       NaN  0.875437  1.030553   NaN     5        NaN
D       NaN  0.106484  1.446618   NaN     5        NaN
E  1.139238  1.059513       NaN   1.0     5        NaN
F  1.830097  0.386769       NaN   1.0     5        NaN
================= df[[False, True, True, False, True, False]] ==================
        one       bar       two   flag  five  one_trunc
B -0.245132 -2.071636 -1.826504  False     5  -0.245132
C -0.155116  0.875437  1.030553  False     5        NaN
E  1.139238  1.059513 -0.079725   True     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-8" class="outline-5">
<h5 id="sec-1-2-2-8"><span class="section-number-5">1.2.2.8</span> 行删除</h5>
<div class="outline-text-5" id="text-1-2-2-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop(<span style="color: #ff4ea3;">'A'</span>)           <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">result &#26159;&#19968;&#20221;&#26032;&#30340;&#25968;&#25454;&#25335;&#36125;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
        one       bar       two   flag  five  one_trunc
B -0.245132 -2.071636 -1.826504  False     5  -0.245132
C -0.155116  0.875437  1.030553  False     5        NaN
D -1.340134  0.106484  1.446618  False     5        NaN
E  1.139238  1.059513 -0.079725   True     5        NaN
F  1.830097  0.386769 -1.443329   True     5        NaN
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-9" class="outline-5">
<h5 id="sec-1-2-2-9"><span class="section-number-5">1.2.2.9</span> 行与列选择</h5>
<div class="outline-text-5" id="text-1-2-2-9">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A':'B', ['one', 'two']]"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'B'</span>, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[0:2, 0:3]"</span>, df.iloc[0:2, 0:3])
</pre>
</div>

<pre class="example">
======================= df.loc['A':'B', ['one', 'two']] ========================
        one       two
A  0.263020 -1.825336
B -0.245132 -1.826504
============================== df.iloc[0:2, 0:3] ===============================
        one       bar       two
A  0.263020 -1.562316 -1.825336
B -0.245132 -2.071636 -1.826504
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-10" class="outline-5">
<h5 id="sec-1-2-2-10"><span class="section-number-5">1.2.2.10</span> 选择指定坐标</h5>
<div class="outline-text-5" id="text-1-2-2-10">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A', 'one']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.at['A', 'one']"</span>, df.at[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[1, 1]"</span>, df.iloc[1, 1])
log(<span style="color: #ff4ea3;">"df.iat[1, 1]"</span>, df.iat[1, 1])
</pre>
</div>

<pre class="example">
============================== df.loc['A', 'one'] ==============================
0.2630200110768385
============================== df.at['A', 'one'] ===============================
0.2630200110768385
================================ df.iloc[1, 1] =================================
-2.0716363712980868
================================= df.iat[1, 1] =================================
-2.0716363712980868
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-11" class="outline-5">
<h5 id="sec-1-2-2-11"><span class="section-number-5">1.2.2.11</span> 数据对齐</h5>
<div class="outline-text-5" id="text-1-2-2-11">
<p>
DataFrame 在进行数据计算时， <b>会自动按行和列进行数据对齐</b> 。
最终的计算结果会合并两个 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = pd.DataFrame(np.random.randn(10, 4),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefghij'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'D'</span>])

<span style="color: #ff8700;">df2</span> = pd.DataFrame(np.random.randn(7, 3),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'cdefghi'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>])

log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df2"</span>, df2)

log(<span style="color: #ff4ea3;">"df1 + df2"</span>, df1 + df2)
log(<span style="color: #ff4ea3;">"df1 - df1.iloc[0]"</span>, df1 - df1.iloc[0])
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
          A         B         C         D
a  1.373271 -0.117728 -1.297682 -0.715131
b -0.331617  0.761411 -0.865216  1.616122
c -0.628753 -1.640175 -1.256601 -0.311857
d -0.132574  0.849488  0.195985  1.250921
e -0.499035 -1.386574 -0.404339  0.481882
f -1.346846  0.636828  1.101050 -0.035570
g -0.927921 -0.174529 -0.960752 -1.052057
h  0.821337 -0.127205 -0.904643  0.000576
i  1.316297 -0.063502  2.291722  0.363900
j  0.577774  1.752237  0.664347  0.198480
===================================== df2 ======================================
          A         B         C
c -0.546136  0.348936 -0.570478
d -0.198216  1.164151 -0.587974
e  1.377826  0.005932 -0.910999
f -0.189605  1.204730 -0.220812
g -0.897681 -1.854801  2.832399
h  2.981851 -0.325516 -1.474498
i -0.671684  1.220257  1.716965
================================== df1 + df2 ===================================
          A         B         C   D
a       NaN       NaN       NaN NaN
b       NaN       NaN       NaN NaN
c -1.174889 -1.291239 -1.827079 NaN
d -0.330790  2.013639 -0.391989 NaN
e  0.878791 -1.380642 -1.315338 NaN
f -1.536450  1.841557  0.880239 NaN
g -1.825602 -2.029330  1.871648 NaN
h  3.803188 -0.452721 -2.379142 NaN
i  0.644614  1.156754  4.008687 NaN
j       NaN       NaN       NaN NaN
============================== df1 - df1.iloc[0] ===============================
          A         B         C         D
a  0.000000  0.000000  0.000000  0.000000
b -1.704888  0.879139  0.432467  2.331253
c -2.002024 -1.522447  0.041081  0.403274
d -1.505845  0.967217  1.493667  1.966053
e -1.872306 -1.268846  0.893344  1.197013
f -2.720117  0.754556  2.398732  0.679561
g -2.301192 -0.056801  0.336930 -0.336926
h -0.551934 -0.009477  0.393039  0.715707
i -0.056974  0.054226  3.589404  1.079031
j -0.795497  1.869965  1.962029  0.913611
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df3</span> = df2.loc[:, [<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]].copy()
log(<span style="color: #ff4ea3;">"df3 (before)"</span>, df3)
<span style="color: #ff8700;">df3</span>[df3 &gt; 0] = -df3
log(<span style="color: #ff4ea3;">"df3 (after)"</span>, df3)
</pre>
</div>

<pre class="example">
================================= df3 (before) =================================
          B         C
c  0.348936 -0.570478
d  1.164151 -0.587974
e  0.005932 -0.910999
f  1.204730 -0.220812
g -1.854801  2.832399
h -0.325516 -1.474498
i  1.220257  1.716965
================================= df3 (after) ==================================
          B         C
c -0.348936 -0.570478
d -1.164151 -0.587974
e -0.005932 -0.910999
f -1.204730 -0.220812
g -1.854801 -2.832399
h -0.325516 -1.474498
i -1.220257 -1.716965
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-12" class="outline-5">
<h5 id="sec-1-2-2-12"><span class="section-number-5">1.2.2.12</span> 使用 numpy 函数</h5>
<div class="outline-text-5" id="text-1-2-2-12">
<p>
因为从本质上讲，DataFrame 内部用的数据结构就是 numpy 的 ndarray 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"np.exp(df)"</span>, np.exp(df))
log(<span style="color: #ff4ea3;">"np.sin(df)"</span>, np.sin(df))
</pre>
</div>

<pre class="example">
================================== np.exp(df) ==================================
        one       two     three      four
0  0.590042  1.080467  0.495529  4.385379
1  1.318059  0.414688  0.350985  0.212860
2  3.054035  2.235156  0.626377  4.549818
3  2.478250  0.248726  5.004689  2.106976
4  1.484382  3.210855  3.560092  1.920240
5  4.822127  1.372864  2.196318  0.279349
6  0.333564  1.038725  1.412996  0.667936
7  0.612904  0.454566  0.649859  0.901511
8  0.479457  1.373783  1.067076  0.220329
9  0.164914  0.699370  3.586872  1.502072
================================== np.sin(df) ==================================
        one       two     three      four
0 -0.503427  0.077316 -0.645845  0.995723
1  0.272663 -0.770885 -0.865932 -0.999720
2  0.898554  0.720353 -0.450926  0.998449
3  0.787999 -0.983952  0.999217  0.678158
4  0.384807  0.919394  0.955038  0.607135
5  0.999997  0.311621  0.708085 -0.956656
6 -0.890262  0.037984  0.338867 -0.392698
7 -0.470226 -0.709236 -0.417779 -0.103497
8 -0.670663  0.312257  0.064877 -0.998309
9 -0.973316 -0.350003  0.957233  0.395714
</pre>
</div>

<div id="outline-container-sec-1-2-2-12-1" class="outline-6">
<h6 id="sec-1-2-2-12-1"><span class="section-number-6">1.2.2.12.1</span> DataFrame 转换为 ndarray 对象</h6>
<div class="outline-text-6" id="text-1-2-2-12-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ary</span> = np.asarray(df)
log(<span style="color: #ff4ea3;">"ary"</span>, ary)
log(<span style="color: #ff4ea3;">"ary == df.values"</span>, ary == df.values)
log(<span style="color: #ff4ea3;">"ary == df"</span>, ary == df)
</pre>
</div>

<pre class="example">
===================================== ary ======================================
[[-0.52756071  0.07739297 -0.70212897  1.47827605]
 [ 0.27616003 -0.88022882 -1.0470117  -1.54712168]
 [ 1.11646361  0.804311   -0.46780225  1.51508717]
 [ 0.90755265 -1.39140273  1.61037518  0.74525376]
 [ 0.39499868  1.16653727  1.26978652  0.65244995]
 [ 1.57321509  0.31689895  0.78678238 -1.27529514]
 [-1.09792066  0.03799356  0.34571246 -0.40356365]
 [-0.48954692 -0.78841326 -0.43099925 -0.10368302]
 [-0.73510181  0.31756821  0.06492234 -1.51263505]
 [-1.80232934 -0.3575748   1.27728045  0.40684547]]
=============================== ary == df.values ===============================
[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
================================== ary == df ===================================
    one   two  three  four
0  True  True   True  True
1  True  True   True  True
2  True  True   True  True
3  True  True   True  True
4  True  True   True  True
5  True  True   True  True
6  True  True   True  True
7  True  True   True  True
8  True  True   True  True
9  True  True   True  True
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Panel</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Panel 是三维带标签的数组。
</p>

<p>
Panel 由三个标签组成：
</p>

<dl class="org-dl">
<dt> items </dt><dd>坐标轴 0 ，索引对应的元素是一个 DataFrame
</dd>
<dt> major_axis </dt><dd>坐标轴 1 , DataFrame 里的行标签
</dd>
<dt> minor_axis </dt><dd>坐标轴 2 , DataFrame 里的列标签
</dd>
</dl>
</div>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 函数应用</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 将数据按行或列进行计算(apply)</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.arange(12).reshape(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       A   B   C
one    0   1   2
two    3   4   5
three  6   7   8
four   9  10  11
</pre>
</div>

<div id="outline-container-sec-2-1-0-1" class="outline-5">
<h5 id="sec-2-1-0-1"><span class="section-number-5">2.1.0.1</span> 按列进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-1">
<p>
每一列作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>())
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
A    9
B    9
C    9
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-2" class="outline-5">
<h5 id="sec-2-1-0-2"><span class="section-number-5">2.1.0.2</span> 按行进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-2">
<p>
每一行作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>(), axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
one      2
two      2
three    2
four     2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-3" class="outline-5">
<h5 id="sec-2-1-0-3"><span class="section-number-5">2.1.0.3</span> 返回多个值组成的 Series</h5>
<div class="outline-text-5" id="text-2-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">min_max</span>(x):
    <span style="color: #a1db00;">return</span> pd.Series([x.<span style="color: #d18aff;">min</span>(), x.<span style="color: #d18aff;">max</span>()], index=[<span style="color: #ff4ea3;">'min'</span>, <span style="color: #ff4ea3;">'max'</span>])
<span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(min_max, axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
       min  max
one      0    2
two      3    5
three    6    8
four     9   11
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 逐元素运算(applymap)</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
              A         B         C
one   -0.537002  0.864639  0.237544
two   -1.098373  0.680594 -1.552007
three  1.154667  0.453694  0.506778
four   0.210007  2.277377  1.984567
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">x &#34920;&#31034; dataframe &#20013;&#30340;&#27599;&#20010;&#20803;&#32032;</span>
<span style="color: #ff8700;">result</span> = df.applymap(<span style="color: #a1db00;">lambda</span> x: <span style="color: #ff4ea3;">'{0:.03f}'</span>.<span style="color: #d18aff;">format</span>(x))
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            A      B       C
one    -0.537  0.865   0.238
two    -1.098  0.681  -1.552
three   1.155  0.454   0.507
four    0.210  2.277   1.985
</pre>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 排序(sort_values)</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    5    9      1
B    2    2      1
C    3    5      1
D    6    8      7
</pre>
</div>


<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> 按列排序</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'two'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   one  two  three
A    5    9      1
D    6    8      7
C    3    5      1
B    2    2      1
</pre>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> 按行排序</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'C'</span>, axis=1, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   two  one  three
A    9    5      1
B    2    2      1
C    5    3      1
D    8    6      7
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 索引排序(sort_index)</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    2    1      7
B    6    7      8
C    4    1      9
D    5    3      3
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">col_sort</span> = df.sort_index(axis=1, ascending=<span style="color: #5fafd7;">False</span>)
<span style="color: #ff8700;">row_sort</span> = df.sort_index(ascending=<span style="color: #5fafd7;">False</span>)

log(<span style="color: #ff4ea3;">"col_sort"</span>, col_sort)
log(<span style="color: #ff4ea3;">"row_sort"</span>, row_sort)
</pre>
</div>

<pre class="example">
=================================== col_sort ===================================
   two  three  one
A    1      7    2
B    7      8    6
C    1      9    4
D    3      3    5
=================================== row_sort ===================================
   one  two  three
D    5    3      3
C    4    1      9
B    6    7      8
A    2    1      7
</pre>
</div>
</div>


<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 排名(rank)</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([3, 6, 2, 6, 4])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    3
1    6
2    2
3    6
4    4
dtype: int64
====================================== df ======================================
   one  two  three
A    5    3      1
B    1    7      2
C    2    3      4
D    5    3      2
</pre>



<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s_result</span> = s.rank(method=<span style="color: #ff4ea3;">'first'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"s_result"</span>, s_result)
</pre>
</div>

<pre class="example">
=================================== s_result ===================================
0    4.0
1    1.0
2    5.0
3    2.0
4    3.0
dtype: float64
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df_result</span> = df.rank(method=<span style="color: #ff4ea3;">'first'</span>)
log(<span style="color: #ff4ea3;">"df_result"</span>, df_result)
</pre>
</div>

<pre class="example">
================================== df_result ===================================
   one  two  three
A  3.0  1.0    1.0
B  1.0  4.0    2.0
C  2.0  2.0    4.0
D  4.0  3.0    3.0
</pre>
</div>
</div>


<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Series 元素统计</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abbcdabacad'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0     a
1     b
2     b
3     c
4     d
5     a
6     b
7     a
8     c
9     a
10    d
dtype: object
</pre>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> 个数统计(value_counts)</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.value_counts()"</span>, s.value_counts())
</pre>
</div>

<pre class="example">
=============================== s.value_counts() ===============================
a    4
b    3
c    2
d    2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> 唯一性统计(uniq)</h4>
<div class="outline-text-4" id="text-2-6-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.unique()"</span>, s.unique())
</pre>
</div>

<pre class="example">
================================== s.unique() ==================================
['a' 'b' 'c' 'd']
</pre>
</div>
</div>


<div id="outline-container-sec-2-6-3" class="outline-4">
<h4 id="sec-2-6-3"><span class="section-number-4">2.6.3</span> 成员资格统计(isin)</h4>
<div class="outline-text-4" id="text-2-6-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.isin(['a', 'b', 'c'])"</span>, s.isin([<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]))
</pre>
</div>

<pre class="example">
=========================== s.isin(['a', 'b', 'c']) ============================
0      True
1      True
2      True
3      True
4     False
5      True
6      True
7      True
8      True
9      True
10    False
dtype: bool
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 索引</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 重新索引</h3>
<div class="outline-text-3" id="text-3-1">
<p>
即把索引值进行重新赋值， <b>以增加一些行的数据</b> 。
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Series</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1, 3, 5, 6, 8], index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'acefh'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    1
c    3
e    5
f    6
h    8
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'))"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>)))
</pre>
</div>

<pre class="example">
========================= s.reindex(list('abcdefgh')) ==========================
a    1.0
b    NaN
c    3.0
d    NaN
e    5.0
f    6.0
g    NaN
h    8.0
dtype: float64
</pre>
</div>


<div id="outline-container-sec-3-1-1-0-1" class="outline-6">
<h6 id="sec-3-1-1-0-1"><span class="section-number-6">3.1.1.0.1</span> 填充默认值</h6>
<div class="outline-text-6" id="text-3-1-1-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), fill_value=0)"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), fill_value=0))
</pre>
</div>

<pre class="example">
================== s.reindex(list('abcdefgh'), fill_value=0) ===================
a    1
b    0
c    3
d    0
e    5
f    6
g    0
h    8
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-1-0-2" class="outline-6">
<h6 id="sec-3-1-1-0-2"><span class="section-number-6">3.1.1.0.2</span> 往前填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='ffill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='ffill') ==================
a    1
b    1
c    3
d    3
e    5
f    6
g    6
h    8
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-1-1-0-3" class="outline-6">
<h6 id="sec-3-1-1-0-3"><span class="section-number-6">3.1.1.0.3</span> 往后填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='bfill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'bfill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='bfill') ==================
a    1
b    3
c    3
d    5
e    5
f    6
g    8
h    8
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> DataFrame</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 6),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ADFH'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'six'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four      five       six
A  1.235708 -1.800775 -0.110192  1.128044  1.696571 -0.494056
D -1.278273 -0.914804  0.955857  1.064877  1.303746 -0.571380
F -1.015574  1.626602  0.788005  0.186243 -0.650036 -1.132667
H  1.083851  0.981366  0.394689 -1.566823 -0.554499 -1.230000
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1" class="outline-6">
<h6 id="sec-3-1-2-0-1"><span class="section-number-6">3.1.2.0.1</span> 对行重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'))"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>)))
</pre>
</div>

<pre class="example">
====================== df.reindex(index=list('ABCDEFGH')) ======================
        one       two     three      four      five       six
A  1.235708 -1.800775 -0.110192  1.128044  1.696571 -0.494056
B       NaN       NaN       NaN       NaN       NaN       NaN
C       NaN       NaN       NaN       NaN       NaN       NaN
D -1.278273 -0.914804  0.955857  1.064877  1.303746 -0.571380
E       NaN       NaN       NaN       NaN       NaN       NaN
F -1.015574  1.626602  0.788005  0.186243 -0.650036 -1.132667
G       NaN       NaN       NaN       NaN       NaN       NaN
H  1.083851  0.981366  0.394689 -1.566823 -0.554499 -1.230000
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1-1" class="outline-7">
<h7 id="sec-3-1-2-0-1-1"><span class="section-number-7">3.1.2.0.1.1</span> 向前填充</h7>
<div class="outline-text-7" id="text-3-1-2-0-1-1">
<p>
<b>fill method 只对行重新索引有效，不适用列</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'), method='ffill')"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
============== df.reindex(index=list('ABCDEFGH'), method='ffill') ==============
        one       two     three      four      five       six
A  1.235708 -1.800775 -0.110192  1.128044  1.696571 -0.494056
B  1.235708 -1.800775 -0.110192  1.128044  1.696571 -0.494056
C  1.235708 -1.800775 -0.110192  1.128044  1.696571 -0.494056
D -1.278273 -0.914804  0.955857  1.064877  1.303746 -0.571380
E -1.278273 -0.914804  0.955857  1.064877  1.303746 -0.571380
F -1.015574  1.626602  0.788005  0.186243 -0.650036 -1.132667
G -1.015574  1.626602  0.788005  0.186243 -0.650036 -1.132667
H  1.083851  0.981366  0.394689 -1.566823 -0.554499 -1.230000
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-2-0-2" class="outline-6">
<h6 id="sec-3-1-2-0-2"><span class="section-number-6">3.1.2.0.2</span> 对列重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0)"</span>,
    df.reindex(columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'seven'</span>], fill_value=0))
</pre>
</div>

<pre class="example">
===== df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0) ======
        one     three      five  seven
A  1.235708 -0.110192  1.696571      0
D -1.278273  0.955857  1.303746      0
F -1.015574  0.788005 -0.650036      0
H  1.083851  0.394689 -0.554499      0
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 索引命名</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.rand(5), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.384550
b    0.670122
c    0.183667
d    0.438467
e    0.394705
dtype: float64
====================================== df ======================================
        one       two     three
0  0.452964 -1.437834 -2.073709
1 -0.943393 -0.298700 -0.068849
2  0.513485 -0.712291  0.545480
3 -0.539535 -0.827717 -0.378738
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s.index.name</span> = <span style="color: #ff4ea3;">'alpha'</span>
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s =======================================
alpha
a    0.384550
b    0.670122
c    0.183667
d    0.438467
e    0.394705
dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.index"</span>, df.index)
log(<span style="color: #ff4ea3;">"df.columns"</span>, df.columns)

<span style="color: #ff8700;">df.index.name</span> = <span style="color: #ff4ea3;">'row'</span>
<span style="color: #ff8700;">df.columns.name</span> = <span style="color: #ff4ea3;">'col'</span>

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
=================================== df.index ===================================
RangeIndex(start=0, stop=4, step=1)
================================== df.columns ==================================
Index(['one', 'two', 'three'], dtype='object')
====================================== df ======================================
col       one       two     three
row
0    0.452964 -1.437834 -2.073709
1   -0.943393 -0.298700 -0.068849
2    0.513485 -0.712291  0.545480
3   -0.539535 -0.827717 -0.378738
</pre>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 重复索引</h3>
<div class="outline-text-3" id="text-3-3">
<p>
索引值有重复项的索引
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.arange(6), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcbda'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0
b    1
c    2
b    3
d    4
a    5
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['a']"</span>, s[<span style="color: #ff4ea3;">'a'</span>])
log(<span style="color: #ff4ea3;">"s.index.is_unique"</span>, s.index.is_unique)
</pre>
</div>

<pre class="example">
==================================== s['a'] ====================================
a    0
a    5
dtype: int64
============================== s.index.is_unique ===============================
False
</pre>
</div>


<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 对重复索引的处理（清洗）</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">sum_result</span> = s.groupby(s.index).<span style="color: #d18aff;">sum</span>()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#36827;&#34892;&#27714;&#21644;</span>
log(<span style="color: #ff4ea3;">"sum_result"</span>, sum_result)

<span style="color: #ff8700;">first_result</span> = s.groupby(s.index).first()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21482;&#21462;&#31532;&#19968;&#39033;</span>
log(<span style="color: #ff4ea3;">"first_result"</span>, first_result)

<span style="color: #ff8700;">avg_result</span> = s.groupby(s.index).mean()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21462;&#24179;&#22343;&#20540;</span>
log(<span style="color: #ff4ea3;">"avg_result"</span>, avg_result)
</pre>
</div>

<pre class="example">
================================== sum_result ==================================
a    5
b    4
c    2
d    4
dtype: int64
================================= first_result =================================
a    0
b    1
c    2
d    4
dtype: int64
================================== avg_result ==================================
a    2.5
b    2.0
c    2.0
d    4.0
dtype: float64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 多级索引</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<b>用二维的数据表达更高维度的数据</b> ，使数据组织方式更清晰，它使用 <code>pd.MultiIndex</code> 类来表示。
</p>
</div>

<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> 层次化索引的作用</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
比如在分析股票数据：
</p>
<ul class="org-ul">
<li>一级行索引可以是日期
</li>
<li>二级行索引可以是股票代码
</li>
<li>列索引可以是股票的交易量，开盘价，收盘价等等
</li>
</ul>

<p>
这样就可以把多个股票放在同一个时间维度下进行考察和分析。
</p>
</div>
</div>


<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Series 多级索引</h4>
<div class="outline-text-4" id="text-3-4-2">
</div><div id="outline-container-sec-3-4-2-1" class="outline-5">
<h5 id="sec-3-4-2-1"><span class="section-number-5">3.4.2.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">a</span> = [[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'c'</span>], [1, 2, 3, 1, 2, 2, 3]]
<span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*a))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
log(<span style="color: #ff4ea3;">"index"</span>, index)
<span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(7), index=index)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
log(<span style="color: #ff4ea3;">"s.index.levels[1]"</span>, s.index.levels[1])
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('a', 1), ('a', 2), ('a', 3), ('b', 1), ('b', 2), ('c', 2), ('c', 3)]
==================================== index =====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
====================================== s =======================================
first  second
a      1         0.758290
       2        -0.865279
       3        -1.562862
b      1        -2.601903
       2        -1.056644
c      2         0.326449
       3         1.804274
dtype: float64
=================================== s.index ====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
============================== s.index.levels[1] ===============================
Int64Index([1, 2, 3], dtype='int64', name='second')
</pre>
</div>
</div>

<div id="outline-container-sec-3-4-2-2" class="outline-5">
<h5 id="sec-3-4-2-2"><span class="section-number-5">3.4.2.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['b']"</span>, s[<span style="color: #ff4ea3;">'b'</span>])
log(<span style="color: #ff4ea3;">"s['b':'c']"</span>, s[<span style="color: #ff4ea3;">'b'</span>:<span style="color: #ff4ea3;">'c'</span>])
log(<span style="color: #ff4ea3;">"s[['b', 'a']]"</span>, s[[<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]])
log(<span style="color: #ff4ea3;">"s['b', 1]"</span>, s[<span style="color: #ff4ea3;">'b'</span>, 1])
log(<span style="color: #ff4ea3;">"s[:, 2]"</span>, s[:, 2])
</pre>
</div>

<pre class="example">
==================================== s['b'] ====================================
second
1   -2.601903
2   -1.056644
dtype: float64
================================== s['b':'c'] ==================================
first  second
b      1        -2.601903
       2        -1.056644
c      2         0.326449
       3         1.804274
dtype: float64
================================ s[['b', 'a']] =================================
first  second
a      1         0.758290
       2        -0.865279
       3        -1.562862
b      1        -2.601903
       2        -1.056644
dtype: float64
================================== s['b', 1] ===================================
-2.601903093230948
=================================== s[:, 2] ====================================
first
a   -0.865279
b   -1.056644
c    0.326449
dtype: float64
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> DataFrame 多级索引</h4>
<div class="outline-text-4" id="text-3-4-3">
</div><div id="outline-container-sec-3-4-3-1" class="outline-5">
<h5 id="sec-3-4-3-1"><span class="section-number-5">3.4.3.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">1-10 &#20043;&#38388;&#30340;&#38543;&#26426;&#25968;&#65292;4 &#34892; 3 &#21015;</span>
                  index=[[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>], [1, 2, 1, 2]],
                  columns=[[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], [<span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'blue'</span>]])
<span style="color: #ff8700;">df.index.names</span> = [<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>]
<span style="color: #ff8700;">df.columns.names</span> = [<span style="color: #ff4ea3;">'col-1'</span>, <span style="color: #ff4ea3;">'col-2'</span>]
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428gsV.png" alt="fig75428gsV.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3-2" class="outline-5">
<h5 id="sec-3-4-3-2"><span class="section-number-5">3.4.3.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-3-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.loc[<span style="color: #ff4ea3;">'a'</span>])
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286Ai.png" alt="fig754286Ai.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['a', 1]"</span>, df.loc[<span style="color: #ff4ea3;">'a'</span>, 1])
</pre>
</div>

<pre class="example">
================================ df.loc['a', 1] ================================
col-1  col-2
one    blue     5
       red      4
two    blue     7
Name: (a, 1), dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-4-3-3" class="outline-5">
<h5 id="sec-3-4-3-3"><span class="section-number-5">3.4.3.3</span> 多级索引交换</h5>
<div class="outline-text-5" id="text-3-4-3-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.swaplevel(<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>)
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UVu.png" alt="fig75428UVu.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-4" class="outline-5">
<h5 id="sec-3-4-3-4"><span class="section-number-5">3.4.3.4</span> 多级索引排序</h5>
<div class="outline-text-5" id="text-3-4-3-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(0))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">0 &#34920;&#31034;&#26681;&#25454;&#19968;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428TpD.png" alt="fig75428TpD.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(1))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#26681;&#25454;&#20108;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428t9P.png" alt="fig75428t9P.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-5" class="outline-5">
<h5 id="sec-3-4-3-5"><span class="section-number-5">3.4.3.5</span> 多级索引统计</h5>
<div class="outline-text-5" id="text-3-4-3-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=0))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HSc.png" alt="fig75428HSc.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=1))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428hmo.png" alt="fig75428hmo.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-6" class="outline-5">
<h5 id="sec-3-4-3-6"><span class="section-number-5">3.4.3.6</span> 列与索引的转换</h5>
<div class="outline-text-5" id="text-3-4-3-6">
<p>
创建多级索引比较复杂，一般情况下会从文件中读取一个 DataFrame ，
然后将其中某个列转换为多级索引，最终得到一个基于多级索引的 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
    <span style="color: #ff4ea3;">'a'</span>: <span style="color: #d18aff;">range</span>(7),
    <span style="color: #ff4ea3;">'b'</span>: <span style="color: #d18aff;">range</span>(7, 0, -1),
    <span style="color: #ff4ea3;">'c'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>],
    <span style="color: #ff4ea3;">'d'</span>: [0, 1, 2, 0, 1, 2, 3]
})
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428760.png" alt="fig75428760.png">
</p>
</div>
</div>

<div id="outline-container-sec-3-4-3-6-1" class="outline-6">
<h6 id="sec-3-4-3-6-1"><span class="section-number-6">3.4.3.6.1</span> 列转换为索引</h6>
<div class="outline-text-6" id="text-3-4-3-6-1">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.set_index(<span style="color: #ff4ea3;">'c'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286OK.png" alt="fig754286OK.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.set_index([<span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UjW.png" alt="fig75428UjW.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-6-2" class="outline-6">
<h6 id="sec-3-4-3-6-2"><span class="section-number-6">3.4.3.6.2</span> 还原</h6>
<div class="outline-text-6" id="text-3-4-3-6-2">
<p>
对由列转换成的多级索引 DataFrame 进行还原
</p>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.reset_index().sort_index(<span style="color: #ff4ea3;">'columns'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428u3i.png" alt="fig75428u3i.png">
</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 分组与聚合</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5)})

show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428IMv.png" alt="fig75428IMv.png">
</p>
</div>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 原理</h3>
<div class="outline-text-3" id="text-4-1">
<p>
三步曲：
</p>

<ol class="org-ol">
<li>拆分：根据什么进行分组
</li>
<li>应用：每个分组进行什么样的计算（每个组应用一个 <b>计算规则</b> ，输出一个结果）
</li>
<li>聚合：把每个分组的计算结果合并起来，构成最终输出
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> 分组</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> 对 Series 进行分组</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
通过索引对齐关联起来
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df[<span style="color: #ff4ea3;">'data1'</span>].groupby(df[<span style="color: #ff4ea3;">'key1'</span>])
log(<span style="color: #ff4ea3;">"grouped"</span>, grouped)         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">groupby &#23545;&#35937;</span>
log(<span style="color: #ff4ea3;">"grouped.mean()"</span>, grouped.mean())
<span style="color: #ff8700;">key</span> = [1, 2, 1, 2, 1]
log(<span style="color: #ff4ea3;">"df['data1'].groupby(key)"</span>, df[<span style="color: #ff4ea3;">'data1'</span>].groupby(key))
</pre>
</div>

<pre class="example">
=================================== grouped ====================================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x108b6cef0&gt;
================================ grouped.mean() ================================
key1
a    4
b    1
Name: data1, dtype: int64
=========================== df['data1'].groupby(key) ===========================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x108b6c908&gt;
</pre>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).mean()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).mean())
log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).size()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).size())
</pre>
</div>

<pre class="example">
============= df['data1'].groupby([df['key1'], df['key2']]).mean() =============
key1  key2
a     one     5
      two     2
b     one     1
      two     1
Name: data1, dtype: int64
============= df['data1'].groupby([df['key1'], df['key2']]).size() =============
key1  key2
a     one     2
      two     1
b     one     1
      two     1
Name: data1, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> 对 DataFrame 进行分组（默认按行分组）</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HgE.png" alt="fig75428HgE.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]).mean()
show_dataframe(df1)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428h0Q.png" alt="fig75428h0Q.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> 对分组对象进行迭代</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby(<span style="color: #ff4ea3;">'key1'</span>):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">'='</span>*80)

<span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)
</pre>
</div>

<pre class="example">
a
   data1  data2 key1 key2
0      2      6    a  one
1      2      3    a  two
4      8      4    a  one
b
   data1  data2 key1 key2
2      1      5    b  one
3      1      7    b  two
================================================================================
('a', 'one')
   data1  data2 key1 key2
0      2      6    a  one
4      8      4    a  one
('a', 'two')
   data1  data2 key1 key2
1      2      3    a  two
('b', 'one')
   data1  data2 key1 key2
2      1      5    b  one
('b', 'two')
   data1  data2 key1 key2
3      1      7    b  two
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> 通过字典进行分组</h4>
<div class="outline-text-4" id="text-4-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
<span style="color: #ff8700;">df.iloc</span>[1, 1:3] = np.NaN
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig754287Id.png" alt="fig754287Id.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mapping</span> = {<span style="color: #ff4ea3;">'a'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'b'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'c'</span>: <span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'d'</span>: <span style="color: #ff4ea3;">'orange'</span>, <span style="color: #ff4ea3;">'e'</span>: <span style="color: #ff4ea3;">'blue'</span>}
<span style="color: #ff8700;">grouped</span> = df.groupby(mapping, axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25353;&#21015;&#20998;&#32452;</span>
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428Vdp.png" alt="fig75428Vdp.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428uFL.png" alt="fig75428uFL.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"grouped.size()"</span>, grouped.size())
</pre>
</div>

<pre class="example">
================================ grouped.size() ================================
blue      2
orange    1
red       2
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-5" class="outline-4">
<h4 id="sec-4-2-5"><span class="section-number-4">4.2.5</span> 通过函数分组</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
当函数作为分组依据时，数据表里的每个索引（可以是行索引，也可以是列索引）都会调用一次函数，
<b>函数的返回值作为分组的索引</b> ，即相同的返回值分在同一组。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
show_dataframe(df)
</pre>
</div>


<div id="img/fig75428iuj.png" class="figure">
<p><img src="img/fig75428iuj.png" alt="fig75428iuj.png">
</p>
<p><span class="figure-number">Figure 18:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">_dummy_group</span>(idx):
    <span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"idx:"</span>, idx)
    <span style="color: #a1db00;">return</span> idx

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=0"</span>)
df.groupby(_dummy_group)
<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=1"</span>)
df.groupby(_dummy_group, axis=1)
</pre>
</div>

<pre class="example">
axis=0
idx: Alice
idx: Bob
idx: Candy
idx: Dark
idx: Emily
axis=1
idx: a
idx: b
idx: c
idx: d
idx: e
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df.groupby(<span style="color: #d18aff;">len</span>)
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig754288Cw.png" alt="fig754288Cw.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-6" class="outline-4">
<h4 id="sec-4-2-6"><span class="section-number-4">4.2.6</span> 多级索引数据根据索引级别来分组</h4>
<div class="outline-text-4" id="text-4-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">columns</span> = pd.MultiIndex.from_arrays([[<span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>],
                                     [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'B'</span>]], names=[<span style="color: #ff4ea3;">'country'</span>, <span style="color: #ff4ea3;">'index'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)), columns=columns)
show_dataframe(df)
</pre>
</div>


<div id="img/fig754287WF.png" class="figure">
<p><img src="img/fig754287WF.png" alt="fig754287WF.png">
</p>
<p><span class="figure-number">Figure 20:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428VrR.png" alt="fig75428VrR.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig3702047R.png" alt="fig3702047R.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'index'</span>, axis=1).count())
</pre>
</div>



<div class="figure">
<p><img src="img/fig37020FNM.png" alt="fig37020FNM.png">
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 聚合</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> 内置聚合函数</h4>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 处理丢失数据</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
<span style="color: #ff8700;">df1</span> = df.reindex(index=dates[0:4], columns=<span style="color: #d18aff;">list</span>(df.columns) + [<span style="color: #ff4ea3;">'E'</span>])
df1.loc[dates[1:3], <span style="color: #ff4ea3;">'E'</span>] = 1
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
                   A         B         C         D    E
2016-03-01 -0.093077  1.870081 -0.409968 -0.657787  NaN
2016-03-02 -0.345385 -0.161873 -0.423914 -1.809966  1.0
2016-03-03  0.921678  0.121892 -0.056392  0.036858  1.0
2016-03-04  0.407140 -0.010656 -0.525897  0.156160  NaN
</pre>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 丢弃 NaN 行</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.dropna(how='any')"</span>, df1.dropna(how=<span style="color: #ff4ea3;">'any'</span>))
</pre>
</div>

<pre class="example">
============================ df1.dropna(how='any') =============================
                   A         B         C         D    E
2016-03-02 -0.345385 -0.161873 -0.423914 -1.809966  1.0
2016-03-03  0.921678  0.121892 -0.056392  0.036858  1.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 用默认值替换 NaN</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.fillna(value=5)"</span>, df1.fillna(value=5))
</pre>
</div>

<pre class="example">
============================= df1.fillna(value=5) ==============================
                   A         B         C         D    E
2016-03-01 -0.093077  1.870081 -0.409968 -0.657787  5.0
2016-03-02 -0.345385 -0.161873 -0.423914 -1.809966  1.0
2016-03-03  0.921678  0.121892 -0.056392  0.036858  1.0
2016-03-04  0.407140 -0.010656 -0.525897  0.156160  5.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 判断数据集是否包含 NaN</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.isnull(df1)"</span>, pd.isnull(df1))
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>())
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any().any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>().<span style="color: #d18aff;">any</span>())
</pre>
</div>

<pre class="example">
================================ pd.isnull(df1) ================================
                A      B      C      D      E
2016-03-01  False  False  False  False   True
2016-03-02  False  False  False  False  False
2016-03-03  False  False  False  False  False
2016-03-04  False  False  False  False   True
============================= pd.isnull(df1).any() =============================
A    False
B    False
C    False
D    False
E     True
dtype: bool
========================== pd.isnull(df1).any().any() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> NaN 不参与运算</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.mean()"</span>, df1.mean())
log(<span style="color: #ff4ea3;">"df1.mean(axis=1)"</span>, df1.mean(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.mean() ==================================
A    0.222589
B    0.454861
C   -0.354043
D   -0.568684
E    1.000000
dtype: float64
=============================== df1.mean(axis=1) ===============================
2016-03-01    0.177312
2016-03-02   -0.348228
2016-03-03    0.404807
2016-03-04    0.006687
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.sum()"</span>, df1.<span style="color: #d18aff;">sum</span>())
log(<span style="color: #ff4ea3;">"df1.sum(axis=1)"</span>, df1.<span style="color: #d18aff;">sum</span>(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.sum() ===================================
A    0.890356
B    1.819444
C   -1.416170
D   -2.274735
E    2.000000
dtype: float64
=============================== df1.sum(axis=1) ================================
2016-03-01    0.709249
2016-03-02   -1.741138
2016-03-03    2.024036
2016-03-04    0.026747
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.sub(s, axis='index')"</span>, df.sub(s, axis=<span style="color: #ff4ea3;">'index'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
2016-03-01    NaN
2016-03-02    NaN
2016-03-03    1.0
2016-03-04    3.0
2016-03-05    5.0
2016-03-06    NaN
Freq: D, dtype: float64
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.093077  1.870081 -0.409968 -0.657787
2016-03-02 -0.345385 -0.161873 -0.423914 -1.809966
2016-03-03  0.921678  0.121892 -0.056392  0.036858
2016-03-04  0.407140 -0.010656 -0.525897  0.156160
2016-03-05  0.229296  0.317213  0.665290  1.683428
2016-03-06  0.507856 -0.205005  0.080257  1.768697
=========================== df.sub(s, axis='index') ============================
                   A         B         C         D
2016-03-01       NaN       NaN       NaN       NaN
2016-03-02       NaN       NaN       NaN       NaN
2016-03-03 -0.078322 -0.878108 -1.056392 -0.963142
2016-03-04 -2.592860 -3.010656 -3.525897 -2.843840
2016-03-05 -4.770704 -4.682787 -4.334710 -3.316572
2016-03-06       NaN       NaN       NaN       NaN
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 数据操作</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D
2016-03-01  1.153555  1.750806  0.447012 -0.287572
2016-03-02 -0.443423  1.421655 -1.023789 -1.711661
2016-03-03 -0.766553  1.923222  0.437075  1.215685
2016-03-04  1.221327  1.311144  0.458728 -1.232267
2016-03-05 -1.051140  0.894948  0.391266  1.599848
2016-03-06 -0.493149  1.068869 -2.060463 -0.335649
</pre>
</div>



<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> concat</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
          A         B         C         D
0 -0.266461  1.164489 -1.582549  1.295440
1 -2.209038 -0.389963 -0.346049  1.143434
2 -0.615208  0.083483  1.035430 -1.539420
3 -0.036610 -1.581714  0.504854 -0.482127
4  0.078280 -1.076219 -0.033553  0.342548
5 -0.540673  1.510377  0.472736 -0.208705
6  0.139326 -0.170274  0.936355 -0.864270
7 -0.446486  0.825098 -0.206565  0.755726
8 -0.069612 -0.354626 -0.671166  0.336131
9 -1.466674  0.702408  1.102627  0.135458
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.concat([df.iloc[:3], df.iloc[3:7], df.iloc[7:]])
log(<span style="color: #ff4ea3;">"result"</span>, result)
log(<span style="color: #ff4ea3;">"(result == df).all().all()"</span>, (result == df).<span style="color: #d18aff;">all</span>().<span style="color: #d18aff;">all</span>())
</pre>
</div>

<pre class="example">
==================================== result ====================================
          A         B         C         D
0 -0.266461  1.164489 -1.582549  1.295440
1 -2.209038 -0.389963 -0.346049  1.143434
2 -0.615208  0.083483  1.035430 -1.539420
3 -0.036610 -1.581714  0.504854 -0.482127
4  0.078280 -1.076219 -0.033553  0.342548
5 -0.540673  1.510377  0.472736 -0.208705
6  0.139326 -0.170274  0.936355 -0.864270
7 -0.446486  0.825098 -0.206565  0.755726
8 -0.069612 -0.354626 -0.671166  0.336131
9 -1.466674  0.702408  1.102627  0.135458
========================== (result == df).all().all() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> merge</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">left</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'lval'</span>: [1, 2]})
<span style="color: #ff8700;">right</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'rval'</span>: [4, 5]})
log(<span style="color: #ff4ea3;">"left"</span>, left)
log(<span style="color: #ff4ea3;">"right"</span>, right)

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">SELECT * FROM left INNER JOIN right ON left.key = right.key;</span>
<span style="color: #ff8700;">result</span> = pd.merge(left, right, on=<span style="color: #ff4ea3;">'key'</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
===================================== left =====================================
   key  lval
0  foo     1
1  foo     2
==================================== right =====================================
   key  rval
0  foo     4
1  foo     5
==================================== result ====================================
   key  lval  rval
0  foo     1     4
1  foo     1     5
2  foo     2     4
3  foo     2     5
</pre>
</div>
</div>


<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> append</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randint(1, 5, size=4), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
<span style="color: #ff8700;">result</span> = df.append(s, ignore_index=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A    4
B    2
C    2
D    1
dtype: int64
==================================== result ====================================
           A         B         C         D
0  -0.266461  1.164489 -1.582549  1.295440
1  -2.209038 -0.389963 -0.346049  1.143434
2  -0.615208  0.083483  1.035430 -1.539420
3  -0.036610 -1.581714  0.504854 -0.482127
4   0.078280 -1.076219 -0.033553  0.342548
5  -0.540673  1.510377  0.472736 -0.208705
6   0.139326 -0.170274  0.936355 -0.864270
7  -0.446486  0.825098 -0.206565  0.755726
8  -0.069612 -0.354626 -0.671166  0.336131
9  -1.466674  0.702408  1.102627  0.135458
10  4.000000  2.000000  2.000000  1.000000
</pre>
</div>
</div>


<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> 数据整形</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*[[<span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'baz'</span>, <span style="color: #ff4ea3;">'baz'</span>,
                     <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'qux'</span>, <span style="color: #ff4ea3;">'qux'</span>],
                    [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>,
                     <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]]))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(8, 2), index=index, columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('bar', 'one'), ('bar', 'two'), ('baz', 'one'), ('baz', 'two'), ('foo', 'one'), ('foo', 'two'), ('qux', 'one'), ('qux', 'two')]
====================================== df ======================================
                     A         B
first second
bar   one    -0.954336 -0.900160
      two    -0.131002 -0.978076
baz   one    -0.875696 -0.660428
      two    -0.401764  0.098776
foo   one    -1.154651 -1.014351
      two    -0.689543 -0.685735
qux   one     1.241447  0.274274
      two    -1.140024 -0.715745
</pre>
</div>

<div id="outline-container-sec-6-4-1" class="outline-4">
<h4 id="sec-6-4-1"><span class="section-number-4">6.4.1</span> 将列索引变为行索引 (stack)</h4>
<div class="outline-text-4" id="text-6-4-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">stacked</span> = df.stack()
log(<span style="color: #ff4ea3;">"stacked"</span>, stacked)
log(<span style="color: #ff4ea3;">"type(stacked)"</span>, <span style="color: #d18aff;">type</span>(stacked))
log(<span style="color: #ff4ea3;">"stacked.index"</span>, stacked.index)
</pre>
</div>

<pre class="example">
=================================== stacked ====================================
first  second
bar    one     A   -0.954336
               B   -0.900160
       two     A   -0.131002
               B   -0.978076
baz    one     A   -0.875696
               B   -0.660428
       two     A   -0.401764
               B    0.098776
foo    one     A   -1.154651
               B   -1.014351
       two     A   -0.689543
               B   -0.685735
qux    one     A    1.241447
               B    0.274274
       two     A   -1.140024
               B   -0.715745
dtype: float64
================================ type(stacked) =================================
&lt;class 'pandas.core.series.Series'&gt;
================================ stacked.index =================================
MultiIndex(levels=[['bar', 'baz', 'foo', 'qux'], ['one', 'two'], ['A', 'B']],
           labels=[[0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3], [0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1], [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1]],
           names=['first', 'second', None])
</pre>
</div>
</div>

<div id="outline-container-sec-6-4-2" class="outline-4">
<h4 id="sec-6-4-2"><span class="section-number-4">6.4.2</span> 将行索引变为列索引 (unstack)</h4>
<div class="outline-text-4" id="text-6-4-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"stacked.unstack()"</span>, stacked.unstack())
</pre>
</div>

<pre class="example">
============================== stacked.unstack() ===============================
                     A         B
first second
bar   one    -0.954336 -0.900160
      two    -0.131002 -0.978076
baz   one    -0.875696 -0.660428
      two    -0.401764  0.098776
foo   one    -1.154651 -1.014351
      two    -0.689543 -0.685735
qux   one     1.241447  0.274274
      two    -1.140024 -0.715745
</pre>
</div>
</div>

<div id="outline-container-sec-6-4-3" class="outline-4">
<h4 id="sec-6-4-3"><span class="section-number-4">6.4.3</span> 透视图（pivot_table）</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
只观察 data frame 中一部分数据
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>] * 3,
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>] * 4,
                   <span style="color: #ff4ea3;">'C'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>] * 2,
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(12),
                   <span style="color: #ff4ea3;">'E'</span> : np.random.randn(12)})

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        A  B    C         D         E
0     one  A  foo -1.199372 -0.386112
1     one  B  foo  0.226544 -2.059246
2     two  C  foo -0.033508 -1.259000
3   three  A  bar  0.658301  0.134531
4     one  B  bar -0.772378  1.248873
5     one  C  bar  0.270118 -0.838241
6     two  A  foo -1.511257  2.722535
7   three  B  foo  1.464360  0.218997
8     one  C  foo -1.646264  0.212017
9     one  A  bar -0.076471  0.051008
10    two  B  bar  0.177284 -1.281281
11  three  C  bar  0.297080 -0.748234
</pre>

<p>
以 A ，B 为行索引，以 C 为列索引的，针对 D 的数据：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=<span style="color: #ff4ea3;">'D'</span>, index=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
C             bar       foo
A     B
one   A -0.076471 -1.199372
      B -0.772378  0.226544
      C  0.270118 -1.646264
three A  0.658301       NaN
      B       NaN  1.464360
      C  0.297080       NaN
two   A       NaN -1.511257
      B  0.177284       NaN
      C       NaN -0.033508
</pre>

<p>
<b>当透视表结果为多个值的时候，返回平均值</b> ，如：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=[<span style="color: #ff4ea3;">'E'</span>], index=[<span style="color: #ff4ea3;">'A'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
              E
C           bar       foo
A
one    0.153880 -0.744447
three -0.306852  0.218997
two   -1.281281  0.731768
</pre>

<p>
针对 A 为 one 的那行数据，其计算过程相当于：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df[df.A==<span style="color: #ff4ea3;">'one'</span>].groupby(<span style="color: #ff4ea3;">'C'</span>).mean()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            D         E
C
bar -0.192910  0.153880
foo -0.873031 -0.744447
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Category</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">"id"</span>:[1,2,3,4,5,6], <span style="color: #ff4ea3;">"raw_grade"</span>:[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'e'</span>]})
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">"grade"</span>] = df[<span style="color: #ff4ea3;">"raw_grade"</span>].astype(<span style="color: #ff4ea3;">"category"</span>)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   id raw_grade grade
0   1         a     a
1   2         b     b
2   3         b     b
3   4         a     a
4   5         a     a
5   6         e     e
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.grade"</span>, df.grade)
log(<span style="color: #ff4ea3;">"df.grade.cat.categories"</span>, df.grade.cat.categories)
<span style="color: #ff8700;">df.grade.cat.categories</span> = [<span style="color: #ff4ea3;">'very good'</span>, <span style="color: #ff4ea3;">'good'</span>, <span style="color: #ff4ea3;">'bad'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#20197; raw_grade &#21015;&#20026;&#25490;&#24207;&#26631;&#20934;</span>
<span style="color: #ff8700;">sort_result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'grade'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"sort_result"</span>, sort_result)
</pre>
</div>

<pre class="example">
=================================== df.grade ===================================
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): [a, b, e]
=========================== df.grade.cat.categories ============================
Index(['a', 'b', 'e'], dtype='object')
====================================== df ======================================
   id raw_grade      grade
0   1         a  very good
1   2         b       good
2   3         b       good
3   4         a  very good
4   5         a  very good
5   6         e        bad
================================= sort_result ==================================
   id raw_grade      grade
5   6         e        bad
2   3         b       good
1   2         b       good
4   5         a  very good
3   4         a  very good
0   1         a  very good
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 信息统计</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> describe</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.describe()"</span>, df.describe())
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D
2016-03-01  0.249757 -0.978374  0.938289 -0.340298
2016-03-02  0.283741 -0.581382 -1.098484  0.202739
2016-03-03 -0.227064 -0.120887  0.035744 -0.060693
2016-03-04  0.076817 -0.335404  1.512107  0.028302
2016-03-05 -1.251399  0.384340  1.450958  0.311114
2016-03-06 -1.293271  0.162168 -1.092828 -1.962299
================================ df.describe() =================================
              A         B         C         D
count  6.000000  6.000000  6.000000  6.000000
mean  -0.360236 -0.244923  0.290964 -0.303523
std    0.729421  0.497277  1.197196  0.843332
min   -1.293271 -0.978374 -1.098484 -1.962299
25%   -0.995315 -0.519888 -0.810685 -0.270397
50%   -0.075123 -0.228145  0.487017 -0.016196
75%    0.206522  0.091404  1.322791  0.159129
max    0.283741  0.384340  1.512107  0.311114
</pre>
</div>
</div>


<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> mode</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.mode()"</span>, s.mode())
</pre>
</div>

<pre class="example">
=================================== s.mode() ===================================
0    2
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 分组统计</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>,
                          <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>],
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>,
                          <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>],
                   <span style="color: #ff4ea3;">'C'</span> : np.random.randn(8),
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(8)})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
     A      B         C         D
0  foo    one  0.948221 -0.430246
1  bar    one  1.157785  0.991178
2  foo    two  0.525356 -0.161460
3  bar  three  0.145023 -1.198971
4  foo    two -0.337490 -0.665220
5  bar    two  0.469535  0.637698
6  foo    one -0.001468 -1.330623
7  foo  three -0.280363  0.995256
</pre>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 对单列分组</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby(<span style="color: #ff4ea3;">'A'</span>).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            C         D
A
bar  1.772343  0.429905
foo  0.854256 -1.592293
</pre>
</div>
</div>


<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 对多列分组</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
A   B
bar one    1.157785  0.991178
    three  0.145023 -1.198971
    two    0.469535  0.637698
foo one    0.946753 -1.760869
    three -0.280363  0.995256
    two    0.187866 -0.826680
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'A'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
B     A
one   bar  1.157785  0.991178
      foo  0.946753 -1.760869
three bar  0.145023 -1.198971
      foo -0.280363  0.995256
two   bar  0.469535  0.637698
      foo  0.187866 -0.826680
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 时间序列</h2>
<div class="outline-text-2" id="text-9">
<p>
pandas 提供了强大的时间序列功能，比如把秒级的股票数据转换为 5 分钟周期数据等。
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> data_range</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=600, freq=<span style="color: #ff4ea3;">'s'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
<span style="color: #ff8700;">ts</span> = pd.Series(np.random.randint(0, 500, <span style="color: #d18aff;">len</span>(rng)), index=rng)
log(<span style="color: #ff4ea3;">"ts"</span>, ts)
</pre>
</div>

<pre class="example">
===================================== rng ======================================
DatetimeIndex(['2016-03-01 00:00:00', '2016-03-01 00:00:01',
               '2016-03-01 00:00:02', '2016-03-01 00:00:03',
               '2016-03-01 00:00:04', '2016-03-01 00:00:05',
               '2016-03-01 00:00:06', '2016-03-01 00:00:07',
               '2016-03-01 00:00:08', '2016-03-01 00:00:09',
               ...
               '2016-03-01 00:09:50', '2016-03-01 00:09:51',
               '2016-03-01 00:09:52', '2016-03-01 00:09:53',
               '2016-03-01 00:09:54', '2016-03-01 00:09:55',
               '2016-03-01 00:09:56', '2016-03-01 00:09:57',
               '2016-03-01 00:09:58', '2016-03-01 00:09:59'],
              dtype='datetime64[ns]', length=600, freq='S')
====================================== ts ======================================
2016-03-01 00:00:00     17
2016-03-01 00:00:01    395
2016-03-01 00:00:02      8
2016-03-01 00:00:03    425
2016-03-01 00:00:04    437
2016-03-01 00:00:05    373
2016-03-01 00:00:06    177
2016-03-01 00:00:07     20
2016-03-01 00:00:08    489
2016-03-01 00:00:09     49
2016-03-01 00:00:10    492
2016-03-01 00:00:11    367
2016-03-01 00:00:12    182
2016-03-01 00:00:13    100
2016-03-01 00:00:14    361
2016-03-01 00:00:15    272
2016-03-01 00:00:16    343
2016-03-01 00:00:17    386
2016-03-01 00:00:18    327
2016-03-01 00:00:19    477
2016-03-01 00:00:20    283
2016-03-01 00:00:21    283
2016-03-01 00:00:22     73
2016-03-01 00:00:23    487
2016-03-01 00:00:24    366
2016-03-01 00:00:25    450
2016-03-01 00:00:26    129
2016-03-01 00:00:27    454
2016-03-01 00:00:28    201
2016-03-01 00:00:29    300
                      ...
2016-03-01 00:09:30     89
2016-03-01 00:09:31    144
2016-03-01 00:09:32    442
2016-03-01 00:09:33    215
2016-03-01 00:09:34    371
2016-03-01 00:09:35    375
2016-03-01 00:09:36    148
2016-03-01 00:09:37    210
2016-03-01 00:09:38    299
2016-03-01 00:09:39    416
2016-03-01 00:09:40     91
2016-03-01 00:09:41    133
2016-03-01 00:09:42     89
2016-03-01 00:09:43     33
2016-03-01 00:09:44     18
2016-03-01 00:09:45    181
2016-03-01 00:09:46    135
2016-03-01 00:09:47    437
2016-03-01 00:09:48    340
2016-03-01 00:09:49    114
2016-03-01 00:09:50    155
2016-03-01 00:09:51    461
2016-03-01 00:09:52    289
2016-03-01 00:09:53    400
2016-03-01 00:09:54    233
2016-03-01 00:09:55    273
2016-03-01 00:09:56    464
2016-03-01 00:09:57    355
2016-03-01 00:09:58    359
2016-03-01 00:09:59    200
Freq: S, Length: 600, dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 重采样</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result_sum</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'sum'</span>)
log(<span style="color: #ff4ea3;">"result_sum"</span>, result_sum)
<span style="color: #ff8700;">result_mean</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"result_mean"</span>, result_mean)
</pre>
</div>

<pre class="example">
================================== result_sum ==================================
2016-03-01 00:00:00    31528
2016-03-01 00:02:00    25669
2016-03-01 00:04:00    28460
2016-03-01 00:06:00    31335
2016-03-01 00:08:00    30955
Freq: 2T, dtype: int64
================================= result_mean ==================================
2016-03-01 00:00:00    262.733333
2016-03-01 00:02:00    213.908333
2016-03-01 00:04:00    237.166667
2016-03-01 00:06:00    261.125000
2016-03-01 00:08:00    257.958333
Freq: 2T, dtype: float64
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).sum()
  """Entry point for launching an IPython kernel.
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:3: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  This is separate from the ipykernel package so we can avoid doing imports until
</pre>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> period_range</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.period_range(<span style="color: #ff4ea3;">'2000Q1'</span>, <span style="color: #ff4ea3;">'2016Q1'</span>, freq=<span style="color: #ff4ea3;">'Q'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
log(<span style="color: #ff4ea3;">"rng.to_timestamp()"</span>, rng.to_timestamp())
</pre>
</div>

<pre class="example">
===================================== rng ======================================
PeriodIndex(['2000Q1', '2000Q2', '2000Q3', '2000Q4', '2001Q1', '2001Q2',
             '2001Q3', '2001Q4', '2002Q1', '2002Q2', '2002Q3', '2002Q4',
             '2003Q1', '2003Q2', '2003Q3', '2003Q4', '2004Q1', '2004Q2',
             '2004Q3', '2004Q4', '2005Q1', '2005Q2', '2005Q3', '2005Q4',
             '2006Q1', '2006Q2', '2006Q3', '2006Q4', '2007Q1', '2007Q2',
             '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3', '2008Q4',
             '2009Q1', '2009Q2', '2009Q3', '2009Q4', '2010Q1', '2010Q2',
             '2010Q3', '2010Q4', '2011Q1', '2011Q2', '2011Q3', '2011Q4',
             '2012Q1', '2012Q2', '2012Q3', '2012Q4', '2013Q1', '2013Q2',
             '2013Q3', '2013Q4', '2014Q1', '2014Q2', '2014Q3', '2014Q4',
             '2015Q1', '2015Q2', '2015Q3', '2015Q4', '2016Q1'],
            dtype='period[Q-DEC]', freq='Q-DEC')
============================== rng.to_timestamp() ==============================
DatetimeIndex(['2000-01-01', '2000-04-01', '2000-07-01', '2000-10-01',
               '2001-01-01', '2001-04-01', '2001-07-01', '2001-10-01',
               '2002-01-01', '2002-04-01', '2002-07-01', '2002-10-01',
               '2003-01-01', '2003-04-01', '2003-07-01', '2003-10-01',
               '2004-01-01', '2004-04-01', '2004-07-01', '2004-10-01',
               '2005-01-01', '2005-04-01', '2005-07-01', '2005-10-01',
               '2006-01-01', '2006-04-01', '2006-07-01', '2006-10-01',
               '2007-01-01', '2007-04-01', '2007-07-01', '2007-10-01',
               '2008-01-01', '2008-04-01', '2008-07-01', '2008-10-01',
               '2009-01-01', '2009-04-01', '2009-07-01', '2009-10-01',
               '2010-01-01', '2010-04-01', '2010-07-01', '2010-10-01',
               '2011-01-01', '2011-04-01', '2011-07-01', '2011-10-01',
               '2012-01-01', '2012-04-01', '2012-07-01', '2012-10-01',
               '2013-01-01', '2013-04-01', '2013-07-01', '2013-10-01',
               '2014-01-01', '2014-04-01', '2014-07-01', '2014-10-01',
               '2015-01-01', '2015-04-01', '2015-07-01', '2015-10-01',
               '2016-01-01'],
              dtype='datetime64[ns]', freq='QS-OCT')
</pre>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> 时间计算</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') - pd.Timestamp('20160201')"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) - pd.Timestamp(<span style="color: #ff4ea3;">'20160201'</span>))
log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') + pd.Timedelta(days=5)"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) + pd.Timedelta(days=5))
</pre>
</div>

<pre class="example">
============= pd.Timestamp('20160301') - pd.Timestamp('20160201') ==============
29 days 00:00:00
=============== pd.Timestamp('20160301') + pd.Timedelta(days=5) ================
2016-03-06 00:00:00
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 可视化</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Series</h3>
<div class="outline-text-3" id="text-10-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ts</span> = pd.Series(np.random.randn(1000), index=pd.date_range(<span style="color: #ff4ea3;">'20000101'</span>, periods=1000))
<span style="color: #ff8700;">ts</span> = ts.cumsum()
show_fig(ts)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HE0.png" alt="fig75428HE0.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 导入导出</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> 导出 csv</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(100, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
df.to_csv(<span style="color: #ff4ea3;">"/tmp/df.csv"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 导入 csv</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">

<pre class="src src-ipython">pd.read_csv(<span style="color: #ff4ea3;">'/tmp/df.csv'</span>, index_col=0)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> 示例工程</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> 电影数据分析</h3>
<div class="outline-text-3" id="text-12-1">
</div><div id="outline-container-sec-12-1-1" class="outline-4">
<h4 id="sec-12-1-1"><span class="section-number-4">12.1.1</span> 数据读取</h4>
<div class="outline-text-4" id="text-12-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">user_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'gender'</span>, <span style="color: #ff4ea3;">'age'</span>, <span style="color: #ff4ea3;">'occupation'</span>, <span style="color: #ff4ea3;">'zip'</span>]
<span style="color: #ff8700;">users</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/users.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=user_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">rating_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'rating'</span>, <span style="color: #ff4ea3;">'timestamp'</span>]
<span style="color: #ff8700;">ratings</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/ratings.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=rating_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">movie_names</span> = [<span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'title'</span>, <span style="color: #ff4ea3;">'genres'</span>]
<span style="color: #ff8700;">movies</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/movies.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=movie_names, engine=<span style="color: #ff4ea3;">'python'</span>)

log(<span style="color: #ff4ea3;">"users.head()"</span>, users.head())
log(<span style="color: #ff4ea3;">"ratings.head()"</span>, ratings.head())
log(<span style="color: #ff4ea3;">"movies.head()"</span>, movies.head())
</pre>
</div>

<pre class="example">
================================= users.head() =================================
   user_id gender  age  occupation    zip
0        1      F    1          10  48067
1        2      M   56          16  70072
2        3      M   25          15  55117
3        4      M   45           7  02460
4        5      M   25          20  55455
================================ ratings.head() ================================
   user_id  movie_id  rating  timestamp
0        1      1193       5  978300760
1        1       661       3  978302109
2        1       914       3  978301968
3        1      3408       4  978300275
4        1      2355       5  978824291
================================ movies.head() =================================
   movie_id                               title                        genres
0         1                    Toy Story (1995)   Animation|Children's|Comedy
1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
2         3             Grumpier Old Men (1995)                Comedy|Romance
3         4            Waiting to Exhale (1995)                  Comedy|Drama
4         5  Father of the Bride Part II (1995)                        Comedy
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-2" class="outline-4">
<h4 id="sec-12-1-2"><span class="section-number-4">12.1.2</span> 数据合并 (merge)</h4>
<div class="outline-text-4" id="text-12-1-2">
<p>
在 pandas 中，数据只有合并后才能进行分析
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = pd.merge(pd.merge(users, ratings), movies)
show_dataframe(data.head())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428GYJ.png" alt="fig75428GYJ.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-12-1-3" class="outline-4">
<h4 id="sec-12-1-3"><span class="section-number-4">12.1.3</span> 按性别查看各个电影的平均评分 (pivot_table)</h4>
<div class="outline-text-4" id="text-12-1-3">
<p>
<b>关心的值</b> 是 rating ，以 title 作为 <b>行索引</b> ，gender 作为 <b>列索引</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, columns=<span style="color: #ff4ea3;">'gender'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"mean_ratings_gender.head()"</span>, mean_ratings_gender.head())
</pre>
</div>

<pre class="example">
========================== mean_ratings_gender.head() ==========================
gender                                F         M
title
$1,000,000 Duck (1971)         3.375000  2.761905
'Night Mother (1986)           3.388889  3.352941
'Til There Was You (1997)      2.675676  2.733333
'burbs, The (1989)             2.793478  2.962085
...And Justice for All (1979)  3.828571  3.689024
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-4" class="outline-4">
<h4 id="sec-12-1-4"><span class="section-number-4">12.1.4</span> 男女意见想差最大的电影 (sort_values)</h4>
<div class="outline-text-4" id="text-12-1-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span>[<span style="color: #ff4ea3;">'diff'</span>] = mean_ratings_gender.F - mean_ratings_gender.M
<span style="color: #ff8700;">result</span> = mean_ratings_gender.sort_values(by=<span style="color: #ff4ea3;">'diff'</span>, ascending=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result.head()"</span>, result.head())
</pre>
</div>

<pre class="example">
================================ result.head() =================================
gender                                        F         M      diff
title
Tigrero: A Film That Was Never Made (1994)  1.0  4.333333 -3.333333
Neon Bible, The (1995)                      1.0  4.000000 -3.000000
Enfer, L' (1994)                            1.0  3.750000 -2.750000
Stalingrad (1993)                           1.0  3.593750 -2.593750
Killer: A Journal of Murder (1995)          1.0  3.428571 -2.428571
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-5" class="outline-4">
<h4 id="sec-12-1-5"><span class="section-number-4">12.1.5</span> 参与评分人数最多 (group_by)</h4>
<div class="outline-text-4" id="text-12-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ratings_by_movie_title</span> = data.groupby(<span style="color: #ff4ea3;">'title'</span>).size()
<span style="color: #ff8700;">top_ratings</span> = ratings_by_movie_title[ratings_by_movie_title &gt; 1000]
<span style="color: #ff8700;">top_10_ratings</span> = top_ratings.sort_values(ascending=<span style="color: #5fafd7;">False</span>).head()
log(<span style="color: #ff4ea3;">"top_10_ratings"</span>, top_10_ratings)
</pre>
</div>

<pre class="example">
================================ top_10_ratings ================================
title
American Beauty (1999)                                   3428
Star Wars: Episode IV - A New Hope (1977)                2991
Star Wars: Episode V - The Empire Strikes Back (1980)    2990
Star Wars: Episode VI - Return of the Jedi (1983)        2883
Jurassic Park (1993)                                     2672
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-12-1-6" class="outline-4">
<h4 id="sec-12-1-6"><span class="section-number-4">12.1.6</span> 活跃度超过 1000 的高分电影</h4>
<div class="outline-text-4" id="text-12-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
<span style="color: #ff8700;">top_10_movies</span> = mean_ratings.loc[top_ratings.index].sort_values(by=<span style="color: #ff4ea3;">'rating'</span>, ascending=<span style="color: #5fafd7;">False</span>).head(10)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25226;&#24179;&#22343;&#35780;&#20998;&#21644;&#28909;&#24230;&#32508;&#21512;&#36215;&#26469;</span>
<span style="color: #ff8700;">df_top_10_movies</span> = pd.DataFrame(top_10_movies)
<span style="color: #ff8700;">df_top_10_movies</span>[<span style="color: #ff4ea3;">'hot'</span>] = top_ratings.loc[top_10_movies.index]
log(<span style="color: #ff4ea3;">"df_top_10_movies"</span>, df_top_10_movies)
</pre>
</div>

<pre class="example">
=============================== df_top_10_movies ===============================
                                                      rating   hot
title
Shawshank Redemption, The (1994)                    4.554558  2227
Godfather, The (1972)                               4.524966  2223
Usual Suspects, The (1995)                          4.517106  1783
Schindler's List (1993)                             4.510417  2304
Raiders of the Lost Ark (1981)                      4.477725  2514
Rear Window (1954)                                  4.476190  1050
Star Wars: Episode IV - A New Hope (1977)           4.453694  2991
Dr. Strangelove or: How I Learned to Stop Worry...  4.449890  1367
Casablanca (1942)                                   4.412822  1669
Sixth Sense, The (1999)                             4.406263  2459
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>