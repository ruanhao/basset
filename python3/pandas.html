<!DOCTYPE html>
<html>
<head>
<title>Pandas</title>
<!-- 2018-02-20 Tue 16:22 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Panel</a></li>
<li><a href="#sec-1-2">1.2. Series</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从字典创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 特性</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 类字典对象</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. DataFrame</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. 创建</a>
<ul>
<li><a href="#sec-1-3-1-1">1.3.1.1. 从字典创建</a></li>
<li><a href="#sec-1-3-1-2">1.3.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-3-1-3">1.3.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-3-1-4">1.3.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-3-1-5">1.3.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-3-1-6">1.3.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-3-2">1.3.2. 数据操作</a>
<ul>
<li><a href="#sec-1-3-2-1">1.3.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-3-2-2">1.3.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-3-2-3">1.3.2.3. 列赋值</a></li>
<li><a href="#sec-1-3-2-4">1.3.2.4. 列删除</a></li>
<li><a href="#sec-1-3-2-5">1.3.2.5. 增加列</a>
<ul>
<li><a href="#sec-1-3-2-5-1">1.3.2.5.1. 添加到最后</a></li>
<li><a href="#sec-1-3-2-5-2">1.3.2.5.2. 指定位置添加</a></li>
<li><a href="#sec-1-3-2-5-3">1.3.2.5.3. assign()</a></li>
</ul>
</li>
<li><a href="#sec-1-3-2-6">1.3.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-3-2-7">1.3.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-3-2-8">1.3.2.8. 行删除</a></li>
<li><a href="#sec-1-3-2-9">1.3.2.9. 增加行</a></li>
<li><a href="#sec-1-3-2-10">1.3.2.10. 行与列选择</a></li>
<li><a href="#sec-1-3-2-11">1.3.2.11. 选择指定坐标</a></li>
<li><a href="#sec-1-3-2-12">1.3.2.12. 数据对齐</a></li>
<li><a href="#sec-1-3-2-13">1.3.2.13. 使用 numpy 函数</a>
<ul>
<li><a href="#sec-1-3-2-13-1">1.3.2.13.1. DataFrame 转换为 ndarray 对象</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
<li><a href="#sec-2-7">2.7. 出现最频繁值的统计(mode)</a></li>
<li><a href="#sec-2-8">2.8. 数据联结(concat)</a></li>
<li><a href="#sec-2-9">2.9. 数据合并(merge)</a></li>
<li><a href="#sec-2-10">2.10. 行列索引转换</a>
<ul>
<li><a href="#sec-2-10-1">2.10.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-2-10-2">2.10.2. 将行索引变为列索引 (unstack)</a></li>
</ul>
</li>
<li><a href="#sec-2-11">2.11. 透视图（pivot_table）</a></li>
<li><a href="#sec-2-12">2.12. 数据分类(astype('category'))</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-1-0-1">3.1.1.0.1. 填充默认值</a></li>
<li><a href="#sec-3-1-1-0-2">3.1.1.0.2. 往前填充</a></li>
<li><a href="#sec-3-1-1-0-3">3.1.1.0.3. 往后填充</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-2-0-1">3.1.2.0.1. 对行重新索引</a>
<ul>
<li><a href="#sec-3-1-2-0-1-1">3.1.2.0.1.1. 向前填充</a></li>
</ul>
</li>
<li><a href="#sec-3-1-2-0-2">3.1.2.0.2. 对列重新索引</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a>
<ul>
<li><a href="#sec-3-4-3-6-1">3.4.3.6.1. 列转换为索引</a></li>
<li><a href="#sec-3-4-3-6-2">3.4.3.6.2. 索引转换为列</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 数据聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a>
<ul>
<li><a href="#sec-4-3-1-1">4.3.1.1. sum</a></li>
<li><a href="#sec-4-3-1-2">4.3.1.2. mean</a></li>
<li><a href="#sec-4-3-1-3">4.3.1.3. size</a></li>
<li><a href="#sec-4-3-1-4">4.3.1.4. count</a></li>
<li><a href="#sec-4-3-1-5">4.3.1.5. min/max</a></li>
<li><a href="#sec-4-3-1-6">4.3.1.6. describe</a></li>
</ul>
</li>
<li><a href="#sec-4-3-2">4.3.2. 自定义聚合函数</a></li>
<li><a href="#sec-4-3-3">4.3.3. 应用多个聚合函数</a></li>
<li><a href="#sec-4-3-4">4.3.4. 给聚合后的列起别名</a></li>
<li><a href="#sec-4-3-5">4.3.5. 自定义需要显示的列</a></li>
<li><a href="#sec-4-3-6">4.3.6. 给不同的列应用不同的聚合函数</a></li>
<li><a href="#sec-4-3-7">4.3.7. 索引重置</a></li>
<li><a href="#sec-4-3-8">4.3.8. transform</a>
<ul>
<li><a href="#sec-4-3-8-1">4.3.8.1. 案例一（给每行都添加一个分组后的平均值）</a>
<ul>
<li><a href="#sec-4-3-8-1-1">4.3.8.1.1. 使用 merge 实现</a></li>
<li><a href="#sec-4-3-8-1-2">4.3.8.1.2. 使用 transform 实现</a></li>
</ul>
</li>
<li><a href="#sec-4-3-8-2">4.3.8.2. 案例二（计算分组后每个值与平均值的差异）</a></li>
</ul>
</li>
<li><a href="#sec-4-3-9">4.3.9. apply</a>
<ul>
<li><a href="#sec-4-3-9-1">4.3.9.1. 案例一（根据 column 排序，输出其最大的 n 行数据）</a></li>
<li><a href="#sec-4-3-9-2">4.3.9.2. 案例二（用不同的分组平均值填充空缺数据）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 时间序列</a>
<ul>
<li><a href="#sec-6-1">6.1. data_range</a></li>
<li><a href="#sec-6-2">6.2. 重采样</a></li>
<li><a href="#sec-6-3">6.3. period_range</a></li>
<li><a href="#sec-6-4">6.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 可视化</a>
<ul>
<li><a href="#sec-7-1">7.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 导入导出</a>
<ul>
<li><a href="#sec-8-1">8.1. 导出 csv</a></li>
<li><a href="#sec-8-2">8.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 示例工程</a>
<ul>
<li><a href="#sec-9-1">9.1. 电影数据分析</a>
<ul>
<li><a href="#sec-9-1-1">9.1.1. 数据读取</a></li>
<li><a href="#sec-9-1-2">9.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-9-1-3">9.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-9-1-4">9.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-9-1-5">9.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-9-1-6">9.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Panel</a></li>
<li><a href="#sec-1-2">1.2. Series</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从字典创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 特性</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 类字典对象</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. DataFrame</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. 创建</a>
<ul>
<li><a href="#sec-1-3-1-1">1.3.1.1. 从字典创建</a></li>
<li><a href="#sec-1-3-1-2">1.3.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-3-1-3">1.3.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-3-1-4">1.3.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-3-1-5">1.3.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-3-1-6">1.3.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-3-2">1.3.2. 数据操作</a>
<ul>
<li><a href="#sec-1-3-2-1">1.3.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-3-2-2">1.3.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-3-2-3">1.3.2.3. 列赋值</a></li>
<li><a href="#sec-1-3-2-4">1.3.2.4. 列删除</a></li>
<li><a href="#sec-1-3-2-5">1.3.2.5. 增加列</a></li>
<li><a href="#sec-1-3-2-6">1.3.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-3-2-7">1.3.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-3-2-8">1.3.2.8. 行删除</a></li>
<li><a href="#sec-1-3-2-9">1.3.2.9. 增加行</a></li>
<li><a href="#sec-1-3-2-10">1.3.2.10. 行与列选择</a></li>
<li><a href="#sec-1-3-2-11">1.3.2.11. 选择指定坐标</a></li>
<li><a href="#sec-1-3-2-12">1.3.2.12. 数据对齐</a></li>
<li><a href="#sec-1-3-2-13">1.3.2.13. 使用 numpy 函数</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
<li><a href="#sec-2-7">2.7. 出现最频繁值的统计(mode)</a></li>
<li><a href="#sec-2-8">2.8. 数据联结(concat)</a></li>
<li><a href="#sec-2-9">2.9. 数据合并(merge)</a></li>
<li><a href="#sec-2-10">2.10. 行列索引转换</a>
<ul>
<li><a href="#sec-2-10-1">2.10.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-2-10-2">2.10.2. 将行索引变为列索引 (unstack)</a></li>
</ul>
</li>
<li><a href="#sec-2-11">2.11. 透视图（pivot_table）</a></li>
<li><a href="#sec-2-12">2.12. 数据分类(astype('category'))</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a></li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 数据聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a>
<ul>
<li><a href="#sec-4-3-1-1">4.3.1.1. sum</a></li>
<li><a href="#sec-4-3-1-2">4.3.1.2. mean</a></li>
<li><a href="#sec-4-3-1-3">4.3.1.3. size</a></li>
<li><a href="#sec-4-3-1-4">4.3.1.4. count</a></li>
<li><a href="#sec-4-3-1-5">4.3.1.5. min/max</a></li>
<li><a href="#sec-4-3-1-6">4.3.1.6. describe</a></li>
</ul>
</li>
<li><a href="#sec-4-3-2">4.3.2. 自定义聚合函数</a></li>
<li><a href="#sec-4-3-3">4.3.3. 应用多个聚合函数</a></li>
<li><a href="#sec-4-3-4">4.3.4. 给聚合后的列起别名</a></li>
<li><a href="#sec-4-3-5">4.3.5. 自定义需要显示的列</a></li>
<li><a href="#sec-4-3-6">4.3.6. 给不同的列应用不同的聚合函数</a></li>
<li><a href="#sec-4-3-7">4.3.7. 索引重置</a></li>
<li><a href="#sec-4-3-8">4.3.8. transform</a>
<ul>
<li><a href="#sec-4-3-8-1">4.3.8.1. 案例一（给每行都添加一个分组后的平均值）</a></li>
<li><a href="#sec-4-3-8-2">4.3.8.2. 案例二（计算分组后每个值与平均值的差异）</a></li>
</ul>
</li>
<li><a href="#sec-4-3-9">4.3.9. apply</a>
<ul>
<li><a href="#sec-4-3-9-1">4.3.9.1. 案例一（根据 column 排序，输出其最大的 n 行数据）</a></li>
<li><a href="#sec-4-3-9-2">4.3.9.2. 案例二（用不同的分组平均值填充空缺数据）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 时间序列</a>
<ul>
<li><a href="#sec-6-1">6.1. data_range</a></li>
<li><a href="#sec-6-2">6.2. 重采样</a></li>
<li><a href="#sec-6-3">6.3. period_range</a></li>
<li><a href="#sec-6-4">6.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 可视化</a>
<ul>
<li><a href="#sec-7-1">7.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 导入导出</a>
<ul>
<li><a href="#sec-8-1">8.1. 导出 csv</a></li>
<li><a href="#sec-8-2">8.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 示例工程</a>
<ul>
<li><a href="#sec-9-1">9.1. 电影数据分析</a>
<ul>
<li><a href="#sec-9-1-1">9.1.1. 数据读取</a></li>
<li><a href="#sec-9-1-2">9.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-9-1-3">9.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-9-1-4">9.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-9-1-5">9.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-9-1-6">9.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Author</td>
<td class="left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="left">Date</td>
<td class="left">2018-02-20 16:20:32</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 核心数据结构</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Panel</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Panel 是三维带标签的数组。
</p>

<p>
Panel 由三个标签组成：
</p>

<dl class="org-dl">
<dt> items </dt><dd>坐标轴 0 ，索引对应的元素是一个 DataFrame
</dd>
<dt> major_axis </dt><dd>坐标轴 1 , DataFrame 里的行标签
</dd>
<dt> minor_axis </dt><dd>坐标轴 2 , DataFrame 里的列标签
</dd>
</dl>
</div>
</div>



<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Series</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Series 是一维带标签的数组，数组里可以放任意的数据（整数，浮点数，字符串，Python Object）。
</p>

<p>
其基本的创建函数是： <code>pd.Series(data, index=index)</code>
</p>

<p>
其中 index 是一个列表，用来作为数据的标签。data 可以是不同的数据类型：
</p>

<ul class="org-ul">
<li>Python 字典
</li>
<li>ndarray 对象
</li>
<li>一个标量值，如 5
</li>
</ul>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-2-1">
</div><div id="outline-container-sec-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1"><span class="section-number-5">1.2.1.1</span> 从 ndarray 创建</h5>
<div class="outline-text-5" id="text-1-2-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(5))
log(<span style="color: #ff4ea3;">"s2"</span>, s2)
log(<span style="color: #ff4ea3;">"s2.index"</span>, s2.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a   -0.183536
b    0.572940
c   -0.161728
d    0.337054
e   -2.161820
dtype: float64
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s2 ======================================
0    0.539817
1    0.039617
2    0.055409
3    0.331841
4   -0.571590
dtype: float64
=================================== s2.index ===================================
RangeIndex(start=0, stop=5, step=1)
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2"><span class="section-number-5">1.2.1.2</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-2-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'a'</span> : 0., <span style="color: #ff4ea3;">'b'</span> : 1., <span style="color: #ff4ea3;">'d'</span> : 3}
<span style="color: #ff8700;">s</span> = pd.Series(d, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcd'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    NaN
d    3.0
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3"><span class="section-number-5">1.2.1.3</span> 从标量创建</h5>
<div class="outline-text-5" id="text-1-2-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(3, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    3
b    3
c    3
d    3
e    3
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> 特性</h4>
<div class="outline-text-4" id="text-1-2-2">
</div><div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1"><span class="section-number-5">1.2.2.1</span> 类 ndarray 对象</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5))

log(<span style="color: #ff4ea3;">"s[0]"</span>, s[0])
log(<span style="color: #ff4ea3;">"s[:3]"</span>, s[:3])
log(<span style="color: #ff4ea3;">"s[[1, 3, 4]]"</span>, s[[1, 3, 4]])
log(<span style="color: #ff4ea3;">"np.exp(s)"</span>, np.exp(s))
log(<span style="color: #ff4ea3;">"np.sin(s)"</span>, np.sin(s))
</pre>
</div>

<pre class="example">
===================================== s[0] =====================================
0.8019501105403066
==================================== s[:3] =====================================
0    0.801950
1   -0.073718
2   -1.156917
dtype: float64
================================= s[[1, 3, 4]] =================================
1   -0.073718
3   -0.071245
4    0.613925
dtype: float64
================================== np.exp(s) ===================================
0    2.229885
1    0.928933
2    0.314454
3    0.931234
4    1.847670
dtype: float64
================================== np.sin(s) ===================================
0    0.718713
1   -0.073652
2   -0.915567
3   -0.071185
4    0.576080
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2"><span class="section-number-5">1.2.2.2</span> 类字典对象</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s</span>[<span style="color: #ff4ea3;">'e'</span>] = 5
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"'e' in s"</span>, <span style="color: #ff4ea3;">'e'</span> <span style="color: #a1db00;">in</span> s)
log(<span style="color: #ff4ea3;">"s.get('f', np.nan)"</span>, s.get(<span style="color: #ff4ea3;">'f'</span>, np.nan))
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.156754
b   -0.740014
c    1.159691
d    0.844544
e    5.000000
dtype: float64
=================================== 'e' in s ===================================
True
============================== s.get('f', np.nan) ==============================
nan
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3"><span class="section-number-5">1.2.2.3</span> 标签对齐</h5>
<div class="outline-text-5" id="text-1-2-2-3">
<p>
相同索引值才进行操作
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s1</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])

log(<span style="color: #ff4ea3;">"s1"</span>, s1)
log(<span style="color: #ff4ea3;">"s2"</span>, s2)


log(<span style="color: #ff4ea3;">"s1 + s2"</span>, s1 + s2)
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a    0.727305
c   -0.425568
e   -0.243525
dtype: float64
====================================== s2 ======================================
a    0.158115
d    0.754155
e    1.308995
dtype: float64
=================================== s1 + s2 ====================================
a    0.88542
c        NaN
d        NaN
e    1.06547
dtype: float64
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> DataFrame</h3>
<div class="outline-text-3" id="text-1-3">
<p>
DataFrame 是 <b>二维带行标签和列标签的数组</b> 。
</p>

<p>
可以把 DataFrame 想象成一个 Excel 表格或一个 SQL 数据库的表格，还可以想象成是一个 Series 对象字典。
</p>

<p>
它是 Pandas 里最常用的数据结构。
</p>

<p>
创建 DataFrame 的基本格式是：
</p>

<div class="org-src-container">

<pre class="src src-ipython">pd.DataFrame(data, index=index, columns=columns)
</pre>
</div>

<p>
其中 index 是行标签，columns 是列标签，data 可以是下面的数据：
</p>

<ul class="org-ul">
<li>由一维 numpy 数组，list，Series 构成的字典
</li>
<li>二维 numpy 数组
</li>
<li>一个 Series
</li>
<li>另外的 DataFrame 对象
</li>
</ul>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-3-1">
</div><div id="outline-container-sec-1-3-1-1" class="outline-5">
<h5 id="sec-1-3-1-1"><span class="section-number-5">1.3.1.1</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-3-1-1">
<p>
key 为 DataFrame 的列；value 为对应列下的值
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : pd.Series([1, 2, 3], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]),
     <span style="color: #ff4ea3;">'two'</span> : pd.Series([1, 2, 3, 4], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three'])"</span>,
    pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>], columns=[<span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
==================== pd.DataFrame(d, index=['d', 'b', 'a']) ====================
   one  two
d  NaN    4
b  2.0    2
a  1.0    1
======= pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three']) =======
   two three
d    4   NaN
b    2   NaN
a    1   NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : [1, 2, 3, 4],
     <span style="color: #ff4ea3;">'two'</span> : [21, 22, 23, 24]}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['a', 'b', 'c', 'd'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
0    1   21
1    2   22
2    3   23
3    4   24
================= pd.DataFrame(d, index=['a', 'b', 'c', 'd']) ==================
   one  two
a    1   21
b    2   22
c    3   23
d    4   24
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
                  <span style="color: #ff4ea3;">'A'</span>: 1,
                  <span style="color: #ff4ea3;">'B'</span>: pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>),
                  <span style="color: #ff4ea3;">'C'</span>: <span style="color: #d18aff;">range</span>(4),
                  <span style="color: #ff4ea3;">'D'</span>: np.arange(5, 9),
                  <span style="color: #ff4ea3;">'E'</span>: <span style="color: #ff4ea3;">'text'</span>,
                  <span style="color: #ff4ea3;">'F'</span>: [<span style="color: #ff4ea3;">'AA'</span>, <span style="color: #ff4ea3;">'BB'</span>, <span style="color: #ff4ea3;">'CC'</span>, <span style="color: #ff4ea3;">'DD'</span>]})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-1-2" class="outline-5">
<h5 id="sec-1-3-1-2"><span class="section-number-5">1.3.1.2</span> 从结构化数据列表创建</h5>
<div class="outline-text-5" id="text-1-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [(1, 2.2, <span style="color: #ff4ea3;">'Hello'</span>), (2, 3., <span style="color: #ff4ea3;">"World"</span>)]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   0    1      2
0  1  2.2  Hello
1  2  3.0  World
==== pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C']) ====
        A    B      C
first   1  2.2  Hello
second  2  3.0  World
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-1-3" class="outline-5">
<h5 id="sec-1-3-1-3"><span class="section-number-5">1.3.1.3</span> 从字典列表创建</h5>
<div class="outline-text-5" id="text-1-3-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [{<span style="color: #ff4ea3;">'a'</span>: 1, <span style="color: #ff4ea3;">'b'</span>: 2}, {<span style="color: #ff4ea3;">'a'</span>: 5, <span style="color: #ff4ea3;">'b'</span>: 10, <span style="color: #ff4ea3;">'c'</span>: 20}]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, columns=['a', 'b'])"</span>,
    pd.DataFrame(data, columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   a   b     c
0  1   2   NaN
1  5  10  20.0
================ pd.DataFrame(data, index=['first', 'second']) =================
        a   b     c
first   1   2   NaN
second  5  10  20.0
==================== pd.DataFrame(data, columns=['a', 'b']) ====================
   a   b
0  1   2
1  5  10
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-1-4" class="outline-5">
<h5 id="sec-1-3-1-4"><span class="section-number-5">1.3.1.4</span> 从元组字典创建</h5>
<div class="outline-text-5" id="text-1-3-1-4">
<p>
实际应用中，会通过数据清洗的方式，把数据整理成方便 Pandas 导入且可读性好的格式。
然后再通过 <b>reindex/groupby</b> 等方式转换成复杂数据结构。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {(<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 1, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 2},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 3, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 4},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 5, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 6},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 7, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 8},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'D'</span>): 9, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 10}}

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#22810;&#32423;&#26631;&#31614;</span>
log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
       a              b
       a    b    c    a     b
A B  4.0  1.0  5.0  8.0  10.0
  C  3.0  2.0  6.0  7.0   NaN
  D  NaN  NaN  NaN  NaN   9.0
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-1-5" class="outline-5">
<h5 id="sec-1-3-1-5"><span class="section-number-5">1.3.1.5</span> 从 Series 创建</h5>
<div class="outline-text-5" id="text-1-3-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"pd.DataFrame(s)"</span>, pd.DataFrame(s))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(s) ================================
          0
a -1.127074
b  0.453993
c -1.594113
d -0.281301
e -1.416290
==================== pd.DataFrame(s, index=['a', 'c', 'd']) ====================
          0
a -1.127074
c -1.594113
d -0.281301
============ pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A']) =============
          A
a -1.127074
c -1.594113
d -0.281301
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-1-6" class="outline-5">
<h5 id="sec-1-3-1-6"><span class="section-number-5">1.3.1.6</span> 指定行列索引创建</h5>
<div class="outline-text-5" id="text-1-3-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
log(<span style="color: #ff4ea3;">"dates"</span>, dates)

<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.332580 -1.073084  0.360434  0.779219
2016-03-02  0.567681 -1.160027 -2.000718 -1.984131
2016-03-03 -1.674580 -0.182869  0.057551  1.177684
2016-03-04 -0.222919 -1.372010  0.853818 -0.470738
2016-03-05 -0.333995 -0.572622 -1.358820  1.490826
2016-03-06  1.827142 -0.947639 -1.185264  1.747825
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> 数据操作</h4>
<div class="outline-text-4" id="text-1-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEF'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.357381  0.596704  2.798947 -1.376419
B  1.457283  0.638497  0.294636 -0.159787
C -0.205405  0.971781  1.772634 -0.792688
D -0.375898  0.843910 -0.065800 -0.270812
E  1.150432 -0.116934 -0.904429  0.707188
F -1.603059  0.066054  0.599469 -1.236657
</pre>
</div>

<div id="outline-container-sec-1-3-2-1" class="outline-5">
<h5 id="sec-1-3-2-1"><span class="section-number-5">1.3.2.1</span> 列选择(Series)</h5>
<div class="outline-text-5" id="text-1-3-2-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['one']"</span>, df[<span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.one"</span>, df.one)
</pre>
</div>

<pre class="example">
================================== df['one'] ===================================
A    0.357381
B    1.457283
C   -0.205405
D   -0.375898
E    1.150432
F   -1.603059
Name: one, dtype: float64
==================================== df.one ====================================
A    0.357381
B    1.457283
C   -0.205405
D   -0.375898
E    1.150432
F   -1.603059
Name: one, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-2" class="outline-5">
<h5 id="sec-1-3-2-2"><span class="section-number-5">1.3.2.2</span> 列选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-3-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc[:, ['one', 'two']]"</span>, df.loc[:, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[:, 0:1]"</span>, df.iloc[:, 0:1])
</pre>
</div>

<pre class="example">
========================== df.loc[:, ['one', 'two']] ===========================
        one       two
A  0.357381  0.596704
B  1.457283  0.638497
C -0.205405  0.971781
D -0.375898  0.843910
E  1.150432 -0.116934
F -1.603059  0.066054
=============================== df.iloc[:, 0:1] ================================
        one
A  0.357381
B  1.457283
C -0.205405
D -0.375898
E  1.150432
F -1.603059
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-3" class="outline-5">
<h5 id="sec-1-3-2-3"><span class="section-number-5">1.3.2.3</span> 列赋值</h5>
<div class="outline-text-5" id="text-1-3-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'three'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] + df[<span style="color: #ff4ea3;">'two'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.357381  0.596704  0.954085 -1.376419
B  1.457283  0.638497  2.095780 -0.159787
C -0.205405  0.971781  0.766376 -0.792688
D -0.375898  0.843910  0.468012 -0.270812
E  1.150432 -0.116934  1.033498  0.707188
F -1.603059  0.066054 -1.537005 -1.236657
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-4" class="outline-5">
<h5 id="sec-1-3-2-4"><span class="section-number-5">1.3.2.4</span> 列删除</h5>
<div class="outline-text-5" id="text-1-3-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">del</span> df[<span style="color: #ff4ea3;">'three'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two      four
A  0.357381  0.596704 -1.376419
B  1.457283  0.638497 -0.159787
C -0.205405  0.971781 -0.792688
D -0.375898  0.843910 -0.270812
E  1.150432 -0.116934  0.707188
F -1.603059  0.066054 -1.236657
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = df.pop(<span style="color: #ff4ea3;">'four'</span>)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A   -1.376419
B   -0.159787
C   -0.792688
D   -0.270812
E    0.707188
F   -1.236657
Name: four, dtype: float64
====================================== df ======================================
        one       two
A  0.357381  0.596704
B  1.457283  0.638497
C -0.205405  0.971781
D -0.375898  0.843910
E  1.150432 -0.116934
F -1.603059  0.066054
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop([<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">df &#19981;&#21464;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
Empty DataFrame
Columns: []
Index: [A, B, C, D, E, F]
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-5" class="outline-5">
<h5 id="sec-1-3-2-5"><span class="section-number-5">1.3.2.5</span> 增加列</h5>
<div class="outline-text-5" id="text-1-3-2-5">
</div><div id="outline-container-sec-1-3-2-5-1" class="outline-6">
<h6 id="sec-1-3-2-5-1"><span class="section-number-6">1.3.2.5.1</span> 添加到最后</h6>
<div class="outline-text-6" id="text-1-3-2-5-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'flag'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] &gt; 0
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'five'</span>] = 5
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'one_trunc'</span>] = df[<span style="color: #ff4ea3;">'one'</span>][:2]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two   flag  five  one_trunc
A  0.357381  0.596704   True     5   0.357381
B  1.457283  0.638497   True     5   1.457283
C -0.205405  0.971781  False     5        NaN
D -0.375898  0.843910  False     5        NaN
E  1.150432 -0.116934   True     5        NaN
F -1.603059  0.066054  False     5        NaN
</pre>
</div>
</div>

<div id="outline-container-sec-1-3-2-5-2" class="outline-6">
<h6 id="sec-1-3-2-5-2"><span class="section-number-6">1.3.2.5.2</span> 指定位置添加</h6>
<div class="outline-text-6" id="text-1-3-2-5-2">
<div class="org-src-container">

<pre class="src src-ipython">df.insert(1, <span style="color: #ff4ea3;">'bar'</span>, df.one + df.two)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.357381  0.954085  0.596704   True     5   0.357381
B  1.457283  2.095780  0.638497   True     5   1.457283
C -0.205405  0.766376  0.971781  False     5        NaN
D -0.375898  0.468012  0.843910  False     5        NaN
E  1.150432  1.033498 -0.116934   True     5        NaN
F -1.603059 -1.537005  0.066054  False     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-5-3" class="outline-6">
<h6 id="sec-1-3-2-5-3"><span class="section-number-6">1.3.2.5.3</span> assign()</h6>
<div class="outline-text-6" id="text-1-3-2-5-3">
<p>
assign 方法并不会 inplace 地改变原来的 dataframe ，
该方法的 <b>优势</b> 在于可以对 dataframe 对象使用链式操作。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.assign(Ratio=df.one/df.two)
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
        one       bar       two   flag  five  one_trunc      Ratio
A  0.357381  0.954085  0.596704   True     5   0.357381   0.598925
B  1.457283  2.095780  0.638497   True     5   1.457283   2.282363
C -0.205405  0.766376  0.971781  False     5        NaN  -0.211370
D -0.375898  0.468012  0.843910  False     5        NaN  -0.445425
E  1.150432  1.033498 -0.116934   True     5        NaN  -9.838302
F -1.603059 -1.537005  0.066054  False     5        NaN -24.268841
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.357381  0.954085  0.596704   True     5   0.357381
B  1.457283  2.095780  0.638497   True     5   1.457283
C -0.205405  0.766376  0.971781  False     5        NaN
D -0.375898  0.468012  0.843910  False     5        NaN
E  1.150432  1.033498 -0.116934   True     5        NaN
F -1.603059 -1.537005  0.066054  False     5        NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.assign(Ratio=lambda x: x.one - x.two)"</span>,
    df.assign(Ratio=<span style="color: #a1db00;">lambda</span> x: x.one - x.two))

log(<span style="color: #ff4ea3;">"df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar)"</span>,
    df.assign(ABRatio=df.one/df.two).assign(BarValue=<span style="color: #a1db00;">lambda</span> x: x.ABRatio*x.bar))
</pre>
</div>

<pre class="example">
=================== df.assign(Ratio=lambda x: x.one - x.two) ===================
        one       bar       two   flag  five  one_trunc     Ratio
A  0.357381  0.954085  0.596704   True     5   0.357381 -0.239323
B  1.457283  2.095780  0.638497   True     5   1.457283  0.818785
C -0.205405  0.766376  0.971781  False     5        NaN -1.177187
D -0.375898  0.468012  0.843910  False     5        NaN -1.219809
E  1.150432  1.033498 -0.116934   True     5        NaN  1.267365
F -1.603059 -1.537005  0.066054  False     5        NaN -1.669114
= df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar) ==
        one       bar       two   flag  five  one_trunc    ABRatio   BarValue
A  0.357381  0.954085  0.596704   True     5   0.357381   0.598925   0.571425
B  1.457283  2.095780  0.638497   True     5   1.457283   2.282363   4.783330
C -0.205405  0.766376  0.971781  False     5        NaN  -0.211370  -0.161989
D -0.375898  0.468012  0.843910  False     5        NaN  -0.445425  -0.208464
E  1.150432  1.033498 -0.116934   True     5        NaN  -9.838302 -10.167861
F -1.603059 -1.537005  0.066054  False     5        NaN -24.268841  37.301333
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-3-2-6" class="outline-5">
<h5 id="sec-1-3-2-6"><span class="section-number-5">1.3.2.6</span> 行选择(Series)</h5>
<div class="outline-text-5" id="text-1-3-2-6">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#26631;&#31614;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df.iloc[0]"</span>, df.iloc[0])    <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#20301;&#32622;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
================================= df.loc['A'] ==================================
one          0.357381
bar          0.954085
two          0.596704
flag             True
five                5
one_trunc    0.357381
Name: A, dtype: object
================================== df.iloc[0] ==================================
one          0.357381
bar          0.954085
two          0.596704
flag             True
five                5
one_trunc    0.357381
Name: A, dtype: object
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-7" class="outline-5">
<h5 id="sec-1-3-2-7"><span class="section-number-5">1.3.2.7</span> 行选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-3-2-7">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df[2:4]"</span>, df[2:4])
log(<span style="color: #ff4ea3;">"df['A':'C']"</span>, df[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[2:4]"</span>, df.iloc[2:4])         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25928;&#29575;&#39640;</span>
log(<span style="color: #ff4ea3;">"df[df.one &gt; 0.5]"</span>, df[df.one &gt; 0.5])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[df &gt; 0]"</span>, df[df &gt; 0])             <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[[False, True, True, False, True, False]]"</span>,
    df[[<span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>]])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
=================================== df[2:4] ====================================
        one       bar       two   flag  five  one_trunc
C -0.205405  0.766376  0.971781  False     5        NaN
D -0.375898  0.468012  0.843910  False     5        NaN
================================= df['A':'C'] ==================================
        one       bar       two   flag  five  one_trunc
A  0.357381  0.954085  0.596704   True     5   0.357381
B  1.457283  2.095780  0.638497   True     5   1.457283
C -0.205405  0.766376  0.971781  False     5        NaN
================================= df.iloc[2:4] =================================
        one       bar       two   flag  five  one_trunc
C -0.205405  0.766376  0.971781  False     5        NaN
D -0.375898  0.468012  0.843910  False     5        NaN
=============================== df[df.one &gt; 0.5] ===============================
        one       bar       two  flag  five  one_trunc
B  1.457283  2.095780  0.638497  True     5   1.457283
E  1.150432  1.033498 -0.116934  True     5        NaN
================================== df[df &gt; 0] ==================================
        one       bar       two  flag  five  one_trunc
A  0.357381  0.954085  0.596704   1.0     5   0.357381
B  1.457283  2.095780  0.638497   1.0     5   1.457283
C       NaN  0.766376  0.971781   NaN     5        NaN
D       NaN  0.468012  0.843910   NaN     5        NaN
E  1.150432  1.033498       NaN   1.0     5        NaN
F       NaN       NaN  0.066054   NaN     5        NaN
================= df[[False, True, True, False, True, False]] ==================
        one       bar       two   flag  five  one_trunc
B  1.457283  2.095780  0.638497   True     5   1.457283
C -0.205405  0.766376  0.971781  False     5        NaN
E  1.150432  1.033498 -0.116934   True     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-8" class="outline-5">
<h5 id="sec-1-3-2-8"><span class="section-number-5">1.3.2.8</span> 行删除</h5>
<div class="outline-text-5" id="text-1-3-2-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop(<span style="color: #ff4ea3;">'A'</span>)           <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">result &#26159;&#19968;&#20221;&#26032;&#30340;&#25968;&#25454;&#25335;&#36125;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
        one       bar       two   flag  five  one_trunc
B  1.457283  2.095780  0.638497   True     5   1.457283
C -0.205405  0.766376  0.971781  False     5        NaN
D -0.375898  0.468012  0.843910  False     5        NaN
E  1.150432  1.033498 -0.116934   True     5        NaN
F -1.603059 -1.537005  0.066054  False     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-9" class="outline-5">
<h5 id="sec-1-3-2-9"><span class="section-number-5">1.3.2.9</span> 增加行</h5>
<div class="outline-text-5" id="text-1-3-2-9">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([7, 7, 7, <span style="color: #5fafd7;">True</span>, 7, 7], index=<span style="color: #d18aff;">list</span>(df.columns))
<span style="color: #ff8700;">appended</span> = df.append(s, ignore_index=<span style="color: #5fafd7;">True</span>)
show_dataframe(appended)
</pre>
</div>


<div id="img/fig37020vuz.png" class="figure">
<p><img src="img/fig37020vuz.png" alt="fig37020vuz.png">
</p>
<p><span class="figure-number">Figure 1:</span> append</p>
</div>
</div>
</div>


<div id="outline-container-sec-1-3-2-10" class="outline-5">
<h5 id="sec-1-3-2-10"><span class="section-number-5">1.3.2.10</span> 行与列选择</h5>
<div class="outline-text-5" id="text-1-3-2-10">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A':'B', ['one', 'two']]"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'B'</span>, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[0:2, 0:3]"</span>, df.iloc[0:2, 0:3])
</pre>
</div>

<pre class="example">
======================= df.loc['A':'B', ['one', 'two']] ========================
        one       two
A  0.357381  0.596704
B  1.457283  0.638497
============================== df.iloc[0:2, 0:3] ===============================
        one       bar       two
A  0.357381  0.954085  0.596704
B  1.457283  2.095780  0.638497
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-11" class="outline-5">
<h5 id="sec-1-3-2-11"><span class="section-number-5">1.3.2.11</span> 选择指定坐标</h5>
<div class="outline-text-5" id="text-1-3-2-11">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A', 'one']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.at['A', 'one']"</span>, df.at[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[1, 1]"</span>, df.iloc[1, 1])
log(<span style="color: #ff4ea3;">"df.iat[1, 1]"</span>, df.iat[1, 1])
</pre>
</div>

<pre class="example">
============================== df.loc['A', 'one'] ==============================
0.35738080729919186
============================== df.at['A', 'one'] ===============================
0.35738080729919186
================================ df.iloc[1, 1] =================================
2.0957799265739268
================================= df.iat[1, 1] =================================
2.0957799265739268
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-12" class="outline-5">
<h5 id="sec-1-3-2-12"><span class="section-number-5">1.3.2.12</span> 数据对齐</h5>
<div class="outline-text-5" id="text-1-3-2-12">
<p>
DataFrame 在进行数据计算时， <b>会自动按行和列进行数据对齐</b> 。
最终的计算结果会合并两个 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = pd.DataFrame(np.random.randn(10, 4),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefghij'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'D'</span>])

<span style="color: #ff8700;">df2</span> = pd.DataFrame(np.random.randn(7, 3),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'cdefghi'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>])

log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df2"</span>, df2)

log(<span style="color: #ff4ea3;">"df1 + df2"</span>, df1 + df2)
log(<span style="color: #ff4ea3;">"df1 - df1.iloc[0]"</span>, df1 - df1.iloc[0])
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
          A         B         C         D
a  0.555401 -0.851900  1.594546 -0.701298
b -0.448250  1.186017  0.056997 -0.209077
c -2.677219 -0.666360 -1.557664  1.754826
d  1.741086 -0.602618 -2.422112  0.529779
e -0.231568  0.504758  0.322917 -0.823914
f -1.593117  0.681283  2.672830 -2.022231
g  0.190530  0.106924  0.953901  0.729002
h  0.289560  1.985045  2.371231  0.240100
i -0.181777 -0.694582 -1.027196  0.728838
j  0.671136  0.627650  1.733267  0.138295
===================================== df2 ======================================
          A         B         C
c -0.354800 -0.310771 -1.531789
d -0.154908 -0.924015  0.231388
e -0.830264  0.773049 -1.365463
f  0.230299  0.480456  0.466270
g  0.610927 -0.734505  1.604289
h  0.450368  0.472872  0.347382
i  1.868654 -0.208424 -0.503590
================================== df1 + df2 ===================================
          A         B         C   D
a       NaN       NaN       NaN NaN
b       NaN       NaN       NaN NaN
c -3.032019 -0.977131 -3.089453 NaN
d  1.586178 -1.526633 -2.190724 NaN
e -1.061831  1.277807 -1.042545 NaN
f -1.362819  1.161739  3.139099 NaN
g  0.801457 -0.627580  2.558190 NaN
h  0.739928  2.457917  2.718613 NaN
i  1.686877 -0.903006 -1.530786 NaN
j       NaN       NaN       NaN NaN
============================== df1 - df1.iloc[0] ===============================
          A         B         C         D
a  0.000000  0.000000  0.000000  0.000000
b -1.003651  2.037917 -1.537549  0.492220
c -3.232620  0.185540 -3.152210  2.456123
d  1.185685  0.249282 -4.016658  1.231076
e -0.786968  1.356658 -1.271628 -0.122616
f -2.148518  1.533183  1.078284 -1.320933
g -0.364871  0.958824 -0.640645  1.430299
h -0.265841  2.836945  0.776685  0.941398
i -0.737178  0.157318 -2.621742  1.430135
j  0.115735  1.479550  0.138721  0.839593
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df3</span> = df2.loc[:, [<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]].copy()
log(<span style="color: #ff4ea3;">"df3 (before)"</span>, df3)
<span style="color: #ff8700;">df3</span>[df3 &gt; 0] = -df3
log(<span style="color: #ff4ea3;">"df3 (after)"</span>, df3)
</pre>
</div>

<pre class="example">
================================= df3 (before) =================================
          B         C
c -0.310771 -1.531789
d -0.924015  0.231388
e  0.773049 -1.365463
f  0.480456  0.466270
g -0.734505  1.604289
h  0.472872  0.347382
i -0.208424 -0.503590
================================= df3 (after) ==================================
          B         C
c -0.310771 -1.531789
d -0.924015 -0.231388
e -0.773049 -1.365463
f -0.480456 -0.466270
g -0.734505 -1.604289
h -0.472872 -0.347382
i -0.208424 -0.503590
</pre>
</div>
</div>


<div id="outline-container-sec-1-3-2-13" class="outline-5">
<h5 id="sec-1-3-2-13"><span class="section-number-5">1.3.2.13</span> 使用 numpy 函数</h5>
<div class="outline-text-5" id="text-1-3-2-13">
<p>
因为从本质上讲，DataFrame 内部用的数据结构就是 numpy 的 ndarray 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"np.exp(df)"</span>, np.exp(df))
log(<span style="color: #ff4ea3;">"np.sin(df)"</span>, np.sin(df))
</pre>
</div>

<pre class="example">
================================== np.exp(df) ==================================
        one       two     three      four
0  1.659179  0.274080  0.501408  1.149368
1  0.410625  0.603607  8.408958  4.140531
2  0.161829  0.405158  1.932589  6.642213
3  0.738202  0.206124  1.131662  0.783875
4  5.426959  4.603962  0.245219  0.567954
5  5.758053  4.680492  1.211310  0.467325
6  1.241263  0.586296  2.922359  0.429579
7  1.161916  0.454429  0.705549  0.304520
8  1.732730  0.214530  2.893414  0.774907
9  1.581505  2.356486  4.452727  0.646382
================================== np.sin(df) ==================================
        one       two     three      four
0  0.484965 -0.962028 -0.636795  0.138763
1 -0.777118 -0.483661  0.848050  0.988775
2 -0.968808 -0.785484  0.612216  0.948399
3 -0.298898 -0.999964  0.123372 -0.241107
4  0.992739  0.999037 -0.986387 -0.536019
5  0.983879  0.999625  0.190530 -0.689451
6  0.214451 -0.508921  0.878346 -0.747938
7  0.149507 -0.709448 -0.341751 -0.928004
8  0.522430 -0.999504  0.873544 -0.252257
9  0.442493  0.755994  0.997015 -0.422647
</pre>
</div>

<div id="outline-container-sec-1-3-2-13-1" class="outline-6">
<h6 id="sec-1-3-2-13-1"><span class="section-number-6">1.3.2.13.1</span> DataFrame 转换为 ndarray 对象</h6>
<div class="outline-text-6" id="text-1-3-2-13-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ary</span> = np.asarray(df)
log(<span style="color: #ff4ea3;">"ary"</span>, ary)
log(<span style="color: #ff4ea3;">"ary == df.values"</span>, ary == df.values)
log(<span style="color: #ff4ea3;">"ary == df"</span>, ary == df)
</pre>
</div>

<pre class="example">
===================================== ary ======================================
[[ 0.50632262 -1.29433577 -0.69033432  0.1392124 ]
 [-0.89007384 -0.50483212  2.12929761  1.42082406]
 [-1.82121774 -0.90347703  0.65886046  1.89344522]
 [-0.30353746 -1.57927568  0.1236875  -0.24350594]
 [ 1.69137902  1.52691715 -1.40560421 -0.56571461]
 [ 1.75059932  1.54340327  0.19170246 -0.76073046]
 [ 0.2161294  -0.53393044  1.07239111 -0.84494994]
 [ 0.15007003 -0.78871452 -0.3487794  -1.18901995]
 [ 0.54969804 -1.5393056   1.06243712 -0.25501205]
 [ 0.45837721  0.85717169  1.49351668 -0.43636423]]
=============================== ary == df.values ===============================
[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
================================== ary == df ===================================
    one   two  three  four
0  True  True   True  True
1  True  True   True  True
2  True  True   True  True
3  True  True   True  True
4  True  True   True  True
5  True  True   True  True
6  True  True   True  True
7  True  True   True  True
8  True  True   True  True
9  True  True   True  True
</pre>
</div>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 函数应用</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 将数据按行或列进行计算(apply)</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.arange(12).reshape(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       A   B   C
one    0   1   2
two    3   4   5
three  6   7   8
four   9  10  11
</pre>
</div>

<div id="outline-container-sec-2-1-0-1" class="outline-5">
<h5 id="sec-2-1-0-1"><span class="section-number-5">2.1.0.1</span> 按列进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-1">
<p>
每一列作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>())
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
A    9
B    9
C    9
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-2" class="outline-5">
<h5 id="sec-2-1-0-2"><span class="section-number-5">2.1.0.2</span> 按行进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-2">
<p>
每一行作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>(), axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
one      2
two      2
three    2
four     2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-3" class="outline-5">
<h5 id="sec-2-1-0-3"><span class="section-number-5">2.1.0.3</span> 返回多个值组成的 Series</h5>
<div class="outline-text-5" id="text-2-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">min_max</span>(x):
    <span style="color: #a1db00;">return</span> pd.Series([x.<span style="color: #d18aff;">min</span>(), x.<span style="color: #d18aff;">max</span>()], index=[<span style="color: #ff4ea3;">'min'</span>, <span style="color: #ff4ea3;">'max'</span>])
<span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(min_max, axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
       min  max
one      0    2
two      3    5
three    6    8
four     9   11
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 逐元素运算(applymap)</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
              A         B         C
one   -2.153761  0.347898 -0.059399
two    0.264453 -1.651431 -0.328332
three  0.993334 -1.541642  0.265911
four   0.573970  1.018839 -0.730719
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">x &#34920;&#31034; dataframe &#20013;&#30340;&#27599;&#20010;&#20803;&#32032;</span>
<span style="color: #ff8700;">result</span> = df.applymap(<span style="color: #a1db00;">lambda</span> x: <span style="color: #ff4ea3;">'{0:.03f}'</span>.<span style="color: #d18aff;">format</span>(x))
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            A       B       C
one    -2.154   0.348  -0.059
two     0.264  -1.651  -0.328
three   0.993  -1.542   0.266
four    0.574   1.019  -0.731
</pre>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 排序(sort_values)</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    1    6      1
B    4    7      6
C    1    5      6
D    9    2      7
</pre>
</div>


<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> 按列排序</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'two'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   one  two  three
B    4    7      6
A    1    6      1
C    1    5      6
D    9    2      7
</pre>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> 按行排序</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'C'</span>, axis=1, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   three  two  one
A      1    6    1
B      6    7    4
C      6    5    1
D      7    2    9
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 索引排序(sort_index)</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    9    6      4
B    2    1      2
C    3    5      1
D    6    7      5
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">col_sort</span> = df.sort_index(axis=1, ascending=<span style="color: #5fafd7;">False</span>)
<span style="color: #ff8700;">row_sort</span> = df.sort_index(ascending=<span style="color: #5fafd7;">False</span>)

log(<span style="color: #ff4ea3;">"col_sort"</span>, col_sort)
log(<span style="color: #ff4ea3;">"row_sort"</span>, row_sort)
</pre>
</div>

<pre class="example">
=================================== col_sort ===================================
   two  three  one
A    6      4    9
B    1      2    2
C    5      1    3
D    7      5    6
=================================== row_sort ===================================
   one  two  three
D    6    7      5
C    3    5      1
B    2    1      2
A    9    6      4
</pre>
</div>
</div>


<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 排名(rank)</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([3, 6, 2, 6, 4])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    3
1    6
2    2
3    6
4    4
dtype: int64
====================================== df ======================================
   one  two  three
A    7    4      6
B    7    5      5
C    9    7      4
D    8    8      8
</pre>



<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s_result</span> = s.rank(method=<span style="color: #ff4ea3;">'first'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"s_result"</span>, s_result)
</pre>
</div>

<pre class="example">
=================================== s_result ===================================
0    4.0
1    1.0
2    5.0
3    2.0
4    3.0
dtype: float64
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df_result</span> = df.rank(method=<span style="color: #ff4ea3;">'first'</span>)
log(<span style="color: #ff4ea3;">"df_result"</span>, df_result)
</pre>
</div>

<pre class="example">
================================== df_result ===================================
   one  two  three
A  1.0  1.0    3.0
B  2.0  2.0    2.0
C  4.0  3.0    1.0
D  3.0  4.0    4.0
</pre>
</div>
</div>


<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Series 元素统计</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abbcdabacad'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0     a
1     b
2     b
3     c
4     d
5     a
6     b
7     a
8     c
9     a
10    d
dtype: object
</pre>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> 个数统计(value_counts)</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.value_counts()"</span>, s.value_counts())
</pre>
</div>

<pre class="example">
=============================== s.value_counts() ===============================
a    4
b    3
c    2
d    2
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> 唯一性统计(uniq)</h4>
<div class="outline-text-4" id="text-2-6-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.unique()"</span>, s.unique())
</pre>
</div>

<pre class="example">
================================== s.unique() ==================================
['a' 'b' 'c' 'd']
</pre>
</div>
</div>


<div id="outline-container-sec-2-6-3" class="outline-4">
<h4 id="sec-2-6-3"><span class="section-number-4">2.6.3</span> 成员资格统计(isin)</h4>
<div class="outline-text-4" id="text-2-6-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.isin(['a', 'b', 'c'])"</span>, s.isin([<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]))
</pre>
</div>

<pre class="example">
=========================== s.isin(['a', 'b', 'c']) ============================
0      True
1      True
2      True
3      True
4     False
5      True
6      True
7      True
8      True
9      True
10    False
dtype: bool
</pre>
</div>
</div>
</div>






<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> 出现最频繁值的统计(mode)</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1, 1, 2, 3, 4, 5])
log(<span style="color: #ff4ea3;">"s.mode()"</span>, s.mode())
</pre>
</div>

<pre class="example">
=================================== s.mode() ===================================
0    1
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'data1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'data2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>],
                   <span style="color: #ff4ea3;">'data3'</span>: [1, 2, 3, 5, 5],
                   <span style="color: #ff4ea3;">'data4'</span>: [6, 7, 8, 8, 9]})
show_dataframe(df.mode())
</pre>
</div>


<div id="img/fig37020hxO.png" class="figure">
<p><img src="img/fig37020hxO.png" alt="fig37020hxO.png">
</p>
<p><span class="figure-number">Figure 2:</span> 频繁值统计</p>
</div>
</div>
</div>



<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> 数据联结(concat)</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
<span style="color: #ff8700;">concatted</span> = pd.concat([df.iloc[:3], df.iloc[3:7], df.iloc[7:]])
show_dataframe(concatted)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">(concatted == df).all().all(): True</span>
</pre>
</div>


<div id="img/fig370207Fb.png" class="figure">
<p><img src="img/fig370207Fb.png" alt="fig370207Fb.png">
</p>
<p><span class="figure-number">Figure 3:</span> cat</p>
</div>
</div>
</div>


<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9"><span class="section-number-3">2.9</span> 数据合并(merge)</h3>
<div class="outline-text-3" id="text-2-9">
<p>
<b>相当于数据库操作中的外连接</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">left</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'lval'</span>: [1, 2]})
<span style="color: #ff8700;">right</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'rval'</span>: [4, 5]})

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">SELECT * FROM left INNER JOIN right ON left.key = right.key;</span>
<span style="color: #ff8700;">merged</span> = pd.merge(left, right, on=<span style="color: #ff4ea3;">'key'</span>)
show_dataframe(merged)
</pre>
</div>


<div id="img/fig37020Van.png" class="figure">
<p><img src="img/fig37020Van.png" alt="fig37020Van.png">
</p>
<p><span class="figure-number">Figure 4:</span> merge</p>
</div>
</div>
</div>


<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10"><span class="section-number-3">2.10</span> 行列索引转换</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*[[<span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'baz'</span>, <span style="color: #ff4ea3;">'baz'</span>,
                     <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'qux'</span>, <span style="color: #ff4ea3;">'qux'</span>],
                    [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>,
                     <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]]))
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(8, 2), index=index, columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>])
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020uCJ.png" class="figure">
<p><img src="img/fig37020uCJ.png" alt="fig37020uCJ.png">
</p>
<p><span class="figure-number">Figure 5:</span> 示例数据</p>
</div>
</div>

<div id="outline-container-sec-2-10-1" class="outline-4">
<h4 id="sec-2-10-1"><span class="section-number-4">2.10.1</span> 将列索引变为行索引 (stack)</h4>
<div class="outline-text-4" id="text-2-10-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">stacked</span> = df.stack()
log(<span style="color: #ff4ea3;">"stacked"</span>, stacked)
log(<span style="color: #ff4ea3;">"type(stacked)"</span>, <span style="color: #d18aff;">type</span>(stacked))
log(<span style="color: #ff4ea3;">"stacked.index"</span>, stacked.index)
</pre>
</div>

<pre class="example">
=================================== stacked ====================================
first  second
bar    one     A   -1.135273
               B    0.355741
       two     A   -1.470655
               B    0.908803
baz    one     A   -0.044774
               B   -1.488249
       two     A    0.216359
               B    0.369997
foo    one     A    0.422689
               B    1.948024
       two     A    1.222006
               B   -1.109501
qux    one     A    1.631047
               B    1.612010
       two     A   -0.704234
               B    0.247101
dtype: float64
================================ type(stacked) =================================
&lt;class 'pandas.core.series.Series'&gt;
================================ stacked.index =================================
MultiIndex(levels=[['bar', 'baz', 'foo', 'qux'], ['one', 'two'], ['A', 'B']],
           labels=[[0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3], [0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1], [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1]],
           names=['first', 'second', None])
</pre>
</div>
</div>


<div id="outline-container-sec-2-10-2" class="outline-4">
<h4 id="sec-2-10-2"><span class="section-number-4">2.10.2</span> 将行索引变为列索引 (unstack)</h4>
<div class="outline-text-4" id="text-2-10-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(stacked.unstack())
</pre>
</div>


<div id="img/fig37020IXV.png" class="figure">
<p><img src="img/fig37020IXV.png" alt="fig37020IXV.png">
</p>
<p><span class="figure-number">Figure 6:</span> unstack</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11"><span class="section-number-3">2.11</span> 透视图（pivot_table）</h3>
<div class="outline-text-3" id="text-2-11">
<p>
用于观察 data frame 中一部分数据
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>] * 3,
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>] * 4,
                   <span style="color: #ff4ea3;">'C'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>] * 2,
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(12),
                   <span style="color: #ff4ea3;">'E'</span> : np.random.randn(12)})

show_dataframe(df)
</pre>
</div>


<div id="img/fig37020irh.png" class="figure">
<p><img src="img/fig37020irh.png" alt="fig37020irh.png">
</p>
<p><span class="figure-number">Figure 7:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=<span style="color: #ff4ea3;">'D'</span>, index=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
show_dataframe(result)
</pre>
</div>


<div id="img/fig370208_t.png" class="figure">
<p><img src="img/fig370208_t.png" alt="fig370208_t.png">
</p>
<p><span class="figure-number">Figure 8:</span> 以 A ，B 为行索引，以 C 为列索引的，针对 D 的数据</p>
</div>


<p>
<b>当透视表结果为多个值的时候，默认返回平均值</b> ：
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=[<span style="color: #ff4ea3;">'E'</span>], index=[<span style="color: #ff4ea3;">'A'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
show_dataframe(result)
</pre>
</div>


<div id="img/fig370207TD.png" class="figure">
<p><img src="img/fig370207TD.png" alt="fig370207TD.png">
</p>
<p><span class="figure-number">Figure 9:</span> 默认计算平均值</p>
</div>

<p>
针对 A 为 one 的那行数据，其计算过程相当于：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df[df.A==<span style="color: #ff4ea3;">'one'</span>].groupby(<span style="color: #ff4ea3;">'C'</span>)[<span style="color: #ff4ea3;">'E'</span>].mean()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
C
bar   -0.013392
foo    0.050566
Name: E, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-2-12" class="outline-3">
<h3 id="sec-2-12"><span class="section-number-3">2.12</span> 数据分类(astype('category'))</h3>
<div class="outline-text-3" id="text-2-12">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">"id"</span>:[1,2,3,4,5,6], <span style="color: #ff4ea3;">"raw_grade"</span>:[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'e'</span>]})
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">"grade"</span>] = df[<span style="color: #ff4ea3;">"raw_grade"</span>].astype(<span style="color: #ff4ea3;">"category"</span>)
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020v8b.png" class="figure">
<p><img src="img/fig37020v8b.png" alt="fig37020v8b.png">
</p>
<p><span class="figure-number">Figure 10:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.grade"</span>, df.grade)
log(<span style="color: #ff4ea3;">"df.grade.cat.categories"</span>, df.grade.cat.categories)
</pre>
</div>

<pre class="example">
=================================== df.grade ===================================
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): [a, b, e]
=========================== df.grade.cat.categories ============================
Index(['a', 'b', 'e'], dtype='object')
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df.grade.cat.categories</span> = [<span style="color: #ff4ea3;">'very good'</span>, <span style="color: #ff4ea3;">'good'</span>, <span style="color: #ff4ea3;">'bad'</span>]
<span style="color: #ff8700;">sort_result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'grade'</span>, ascending=<span style="color: #5fafd7;">False</span>)
show_dataframe(sort_result)
</pre>
</div>


<div id="img/fig37020JRo.png" class="figure">
<p><img src="img/fig37020JRo.png" alt="fig37020JRo.png">
</p>
<p><span class="figure-number">Figure 11:</span> 以 raw_grade 列为排序标准</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 索引</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 重新索引</h3>
<div class="outline-text-3" id="text-3-1">
<p>
即把索引值进行重新赋值， <b>以增加一些行的数据</b> 。
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Series</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1, 3, 5, 6, 8], index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'acefh'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    1
c    3
e    5
f    6
h    8
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'))"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>)))
</pre>
</div>

<pre class="example">
========================= s.reindex(list('abcdefgh')) ==========================
a    1.0
b    NaN
c    3.0
d    NaN
e    5.0
f    6.0
g    NaN
h    8.0
dtype: float64
</pre>
</div>


<div id="outline-container-sec-3-1-1-0-1" class="outline-6">
<h6 id="sec-3-1-1-0-1"><span class="section-number-6">3.1.1.0.1</span> 填充默认值</h6>
<div class="outline-text-6" id="text-3-1-1-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), fill_value=0)"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), fill_value=0))
</pre>
</div>

<pre class="example">
================== s.reindex(list('abcdefgh'), fill_value=0) ===================
a    1
b    0
c    3
d    0
e    5
f    6
g    0
h    8
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-1-0-2" class="outline-6">
<h6 id="sec-3-1-1-0-2"><span class="section-number-6">3.1.1.0.2</span> 往前填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='ffill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='ffill') ==================
a    1
b    1
c    3
d    3
e    5
f    6
g    6
h    8
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-1-1-0-3" class="outline-6">
<h6 id="sec-3-1-1-0-3"><span class="section-number-6">3.1.1.0.3</span> 往后填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='bfill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'bfill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='bfill') ==================
a    1
b    3
c    3
d    5
e    5
f    6
g    8
h    8
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> DataFrame</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 6),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ADFH'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'six'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four      five       six
A  0.510461 -1.162299  1.123718  0.001394 -1.133817  0.667278
D -0.517797 -1.261991 -0.633396  0.755784  0.815602  1.375197
F -0.829357 -1.358877  0.110153 -1.270010 -0.027426  1.237127
H -0.007870 -0.196172  0.552996 -2.469511 -0.463788  0.597297
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1" class="outline-6">
<h6 id="sec-3-1-2-0-1"><span class="section-number-6">3.1.2.0.1</span> 对行重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'))"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>)))
</pre>
</div>

<pre class="example">
====================== df.reindex(index=list('ABCDEFGH')) ======================
        one       two     three      four      five       six
A  0.510461 -1.162299  1.123718  0.001394 -1.133817  0.667278
B       NaN       NaN       NaN       NaN       NaN       NaN
C       NaN       NaN       NaN       NaN       NaN       NaN
D -0.517797 -1.261991 -0.633396  0.755784  0.815602  1.375197
E       NaN       NaN       NaN       NaN       NaN       NaN
F -0.829357 -1.358877  0.110153 -1.270010 -0.027426  1.237127
G       NaN       NaN       NaN       NaN       NaN       NaN
H -0.007870 -0.196172  0.552996 -2.469511 -0.463788  0.597297
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1-1" class="outline-7">
<h7 id="sec-3-1-2-0-1-1"><span class="section-number-7">3.1.2.0.1.1</span> 向前填充</h7>
<div class="outline-text-7" id="text-3-1-2-0-1-1">
<p>
<b>fill method 只对行重新索引有效，不适用列</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'), method='ffill')"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
============== df.reindex(index=list('ABCDEFGH'), method='ffill') ==============
        one       two     three      four      five       six
A  0.510461 -1.162299  1.123718  0.001394 -1.133817  0.667278
B  0.510461 -1.162299  1.123718  0.001394 -1.133817  0.667278
C  0.510461 -1.162299  1.123718  0.001394 -1.133817  0.667278
D -0.517797 -1.261991 -0.633396  0.755784  0.815602  1.375197
E -0.517797 -1.261991 -0.633396  0.755784  0.815602  1.375197
F -0.829357 -1.358877  0.110153 -1.270010 -0.027426  1.237127
G -0.829357 -1.358877  0.110153 -1.270010 -0.027426  1.237127
H -0.007870 -0.196172  0.552996 -2.469511 -0.463788  0.597297
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-2-0-2" class="outline-6">
<h6 id="sec-3-1-2-0-2"><span class="section-number-6">3.1.2.0.2</span> 对列重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0)"</span>,
    df.reindex(columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'seven'</span>], fill_value=0))
</pre>
</div>

<pre class="example">
===== df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0) ======
        one     three      five  seven
A  0.510461  1.123718 -1.133817      0
D -0.517797 -0.633396  0.815602      0
F -0.829357  0.110153 -0.027426      0
H -0.007870  0.552996 -0.463788      0
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 索引命名</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.rand(5), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.271141
b    0.286240
c    0.355872
d    0.405913
e    0.588322
dtype: float64
====================================== df ======================================
        one       two     three
0 -0.484086  1.345229  1.472389
1 -0.310969  1.621659 -0.762578
2 -0.798400 -1.308033  1.596506
3 -0.797359 -0.128928  0.219157
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s.index.name</span> = <span style="color: #ff4ea3;">'alpha'</span>
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s =======================================
alpha
a    0.271141
b    0.286240
c    0.355872
d    0.405913
e    0.588322
dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.index"</span>, df.index)
log(<span style="color: #ff4ea3;">"df.columns"</span>, df.columns)

<span style="color: #ff8700;">df.index.name</span> = <span style="color: #ff4ea3;">'row'</span>
<span style="color: #ff8700;">df.columns.name</span> = <span style="color: #ff4ea3;">'col'</span>

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
=================================== df.index ===================================
RangeIndex(start=0, stop=4, step=1)
================================== df.columns ==================================
Index(['one', 'two', 'three'], dtype='object')
====================================== df ======================================
col       one       two     three
row
0   -0.484086  1.345229  1.472389
1   -0.310969  1.621659 -0.762578
2   -0.798400 -1.308033  1.596506
3   -0.797359 -0.128928  0.219157
</pre>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 重复索引</h3>
<div class="outline-text-3" id="text-3-3">
<p>
索引值有重复项的索引
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.arange(6), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcbda'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0
b    1
c    2
b    3
d    4
a    5
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['a']"</span>, s[<span style="color: #ff4ea3;">'a'</span>])
log(<span style="color: #ff4ea3;">"s.index.is_unique"</span>, s.index.is_unique)
</pre>
</div>

<pre class="example">
==================================== s['a'] ====================================
a    0
a    5
dtype: int64
============================== s.index.is_unique ===============================
False
</pre>
</div>


<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 对重复索引的处理（清洗）</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">sum_result</span> = s.groupby(s.index).<span style="color: #d18aff;">sum</span>()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#36827;&#34892;&#27714;&#21644;</span>
log(<span style="color: #ff4ea3;">"sum_result"</span>, sum_result)

<span style="color: #ff8700;">first_result</span> = s.groupby(s.index).first()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21482;&#21462;&#31532;&#19968;&#39033;</span>
log(<span style="color: #ff4ea3;">"first_result"</span>, first_result)

<span style="color: #ff8700;">avg_result</span> = s.groupby(s.index).mean()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21462;&#24179;&#22343;&#20540;</span>
log(<span style="color: #ff4ea3;">"avg_result"</span>, avg_result)
</pre>
</div>

<pre class="example">
================================== sum_result ==================================
a    5
b    4
c    2
d    4
dtype: int64
================================= first_result =================================
a    0
b    1
c    2
d    4
dtype: int64
================================== avg_result ==================================
a    2.5
b    2.0
c    2.0
d    4.0
dtype: float64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 多级索引</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<b>用二维的数据表达更高维度的数据</b> ，使数据组织方式更清晰，它使用 <code>pd.MultiIndex</code> 类来表示。
</p>
</div>

<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> 层次化索引的作用</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
比如在分析股票数据：
</p>
<ul class="org-ul">
<li>一级行索引可以是日期
</li>
<li>二级行索引可以是股票代码
</li>
<li>列索引可以是股票的交易量，开盘价，收盘价等等
</li>
</ul>

<p>
这样就可以把多个股票放在同一个时间维度下进行考察和分析。
</p>
</div>
</div>


<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Series 多级索引</h4>
<div class="outline-text-4" id="text-3-4-2">
</div><div id="outline-container-sec-3-4-2-1" class="outline-5">
<h5 id="sec-3-4-2-1"><span class="section-number-5">3.4.2.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">a</span> = [[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'c'</span>], [1, 2, 3, 1, 2, 2, 3]]
<span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*a))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
log(<span style="color: #ff4ea3;">"index"</span>, index)
<span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(7), index=index)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
log(<span style="color: #ff4ea3;">"s.index.levels[1]"</span>, s.index.levels[1])
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('a', 1), ('a', 2), ('a', 3), ('b', 1), ('b', 2), ('c', 2), ('c', 3)]
==================================== index =====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
====================================== s =======================================
first  second
a      1        -0.493361
       2         0.904171
       3        -1.981490
b      1         0.509142
       2         0.185314
c      2        -1.568566
       3        -0.410958
dtype: float64
=================================== s.index ====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
============================== s.index.levels[1] ===============================
Int64Index([1, 2, 3], dtype='int64', name='second')
</pre>
</div>
</div>

<div id="outline-container-sec-3-4-2-2" class="outline-5">
<h5 id="sec-3-4-2-2"><span class="section-number-5">3.4.2.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['b']"</span>, s[<span style="color: #ff4ea3;">'b'</span>])
log(<span style="color: #ff4ea3;">"s['b':'c']"</span>, s[<span style="color: #ff4ea3;">'b'</span>:<span style="color: #ff4ea3;">'c'</span>])
log(<span style="color: #ff4ea3;">"s[['b', 'a']]"</span>, s[[<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]])
log(<span style="color: #ff4ea3;">"s['b', 1]"</span>, s[<span style="color: #ff4ea3;">'b'</span>, 1])
log(<span style="color: #ff4ea3;">"s[:, 2]"</span>, s[:, 2])
</pre>
</div>

<pre class="example">
==================================== s['b'] ====================================
second
1    0.509142
2    0.185314
dtype: float64
================================== s['b':'c'] ==================================
first  second
b      1         0.509142
       2         0.185314
c      2        -1.568566
       3        -0.410958
dtype: float64
================================ s[['b', 'a']] =================================
first  second
a      1        -0.493361
       2         0.904171
       3        -1.981490
b      1         0.509142
       2         0.185314
dtype: float64
================================== s['b', 1] ===================================
0.509141878890176
=================================== s[:, 2] ====================================
first
a    0.904171
b    0.185314
c   -1.568566
dtype: float64
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> DataFrame 多级索引</h4>
<div class="outline-text-4" id="text-3-4-3">
</div><div id="outline-container-sec-3-4-3-1" class="outline-5">
<h5 id="sec-3-4-3-1"><span class="section-number-5">3.4.3.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">1-10 &#20043;&#38388;&#30340;&#38543;&#26426;&#25968;&#65292;4 &#34892; 3 &#21015;</span>
                  index=[[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>], [1, 2, 1, 2]],
                  columns=[[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], [<span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'blue'</span>]])
<span style="color: #ff8700;">df.index.names</span> = [<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>]
<span style="color: #ff8700;">df.columns.names</span> = [<span style="color: #ff4ea3;">'col-1'</span>, <span style="color: #ff4ea3;">'col-2'</span>]
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428gsV.png" alt="fig75428gsV.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3-2" class="outline-5">
<h5 id="sec-3-4-3-2"><span class="section-number-5">3.4.3.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-3-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.loc[<span style="color: #ff4ea3;">'a'</span>])
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286Ai.png" alt="fig754286Ai.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['a', 1]"</span>, df.loc[<span style="color: #ff4ea3;">'a'</span>, 1])
</pre>
</div>

<pre class="example">
================================ df.loc['a', 1] ================================
col-1  col-2
one    blue     6
       red      4
two    blue     8
Name: (a, 1), dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-4-3-3" class="outline-5">
<h5 id="sec-3-4-3-3"><span class="section-number-5">3.4.3.3</span> 多级索引交换</h5>
<div class="outline-text-5" id="text-3-4-3-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.swaplevel(<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>)
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UVu.png" alt="fig75428UVu.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-4" class="outline-5">
<h5 id="sec-3-4-3-4"><span class="section-number-5">3.4.3.4</span> 多级索引排序</h5>
<div class="outline-text-5" id="text-3-4-3-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(0))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">0 &#34920;&#31034;&#26681;&#25454;&#19968;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428TpD.png" alt="fig75428TpD.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(1))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#26681;&#25454;&#20108;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428t9P.png" alt="fig75428t9P.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-5" class="outline-5">
<h5 id="sec-3-4-3-5"><span class="section-number-5">3.4.3.5</span> 多级索引统计</h5>
<div class="outline-text-5" id="text-3-4-3-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=0))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HSc.png" alt="fig75428HSc.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=1))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428hmo.png" alt="fig75428hmo.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-6" class="outline-5">
<h5 id="sec-3-4-3-6"><span class="section-number-5">3.4.3.6</span> 列与索引的转换</h5>
<div class="outline-text-5" id="text-3-4-3-6">
<p>
创建多级索引比较复杂，一般情况下会从文件中读取一个 DataFrame ，
然后将其中某个列转换为多级索引，最终得到一个基于多级索引的 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
    <span style="color: #ff4ea3;">'a'</span>: <span style="color: #d18aff;">range</span>(7),
    <span style="color: #ff4ea3;">'b'</span>: <span style="color: #d18aff;">range</span>(7, 0, -1),
    <span style="color: #ff4ea3;">'c'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>],
    <span style="color: #ff4ea3;">'d'</span>: [0, 1, 2, 0, 1, 2, 3]
})
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428760.png" alt="fig75428760.png">
</p>
</div>
</div>

<div id="outline-container-sec-3-4-3-6-1" class="outline-6">
<h6 id="sec-3-4-3-6-1"><span class="section-number-6">3.4.3.6.1</span> 列转换为索引</h6>
<div class="outline-text-6" id="text-3-4-3-6-1">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.set_index(<span style="color: #ff4ea3;">'c'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286OK.png" alt="fig754286OK.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.set_index([<span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UjW.png" alt="fig75428UjW.png">
</p>
</div>
</div>
</div>



<div id="outline-container-sec-3-4-3-6-2" class="outline-6">
<h6 id="sec-3-4-3-6-2"><span class="section-number-6">3.4.3.6.2</span> 索引转换为列</h6>
<div class="outline-text-6" id="text-3-4-3-6-2">
<p>
将所有索引转换为列
</p>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.reset_index().sort_index(<span style="color: #ff4ea3;">'columns'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428u3i.png" alt="fig75428u3i.png">
</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 分组与聚合</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5)})

show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428IMv.png" alt="fig75428IMv.png">
</p>
</div>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 原理</h3>
<div class="outline-text-3" id="text-4-1">
<p>
三步曲：
</p>

<ol class="org-ol">
<li>拆分：根据什么进行分组
</li>
<li>应用：每个分组进行什么样的计算（每个组应用一个 <b>计算规则</b> ，输出一个结果）
</li>
<li>聚合：把每个分组的计算结果合并起来，构成最终输出
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> 分组</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> 对 Series 进行分组</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
通过索引对齐关联起来
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df[<span style="color: #ff4ea3;">'data1'</span>].groupby(df[<span style="color: #ff4ea3;">'key1'</span>])
log(<span style="color: #ff4ea3;">"grouped"</span>, grouped)         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">groupby &#23545;&#35937;</span>
log(<span style="color: #ff4ea3;">"grouped.mean()"</span>, grouped.mean())
<span style="color: #ff8700;">key</span> = [1, 2, 1, 2, 1]
log(<span style="color: #ff4ea3;">"df['data1'].groupby(key)"</span>, df[<span style="color: #ff4ea3;">'data1'</span>].groupby(key))
</pre>
</div>

<pre class="example">
=================================== grouped ====================================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x1093920f0&gt;
================================ grouped.mean() ================================
key1
a    4.333333
b    7.500000
Name: data1, dtype: float64
=========================== df['data1'].groupby(key) ===========================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x109392278&gt;
</pre>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).mean()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).mean())
log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).size()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).size())
</pre>
</div>

<pre class="example">
============= df['data1'].groupby([df['key1'], df['key2']]).mean() =============
key1  key2
a     one     2
      two     9
b     one     9
      two     6
Name: data1, dtype: int64
============= df['data1'].groupby([df['key1'], df['key2']]).size() =============
key1  key2
a     one     2
      two     1
b     one     1
      two     1
Name: data1, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> 对 DataFrame 进行分组（默认按行分组）</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HgE.png" alt="fig75428HgE.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]).mean()
show_dataframe(df1)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428h0Q.png" alt="fig75428h0Q.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> 对分组对象进行迭代</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby(<span style="color: #ff4ea3;">'key1'</span>):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">'='</span>*80)

<span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)
</pre>
</div>

<pre class="example">
a
   data1  data2 key1 key2
0      3      9    a  one
1      9      8    a  two
4      1      3    a  one
b
   data1  data2 key1 key2
2      9      6    b  one
3      6      8    b  two
================================================================================
('a', 'one')
   data1  data2 key1 key2
0      3      9    a  one
4      1      3    a  one
('a', 'two')
   data1  data2 key1 key2
1      9      8    a  two
('b', 'one')
   data1  data2 key1 key2
2      9      6    b  one
('b', 'two')
   data1  data2 key1 key2
3      6      8    b  two
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> 通过字典进行分组</h4>
<div class="outline-text-4" id="text-4-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
<span style="color: #ff8700;">df.iloc</span>[1, 1:3] = np.NaN
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig754287Id.png" alt="fig754287Id.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mapping</span> = {<span style="color: #ff4ea3;">'a'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'b'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'c'</span>: <span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'d'</span>: <span style="color: #ff4ea3;">'orange'</span>, <span style="color: #ff4ea3;">'e'</span>: <span style="color: #ff4ea3;">'blue'</span>}
<span style="color: #ff8700;">grouped</span> = df.groupby(mapping, axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25353;&#21015;&#20998;&#32452;</span>
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428Vdp.png" alt="fig75428Vdp.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428uFL.png" alt="fig75428uFL.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"grouped.size()"</span>, grouped.size())
</pre>
</div>

<pre class="example">
================================ grouped.size() ================================
blue      2
orange    1
red       2
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-5" class="outline-4">
<h4 id="sec-4-2-5"><span class="section-number-4">4.2.5</span> 通过函数分组</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
当函数作为分组依据时，数据表里的每个索引（可以是行索引，也可以是列索引）都会调用一次函数，
<b>函数的返回值作为分组的索引</b> ，即相同的返回值分在同一组。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
show_dataframe(df)
</pre>
</div>


<div id="img/fig75428iuj.png" class="figure">
<p><img src="img/fig75428iuj.png" alt="fig75428iuj.png">
</p>
<p><span class="figure-number">Figure 29:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">_dummy_group</span>(idx):
    <span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"idx:"</span>, idx)
    <span style="color: #a1db00;">return</span> idx

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=0"</span>)
df.groupby(_dummy_group)
<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=1"</span>)
df.groupby(_dummy_group, axis=1)
</pre>
</div>

<pre class="example">
axis=0
idx: Alice
idx: Bob
idx: Candy
idx: Dark
idx: Emily
axis=1
idx: a
idx: b
idx: c
idx: d
idx: e
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df.groupby(<span style="color: #d18aff;">len</span>)
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig754288Cw.png" alt="fig754288Cw.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-6" class="outline-4">
<h4 id="sec-4-2-6"><span class="section-number-4">4.2.6</span> 多级索引数据根据索引级别来分组</h4>
<div class="outline-text-4" id="text-4-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">columns</span> = pd.MultiIndex.from_arrays([[<span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>],
                                     [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'B'</span>]], names=[<span style="color: #ff4ea3;">'country'</span>, <span style="color: #ff4ea3;">'index'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)), columns=columns)
show_dataframe(df)
</pre>
</div>


<div id="img/fig754287WF.png" class="figure">
<p><img src="img/fig754287WF.png" alt="fig754287WF.png">
</p>
<p><span class="figure-number">Figure 31:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428VrR.png" alt="fig75428VrR.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig3702047R.png" alt="fig3702047R.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'index'</span>, axis=1).count())
</pre>
</div>



<div class="figure">
<p><img src="img/fig37020FNM.png" alt="fig37020FNM.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 数据聚合</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data3'</span>: np.random.randint(1, 10, 5)})
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020fhY.png" class="figure">
<p><img src="img/fig37020fhY.png" alt="fig37020fhY.png">
</p>
<p><span class="figure-number">Figure 35:</span> 示例数据</p>
</div>
</div>

<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> 内置聚合函数</h4>
<div class="outline-text-4" id="text-4-3-1">
</div><div id="outline-container-sec-4-3-1-1" class="outline-5">
<h5 id="sec-4-3-1-1"><span class="section-number-5">4.3.1.1</span> sum</h5>
<div class="outline-text-5" id="text-4-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020TKx.png" class="figure">
<p><img src="img/fig37020TKx.png" alt="fig37020TKx.png">
</p>
<p><span class="figure-number">Figure 36:</span> sum</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-2" class="outline-5">
<h5 id="sec-4-3-1-2"><span class="section-number-5">4.3.1.2</span> mean</h5>
<div class="outline-text-5" id="text-4-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean())
</pre>
</div>


<div id="img/fig37020SeG.png" class="figure">
<p><img src="img/fig37020SeG.png" alt="fig37020SeG.png">
</p>
<p><span class="figure-number">Figure 37:</span> mean</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-3" class="outline-5">
<h5 id="sec-4-3-1-3"><span class="section-number-5">4.3.1.3</span> size</h5>
<div class="outline-text-5" id="text-4-3-1-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.groupby('key1').size()"</span>, df.groupby(<span style="color: #ff4ea3;">'key1'</span>).size())
</pre>
</div>

<pre class="example">
========================== df.groupby('key1').size() ===========================
key1
a    3
b    2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-4-3-1-4" class="outline-5">
<h5 id="sec-4-3-1-4"><span class="section-number-5">4.3.1.4</span> count</h5>
<div class="outline-text-5" id="text-4-3-1-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).count())
</pre>
</div>


<div id="img/fig37020GHf.png" class="figure">
<p><img src="img/fig37020GHf.png" alt="fig37020GHf.png">
</p>
<p><span class="figure-number">Figure 38:</span> count</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-5" class="outline-5">
<h5 id="sec-4-3-1-5"><span class="section-number-5">4.3.1.5</span> min/max</h5>
<div class="outline-text-5" id="text-4-3-1-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).<span style="color: #d18aff;">min</span>())
</pre>
</div>


<div id="img/fig37020gbr.png" class="figure">
<p><img src="img/fig37020gbr.png" alt="fig37020gbr.png">
</p>
<p><span class="figure-number">Figure 39:</span> min</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-6" class="outline-5">
<h5 id="sec-4-3-1-6"><span class="section-number-5">4.3.1.6</span> describe</h5>
<div class="outline-text-5" id="text-4-3-1-6">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).describe())
</pre>
</div>


<div id="img/fig37020fvA.png" class="figure">
<p><img src="img/fig37020fvA.png" alt="fig37020fvA.png">
</p>
<p><span class="figure-number">Figure 40:</span> describe</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> 自定义聚合函数</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
自定义聚合函数时，需使用 <code>agg()</code> 或 <code>aggregate()</code> 函数。
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">peak_range</span>(s):
    <span style="color: #a1db00;">print</span>(s)
    <span style="color: #a1db00;">print</span>(<span style="color: #d18aff;">type</span>(s))
    <span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">'====='</span>)
    <span style="color: #a1db00;">return</span> s.<span style="color: #d18aff;">max</span>() - s.<span style="color: #d18aff;">min</span>()

<span style="color: #ff8700;">grouped</span> = df.groupby(<span style="color: #ff4ea3;">'key1'</span>)
<span style="color: #ff8700;">result</span> = grouped.agg(peak_range)
</pre>
</div>

<pre class="example">
0    3
1    5
4    6
Name: data1, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    3
3    6
Name: data1, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    6
1    7
4    1
Name: data2, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    7
3    6
Name: data2, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    7
1    9
4    3
Name: data3, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    5
3    5
Name: data3, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: key2, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: key2, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: a, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: a, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
</pre>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(result)
</pre>
</div>


<div class="figure">
<p><img src="img/fig3702051k.png" alt="fig3702051k.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> 应用多个聚合函数</h4>
<div class="outline-text-4" id="text-4-3-3">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.agg([<span style="color: #ff4ea3;">'std'</span>, <span style="color: #ff4ea3;">'mean'</span>, peak_range]))
</pre>
</div>


<div id="img/fig370205DN.png" class="figure">
<p><img src="img/fig370205DN.png" alt="fig370205DN.png">
</p>
<p><span class="figure-number">Figure 42:</span> 多个聚合函数</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> 给聚合后的列起别名</h4>
<div class="outline-text-4" id="text-4-3-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.agg([<span style="color: #ff4ea3;">'std'</span>, <span style="color: #ff4ea3;">'mean'</span>, (<span style="color: #ff4ea3;">'high-low'</span>, peak_range)]))
</pre>
</div>


<div id="img/fig37020TYZ.png" class="figure">
<p><img src="img/fig37020TYZ.png" alt="fig37020TYZ.png">
</p>
<p><span class="figure-number">Figure 43:</span> 别名</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-5" class="outline-4">
<h4 id="sec-4-3-5"><span class="section-number-4">4.3.5</span> 自定义需要显示的列</h4>
<div class="outline-text-4" id="text-4-3-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020tsl.png" class="figure">
<p><img src="img/fig37020tsl.png" alt="fig37020tsl.png">
</p>
<p><span class="figure-number">Figure 44:</span> 所有列</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped[<span style="color: #ff4ea3;">'data1'</span>, <span style="color: #ff4ea3;">'data3'</span>].<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020HBy.png" class="figure">
<p><img src="img/fig37020HBy.png" alt="fig37020HBy.png">
</p>
<p><span class="figure-number">Figure 45:</span> 自定义后的列</p>
</div>
</div>
</div>



<div id="outline-container-sec-4-3-6" class="outline-4">
<h4 id="sec-4-3-6"><span class="section-number-4">4.3.6</span> 给不同的列应用不同的聚合函数</h4>
<div class="outline-text-4" id="text-4-3-6">
<p>
使用 dict 作为参数来实现，此方法也能实现自定义需要显示的列。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'data1'</span>: [<span style="color: #ff4ea3;">'mean'</span>, peak_range, <span style="color: #ff4ea3;">'max'</span>, <span style="color: #ff4ea3;">'min'</span>],
     <span style="color: #ff4ea3;">'data2'</span>: <span style="color: #ff4ea3;">'sum'</span>}
show_dataframe(grouped.agg(d))
</pre>
</div>


<div id="img/fig37020GVH.png" class="figure">
<p><img src="img/fig37020GVH.png" alt="fig37020GVH.png">
</p>
<p><span class="figure-number">Figure 46:</span> 不同的聚合函数</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-7" class="outline-4">
<h4 id="sec-4-3-7"><span class="section-number-4">4.3.7</span> 索引重置</h4>
<div class="outline-text-4" id="text-4-3-7">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#31561;&#25928;&#20110; df.groupby('key1', as_index=False).agg(d)</span>
show_dataframe(grouped.agg(d).reset_index())
</pre>
</div>


<div id="img/fig37020gpT.png" class="figure">
<p><img src="img/fig37020gpT.png" alt="fig37020gpT.png">
</p>
<p><span class="figure-number">Figure 47:</span> reset_index 效果</p>
</div>
</div>
</div>





<div id="outline-container-sec-4-3-8" class="outline-4">
<h4 id="sec-4-3-8"><span class="section-number-4">4.3.8</span> transform</h4>
<div class="outline-text-4" id="text-4-3-8">
<p>
transform_func 作用的是分组后每个列上的数据（Series）， <b>运算结果是 Series</b> ，不是标量。
</p>


<div id="transform" class="figure">
<p><img src="img/pandas_transform.png" alt="pandas_transform.png">
</p>
<p><span class="figure-number">Figure 48:</span> transform 原理</p>
</div>
</div>

<div id="outline-container-sec-4-3-8-1" class="outline-5">
<h5 id="sec-4-3-8-1"><span class="section-number-5">4.3.8.1</span> 案例一（给每行都添加一个分组后的平均值）</h5>
<div class="outline-text-5" id="text-4-3-8-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5)})
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020USs.png" class="figure">
<p><img src="img/fig37020USs.png" alt="fig37020USs.png">
</p>
<p><span class="figure-number">Figure 49:</span> 示例数据</p>
</div>
</div>

<div id="outline-container-sec-4-3-8-1-1" class="outline-6">
<h6 id="sec-4-3-8-1-1"><span class="section-number-6">4.3.8.1.1</span> 使用 merge 实现</h6>
<div class="outline-text-6" id="text-4-3-8-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">k1_mean</span> = df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean().add_prefix(<span style="color: #ff4ea3;">'mean_'</span>)
show_dataframe(k1_mean)
</pre>
</div>


<div id="img/fig37020TmB.png" class="figure">
<p><img src="img/fig37020TmB.png" alt="fig37020TmB.png">
</p>
<p><span class="figure-number">Figure 50:</span> 先求平均值</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(pd.merge(df, k1_mean, left_on=<span style="color: #ff4ea3;">'key1'</span>, right_index=<span style="color: #5fafd7;">True</span>))
</pre>
</div>


<div id="img/fig37020t6N.png" class="figure">
<p><img src="img/fig37020t6N.png" alt="fig37020t6N.png">
</p>
<p><span class="figure-number">Figure 51:</span> 使用 merge</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-8-1-2" class="outline-6">
<h6 id="sec-4-3-8-1-2"><span class="section-number-6">4.3.8.1.2</span> 使用 transform 实现</h6>
<div class="outline-text-6" id="text-4-3-8-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">k1_mean</span> = df.groupby(<span style="color: #ff4ea3;">'key1'</span>).transform(np.mean).add_prefix(<span style="color: #ff4ea3;">'mean_'</span>)
show_dataframe(k1_mean)
</pre>
</div>


<div id="img/fig37020HPa.png" class="figure">
<p><img src="img/fig37020HPa.png" alt="fig37020HPa.png">
</p>
<p><span class="figure-number">Figure 52:</span> 使用 transform 计算平均值</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[k1_mean.columns] = k1_mean
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020hjm.png" class="figure">
<p><img src="img/fig37020hjm.png" alt="fig37020hjm.png">
</p>
<p><span class="figure-number">Figure 53:</span> 将 k1_mean 附加到原 dataframe 中</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-8-2" class="outline-5">
<h5 id="sec-4-3-8-2"><span class="section-number-5">4.3.8.2</span> 案例二（计算分组后每个值与平均值的差异）</h5>
<div class="outline-text-5" id="text-4-3-8-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
show_dataframe(df)
</pre>
</div>


<div id="img/fig3702073y.png" class="figure">
<p><img src="img/fig3702073y.png" alt="fig3702073y.png">
</p>
<p><span class="figure-number">Figure 54:</span> 示例数据</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">demean</span>(s):
    <span style="color: #a1db00;">return</span> s - s.mean()

<span style="color: #ff8700;">key</span> = [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]
<span style="color: #ff8700;">demeaned</span> = df.groupby(key).transform(demean)
show_dataframe(demeaned)
</pre>
</div>


<div id="img/fig370206LI.png" class="figure">
<p><img src="img/fig370206LI.png" alt="fig370206LI.png">
</p>
<p><span class="figure-number">Figure 55:</span> 均值差</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-9" class="outline-4">
<h4 id="sec-4-3-9"><span class="section-number-4">4.3.9</span> apply</h4>
<div class="outline-text-4" id="text-4-3-9">
<p>
<b>DataFrame 的 apply 函数是逐行或逐列来处理数据。GroupBy 的 apply 函数对每个分组进行计算。</b>
</p>

<p>
<b>apply_func 作用的是分组后每个 group 对象。</b>
</p>


<div id="apply" class="figure">
<p><img src="img/pandas_apply.png" alt="pandas_apply.png">
</p>
<p><span class="figure-number">Figure 56:</span> apply 原理</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                  <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                  <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 10),
                  <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 10)})
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020UgU.png" class="figure">
<p><img src="img/fig37020UgU.png" alt="fig37020UgU.png">
</p>
<p><span class="figure-number">Figure 57:</span> 示例数据</p>
</div>
</div>

<div id="outline-container-sec-4-3-9-1" class="outline-5">
<h5 id="sec-4-3-9-1"><span class="section-number-5">4.3.9.1</span> 案例一（根据 column 排序，输出其最大的 n 行数据）</h5>
<div class="outline-text-5" id="text-4-3-9-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">top</span>(df, n=2, column=<span style="color: #ff4ea3;">'data1'</span>):
    <span style="color: #a1db00;">return</span> df.sort_values(by=column, ascending=<span style="color: #5fafd7;">False</span>)[:n]

show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).<span style="color: #d18aff;">apply</span>(top))
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#21487;&#20197;&#20256;&#36882;&#21442;&#25968;&#65306;df.groupby('key1').apply(top, n=3, column='data2')</span>
</pre>
</div>


<div id="img/fig37020u0g.png" class="figure">
<p><img src="img/fig37020u0g.png" alt="fig37020u0g.png">
</p>
<p><span class="figure-number">Figure 58:</span> 输出 n 行</p>
</div>


<p>
禁用分组键：
</p>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>, group_keys=<span style="color: #5fafd7;">False</span>).<span style="color: #d18aff;">apply</span>(top))
</pre>
</div>


<div id="img/fig37020IJt.png" class="figure">
<p><img src="img/fig37020IJt.png" alt="fig37020IJt.png">
</p>
<p><span class="figure-number">Figure 59:</span> 禁用分组键</p>
</div>
</div>
</div>



<div id="outline-container-sec-4-3-9-2" class="outline-5">
<h5 id="sec-4-3-9-2"><span class="section-number-5">4.3.9.2</span> 案例二（用不同的分组平均值填充空缺数据）</h5>
<div class="outline-text-5" id="text-4-3-9-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">states</span> = [<span style="color: #ff4ea3;">'Ohio'</span>, <span style="color: #ff4ea3;">'New York'</span>, <span style="color: #ff4ea3;">'Vermont'</span>, <span style="color: #ff4ea3;">'Florida'</span>,
          <span style="color: #ff4ea3;">'Oregon'</span>, <span style="color: #ff4ea3;">'Nevada'</span>, <span style="color: #ff4ea3;">'California'</span>, <span style="color: #ff4ea3;">'Idaho'</span>]
<span style="color: #ff8700;">group_key</span> = [<span style="color: #ff4ea3;">'East'</span>] * 4 + [<span style="color: #ff4ea3;">'West'</span>] * 4
<span style="color: #ff8700;">data</span> = pd.Series(np.random.randn(8), index=states)
data[[<span style="color: #ff4ea3;">'Vermont'</span>, <span style="color: #ff4ea3;">'Nevada'</span>, <span style="color: #ff4ea3;">'Idaho'</span>]] = np.nan
log(<span style="color: #ff4ea3;">"data"</span>, data)

<span style="color: #ff8700;">fill_mean</span> = <span style="color: #a1db00;">lambda</span> g: g.fillna(g.mean())
<span style="color: #ff8700;">result</span> = data.groupby(group_key).<span style="color: #d18aff;">apply</span>(fill_mean)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
===================================== data =====================================
Ohio          0.586161
New York     -0.524998
Vermont            NaN
Florida       0.153255
Oregon       -0.856144
Nevada             NaN
California   -0.982317
Idaho              NaN
dtype: float64
==================================== result ====================================
Ohio          0.586161
New York     -0.524998
Vermont       0.071473
Florida       0.153255
Oregon       -0.856144
Nevada       -0.919230
California   -0.982317
Idaho        -0.919230
dtype: float64
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 处理丢失数据</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
<span style="color: #ff8700;">df1</span> = df.reindex(index=dates[0:4], columns=<span style="color: #d18aff;">list</span>(df.columns) + [<span style="color: #ff4ea3;">'E'</span>])
df1.loc[dates[1:3], <span style="color: #ff4ea3;">'E'</span>] = 1
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
                   A         B         C         D    E
2016-03-01 -1.169503  0.379738 -0.065993 -0.135991  NaN
2016-03-02 -1.390767  0.298445 -0.480922 -0.384975  1.0
2016-03-03  0.290042 -2.198048 -1.029992 -0.685874  1.0
2016-03-04  0.192356 -0.051439 -1.024347 -0.024374  NaN
</pre>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 丢弃 NaN 行</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.dropna(how='any')"</span>, df1.dropna(how=<span style="color: #ff4ea3;">'any'</span>))
</pre>
</div>

<pre class="example">
============================ df1.dropna(how='any') =============================
                   A         B         C         D    E
2016-03-02 -1.390767  0.298445 -0.480922 -0.384975  1.0
2016-03-03  0.290042 -2.198048 -1.029992 -0.685874  1.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 用默认值替换 NaN</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.fillna(value=5)"</span>, df1.fillna(value=5))
</pre>
</div>

<pre class="example">
============================= df1.fillna(value=5) ==============================
                   A         B         C         D    E
2016-03-01 -1.169503  0.379738 -0.065993 -0.135991  5.0
2016-03-02 -1.390767  0.298445 -0.480922 -0.384975  1.0
2016-03-03  0.290042 -2.198048 -1.029992 -0.685874  1.0
2016-03-04  0.192356 -0.051439 -1.024347 -0.024374  5.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 判断数据集是否包含 NaN</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.isnull(df1)"</span>, pd.isnull(df1))
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>())
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any().any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>().<span style="color: #d18aff;">any</span>())
</pre>
</div>

<pre class="example">
================================ pd.isnull(df1) ================================
                A      B      C      D      E
2016-03-01  False  False  False  False   True
2016-03-02  False  False  False  False  False
2016-03-03  False  False  False  False  False
2016-03-04  False  False  False  False   True
============================= pd.isnull(df1).any() =============================
A    False
B    False
C    False
D    False
E     True
dtype: bool
========================== pd.isnull(df1).any().any() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> NaN 不参与运算</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.mean()"</span>, df1.mean())
log(<span style="color: #ff4ea3;">"df1.mean(axis=1)"</span>, df1.mean(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.mean() ==================================
A   -0.519468
B   -0.392826
C   -0.650313
D   -0.307803
E    1.000000
dtype: float64
=============================== df1.mean(axis=1) ===============================
2016-03-01   -0.247937
2016-03-02   -0.191644
2016-03-03   -0.524774
2016-03-04   -0.226951
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.sum()"</span>, df1.<span style="color: #d18aff;">sum</span>())
log(<span style="color: #ff4ea3;">"df1.sum(axis=1)"</span>, df1.<span style="color: #d18aff;">sum</span>(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.sum() ===================================
A   -2.077873
B   -1.571304
C   -2.601253
D   -1.231213
E    2.000000
dtype: float64
=============================== df1.sum(axis=1) ================================
2016-03-01   -0.991749
2016-03-02   -0.958219
2016-03-03   -2.623872
2016-03-04   -0.907804
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.sub(s, axis='index')"</span>, df.sub(s, axis=<span style="color: #ff4ea3;">'index'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
2016-03-01    NaN
2016-03-02    NaN
2016-03-03    1.0
2016-03-04    3.0
2016-03-05    5.0
2016-03-06    NaN
Freq: D, dtype: float64
====================================== df ======================================
                   A         B         C         D
2016-03-01 -1.169503  0.379738 -0.065993 -0.135991
2016-03-02 -1.390767  0.298445 -0.480922 -0.384975
2016-03-03  0.290042 -2.198048 -1.029992 -0.685874
2016-03-04  0.192356 -0.051439 -1.024347 -0.024374
2016-03-05  1.183551  2.752682 -1.839441  0.245553
2016-03-06  1.127163  0.573775  1.255619 -0.618137
=========================== df.sub(s, axis='index') ============================
                   A         B         C         D
2016-03-01       NaN       NaN       NaN       NaN
2016-03-02       NaN       NaN       NaN       NaN
2016-03-03 -0.709958 -3.198048 -2.029992 -1.685874
2016-03-04 -2.807644 -3.051439 -4.024347 -3.024374
2016-03-05 -3.816449 -2.247318 -6.839441 -4.754447
2016-03-06       NaN       NaN       NaN       NaN
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 时间序列</h2>
<div class="outline-text-2" id="text-6">
<p>
pandas 提供了强大的时间序列功能，比如把秒级的股票数据转换为 5 分钟周期数据等。
</p>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> data_range</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=600, freq=<span style="color: #ff4ea3;">'s'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
<span style="color: #ff8700;">ts</span> = pd.Series(np.random.randint(0, 500, <span style="color: #d18aff;">len</span>(rng)), index=rng)
log(<span style="color: #ff4ea3;">"ts"</span>, ts)
</pre>
</div>

<pre class="example">
===================================== rng ======================================
DatetimeIndex(['2016-03-01 00:00:00', '2016-03-01 00:00:01',
               '2016-03-01 00:00:02', '2016-03-01 00:00:03',
               '2016-03-01 00:00:04', '2016-03-01 00:00:05',
               '2016-03-01 00:00:06', '2016-03-01 00:00:07',
               '2016-03-01 00:00:08', '2016-03-01 00:00:09',
               ...
               '2016-03-01 00:09:50', '2016-03-01 00:09:51',
               '2016-03-01 00:09:52', '2016-03-01 00:09:53',
               '2016-03-01 00:09:54', '2016-03-01 00:09:55',
               '2016-03-01 00:09:56', '2016-03-01 00:09:57',
               '2016-03-01 00:09:58', '2016-03-01 00:09:59'],
              dtype='datetime64[ns]', length=600, freq='S')
====================================== ts ======================================
2016-03-01 00:00:00    192
2016-03-01 00:00:01    388
2016-03-01 00:00:02    452
2016-03-01 00:00:03    270
2016-03-01 00:00:04    235
2016-03-01 00:00:05      6
2016-03-01 00:00:06    392
2016-03-01 00:00:07    250
2016-03-01 00:00:08    395
2016-03-01 00:00:09    468
2016-03-01 00:00:10    273
2016-03-01 00:00:11    386
2016-03-01 00:00:12    467
2016-03-01 00:00:13    171
2016-03-01 00:00:14     25
2016-03-01 00:00:15    164
2016-03-01 00:00:16    246
2016-03-01 00:00:17     21
2016-03-01 00:00:18     61
2016-03-01 00:00:19    284
2016-03-01 00:00:20    199
2016-03-01 00:00:21     33
2016-03-01 00:00:22    318
2016-03-01 00:00:23    436
2016-03-01 00:00:24    285
2016-03-01 00:00:25    356
2016-03-01 00:00:26     38
2016-03-01 00:00:27    453
2016-03-01 00:00:28    113
2016-03-01 00:00:29     89
                      ...
2016-03-01 00:09:30    489
2016-03-01 00:09:31    257
2016-03-01 00:09:32    299
2016-03-01 00:09:33    190
2016-03-01 00:09:34    217
2016-03-01 00:09:35    267
2016-03-01 00:09:36    396
2016-03-01 00:09:37    315
2016-03-01 00:09:38    162
2016-03-01 00:09:39    350
2016-03-01 00:09:40    473
2016-03-01 00:09:41    357
2016-03-01 00:09:42    495
2016-03-01 00:09:43    219
2016-03-01 00:09:44    183
2016-03-01 00:09:45      5
2016-03-01 00:09:46    465
2016-03-01 00:09:47    229
2016-03-01 00:09:48     96
2016-03-01 00:09:49    315
2016-03-01 00:09:50    112
2016-03-01 00:09:51    412
2016-03-01 00:09:52    311
2016-03-01 00:09:53    384
2016-03-01 00:09:54    262
2016-03-01 00:09:55    231
2016-03-01 00:09:56    126
2016-03-01 00:09:57    295
2016-03-01 00:09:58    149
2016-03-01 00:09:59    171
Freq: S, Length: 600, dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> 重采样</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result_sum</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'sum'</span>)
log(<span style="color: #ff4ea3;">"result_sum"</span>, result_sum)
<span style="color: #ff8700;">result_mean</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"result_mean"</span>, result_mean)
</pre>
</div>

<pre class="example">
================================== result_sum ==================================
2016-03-01 00:00:00    29552
2016-03-01 00:02:00    31326
2016-03-01 00:04:00    30626
2016-03-01 00:06:00    29622
2016-03-01 00:08:00    32108
Freq: 2T, dtype: int64
================================= result_mean ==================================
2016-03-01 00:00:00    246.266667
2016-03-01 00:02:00    261.050000
2016-03-01 00:04:00    255.216667
2016-03-01 00:06:00    246.850000
2016-03-01 00:08:00    267.566667
Freq: 2T, dtype: float64
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).sum()
  """Entry point for launching an IPython kernel.
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:3: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  This is separate from the ipykernel package so we can avoid doing imports until
</pre>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> period_range</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.period_range(<span style="color: #ff4ea3;">'2000Q1'</span>, <span style="color: #ff4ea3;">'2016Q1'</span>, freq=<span style="color: #ff4ea3;">'Q'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
log(<span style="color: #ff4ea3;">"rng.to_timestamp()"</span>, rng.to_timestamp())
</pre>
</div>

<pre class="example">
===================================== rng ======================================
PeriodIndex(['2000Q1', '2000Q2', '2000Q3', '2000Q4', '2001Q1', '2001Q2',
             '2001Q3', '2001Q4', '2002Q1', '2002Q2', '2002Q3', '2002Q4',
             '2003Q1', '2003Q2', '2003Q3', '2003Q4', '2004Q1', '2004Q2',
             '2004Q3', '2004Q4', '2005Q1', '2005Q2', '2005Q3', '2005Q4',
             '2006Q1', '2006Q2', '2006Q3', '2006Q4', '2007Q1', '2007Q2',
             '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3', '2008Q4',
             '2009Q1', '2009Q2', '2009Q3', '2009Q4', '2010Q1', '2010Q2',
             '2010Q3', '2010Q4', '2011Q1', '2011Q2', '2011Q3', '2011Q4',
             '2012Q1', '2012Q2', '2012Q3', '2012Q4', '2013Q1', '2013Q2',
             '2013Q3', '2013Q4', '2014Q1', '2014Q2', '2014Q3', '2014Q4',
             '2015Q1', '2015Q2', '2015Q3', '2015Q4', '2016Q1'],
            dtype='period[Q-DEC]', freq='Q-DEC')
============================== rng.to_timestamp() ==============================
DatetimeIndex(['2000-01-01', '2000-04-01', '2000-07-01', '2000-10-01',
               '2001-01-01', '2001-04-01', '2001-07-01', '2001-10-01',
               '2002-01-01', '2002-04-01', '2002-07-01', '2002-10-01',
               '2003-01-01', '2003-04-01', '2003-07-01', '2003-10-01',
               '2004-01-01', '2004-04-01', '2004-07-01', '2004-10-01',
               '2005-01-01', '2005-04-01', '2005-07-01', '2005-10-01',
               '2006-01-01', '2006-04-01', '2006-07-01', '2006-10-01',
               '2007-01-01', '2007-04-01', '2007-07-01', '2007-10-01',
               '2008-01-01', '2008-04-01', '2008-07-01', '2008-10-01',
               '2009-01-01', '2009-04-01', '2009-07-01', '2009-10-01',
               '2010-01-01', '2010-04-01', '2010-07-01', '2010-10-01',
               '2011-01-01', '2011-04-01', '2011-07-01', '2011-10-01',
               '2012-01-01', '2012-04-01', '2012-07-01', '2012-10-01',
               '2013-01-01', '2013-04-01', '2013-07-01', '2013-10-01',
               '2014-01-01', '2014-04-01', '2014-07-01', '2014-10-01',
               '2015-01-01', '2015-04-01', '2015-07-01', '2015-10-01',
               '2016-01-01'],
              dtype='datetime64[ns]', freq='QS-OCT')
</pre>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> 时间计算</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') - pd.Timestamp('20160201')"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) - pd.Timestamp(<span style="color: #ff4ea3;">'20160201'</span>))
log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') + pd.Timedelta(days=5)"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) + pd.Timedelta(days=5))
</pre>
</div>

<pre class="example">
============= pd.Timestamp('20160301') - pd.Timestamp('20160201') ==============
29 days 00:00:00
=============== pd.Timestamp('20160301') + pd.Timedelta(days=5) ================
2016-03-06 00:00:00
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 可视化</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Series</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ts</span> = pd.Series(np.random.randn(1000), index=pd.date_range(<span style="color: #ff4ea3;">'20000101'</span>, periods=1000))
<span style="color: #ff8700;">ts</span> = ts.cumsum()
show_fig(ts)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HE0.png" alt="fig75428HE0.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 导入导出</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 导出 csv</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(100, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
df.to_csv(<span style="color: #ff4ea3;">"/tmp/df.csv"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 导入 csv</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-ipython">pd.read_csv(<span style="color: #ff4ea3;">'/tmp/df.csv'</span>, index_col=0)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 示例工程</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> 电影数据分析</h3>
<div class="outline-text-3" id="text-9-1">
</div><div id="outline-container-sec-9-1-1" class="outline-4">
<h4 id="sec-9-1-1"><span class="section-number-4">9.1.1</span> 数据读取</h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">user_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'gender'</span>, <span style="color: #ff4ea3;">'age'</span>, <span style="color: #ff4ea3;">'occupation'</span>, <span style="color: #ff4ea3;">'zip'</span>]
<span style="color: #ff8700;">users</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/users.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>,
                      header=<span style="color: #5fafd7;">None</span>, names=user_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">rating_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'rating'</span>, <span style="color: #ff4ea3;">'timestamp'</span>]
<span style="color: #ff8700;">ratings</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/ratings.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>,
                        header=<span style="color: #5fafd7;">None</span>, names=rating_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">movie_names</span> = [<span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'title'</span>, <span style="color: #ff4ea3;">'genres'</span>]
<span style="color: #ff8700;">movies</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/movies.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>,
                       header=<span style="color: #5fafd7;">None</span>, names=movie_names, engine=<span style="color: #ff4ea3;">'python'</span>)

log(<span style="color: #ff4ea3;">"users.head()"</span>, users.head())
log(<span style="color: #ff4ea3;">"ratings.head()"</span>, ratings.head())
log(<span style="color: #ff4ea3;">"movies.head()"</span>, movies.head())
</pre>
</div>

<pre class="example">
================================= users.head() =================================
   user_id gender  age  occupation    zip
0        1      F    1          10  48067
1        2      M   56          16  70072
2        3      M   25          15  55117
3        4      M   45           7  02460
4        5      M   25          20  55455
================================ ratings.head() ================================
   user_id  movie_id  rating  timestamp
0        1      1193       5  978300760
1        1       661       3  978302109
2        1       914       3  978301968
3        1      3408       4  978300275
4        1      2355       5  978824291
================================ movies.head() =================================
   movie_id                               title                        genres
0         1                    Toy Story (1995)   Animation|Children's|Comedy
1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
2         3             Grumpier Old Men (1995)                Comedy|Romance
3         4            Waiting to Exhale (1995)                  Comedy|Drama
4         5  Father of the Bride Part II (1995)                        Comedy
</pre>
</div>
</div>

<div id="outline-container-sec-9-1-2" class="outline-4">
<h4 id="sec-9-1-2"><span class="section-number-4">9.1.2</span> 数据合并 (merge)</h4>
<div class="outline-text-4" id="text-9-1-2">
<p>
在 pandas 中，数据只有合并后才能进行分析
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = pd.merge(pd.merge(users, ratings), movies)
show_dataframe(data.head())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428GYJ.png" alt="fig75428GYJ.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-9-1-3" class="outline-4">
<h4 id="sec-9-1-3"><span class="section-number-4">9.1.3</span> 按性别查看各个电影的平均评分 (pivot_table)</h4>
<div class="outline-text-4" id="text-9-1-3">
<p>
<b>关心的值</b> 是 rating ，以 title 作为 <b>行索引</b> ，gender 作为 <b>列索引</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>,
                                       columns=<span style="color: #ff4ea3;">'gender'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"mean_ratings_gender.head()"</span>, mean_ratings_gender.head())
</pre>
</div>

<pre class="example">
========================== mean_ratings_gender.head() ==========================
gender                                F         M
title
$1,000,000 Duck (1971)         3.375000  2.761905
'Night Mother (1986)           3.388889  3.352941
'Til There Was You (1997)      2.675676  2.733333
'burbs, The (1989)             2.793478  2.962085
...And Justice for All (1979)  3.828571  3.689024
</pre>
</div>
</div>

<div id="outline-container-sec-9-1-4" class="outline-4">
<h4 id="sec-9-1-4"><span class="section-number-4">9.1.4</span> 男女意见想差最大的电影 (sort_values)</h4>
<div class="outline-text-4" id="text-9-1-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span>[<span style="color: #ff4ea3;">'diff'</span>] = mean_ratings_gender.F - mean_ratings_gender.M
<span style="color: #ff8700;">result</span> = mean_ratings_gender.sort_values(by=<span style="color: #ff4ea3;">'diff'</span>, ascending=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result.head()"</span>, result.head())
</pre>
</div>

<pre class="example">
================================ result.head() =================================
gender                                        F         M      diff
title
Tigrero: A Film That Was Never Made (1994)  1.0  4.333333 -3.333333
Neon Bible, The (1995)                      1.0  4.000000 -3.000000
Enfer, L' (1994)                            1.0  3.750000 -2.750000
Stalingrad (1993)                           1.0  3.593750 -2.593750
Killer: A Journal of Murder (1995)          1.0  3.428571 -2.428571
</pre>
</div>
</div>

<div id="outline-container-sec-9-1-5" class="outline-4">
<h4 id="sec-9-1-5"><span class="section-number-4">9.1.5</span> 参与评分人数最多 (group_by)</h4>
<div class="outline-text-4" id="text-9-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ratings_by_movie_title</span> = data.groupby(<span style="color: #ff4ea3;">'title'</span>).size()
<span style="color: #ff8700;">top_ratings</span> = ratings_by_movie_title[ratings_by_movie_title &gt; 1000]
<span style="color: #ff8700;">top_10_ratings</span> = top_ratings.sort_values(ascending=<span style="color: #5fafd7;">False</span>).head()
log(<span style="color: #ff4ea3;">"top_10_ratings"</span>, top_10_ratings)
</pre>
</div>

<pre class="example">
================================ top_10_ratings ================================
title
American Beauty (1999)                                   3428
Star Wars: Episode IV - A New Hope (1977)                2991
Star Wars: Episode V - The Empire Strikes Back (1980)    2990
Star Wars: Episode VI - Return of the Jedi (1983)        2883
Jurassic Park (1993)                                     2672
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-9-1-6" class="outline-4">
<h4 id="sec-9-1-6"><span class="section-number-4">9.1.6</span> 活跃度超过 1000 的高分电影</h4>
<div class="outline-text-4" id="text-9-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
<span style="color: #ff8700;">top_10_movies</span> = mean_ratings.loc[top_ratings.index].sort_values(by=<span style="color: #ff4ea3;">'rating'</span>,
                                                                ascending=<span style="color: #5fafd7;">False</span>).head(10)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25226;&#24179;&#22343;&#35780;&#20998;&#21644;&#28909;&#24230;&#32508;&#21512;&#36215;&#26469;</span>
<span style="color: #ff8700;">df_top_10_movies</span> = pd.DataFrame(top_10_movies)
<span style="color: #ff8700;">df_top_10_movies</span>[<span style="color: #ff4ea3;">'hot'</span>] = top_ratings.loc[top_10_movies.index]
log(<span style="color: #ff4ea3;">"df_top_10_movies"</span>, df_top_10_movies)
</pre>
</div>

<pre class="example">
=============================== df_top_10_movies ===============================
                                                      rating   hot
title
Shawshank Redemption, The (1994)                    4.554558  2227
Godfather, The (1972)                               4.524966  2223
Usual Suspects, The (1995)                          4.517106  1783
Schindler's List (1993)                             4.510417  2304
Raiders of the Lost Ark (1981)                      4.477725  2514
Rear Window (1954)                                  4.476190  1050
Star Wars: Episode IV - A New Hope (1977)           4.453694  2991
Dr. Strangelove or: How I Learned to Stop Worry...  4.449890  1367
Casablanca (1942)                                   4.412822  1669
Sixth Sense, The (1999)                             4.406263  2459
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>