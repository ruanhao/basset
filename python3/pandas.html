<!DOCTYPE html>
<html>
<head>
<title>Pandas</title>
<!-- 2018-02-18 Sun 18:41 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 创建</a>
<ul>
<li><a href="#sec-1-1">1.1. 使用字典创建</a></li>
<li><a href="#sec-1-2">1.2. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 查看信息</a>
<ul>
<li><a href="#sec-2-1">2.1. 维度</a></li>
<li><a href="#sec-2-2">2.2. 行索引信息</a></li>
<li><a href="#sec-2-3">2.3. 列索引信息</a></li>
<li><a href="#sec-2-4">2.4. 底层数据</a></li>
<li><a href="#sec-2-5">2.5. 列类型</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 排序</a>
<ul>
<li><a href="#sec-3-1">3.1. 按列索引排序</a></li>
<li><a href="#sec-3-2">3.2. 按列数据排序</a></li>
</ul>
</li>
<li><a href="#sec-4">4. 数据选择</a>
<ul>
<li><a href="#sec-4-1">4.1. 列数据（Series 类型对象）</a></li>
<li><a href="#sec-4-2">4.2. 列数据（DataFrame 类型对象）</a></li>
<li><a href="#sec-4-3">4.3. 行数据（Series 类型对象）</a></li>
<li><a href="#sec-4-4">4.4. 行数据（DataFrame 类型对象）</a></li>
<li><a href="#sec-4-5">4.5. 选择行与列</a></li>
<li><a href="#sec-4-6">4.6. 选择指定坐标</a></li>
<li><a href="#sec-4-7">4.7. 布尔选择</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. 增加列</a></li>
<li><a href="#sec-6-2">6.2. 修改列</a></li>
<li><a href="#sec-6-3">6.3. 修改指定坐标</a></li>
<li><a href="#sec-6-4">6.4. 整体赋值</a></li>
<li><a href="#sec-6-5">6.5. apply</a></li>
<li><a href="#sec-6-6">6.6. concat</a></li>
<li><a href="#sec-6-7">6.7. merge</a></li>
<li><a href="#sec-6-8">6.8. append</a></li>
<li><a href="#sec-6-9">6.9. 数据整形</a>
<ul>
<li><a href="#sec-6-9-1">6.9.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-9-2">6.9.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-9-3">6.9.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-10">6.10. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. describe</a></li>
<li><a href="#sec-7-2">7.2. value_counts</a></li>
<li><a href="#sec-7-3">7.3. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 创建</a>
<ul>
<li><a href="#sec-1-1">1.1. 使用字典创建</a></li>
<li><a href="#sec-1-2">1.2. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 查看信息</a>
<ul>
<li><a href="#sec-2-1">2.1. 维度</a></li>
<li><a href="#sec-2-2">2.2. 行索引信息</a></li>
<li><a href="#sec-2-3">2.3. 列索引信息</a></li>
<li><a href="#sec-2-4">2.4. 底层数据</a></li>
<li><a href="#sec-2-5">2.5. 列类型</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 排序</a>
<ul>
<li><a href="#sec-3-1">3.1. 按列索引排序</a></li>
<li><a href="#sec-3-2">3.2. 按列数据排序</a></li>
</ul>
</li>
<li><a href="#sec-4">4. 数据选择</a>
<ul>
<li><a href="#sec-4-1">4.1. 列数据（Series 类型对象）</a></li>
<li><a href="#sec-4-2">4.2. 列数据（DataFrame 类型对象）</a></li>
<li><a href="#sec-4-3">4.3. 行数据（Series 类型对象）</a></li>
<li><a href="#sec-4-4">4.4. 行数据（DataFrame 类型对象）</a></li>
<li><a href="#sec-4-5">4.5. 选择行与列</a></li>
<li><a href="#sec-4-6">4.6. 选择指定坐标</a></li>
<li><a href="#sec-4-7">4.7. 布尔选择</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. 增加列</a></li>
<li><a href="#sec-6-2">6.2. 修改列</a></li>
<li><a href="#sec-6-3">6.3. 修改指定坐标</a></li>
<li><a href="#sec-6-4">6.4. 整体赋值</a></li>
<li><a href="#sec-6-5">6.5. apply</a></li>
<li><a href="#sec-6-6">6.6. concat</a></li>
<li><a href="#sec-6-7">6.7. merge</a></li>
<li><a href="#sec-6-8">6.8. append</a></li>
<li><a href="#sec-6-9">6.9. 数据整形</a>
<ul>
<li><a href="#sec-6-9-1">6.9.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-9-2">6.9.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-9-3">6.9.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-10">6.10. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. describe</a></li>
<li><a href="#sec-7-2">7.2. value_counts</a></li>
<li><a href="#sec-7-3">7.3. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Author</td>
<td class="left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="left">Date</td>
<td class="left">2018-02-18 18:40:59</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 创建</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 使用字典创建</h3>
<div class="outline-text-3" id="text-1-1">
<p>
key 为 DataFrame 的列；value 为对应列下的值
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
                  <span style="color: #ff4ea3;">'A'</span>: 1,
                  <span style="color: #ff4ea3;">'B'</span>: pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>),
                  <span style="color: #ff4ea3;">'C'</span>: <span style="color: #d18aff;">range</span>(4),
                  <span style="color: #ff4ea3;">'D'</span>: np.arange(5, 9),
                  <span style="color: #ff4ea3;">'E'</span>: <span style="color: #ff4ea3;">'text'</span>,
                  <span style="color: #ff4ea3;">'F'</span>: [<span style="color: #ff4ea3;">'AA'</span>, <span style="color: #ff4ea3;">'BB'</span>, <span style="color: #ff4ea3;">'CC'</span>, <span style="color: #ff4ea3;">'DD'</span>]})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD
</pre>
</div>
</div>


<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 指定行列索引创建</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
log(<span style="color: #ff4ea3;">"dates"</span>, dates)

<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01  0.532636  0.356540 -1.411507 -0.688873
2016-03-02  0.083138 -1.824050 -0.090720 -0.311539
2016-03-03  0.745254  0.695164 -0.662537 -0.224461
2016-03-04 -1.873410  0.109342  0.533539  0.259526
2016-03-05 -0.035570 -0.782426 -0.448951  1.048616
2016-03-06 -1.234143  0.208506  1.386050 -1.733326
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 查看信息</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 维度</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.shape"</span>, df.shape)
</pre>
</div>

<pre class="example">
=================================== df.shape ===================================
(6, 4)
</pre>

<p>
DataFrame 对象可以理解为二维数组
</p>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 行索引信息</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.index"</span>, df.index)
</pre>
</div>

<pre class="example">
=================================== df.index ===================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
</pre>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 列索引信息</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.columns"</span>, df.columns)
</pre>
</div>

<pre class="example">
================================== df.columns ==================================
Index(['A', 'B', 'C', 'D'], dtype='object')
</pre>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 底层数据</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.values"</span>, df.values)
log(<span style="color: #ff4ea3;">"type(df.values)"</span>, <span style="color: #d18aff;">type</span>(df.values))
</pre>
</div>

<pre class="example">
================================== df.values ===================================
[[ 0.5326356   0.3565399  -1.41150658 -0.68887286]
 [ 0.08313765 -1.82405045 -0.09071982 -0.31153915]
 [ 0.74525439  0.69516396 -0.66253664 -0.22446133]
 [-1.87340977  0.109342    0.53353921  0.25952619]
 [-0.03556995 -0.78242599 -0.44895054  1.04861554]
 [-1.23414285  0.20850611  1.38604989 -1.73332565]]
=============================== type(df.values) ================================
&lt;class 'numpy.ndarray'&gt;
</pre>

<p>
<b>本质上 DataFrame 是对 Numpy array 的封装</b>
</p>
</div>
</div>


<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 列类型</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.dtypes"</span>, df.dtypes)
</pre>
</div>

<pre class="example">
================================== df.dtypes ===================================
A    float64
B    float64
C    float64
D    float64
dtype: object
</pre>
</div>
</div>
</div>





<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 排序</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 按列索引排序</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.sort_index(axis=1, ascending=False)"</span>, df.sort_index(axis=1, ascending=<span style="color: #5fafd7;">False</span>))
</pre>
</div>

<pre class="example">
==================== df.sort_index(axis=1, ascending=False) ====================
                   D         C         B         A
2016-03-01 -0.688873 -1.411507  0.356540  0.532636
2016-03-02 -0.311539 -0.090720 -1.824050  0.083138
2016-03-03 -0.224461 -0.662537  0.695164  0.745254
2016-03-04  0.259526  0.533539  0.109342 -1.873410
2016-03-05  1.048616 -0.448951 -0.782426 -0.035570
2016-03-06 -1.733326  1.386050  0.208506 -1.234143
</pre>
</div>
</div>


<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 按列数据排序</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.sort_values(by='C')"</span>, df.sort_values(by=<span style="color: #ff4ea3;">'C'</span>))
</pre>
</div>

<pre class="example">
============================ df.sort_values(by='C') ============================
                   A         B         C         D
2016-03-01  0.532636  0.356540 -1.411507 -0.688873
2016-03-03  0.745254  0.695164 -0.662537 -0.224461
2016-03-05 -0.035570 -0.782426 -0.448951  1.048616
2016-03-02  0.083138 -1.824050 -0.090720 -0.311539
2016-03-04 -1.873410  0.109342  0.533539  0.259526
2016-03-06 -1.234143  0.208506  1.386050 -1.733326
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 数据选择</h2>
<div class="outline-text-2" id="text-4">
<p>
使用基于标签的 <code>loc</code> 函数选择数据效率较高。
</p>

<p>
<b>DataFrame 中每一行 / 列是由一个 Series 对象组成的</b> 。
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 列数据（Series 类型对象）</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['A']"</span>, df[<span style="color: #ff4ea3;">'A'</span>])         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#31561;&#25928;&#20110; df.A</span>
log(<span style="color: #ff4ea3;">"df.iloc[0]"</span>, df.iloc[0])
</pre>
</div>

<pre class="example">
=================================== df['A'] ====================================
2016-03-01    0.532636
2016-03-02    0.083138
2016-03-03    0.745254
2016-03-04   -1.873410
2016-03-05   -0.035570
2016-03-06   -1.234143
Freq: D, Name: A, dtype: float64
================================== df.iloc[0] ==================================
A    0.532636
B    0.356540
C   -1.411507
D   -0.688873
Name: 2016-03-01 00:00:00, dtype: float64
</pre>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> 列数据（DataFrame 类型对象）</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc[:, ['A', 'B']]"</span>, df.loc[:, [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[:, 1:2]"</span>, df.iloc[:, 1:2])
</pre>
</div>

<pre class="example">
============================ df.loc[:, ['A', 'B']] =============================
                   A         B
2016-03-01  0.532636  0.356540
2016-03-02  0.083138 -1.824050
2016-03-03  0.745254  0.695164
2016-03-04 -1.873410  0.109342
2016-03-05 -0.035570 -0.782426
2016-03-06 -1.234143  0.208506
=============================== df.iloc[:, 1:2] ================================
                   B
2016-03-01  0.356540
2016-03-02 -1.824050
2016-03-03  0.695164
2016-03-04  0.109342
2016-03-05 -0.782426
2016-03-06  0.208506
</pre>
</div>
</div>


<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 行数据（Series 类型对象）</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['20160301']"</span>, df.loc[<span style="color: #ff4ea3;">'20160301'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[0]"</span>, df.iloc[0])
</pre>
</div>

<pre class="example">
============================== df.loc['20160301'] ==============================
A    0.532636
B    0.356540
C   -1.411507
D   -0.688873
Name: 2016-03-01 00:00:00, dtype: float64
================================== df.iloc[0] ==================================
A    0.532636
B    0.356540
C   -1.411507
D   -0.688873
Name: 2016-03-01 00:00:00, dtype: float64
</pre>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> 行数据（DataFrame 类型对象）</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df[2:4]"</span>, df[2:4])
log(<span style="color: #ff4ea3;">"df['20160302':'20160305']"</span>, df[<span style="color: #ff4ea3;">'20160302'</span>:<span style="color: #ff4ea3;">'20160305'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[1:3]"</span>, df.iloc[1:3])
</pre>
</div>

<pre class="example">
=================================== df[2:4] ====================================
                   A         B         C         D
2016-03-03  0.745254  0.695164 -0.662537 -0.224461
2016-03-04 -1.873410  0.109342  0.533539  0.259526
========================== df['20160302':'20160305'] ===========================
                   A         B         C         D
2016-03-02  0.083138 -1.824050 -0.090720 -0.311539
2016-03-03  0.745254  0.695164 -0.662537 -0.224461
2016-03-04 -1.873410  0.109342  0.533539  0.259526
2016-03-05 -0.035570 -0.782426 -0.448951  1.048616
================================= df.iloc[1:3] =================================
                   A         B         C         D
2016-03-02  0.083138 -1.824050 -0.090720 -0.311539
2016-03-03  0.745254  0.695164 -0.662537 -0.224461
</pre>
</div>
</div>


<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> 选择行与列</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['20160301':'20160305', ['A', 'B']]"</span>, df.loc[<span style="color: #ff4ea3;">'20160301'</span>:<span style="color: #ff4ea3;">'20160305'</span>, [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[1:3, 2:4]"</span>, df.iloc[1:3, 2:4])
</pre>
</div>

<pre class="example">
================== df.loc['20160301':'20160305', ['A', 'B']] ===================
                   A         B
2016-03-01  0.532636  0.356540
2016-03-02  0.083138 -1.824050
2016-03-03  0.745254  0.695164
2016-03-04 -1.873410  0.109342
2016-03-05 -0.035570 -0.782426
============================== df.iloc[1:3, 2:4] ===============================
                   C         D
2016-03-02 -0.090720 -0.311539
2016-03-03 -0.662537 -0.224461
</pre>
</div>
</div>


<div id="outline-container-sec-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> 选择指定坐标</h3>
<div class="outline-text-3" id="text-4-6">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['2016-03-01', 'A']"</span>, df.loc[<span style="color: #ff4ea3;">'2016-03-01'</span>, <span style="color: #ff4ea3;">'A'</span>])
log(<span style="color: #ff4ea3;">"df.at[pd.Timestamp('2016-03-01'), 'A']"</span>, df.at[pd.Timestamp(<span style="color: #ff4ea3;">'2016-03-01'</span>), <span style="color: #ff4ea3;">'A'</span>])
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">df.at['2016-03-01', 'A'] will raise error</span>
log(<span style="color: #ff4ea3;">"df.iloc[1, 1]"</span>, df.iloc[1, 1])
log(<span style="color: #ff4ea3;">"df.iat[1, 1]"</span>, df.iat[1, 1])
</pre>
</div>

<pre class="example">
========================== df.loc['2016-03-01', 'A'] ===========================
0.5326355967336309
==================== df.at[pd.Timestamp('2016-03-01'), 'A'] ====================
0.5326355967336309
================================ df.iloc[1, 1] =================================
-1.8240504511239488
================================= df.iat[1, 1] =================================
-1.8240504511239488
</pre>
</div>
</div>

<div id="outline-container-sec-4-7" class="outline-3">
<h3 id="sec-4-7"><span class="section-number-3">4.7</span> 布尔选择</h3>
<div class="outline-text-3" id="text-4-7">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df[df.A &lt; 0]"</span>, df[df.A &lt; 0])
log(<span style="color: #ff4ea3;">"df[df &gt; 0]"</span>, df[df &gt; 0])
</pre>
</div>

<pre class="example">
================================= df[df.A &lt; 0] =================================
                   A         B         C         D
2016-03-04 -1.873410  0.109342  0.533539  0.259526
2016-03-05 -0.035570 -0.782426 -0.448951  1.048616
2016-03-06 -1.234143  0.208506  1.386050 -1.733326
================================== df[df &gt; 0] ==================================
                   A         B         C         D
2016-03-01  0.532636  0.356540       NaN       NaN
2016-03-02  0.083138       NaN       NaN       NaN
2016-03-03  0.745254  0.695164       NaN       NaN
2016-03-04       NaN  0.109342  0.533539  0.259526
2016-03-05       NaN       NaN       NaN  1.048616
2016-03-06       NaN  0.208506  1.386050       NaN
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 处理丢失数据</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
<span style="color: #ff8700;">df1</span> = df.reindex(index=dates[0:4], columns=<span style="color: #d18aff;">list</span>(df.columns) + [<span style="color: #ff4ea3;">'E'</span>])
df1.loc[dates[1:3], <span style="color: #ff4ea3;">'E'</span>] = 1
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
                   A         B         C         D    E
2016-03-01  1.020773  1.023099  0.105737 -0.111994  NaN
2016-03-02 -0.778058  1.298551  0.449568  0.851687  1.0
2016-03-03 -1.213934  0.908412  1.350923 -0.778425  1.0
2016-03-04 -1.528374 -0.032039  0.433028  0.650533  NaN
</pre>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 丢弃 NaN 行</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.dropna(how='any')"</span>, df1.dropna(how=<span style="color: #ff4ea3;">'any'</span>))
</pre>
</div>

<pre class="example">
============================ df1.dropna(how='any') =============================
                   A         B         C         D    E
2016-03-02 -0.778058  1.298551  0.449568  0.851687  1.0
2016-03-03 -1.213934  0.908412  1.350923 -0.778425  1.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 用默认值替换 NaN</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.fillna(value=5)"</span>, df1.fillna(value=5))
</pre>
</div>

<pre class="example">
============================= df1.fillna(value=5) ==============================
                   A         B         C         D    E
2016-03-01  1.020773  1.023099  0.105737 -0.111994  5.0
2016-03-02 -0.778058  1.298551  0.449568  0.851687  1.0
2016-03-03 -1.213934  0.908412  1.350923 -0.778425  1.0
2016-03-04 -1.528374 -0.032039  0.433028  0.650533  5.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 判断数据集是否包含 NaN</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.isnull(df1)"</span>, pd.isnull(df1))
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>())
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any().any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>().<span style="color: #d18aff;">any</span>())
</pre>
</div>

<pre class="example">
================================ pd.isnull(df1) ================================
                A      B      C      D      E
2016-03-01  False  False  False  False   True
2016-03-02  False  False  False  False  False
2016-03-03  False  False  False  False  False
2016-03-04  False  False  False  False   True
============================= pd.isnull(df1).any() =============================
A    False
B    False
C    False
D    False
E     True
dtype: bool
========================== pd.isnull(df1).any().any() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> NaN 不参与运算</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.mean()"</span>, df1.mean())
log(<span style="color: #ff4ea3;">"df1.mean(axis=1)"</span>, df1.mean(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.mean() ==================================
A   -0.624898
B    0.799506
C    0.584814
D    0.152950
E    1.000000
dtype: float64
=============================== df1.mean(axis=1) ===============================
2016-03-01    0.509404
2016-03-02    0.564350
2016-03-03    0.253395
2016-03-04   -0.119213
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.sum()"</span>, df1.<span style="color: #d18aff;">sum</span>())
log(<span style="color: #ff4ea3;">"df1.sum(axis=1)"</span>, df1.<span style="color: #d18aff;">sum</span>(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.sum() ===================================
A   -2.499592
B    3.198023
C    2.339256
D    0.611801
E    2.000000
dtype: float64
=============================== df1.sum(axis=1) ================================
2016-03-01    2.037616
2016-03-02    2.821748
2016-03-03    1.266977
2016-03-04   -0.476853
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.sub(s, axis='index')"</span>, df.sub(s, axis=<span style="color: #ff4ea3;">'index'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
2016-03-01    NaN
2016-03-02    NaN
2016-03-03    1.0
2016-03-04    3.0
2016-03-05    5.0
2016-03-06    NaN
Freq: D, dtype: float64
====================================== df ======================================
                   A         B         C         D
2016-03-01  1.020773  1.023099  0.105737 -0.111994
2016-03-02 -0.778058  1.298551  0.449568  0.851687
2016-03-03 -1.213934  0.908412  1.350923 -0.778425
2016-03-04 -1.528374 -0.032039  0.433028  0.650533
2016-03-05  0.214027 -1.227334 -0.110959 -1.009341
2016-03-06 -2.417962 -0.359982  0.670071 -0.560019
=========================== df.sub(s, axis='index') ============================
                   A         B         C         D
2016-03-01       NaN       NaN       NaN       NaN
2016-03-02       NaN       NaN       NaN       NaN
2016-03-03 -2.213934 -0.091588  0.350923 -1.778425
2016-03-04 -4.528374 -3.032039 -2.566972 -2.349467
2016-03-05 -4.785973 -6.227334 -5.110959 -6.009341
2016-03-06       NaN       NaN       NaN       NaN
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 数据操作</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D
2016-03-01  0.697232  0.607249 -0.149952  0.399362
2016-03-02  0.637409  0.102238  0.352435 -1.051465
2016-03-03  1.502642  0.005583  0.698379 -2.819079
2016-03-04 -0.401596 -0.164851 -1.621371 -1.051040
2016-03-05 -0.320215 -0.322924  0.000743  0.445042
2016-03-06  0.302772  1.201058 -1.055231 -0.507314
</pre>
</div>


<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> 增加列</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.arange(6), index=pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6))
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'E'</span>] = s
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D  E
2016-03-01  0.697232  0.607249 -0.149952  0.399362  0
2016-03-02  0.637409  0.102238  0.352435 -1.051465  1
2016-03-03  1.502642  0.005583  0.698379 -2.819079  2
2016-03-04 -0.401596 -0.164851 -1.621371 -1.051040  3
2016-03-05 -0.320215 -0.322924  0.000743  0.445042  4
2016-03-06  0.302772  1.201058 -1.055231 -0.507314  5
</pre>
</div>
</div>


<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> 修改列</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df.loc</span>[:, <span style="color: #ff4ea3;">'A'</span>] = np.arange(10, 16)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
             A         B         C         D  E
2016-03-01  10  0.607249 -0.149952  0.399362  0
2016-03-02  11  0.102238  0.352435 -1.051465  1
2016-03-03  12  0.005583  0.698379 -2.819079  2
2016-03-04  13 -0.164851 -1.621371 -1.051040  3
2016-03-05  14 -0.322924  0.000743  0.445042  4
2016-03-06  15  1.201058 -1.055231 -0.507314  5
</pre>
</div>
</div>


<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> 修改指定坐标</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df.loc</span>[<span style="color: #ff4ea3;">'20160301'</span>, <span style="color: #ff4ea3;">'A'</span>] = 0.2
<span style="color: #ff8700;">df.at</span>[pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>), <span style="color: #ff4ea3;">'A'</span>] = 0.4
<span style="color: #ff8700;">df.iat</span>[0, 0] = 0.6
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
               A         B         C         D  E
2016-03-01   0.6  0.607249 -0.149952  0.399362  0
2016-03-02  11.0  0.102238  0.352435 -1.051465  1
2016-03-03  12.0  0.005583  0.698379 -2.819079  2
2016-03-04  13.0 -0.164851 -1.621371 -1.051040  3
2016-03-05  14.0 -0.322924  0.000743  0.445042  4
2016-03-06  15.0  1.201058 -1.055231 -0.507314  5
</pre>
</div>
</div>


<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> 整体赋值</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.loc[:, [<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]].copy()
<span style="color: #ff8700;">df2</span>[df2 &gt; 0] = -df2
log(<span style="color: #ff4ea3;">"df2"</span>, df2)
</pre>
</div>

<pre class="example">
===================================== df2 ======================================
                   B         C
2016-03-01 -0.607249 -0.149952
2016-03-02 -0.102238 -0.352435
2016-03-03 -0.005583 -0.698379
2016-03-04 -0.164851 -1.621371
2016-03-05 -0.322924 -0.000743
2016-03-06 -1.201058 -1.055231
</pre>
</div>
</div>



<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> apply</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.apply(np.cumsum)"</span>, df.<span style="color: #d18aff;">apply</span>(np.cumsum))
</pre>
</div>

<pre class="example">
============================= df.apply(np.cumsum) ==============================
               A         B         C         D   E
2016-03-01   0.6  0.607249 -0.149952  0.399362   0
2016-03-02  11.6  0.709487  0.202483 -0.652103   1
2016-03-03  23.6  0.715069  0.900861 -3.471183   3
2016-03-04  36.6  0.550218 -0.720509 -4.522223   6
2016-03-05  50.6  0.227294 -0.719766 -4.077181  10
2016-03-06  65.6  1.428352 -1.774998 -4.584495  15
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.apply(lambda x: x.max() - x.min())"</span>, df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>()))
</pre>
</div>

<pre class="example">
==================== df.apply(lambda x: x.max() - x.min()) =====================
A    14.400000
B     1.523981
C     2.319749
D     3.264121
E     5.000000
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="section-number-3">6.6</span> concat</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
          A         B         C         D
0  0.378066 -0.740079  1.127442  0.810306
1  0.973077 -0.392192 -0.859464  1.744233
2  0.289765 -0.416978 -0.069027  0.163929
3 -0.708653 -0.700105 -0.296862 -1.265261
4  0.943287  0.320653  0.821595 -2.354610
5 -0.100405 -0.200439 -0.593389  1.149051
6 -0.573298 -0.795423  0.112136 -0.207383
7 -0.622403  0.910907 -0.437496 -0.374832
8 -1.200341 -0.350762  0.755248  1.212612
9 -2.503909 -0.244715 -1.970061 -0.112274
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.concat([df.iloc[:3], df.iloc[3:7], df.iloc[7:]])
log(<span style="color: #ff4ea3;">"result"</span>, result)
log(<span style="color: #ff4ea3;">"(result == df).all().all()"</span>, (result == df).<span style="color: #d18aff;">all</span>().<span style="color: #d18aff;">all</span>())
</pre>
</div>

<pre class="example">
==================================== result ====================================
          A         B         C         D
0  0.378066 -0.740079  1.127442  0.810306
1  0.973077 -0.392192 -0.859464  1.744233
2  0.289765 -0.416978 -0.069027  0.163929
3 -0.708653 -0.700105 -0.296862 -1.265261
4  0.943287  0.320653  0.821595 -2.354610
5 -0.100405 -0.200439 -0.593389  1.149051
6 -0.573298 -0.795423  0.112136 -0.207383
7 -0.622403  0.910907 -0.437496 -0.374832
8 -1.200341 -0.350762  0.755248  1.212612
9 -2.503909 -0.244715 -1.970061 -0.112274
========================== (result == df).all().all() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-6-7" class="outline-3">
<h3 id="sec-6-7"><span class="section-number-3">6.7</span> merge</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">left</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'lval'</span>: [1, 2]})
<span style="color: #ff8700;">right</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'rval'</span>: [4, 5]})
log(<span style="color: #ff4ea3;">"left"</span>, left)
log(<span style="color: #ff4ea3;">"right"</span>, right)

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">SELECT * FROM left INNER JOIN right ON left.key = right.key;</span>
<span style="color: #ff8700;">result</span> = pd.merge(left, right, on=<span style="color: #ff4ea3;">'key'</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
===================================== left =====================================
   key  lval
0  foo     1
1  foo     2
==================================== right =====================================
   key  rval
0  foo     4
1  foo     5
==================================== result ====================================
   key  lval  rval
0  foo     1     4
1  foo     1     5
2  foo     2     4
3  foo     2     5
</pre>
</div>
</div>


<div id="outline-container-sec-6-8" class="outline-3">
<h3 id="sec-6-8"><span class="section-number-3">6.8</span> append</h3>
<div class="outline-text-3" id="text-6-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randint(1, 5, size=4), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
<span style="color: #ff8700;">result</span> = df.append(s, ignore_index=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A    2
B    1
C    1
D    3
dtype: int64
==================================== result ====================================
           A         B         C         D
0   0.378066 -0.740079  1.127442  0.810306
1   0.973077 -0.392192 -0.859464  1.744233
2   0.289765 -0.416978 -0.069027  0.163929
3  -0.708653 -0.700105 -0.296862 -1.265261
4   0.943287  0.320653  0.821595 -2.354610
5  -0.100405 -0.200439 -0.593389  1.149051
6  -0.573298 -0.795423  0.112136 -0.207383
7  -0.622403  0.910907 -0.437496 -0.374832
8  -1.200341 -0.350762  0.755248  1.212612
9  -2.503909 -0.244715 -1.970061 -0.112274
10  2.000000  1.000000  1.000000  3.000000
</pre>
</div>
</div>


<div id="outline-container-sec-6-9" class="outline-3">
<h3 id="sec-6-9"><span class="section-number-3">6.9</span> 数据整形</h3>
<div class="outline-text-3" id="text-6-9">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*[[<span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'baz'</span>, <span style="color: #ff4ea3;">'baz'</span>,
                     <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'qux'</span>, <span style="color: #ff4ea3;">'qux'</span>],
                    [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>,
                     <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]]))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(8, 2), index=index, columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('bar', 'one'), ('bar', 'two'), ('baz', 'one'), ('baz', 'two'), ('foo', 'one'), ('foo', 'two'), ('qux', 'one'), ('qux', 'two')]
====================================== df ======================================
                     A         B
first second
bar   one    -0.673452 -0.901687
      two    -1.751302 -0.722018
baz   one     1.145836 -2.092757
      two     1.892349 -1.695332
foo   one     1.036723  0.896265
      two     0.109888 -1.989356
qux   one    -0.009183  1.433188
      two     0.891392 -1.655394
</pre>
</div>

<div id="outline-container-sec-6-9-1" class="outline-4">
<h4 id="sec-6-9-1"><span class="section-number-4">6.9.1</span> 将列索引变为行索引 (stack)</h4>
<div class="outline-text-4" id="text-6-9-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">stacked</span> = df.stack()
log(<span style="color: #ff4ea3;">"stacked"</span>, stacked)
log(<span style="color: #ff4ea3;">"type(stacked)"</span>, <span style="color: #d18aff;">type</span>(stacked))
log(<span style="color: #ff4ea3;">"stacked.index"</span>, stacked.index)
</pre>
</div>

<pre class="example">
=================================== stacked ====================================
first  second
bar    one     A   -0.673452
               B   -0.901687
       two     A   -1.751302
               B   -0.722018
baz    one     A    1.145836
               B   -2.092757
       two     A    1.892349
               B   -1.695332
foo    one     A    1.036723
               B    0.896265
       two     A    0.109888
               B   -1.989356
qux    one     A   -0.009183
               B    1.433188
       two     A    0.891392
               B   -1.655394
dtype: float64
================================ type(stacked) =================================
&lt;class 'pandas.core.series.Series'&gt;
================================ stacked.index =================================
MultiIndex(levels=[['bar', 'baz', 'foo', 'qux'], ['one', 'two'], ['A', 'B']],
           labels=[[0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3], [0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1], [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1]],
           names=['first', 'second', None])
</pre>
</div>
</div>

<div id="outline-container-sec-6-9-2" class="outline-4">
<h4 id="sec-6-9-2"><span class="section-number-4">6.9.2</span> 将行索引变为列索引 (unstack)</h4>
<div class="outline-text-4" id="text-6-9-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"stacked.unstack()"</span>, stacked.unstack())
</pre>
</div>

<pre class="example">
============================== stacked.unstack() ===============================
                     A         B
first second
bar   one    -0.673452 -0.901687
      two    -1.751302 -0.722018
baz   one     1.145836 -2.092757
      two     1.892349 -1.695332
foo   one     1.036723  0.896265
      two     0.109888 -1.989356
qux   one    -0.009183  1.433188
      two     0.891392 -1.655394
</pre>
</div>
</div>

<div id="outline-container-sec-6-9-3" class="outline-4">
<h4 id="sec-6-9-3"><span class="section-number-4">6.9.3</span> 透视图（pivot_table）</h4>
<div class="outline-text-4" id="text-6-9-3">
<p>
只观察 data frame 中一部分数据
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>] * 3,
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>] * 4,
                   <span style="color: #ff4ea3;">'C'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>] * 2,
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(12),
                   <span style="color: #ff4ea3;">'E'</span> : np.random.randn(12)})

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        A  B    C         D         E
0     one  A  foo  1.134572  1.100447
1     one  B  foo -0.880082  0.176647
2     two  C  foo  0.076353  0.247115
3   three  A  bar -0.097865 -1.955502
4     one  B  bar  0.838803 -0.419073
5     one  C  bar -1.165200  0.416583
6     two  A  foo  1.163344 -1.086826
7   three  B  foo  0.946516  0.711345
8     one  C  foo  0.733041  0.260971
9     one  A  bar -0.045652  0.267900
10    two  B  bar  0.285165 -0.348909
11  three  C  bar  0.570444 -1.750690
</pre>

<p>
以 A ，B 为行索引，以 C 为列索引的，针对 D 的数据：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=<span style="color: #ff4ea3;">'D'</span>, index=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
C             bar       foo
A     B
one   A -0.045652  1.134572
      B  0.838803 -0.880082
      C -1.165200  0.733041
three A -0.097865       NaN
      B       NaN  0.946516
      C  0.570444       NaN
two   A       NaN  1.163344
      B  0.285165       NaN
      C       NaN  0.076353
</pre>

<p>
<b>当透视表结果为多个值的时候，返回平均值</b> ，如：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=[<span style="color: #ff4ea3;">'E'</span>], index=[<span style="color: #ff4ea3;">'A'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
              E
C           bar       foo
A
one    0.088470  0.512688
three -1.853096  0.711345
two   -0.348909 -0.419856
</pre>

<p>
针对 A 为 one 的那行数据，其计算过程相当于：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df[df.A==<span style="color: #ff4ea3;">'one'</span>].groupby(<span style="color: #ff4ea3;">'C'</span>).mean()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            D         E
C
bar -0.124016  0.088470
foo  0.329177  0.512688
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6-10" class="outline-3">
<h3 id="sec-6-10"><span class="section-number-3">6.10</span> Category</h3>
<div class="outline-text-3" id="text-6-10">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">"id"</span>:[1,2,3,4,5,6], <span style="color: #ff4ea3;">"raw_grade"</span>:[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'e'</span>]})
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">"grade"</span>] = df[<span style="color: #ff4ea3;">"raw_grade"</span>].astype(<span style="color: #ff4ea3;">"category"</span>)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   id raw_grade grade
0   1         a     a
1   2         b     b
2   3         b     b
3   4         a     a
4   5         a     a
5   6         e     e
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.grade"</span>, df.grade)
log(<span style="color: #ff4ea3;">"df.grade.cat.categories"</span>, df.grade.cat.categories)
<span style="color: #ff8700;">df.grade.cat.categories</span> = [<span style="color: #ff4ea3;">'very good'</span>, <span style="color: #ff4ea3;">'good'</span>, <span style="color: #ff4ea3;">'bad'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#20197; raw_grade &#21015;&#20026;&#25490;&#24207;&#26631;&#20934;</span>
<span style="color: #ff8700;">sort_result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'grade'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"sort_result"</span>, sort_result)
</pre>
</div>

<pre class="example">
=================================== df.grade ===================================
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): [a, b, e]
=========================== df.grade.cat.categories ============================
Index(['a', 'b', 'e'], dtype='object')
====================================== df ======================================
   id raw_grade      grade
0   1         a  very good
1   2         b       good
2   3         b       good
3   4         a  very good
4   5         a  very good
5   6         e        bad
================================= sort_result ==================================
   id raw_grade      grade
5   6         e        bad
2   3         b       good
1   2         b       good
4   5         a  very good
3   4         a  very good
0   1         a  very good
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 信息统计</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> describe</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.describe()"</span>, df.describe())
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.890713  1.731549 -0.819759 -1.433703
2016-03-02 -0.651259 -0.682624 -0.631661  0.032853
2016-03-03 -1.167830 -0.637942  0.310298 -1.690597
2016-03-04 -0.852791 -0.880532  0.056582 -0.511704
2016-03-05  1.086752 -1.379618  0.089785  0.440358
2016-03-06  0.568446 -0.232396  0.699720  1.474725
================================ df.describe() =================================
              A         B         C         D
count  6.000000  6.000000  6.000000  6.000000
mean  -0.317899 -0.346927 -0.049172 -0.281345
std    0.917212  1.084596  0.575091  1.189146
min   -1.167830 -1.379618 -0.819759 -1.690597
25%   -0.881233 -0.831055 -0.459600 -1.203204
50%   -0.752025 -0.660283  0.073184 -0.239426
75%    0.263520 -0.333783  0.255169  0.338482
max    1.086752  1.731549  0.699720  1.474725
</pre>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> value_counts</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randint(10, 20, size=10))
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.value_counts()"</span>, s.value_counts())
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    18
1    14
2    18
3    10
4    15
5    18
6    17
7    17
8    16
9    14
dtype: int64
=============================== s.value_counts() ===============================
18    3
14    2
17    2
15    1
10    1
16    1
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> mode</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.mode()"</span>, s.mode())
</pre>
</div>

<pre class="example">
=================================== s.mode() ===================================
0    18
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 分组统计</h2>
<div class="outline-text-2" id="text-8">
<p>
执行步骤：
</p>

<ol class="org-ol">
<li>数据分组
</li>
<li>每个组应用一个函数，输出一个结果
</li>
<li>合并每个组的结果构成最终输出
</li>
</ol>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>,
                          <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>],
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>,
                          <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>],
                   <span style="color: #ff4ea3;">'C'</span> : np.random.randn(8),
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(8)})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
     A      B         C         D
0  foo    one -1.045295 -1.136248
1  bar    one -1.097611 -0.304475
2  foo    two -0.425652  1.985694
3  bar  three  0.169674  0.058648
4  foo    two -0.814353  0.879171
5  bar    two -1.837651 -0.023279
6  foo    one -0.110396  1.438022
7  foo  three -0.473942  0.045392
</pre>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 对单列分组</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby(<span style="color: #ff4ea3;">'A'</span>).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            C         D
A
bar -2.765588 -0.269106
foo -2.869638  3.212031
</pre>
</div>
</div>


<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 对多列分组</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
A   B
bar one   -1.097611 -0.304475
    three  0.169674  0.058648
    two   -1.837651 -0.023279
foo one   -1.155691  0.301774
    three -0.473942  0.045392
    two   -1.240005  2.864865
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'A'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
B     A
one   bar -1.097611 -0.304475
      foo -1.155691  0.301774
three bar  0.169674  0.058648
      foo -0.473942  0.045392
two   bar -1.837651 -0.023279
      foo -1.240005  2.864865
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 时间序列</h2>
<div class="outline-text-2" id="text-9">
<p>
pandas 提供了强大的时间序列功能，比如把秒级的股票数据转换为 5 分钟周期数据等。
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> data_range</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=600, freq=<span style="color: #ff4ea3;">'s'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
<span style="color: #ff8700;">ts</span> = pd.Series(np.random.randint(0, 500, <span style="color: #d18aff;">len</span>(rng)), index=rng)
log(<span style="color: #ff4ea3;">"ts"</span>, ts)
</pre>
</div>

<pre class="example">
===================================== rng ======================================
DatetimeIndex(['2016-03-01 00:00:00', '2016-03-01 00:00:01',
               '2016-03-01 00:00:02', '2016-03-01 00:00:03',
               '2016-03-01 00:00:04', '2016-03-01 00:00:05',
               '2016-03-01 00:00:06', '2016-03-01 00:00:07',
               '2016-03-01 00:00:08', '2016-03-01 00:00:09',
               ...
               '2016-03-01 00:09:50', '2016-03-01 00:09:51',
               '2016-03-01 00:09:52', '2016-03-01 00:09:53',
               '2016-03-01 00:09:54', '2016-03-01 00:09:55',
               '2016-03-01 00:09:56', '2016-03-01 00:09:57',
               '2016-03-01 00:09:58', '2016-03-01 00:09:59'],
              dtype='datetime64[ns]', length=600, freq='S')
====================================== ts ======================================
2016-03-01 00:00:00    252
2016-03-01 00:00:01    261
2016-03-01 00:00:02    168
2016-03-01 00:00:03     79
2016-03-01 00:00:04    463
2016-03-01 00:00:05    244
2016-03-01 00:00:06     86
2016-03-01 00:00:07    463
2016-03-01 00:00:08    145
2016-03-01 00:00:09     13
2016-03-01 00:00:10     53
2016-03-01 00:00:11    246
2016-03-01 00:00:12    430
2016-03-01 00:00:13    115
2016-03-01 00:00:14    354
2016-03-01 00:00:15    248
2016-03-01 00:00:16    396
2016-03-01 00:00:17    418
2016-03-01 00:00:18    367
2016-03-01 00:00:19    490
2016-03-01 00:00:20    266
2016-03-01 00:00:21    239
2016-03-01 00:00:22    216
2016-03-01 00:00:23    402
2016-03-01 00:00:24    463
2016-03-01 00:00:25     23
2016-03-01 00:00:26    456
2016-03-01 00:00:27    237
2016-03-01 00:00:28    179
2016-03-01 00:00:29    214
                      ...
2016-03-01 00:09:30    449
2016-03-01 00:09:31    169
2016-03-01 00:09:32     49
2016-03-01 00:09:33    159
2016-03-01 00:09:34    471
2016-03-01 00:09:35    246
2016-03-01 00:09:36    316
2016-03-01 00:09:37    308
2016-03-01 00:09:38    207
2016-03-01 00:09:39    133
2016-03-01 00:09:40     78
2016-03-01 00:09:41     56
2016-03-01 00:09:42    249
2016-03-01 00:09:43    212
2016-03-01 00:09:44    246
2016-03-01 00:09:45    144
2016-03-01 00:09:46    370
2016-03-01 00:09:47    264
2016-03-01 00:09:48    228
2016-03-01 00:09:49    148
2016-03-01 00:09:50    362
2016-03-01 00:09:51    247
2016-03-01 00:09:52    423
2016-03-01 00:09:53     72
2016-03-01 00:09:54    263
2016-03-01 00:09:55      0
2016-03-01 00:09:56     21
2016-03-01 00:09:57    122
2016-03-01 00:09:58     85
2016-03-01 00:09:59     98
Freq: S, Length: 600, dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 重采样</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result_sum</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'sum'</span>)
log(<span style="color: #ff4ea3;">"result_sum"</span>, result_sum)
<span style="color: #ff8700;">result_mean</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"result_mean"</span>, result_mean)
</pre>
</div>

<pre class="example">
================================== result_sum ==================================
2016-03-01 00:00:00    29406
2016-03-01 00:02:00    29893
2016-03-01 00:04:00    29336
2016-03-01 00:06:00    26448
2016-03-01 00:08:00    29775
Freq: 2T, dtype: int64
================================= result_mean ==================================
2016-03-01 00:00:00    245.050000
2016-03-01 00:02:00    249.108333
2016-03-01 00:04:00    244.466667
2016-03-01 00:06:00    220.400000
2016-03-01 00:08:00    248.125000
Freq: 2T, dtype: float64
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).sum()
  """Entry point for launching an IPython kernel.
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:3: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  This is separate from the ipykernel package so we can avoid doing imports until
</pre>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> period_range</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.period_range(<span style="color: #ff4ea3;">'2000Q1'</span>, <span style="color: #ff4ea3;">'2016Q1'</span>, freq=<span style="color: #ff4ea3;">'Q'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
log(<span style="color: #ff4ea3;">"rng.to_timestamp()"</span>, rng.to_timestamp())
</pre>
</div>

<pre class="example">
===================================== rng ======================================
PeriodIndex(['2000Q1', '2000Q2', '2000Q3', '2000Q4', '2001Q1', '2001Q2',
             '2001Q3', '2001Q4', '2002Q1', '2002Q2', '2002Q3', '2002Q4',
             '2003Q1', '2003Q2', '2003Q3', '2003Q4', '2004Q1', '2004Q2',
             '2004Q3', '2004Q4', '2005Q1', '2005Q2', '2005Q3', '2005Q4',
             '2006Q1', '2006Q2', '2006Q3', '2006Q4', '2007Q1', '2007Q2',
             '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3', '2008Q4',
             '2009Q1', '2009Q2', '2009Q3', '2009Q4', '2010Q1', '2010Q2',
             '2010Q3', '2010Q4', '2011Q1', '2011Q2', '2011Q3', '2011Q4',
             '2012Q1', '2012Q2', '2012Q3', '2012Q4', '2013Q1', '2013Q2',
             '2013Q3', '2013Q4', '2014Q1', '2014Q2', '2014Q3', '2014Q4',
             '2015Q1', '2015Q2', '2015Q3', '2015Q4', '2016Q1'],
            dtype='period[Q-DEC]', freq='Q-DEC')
============================== rng.to_timestamp() ==============================
DatetimeIndex(['2000-01-01', '2000-04-01', '2000-07-01', '2000-10-01',
               '2001-01-01', '2001-04-01', '2001-07-01', '2001-10-01',
               '2002-01-01', '2002-04-01', '2002-07-01', '2002-10-01',
               '2003-01-01', '2003-04-01', '2003-07-01', '2003-10-01',
               '2004-01-01', '2004-04-01', '2004-07-01', '2004-10-01',
               '2005-01-01', '2005-04-01', '2005-07-01', '2005-10-01',
               '2006-01-01', '2006-04-01', '2006-07-01', '2006-10-01',
               '2007-01-01', '2007-04-01', '2007-07-01', '2007-10-01',
               '2008-01-01', '2008-04-01', '2008-07-01', '2008-10-01',
               '2009-01-01', '2009-04-01', '2009-07-01', '2009-10-01',
               '2010-01-01', '2010-04-01', '2010-07-01', '2010-10-01',
               '2011-01-01', '2011-04-01', '2011-07-01', '2011-10-01',
               '2012-01-01', '2012-04-01', '2012-07-01', '2012-10-01',
               '2013-01-01', '2013-04-01', '2013-07-01', '2013-10-01',
               '2014-01-01', '2014-04-01', '2014-07-01', '2014-10-01',
               '2015-01-01', '2015-04-01', '2015-07-01', '2015-10-01',
               '2016-01-01'],
              dtype='datetime64[ns]', freq='QS-OCT')
</pre>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> 时间计算</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') - pd.Timestamp('20160201')"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) - pd.Timestamp(<span style="color: #ff4ea3;">'20160201'</span>))
log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') + pd.Timedelta(days=5)"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) + pd.Timedelta(days=5))
</pre>
</div>

<pre class="example">
============= pd.Timestamp('20160301') - pd.Timestamp('20160201') ==============
29 days 00:00:00
=============== pd.Timestamp('20160301') + pd.Timedelta(days=5) ================
2016-03-06 00:00:00
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 可视化</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Series</h3>
<div class="outline-text-3" id="text-10-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ts</span> = pd.Series(np.random.randn(1000), index=pd.date_range(<span style="color: #ff4ea3;">'20000101'</span>, periods=1000))
<span style="color: #ff8700;">ts</span> = ts.cumsum()
show_fig(ts)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HE0.png" alt="fig75428HE0.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 导入导出</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> 导出 csv</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(100, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
df.to_csv(<span style="color: #ff4ea3;">"/tmp/df.csv"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 导入 csv</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">

<pre class="src src-ipython">pd.read_csv(<span style="color: #ff4ea3;">'/tmp/df.csv'</span>, index_col=0)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> 示例工程</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> 电影数据分析</h3>
<div class="outline-text-3" id="text-12-1">
</div><div id="outline-container-sec-12-1-1" class="outline-4">
<h4 id="sec-12-1-1"><span class="section-number-4">12.1.1</span> 数据读取</h4>
<div class="outline-text-4" id="text-12-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">user_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'gender'</span>, <span style="color: #ff4ea3;">'age'</span>, <span style="color: #ff4ea3;">'occupation'</span>, <span style="color: #ff4ea3;">'zip'</span>]
<span style="color: #ff8700;">users</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/users.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=user_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">rating_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'rating'</span>, <span style="color: #ff4ea3;">'timestamp'</span>]
<span style="color: #ff8700;">ratings</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/ratings.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=rating_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">movie_names</span> = [<span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'title'</span>, <span style="color: #ff4ea3;">'genres'</span>]
<span style="color: #ff8700;">movies</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/movies.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=movie_names, engine=<span style="color: #ff4ea3;">'python'</span>)

log(<span style="color: #ff4ea3;">"users.head()"</span>, users.head())
log(<span style="color: #ff4ea3;">"ratings.head()"</span>, ratings.head())
log(<span style="color: #ff4ea3;">"movies.head()"</span>, movies.head())
</pre>
</div>

<pre class="example">
================================= users.head() =================================
   user_id gender  age  occupation    zip
0        1      F    1          10  48067
1        2      M   56          16  70072
2        3      M   25          15  55117
3        4      M   45           7  02460
4        5      M   25          20  55455
================================ ratings.head() ================================
   user_id  movie_id  rating  timestamp
0        1      1193       5  978300760
1        1       661       3  978302109
2        1       914       3  978301968
3        1      3408       4  978300275
4        1      2355       5  978824291
================================ movies.head() =================================
   movie_id                               title                        genres
0         1                    Toy Story (1995)   Animation|Children's|Comedy
1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
2         3             Grumpier Old Men (1995)                Comedy|Romance
3         4            Waiting to Exhale (1995)                  Comedy|Drama
4         5  Father of the Bride Part II (1995)                        Comedy
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-2" class="outline-4">
<h4 id="sec-12-1-2"><span class="section-number-4">12.1.2</span> 数据合并 (merge)</h4>
<div class="outline-text-4" id="text-12-1-2">
<p>
在 pandas 中，数据只有合并后才能进行分析
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = pd.merge(pd.merge(users, ratings), movies)
show_dataframe(data.head())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428GYJ.png" alt="fig75428GYJ.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-12-1-3" class="outline-4">
<h4 id="sec-12-1-3"><span class="section-number-4">12.1.3</span> 按性别查看各个电影的平均评分 (pivot_table)</h4>
<div class="outline-text-4" id="text-12-1-3">
<p>
<b>关心的值</b> 是 rating ，以 title 作为 <b>行索引</b> ，gender 作为 <b>列索引</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, columns=<span style="color: #ff4ea3;">'gender'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"mean_ratings_gender.head()"</span>, mean_ratings_gender.head())
</pre>
</div>

<pre class="example">
========================== mean_ratings_gender.head() ==========================
gender                                F         M
title
$1,000,000 Duck (1971)         3.375000  2.761905
'Night Mother (1986)           3.388889  3.352941
'Til There Was You (1997)      2.675676  2.733333
'burbs, The (1989)             2.793478  2.962085
...And Justice for All (1979)  3.828571  3.689024
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-4" class="outline-4">
<h4 id="sec-12-1-4"><span class="section-number-4">12.1.4</span> 男女意见想差最大的电影 (sort_values)</h4>
<div class="outline-text-4" id="text-12-1-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span>[<span style="color: #ff4ea3;">'diff'</span>] = mean_ratings_gender.F - mean_ratings_gender.M
<span style="color: #ff8700;">result</span> = mean_ratings_gender.sort_values(by=<span style="color: #ff4ea3;">'diff'</span>, ascending=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result.head()"</span>, result.head())
</pre>
</div>

<pre class="example">
================================ result.head() =================================
gender                                        F         M      diff
title
Tigrero: A Film That Was Never Made (1994)  1.0  4.333333 -3.333333
Neon Bible, The (1995)                      1.0  4.000000 -3.000000
Enfer, L' (1994)                            1.0  3.750000 -2.750000
Stalingrad (1993)                           1.0  3.593750 -2.593750
Killer: A Journal of Murder (1995)          1.0  3.428571 -2.428571
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-5" class="outline-4">
<h4 id="sec-12-1-5"><span class="section-number-4">12.1.5</span> 参与评分人数最多 (group_by)</h4>
<div class="outline-text-4" id="text-12-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ratings_by_movie_title</span> = data.groupby(<span style="color: #ff4ea3;">'title'</span>).size()
<span style="color: #ff8700;">top_ratings</span> = ratings_by_movie_title[ratings_by_movie_title &gt; 1000]
<span style="color: #ff8700;">top_10_ratings</span> = top_ratings.sort_values(ascending=<span style="color: #5fafd7;">False</span>).head()
log(<span style="color: #ff4ea3;">"top_10_ratings"</span>, top_10_ratings)
</pre>
</div>

<pre class="example">
================================ top_10_ratings ================================
title
American Beauty (1999)                                   3428
Star Wars: Episode IV - A New Hope (1977)                2991
Star Wars: Episode V - The Empire Strikes Back (1980)    2990
Star Wars: Episode VI - Return of the Jedi (1983)        2883
Jurassic Park (1993)                                     2672
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-12-1-6" class="outline-4">
<h4 id="sec-12-1-6"><span class="section-number-4">12.1.6</span> 活跃度超过 1000 的高分电影</h4>
<div class="outline-text-4" id="text-12-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
<span style="color: #ff8700;">top_10_movies</span> = mean_ratings.loc[top_ratings.index].sort_values(by=<span style="color: #ff4ea3;">'rating'</span>, ascending=<span style="color: #5fafd7;">False</span>).head(10)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25226;&#24179;&#22343;&#35780;&#20998;&#21644;&#28909;&#24230;&#32508;&#21512;&#36215;&#26469;</span>
<span style="color: #ff8700;">df_top_10_movies</span> = pd.DataFrame(top_10_movies)
<span style="color: #ff8700;">df_top_10_movies</span>[<span style="color: #ff4ea3;">'hot'</span>] = top_ratings.loc[top_10_movies.index]
log(<span style="color: #ff4ea3;">"df_top_10_movies"</span>, df_top_10_movies)
</pre>
</div>

<pre class="example">
=============================== df_top_10_movies ===============================
                                                      rating   hot
title
Shawshank Redemption, The (1994)                    4.554558  2227
Godfather, The (1972)                               4.524966  2223
Usual Suspects, The (1995)                          4.517106  1783
Schindler's List (1993)                             4.510417  2304
Raiders of the Lost Ark (1981)                      4.477725  2514
Rear Window (1954)                                  4.476190  1050
Star Wars: Episode IV - A New Hope (1977)           4.453694  2991
Dr. Strangelove or: How I Learned to Stop Worry...  4.449890  1367
Casablanca (1942)                                   4.412822  1669
Sixth Sense, The (1999)                             4.406263  2459
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>