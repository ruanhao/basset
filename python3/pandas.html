<!DOCTYPE html>
<html>
<head>
<title>Pandas</title>
<!-- 2018-02-19 Mon 22:48 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pandas</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Series</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. 创建</a>
<ul>
<li><a href="#sec-1-1-1-1">1.1.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-1-1-2">1.1.1.2. 从字典创建</a></li>
<li><a href="#sec-1-1-1-3">1.1.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-1-2">1.1.2. 特性</a>
<ul>
<li><a href="#sec-1-1-2-1">1.1.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-1-2-2">1.1.2.2. 类字典对象</a></li>
<li><a href="#sec-1-1-2-3">1.1.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. DataFrame</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从字典创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-2-1-4">1.2.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-2-1-5">1.2.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-2-1-6">1.2.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 数据操作</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 列赋值</a></li>
<li><a href="#sec-1-2-2-4">1.2.2.4. 列删除</a></li>
<li><a href="#sec-1-2-2-5">1.2.2.5. 增加列</a>
<ul>
<li><a href="#sec-1-2-2-5-1">1.2.2.5.1. 添加到最后</a></li>
<li><a href="#sec-1-2-2-5-2">1.2.2.5.2. 指定位置添加</a></li>
<li><a href="#sec-1-2-2-5-3">1.2.2.5.3. assign()</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2-6">1.2.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-2-2-7">1.2.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-8">1.2.2.8. 行删除</a></li>
<li><a href="#sec-1-2-2-9">1.2.2.9. 行与列选择</a></li>
<li><a href="#sec-1-2-2-10">1.2.2.10. 选择指定坐标</a></li>
<li><a href="#sec-1-2-2-11">1.2.2.11. 数据对齐</a></li>
<li><a href="#sec-1-2-2-12">1.2.2.12. 使用 numpy 函数</a>
<ul>
<li><a href="#sec-1-2-2-12-1">1.2.2.12.1. DataFrame 转换为 ndarray 对象</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Panel</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-1-0-1">3.1.1.0.1. 填充默认值</a></li>
<li><a href="#sec-3-1-1-0-2">3.1.1.0.2. 往前填充</a></li>
<li><a href="#sec-3-1-1-0-3">3.1.1.0.3. 往后填充</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a>
<ul>
<li>
<ul>
<li><a href="#sec-3-1-2-0-1">3.1.2.0.1. 对行重新索引</a>
<ul>
<li><a href="#sec-3-1-2-0-1-1">3.1.2.0.1.1. 向前填充</a></li>
</ul>
</li>
<li><a href="#sec-3-1-2-0-2">3.1.2.0.2. 对列重新索引</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a>
<ul>
<li><a href="#sec-3-4-3-6-1">3.4.3.6.1. 列转换为索引</a></li>
<li><a href="#sec-3-4-3-6-2">3.4.3.6.2. 索引转换为列</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 数据聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a>
<ul>
<li><a href="#sec-4-3-1-1">4.3.1.1. sum</a></li>
<li><a href="#sec-4-3-1-2">4.3.1.2. mean</a></li>
<li><a href="#sec-4-3-1-3">4.3.1.3. size</a></li>
<li><a href="#sec-4-3-1-4">4.3.1.4. count</a></li>
<li><a href="#sec-4-3-1-5">4.3.1.5. min/max</a></li>
<li><a href="#sec-4-3-1-6">4.3.1.6. describe</a></li>
</ul>
</li>
<li><a href="#sec-4-3-2">4.3.2. 自定义聚合函数</a></li>
<li><a href="#sec-4-3-3">4.3.3. 应用多个聚合函数</a></li>
<li><a href="#sec-4-3-4">4.3.4. 给聚合后的列起别名</a></li>
<li><a href="#sec-4-3-5">4.3.5. 自定义需要显示的列</a></li>
<li><a href="#sec-4-3-6">4.3.6. 给不同的列应用不同的聚合函数</a></li>
<li><a href="#sec-4-3-7">4.3.7. 索引重置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. concat</a></li>
<li><a href="#sec-6-2">6.2. merge</a></li>
<li><a href="#sec-6-3">6.3. append</a></li>
<li><a href="#sec-6-4">6.4. 数据整形</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-4-2">6.4.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-4-3">6.4.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 核心数据结构</a>
<ul>
<li><a href="#sec-1-1">1.1. Series</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. 创建</a>
<ul>
<li><a href="#sec-1-1-1-1">1.1.1.1. 从 ndarray 创建</a></li>
<li><a href="#sec-1-1-1-2">1.1.1.2. 从字典创建</a></li>
<li><a href="#sec-1-1-1-3">1.1.1.3. 从标量创建</a></li>
</ul>
</li>
<li><a href="#sec-1-1-2">1.1.2. 特性</a>
<ul>
<li><a href="#sec-1-1-2-1">1.1.2.1. 类 ndarray 对象</a></li>
<li><a href="#sec-1-1-2-2">1.1.2.2. 类字典对象</a></li>
<li><a href="#sec-1-1-2-3">1.1.2.3. 标签对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. DataFrame</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. 创建</a>
<ul>
<li><a href="#sec-1-2-1-1">1.2.1.1. 从字典创建</a></li>
<li><a href="#sec-1-2-1-2">1.2.1.2. 从结构化数据列表创建</a></li>
<li><a href="#sec-1-2-1-3">1.2.1.3. 从字典列表创建</a></li>
<li><a href="#sec-1-2-1-4">1.2.1.4. 从元组字典创建</a></li>
<li><a href="#sec-1-2-1-5">1.2.1.5. 从 Series 创建</a></li>
<li><a href="#sec-1-2-1-6">1.2.1.6. 指定行列索引创建</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">1.2.2. 数据操作</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. 列选择(Series)</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. 列选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-3">1.2.2.3. 列赋值</a></li>
<li><a href="#sec-1-2-2-4">1.2.2.4. 列删除</a></li>
<li><a href="#sec-1-2-2-5">1.2.2.5. 增加列</a></li>
<li><a href="#sec-1-2-2-6">1.2.2.6. 行选择(Series)</a></li>
<li><a href="#sec-1-2-2-7">1.2.2.7. 行选择(DataFrame)</a></li>
<li><a href="#sec-1-2-2-8">1.2.2.8. 行删除</a></li>
<li><a href="#sec-1-2-2-9">1.2.2.9. 行与列选择</a></li>
<li><a href="#sec-1-2-2-10">1.2.2.10. 选择指定坐标</a></li>
<li><a href="#sec-1-2-2-11">1.2.2.11. 数据对齐</a></li>
<li><a href="#sec-1-2-2-12">1.2.2.12. 使用 numpy 函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Panel</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 函数应用</a>
<ul>
<li><a href="#sec-2-1">2.1. 将数据按行或列进行计算(apply)</a>
<ul>
<li>
<ul>
<li><a href="#sec-2-1-0-1">2.1.0.1. 按列进行运算</a></li>
<li><a href="#sec-2-1-0-2">2.1.0.2. 按行进行运算</a></li>
<li><a href="#sec-2-1-0-3">2.1.0.3. 返回多个值组成的 Series</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 逐元素运算(applymap)</a></li>
<li><a href="#sec-2-3">2.3. 排序(sort_values)</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. 按列排序</a></li>
<li><a href="#sec-2-3-2">2.3.2. 按行排序</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. 索引排序(sort_index)</a></li>
<li><a href="#sec-2-5">2.5. 排名(rank)</a></li>
<li><a href="#sec-2-6">2.6. Series 元素统计</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 个数统计(value_counts)</a></li>
<li><a href="#sec-2-6-2">2.6.2. 唯一性统计(uniq)</a></li>
<li><a href="#sec-2-6-3">2.6.3. 成员资格统计(isin)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. 索引</a>
<ul>
<li><a href="#sec-3-1">3.1. 重新索引</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Series</a></li>
<li><a href="#sec-3-1-2">3.1.2. DataFrame</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. 索引命名</a></li>
<li><a href="#sec-3-3">3.3. 重复索引</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 对重复索引的处理（清洗）</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. 多级索引</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 层次化索引的作用</a></li>
<li><a href="#sec-3-4-2">3.4.2. Series 多级索引</a>
<ul>
<li><a href="#sec-3-4-2-1">3.4.2.1. 创建</a></li>
<li><a href="#sec-3-4-2-2">3.4.2.2. 选取</a></li>
</ul>
</li>
<li><a href="#sec-3-4-3">3.4.3. DataFrame 多级索引</a>
<ul>
<li><a href="#sec-3-4-3-1">3.4.3.1. 创建</a></li>
<li><a href="#sec-3-4-3-2">3.4.3.2. 选取</a></li>
<li><a href="#sec-3-4-3-3">3.4.3.3. 多级索引交换</a></li>
<li><a href="#sec-3-4-3-4">3.4.3.4. 多级索引排序</a></li>
<li><a href="#sec-3-4-3-5">3.4.3.5. 多级索引统计</a></li>
<li><a href="#sec-3-4-3-6">3.4.3.6. 列与索引的转换</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 分组与聚合</a>
<ul>
<li><a href="#sec-4-1">4.1. 原理</a></li>
<li><a href="#sec-4-2">4.2. 分组</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 对 Series 进行分组</a></li>
<li><a href="#sec-4-2-2">4.2.2. 对 DataFrame 进行分组（默认按行分组）</a></li>
<li><a href="#sec-4-2-3">4.2.3. 对分组对象进行迭代</a></li>
<li><a href="#sec-4-2-4">4.2.4. 通过字典进行分组</a></li>
<li><a href="#sec-4-2-5">4.2.5. 通过函数分组</a></li>
<li><a href="#sec-4-2-6">4.2.6. 多级索引数据根据索引级别来分组</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 数据聚合</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 内置聚合函数</a>
<ul>
<li><a href="#sec-4-3-1-1">4.3.1.1. sum</a></li>
<li><a href="#sec-4-3-1-2">4.3.1.2. mean</a></li>
<li><a href="#sec-4-3-1-3">4.3.1.3. size</a></li>
<li><a href="#sec-4-3-1-4">4.3.1.4. count</a></li>
<li><a href="#sec-4-3-1-5">4.3.1.5. min/max</a></li>
<li><a href="#sec-4-3-1-6">4.3.1.6. describe</a></li>
</ul>
</li>
<li><a href="#sec-4-3-2">4.3.2. 自定义聚合函数</a></li>
<li><a href="#sec-4-3-3">4.3.3. 应用多个聚合函数</a></li>
<li><a href="#sec-4-3-4">4.3.4. 给聚合后的列起别名</a></li>
<li><a href="#sec-4-3-5">4.3.5. 自定义需要显示的列</a></li>
<li><a href="#sec-4-3-6">4.3.6. 给不同的列应用不同的聚合函数</a></li>
<li><a href="#sec-4-3-7">4.3.7. 索引重置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 处理丢失数据</a>
<ul>
<li><a href="#sec-5-1">5.1. 丢弃 NaN 行</a></li>
<li><a href="#sec-5-2">5.2. 用默认值替换 NaN</a></li>
<li><a href="#sec-5-3">5.3. 判断数据集是否包含 NaN</a></li>
<li><a href="#sec-5-4">5.4. NaN 不参与运算</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 数据操作</a>
<ul>
<li><a href="#sec-6-1">6.1. concat</a></li>
<li><a href="#sec-6-2">6.2. merge</a></li>
<li><a href="#sec-6-3">6.3. append</a></li>
<li><a href="#sec-6-4">6.4. 数据整形</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. 将列索引变为行索引 (stack)</a></li>
<li><a href="#sec-6-4-2">6.4.2. 将行索引变为列索引 (unstack)</a></li>
<li><a href="#sec-6-4-3">6.4.3. 透视图（pivot_table）</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5. Category</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 信息统计</a>
<ul>
<li><a href="#sec-7-1">7.1. mode</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 分组统计</a>
<ul>
<li><a href="#sec-8-1">8.1. 对单列分组</a></li>
<li><a href="#sec-8-2">8.2. 对多列分组</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 时间序列</a>
<ul>
<li><a href="#sec-9-1">9.1. data_range</a></li>
<li><a href="#sec-9-2">9.2. 重采样</a></li>
<li><a href="#sec-9-3">9.3. period_range</a></li>
<li><a href="#sec-9-4">9.4. 时间计算</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 可视化</a>
<ul>
<li><a href="#sec-10-1">10.1. Series</a></li>
</ul>
</li>
<li><a href="#sec-11">11. 导入导出</a>
<ul>
<li><a href="#sec-11-1">11.1. 导出 csv</a></li>
<li><a href="#sec-11-2">11.2. 导入 csv</a></li>
</ul>
</li>
<li><a href="#sec-12">12. 示例工程</a>
<ul>
<li><a href="#sec-12-1">12.1. 电影数据分析</a>
<ul>
<li><a href="#sec-12-1-1">12.1.1. 数据读取</a></li>
<li><a href="#sec-12-1-2">12.1.2. 数据合并 (merge)</a></li>
<li><a href="#sec-12-1-3">12.1.3. 按性别查看各个电影的平均评分 (pivot_table)</a></li>
<li><a href="#sec-12-1-4">12.1.4. 男女意见想差最大的电影 (sort_values)</a></li>
<li><a href="#sec-12-1-5">12.1.5. 参与评分人数最多 (group_by)</a></li>
<li><a href="#sec-12-1-6">12.1.6. 活跃度超过 1000 的高分电影</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Author</td>
<td class="left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="left">Date</td>
<td class="left">2018-02-19 22:46:27</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 核心数据结构</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Series</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Series 是一维带标签的数组，数组里可以放任意的数据（整数，浮点数，字符串，Python Object）。
</p>

<p>
其基本的创建函数是： <code>pd.Series(data, index=index)</code>
</p>

<p>
其中 index 是一个列表，用来作为数据的标签。data 可以是不同的数据类型：
</p>

<ul class="org-ul">
<li>Python 字典
</li>
<li>ndarray 对象
</li>
<li>一个标量值，如 5
</li>
</ul>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-1-1">
</div><div id="outline-container-sec-1-1-1-1" class="outline-5">
<h5 id="sec-1-1-1-1"><span class="section-number-5">1.1.1.1</span> 从 ndarray 创建</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(5))
log(<span style="color: #ff4ea3;">"s2"</span>, s2)
log(<span style="color: #ff4ea3;">"s2.index"</span>, s2.index)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.654609
b    0.524601
c    0.576032
d    0.946077
e   -1.381760
dtype: float64
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s2 ======================================
0    0.248960
1    1.183231
2    1.749614
3    0.842280
4   -0.621915
dtype: float64
=================================== s2.index ===================================
RangeIndex(start=0, stop=5, step=1)
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-1-2" class="outline-5">
<h5 id="sec-1-1-1-2"><span class="section-number-5">1.1.1.2</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'a'</span> : 0., <span style="color: #ff4ea3;">'b'</span> : 1., <span style="color: #ff4ea3;">'d'</span> : 3}
<span style="color: #ff8700;">s</span> = pd.Series(d, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcd'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.0
b    1.0
c    NaN
d    3.0
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-1-3" class="outline-5">
<h5 id="sec-1-1-1-3"><span class="section-number-5">1.1.1.3</span> 从标量创建</h5>
<div class="outline-text-5" id="text-1-1-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(3, index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    3
b    3
c    3
d    3
e    3
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> 特性</h4>
<div class="outline-text-4" id="text-1-1-2">
</div><div id="outline-container-sec-1-1-2-1" class="outline-5">
<h5 id="sec-1-1-2-1"><span class="section-number-5">1.1.2.1</span> 类 ndarray 对象</h5>
<div class="outline-text-5" id="text-1-1-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5))

log(<span style="color: #ff4ea3;">"s[0]"</span>, s[0])
log(<span style="color: #ff4ea3;">"s[:3]"</span>, s[:3])
log(<span style="color: #ff4ea3;">"s[[1, 3, 4]]"</span>, s[[1, 3, 4]])
log(<span style="color: #ff4ea3;">"np.exp(s)"</span>, np.exp(s))
log(<span style="color: #ff4ea3;">"np.sin(s)"</span>, np.sin(s))
</pre>
</div>

<pre class="example">
===================================== s[0] =====================================
0.008477111495416207
==================================== s[:3] =====================================
0    0.008477
1   -0.499772
2   -0.471886
dtype: float64
================================= s[[1, 3, 4]] =================================
1   -0.499772
3   -1.785127
4   -0.427500
dtype: float64
================================== np.exp(s) ===================================
0    1.008513
1    0.606669
2    0.623825
3    0.167776
4    0.652137
dtype: float64
================================== np.sin(s) ===================================
0    0.008477
1   -0.479225
2   -0.454567
3   -0.977119
4   -0.414597
dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-1-2-2" class="outline-5">
<h5 id="sec-1-1-2-2"><span class="section-number-5">1.1.2.2</span> 类字典对象</h5>
<div class="outline-text-5" id="text-1-1-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s</span>[<span style="color: #ff4ea3;">'e'</span>] = 5
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"'e' in s"</span>, <span style="color: #ff4ea3;">'e'</span> <span style="color: #a1db00;">in</span> s)
log(<span style="color: #ff4ea3;">"s.get('f', np.nan)"</span>, s.get(<span style="color: #ff4ea3;">'f'</span>, np.nan))
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.254533
b   -0.462852
c    0.009711
d    0.041161
e    5.000000
dtype: float64
=================================== 'e' in s ===================================
True
============================== s.get('f', np.nan) ==============================
nan
</pre>
</div>
</div>


<div id="outline-container-sec-1-1-2-3" class="outline-5">
<h5 id="sec-1-1-2-3"><span class="section-number-5">1.1.2.3</span> 标签对齐</h5>
<div class="outline-text-5" id="text-1-1-2-3">
<p>
相同索引值才进行操作
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s1</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'e'</span>])
<span style="color: #ff8700;">s2</span> = pd.Series(np.random.randn(3), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])

log(<span style="color: #ff4ea3;">"s1"</span>, s1)
log(<span style="color: #ff4ea3;">"s2"</span>, s2)


log(<span style="color: #ff4ea3;">"s1 + s2"</span>, s1 + s2)
</pre>
</div>

<pre class="example">
====================================== s1 ======================================
a   -0.597988
c   -2.905320
e   -1.006727
dtype: float64
====================================== s2 ======================================
a   -2.009629
d    2.187941
e   -0.281375
dtype: float64
=================================== s1 + s2 ====================================
a   -2.607617
c         NaN
d         NaN
e   -1.288102
dtype: float64
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> DataFrame</h3>
<div class="outline-text-3" id="text-1-2">
<p>
DataFrame 是 <b>二维带行标签和列标签的数组</b> 。
</p>

<p>
可以把 DataFrame 想象成一个 Excel 表格或一个 SQL 数据库的表格，还可以想象成是一个 Series 对象字典。
</p>

<p>
它是 Pandas 里最常用的数据结构。
</p>

<p>
创建 DataFrame 的基本格式是：
</p>

<div class="org-src-container">

<pre class="src src-ipython">pd.DataFrame(data, index=index, columns=columns)
</pre>
</div>

<p>
其中 index 是行标签，columns 是列标签，data 可以是下面的数据：
</p>

<ul class="org-ul">
<li>由一维 numpy 数组，list，Series 构成的字典
</li>
<li>二维 numpy 数组
</li>
<li>一个 Series
</li>
<li>另外的 DataFrame 对象
</li>
</ul>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> 创建</h4>
<div class="outline-text-4" id="text-1-2-1">
</div><div id="outline-container-sec-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1"><span class="section-number-5">1.2.1.1</span> 从字典创建</h5>
<div class="outline-text-5" id="text-1-2-1-1">
<p>
key 为 DataFrame 的列；value 为对应列下的值
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : pd.Series([1, 2, 3], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]),
     <span style="color: #ff4ea3;">'two'</span> : pd.Series([1, 2, 3, 4], index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>], columns=[<span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
==================== pd.DataFrame(d, index=['d', 'b', 'a']) ====================
   one  two
d  NaN    4
b  2.0    2
a  1.0    1
======= pd.DataFrame(d, index=['d', 'b', 'a'], columns=['two', 'three']) =======
   two three
d    4   NaN
b    2   NaN
a    1   NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'one'</span> : [1, 2, 3, 4],
     <span style="color: #ff4ea3;">'two'</span> : [21, 22, 23, 24]}

log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
log(<span style="color: #ff4ea3;">"pd.DataFrame(d, index=['a', 'b', 'c', 'd'])"</span>, pd.DataFrame(d, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
   one  two
0    1   21
1    2   22
2    3   23
3    4   24
================= pd.DataFrame(d, index=['a', 'b', 'c', 'd']) ==================
   one  two
a    1   21
b    2   22
c    3   23
d    4   24
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
                  <span style="color: #ff4ea3;">'A'</span>: 1,
                  <span style="color: #ff4ea3;">'B'</span>: pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>),
                  <span style="color: #ff4ea3;">'C'</span>: <span style="color: #d18aff;">range</span>(4),
                  <span style="color: #ff4ea3;">'D'</span>: np.arange(5, 9),
                  <span style="color: #ff4ea3;">'E'</span>: <span style="color: #ff4ea3;">'text'</span>,
                  <span style="color: #ff4ea3;">'F'</span>: [<span style="color: #ff4ea3;">'AA'</span>, <span style="color: #ff4ea3;">'BB'</span>, <span style="color: #ff4ea3;">'CC'</span>, <span style="color: #ff4ea3;">'DD'</span>]})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   A          B  C  D     E   F
0  1 2016-03-01  0  5  text  AA
1  1 2016-03-01  1  6  text  BB
2  1 2016-03-01  2  7  text  CC
3  1 2016-03-01  3  8  text  DD
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2"><span class="section-number-5">1.2.1.2</span> 从结构化数据列表创建</h5>
<div class="outline-text-5" id="text-1-2-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [(1, 2.2, <span style="color: #ff4ea3;">'Hello'</span>), (2, 3., <span style="color: #ff4ea3;">"World"</span>)]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   0    1      2
0  1  2.2  Hello
1  2  3.0  World
==== pd.DataFrame(data, index=['first', 'second'], columns=['A', 'B', 'C']) ====
        A    B      C
first   1  2.2  Hello
second  2  3.0  World
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3"><span class="section-number-5">1.2.1.3</span> 从字典列表创建</h5>
<div class="outline-text-5" id="text-1-2-1-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = [{<span style="color: #ff4ea3;">'a'</span>: 1, <span style="color: #ff4ea3;">'b'</span>: 2}, {<span style="color: #ff4ea3;">'a'</span>: 5, <span style="color: #ff4ea3;">'b'</span>: 10, <span style="color: #ff4ea3;">'c'</span>: 20}]

log(<span style="color: #ff4ea3;">"pd.DataFrame(data)"</span>, pd.DataFrame(data))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, index=['first', 'second'])"</span>,
    pd.DataFrame(data, index=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(data, columns=['a', 'b'])"</span>,
    pd.DataFrame(data, columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>]))
</pre>
</div>

<pre class="example">
============================== pd.DataFrame(data) ==============================
   a   b     c
0  1   2   NaN
1  5  10  20.0
================ pd.DataFrame(data, index=['first', 'second']) =================
        a   b     c
first   1   2   NaN
second  5  10  20.0
==================== pd.DataFrame(data, columns=['a', 'b']) ====================
   a   b
0  1   2
1  5  10
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-4" class="outline-5">
<h5 id="sec-1-2-1-4"><span class="section-number-5">1.2.1.4</span> 从元组字典创建</h5>
<div class="outline-text-5" id="text-1-2-1-4">
<p>
实际应用中，会通过数据清洗的方式，把数据整理成方便 Pandas 导入且可读性好的格式。
然后再通过 <b>reindex/groupby</b> 等方式转换成复杂数据结构。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {(<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 1, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 2},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 3, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 4},
     (<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 5, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 6},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'C'</span>): 7, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 8},
     (<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>): {(<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'D'</span>): 9, (<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>): 10}}

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#22810;&#32423;&#26631;&#31614;</span>
log(<span style="color: #ff4ea3;">"pd.DataFrame(d)"</span>, pd.DataFrame(d))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(d) ================================
       a              b
       a    b    c    a     b
A B  4.0  1.0  5.0  8.0  10.0
  C  3.0  2.0  6.0  7.0   NaN
  D  NaN  NaN  NaN  NaN   9.0
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-5" class="outline-5">
<h5 id="sec-1-2-1-5"><span class="section-number-5">1.2.1.5</span> 从 Series 创建</h5>
<div class="outline-text-5" id="text-1-2-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(5), index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>])
log(<span style="color: #ff4ea3;">"pd.DataFrame(s)"</span>, pd.DataFrame(s))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>]))
log(<span style="color: #ff4ea3;">"pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A'])"</span>,
    pd.DataFrame(s, index=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>], columns=[<span style="color: #ff4ea3;">'A'</span>]))
</pre>
</div>

<pre class="example">
=============================== pd.DataFrame(s) ================================
          0
a  0.848499
b  0.006919
c -2.268269
d  0.920902
e  0.842584
==================== pd.DataFrame(s, index=['a', 'c', 'd']) ====================
          0
a  0.848499
c -2.268269
d  0.920902
============ pd.DataFrame(s, index=['a', 'c', 'd'], columns=['A']) =============
          A
a  0.848499
c -2.268269
d  0.920902
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-1-6" class="outline-5">
<h5 id="sec-1-2-1-6"><span class="section-number-5">1.2.1.6</span> 指定行列索引创建</h5>
<div class="outline-text-5" id="text-1-2-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
log(<span style="color: #ff4ea3;">"dates"</span>, dates)

<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6,4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== dates =====================================
DatetimeIndex(['2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04',
               '2016-03-05', '2016-03-06'],
              dtype='datetime64[ns]', freq='D')
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.524607 -1.501606 -0.543896 -1.302627
2016-03-02  0.406320 -0.866113 -0.947605 -0.006368
2016-03-03 -0.547483 -0.584272 -0.344114 -1.004443
2016-03-04 -0.231592 -0.419596  0.128426  0.993333
2016-03-05  0.095829  1.484087 -2.253950 -0.075188
2016-03-06 -0.576873  0.242221 -1.065005 -0.481174
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> 数据操作</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(6, 4),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEF'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.624742 -2.624470  0.333018 -0.237805
B -0.498780 -0.526494  1.976712 -0.733802
C -0.757928  0.342199 -1.205347 -1.739901
D  1.192872  0.576566  1.194880 -0.086314
E  0.609221 -1.135562 -0.591132  0.209602
F  1.099345  1.297526 -1.070683  0.460228
</pre>
</div>

<div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1"><span class="section-number-5">1.2.2.1</span> 列选择(Series)</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['one']"</span>, df[<span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.one"</span>, df.one)
</pre>
</div>

<pre class="example">
================================== df['one'] ===================================
A    0.624742
B   -0.498780
C   -0.757928
D    1.192872
E    0.609221
F    1.099345
Name: one, dtype: float64
==================================== df.one ====================================
A    0.624742
B   -0.498780
C   -0.757928
D    1.192872
E    0.609221
F    1.099345
Name: one, dtype: float64
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2"><span class="section-number-5">1.2.2.2</span> 列选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc[:, ['one', 'two']]"</span>, df.loc[:, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[:, 0:1]"</span>, df.iloc[:, 0:1])
</pre>
</div>

<pre class="example">
========================== df.loc[:, ['one', 'two']] ===========================
        one       two
A  0.624742 -2.624470
B -0.498780 -0.526494
C -0.757928  0.342199
D  1.192872  0.576566
E  0.609221 -1.135562
F  1.099345  1.297526
=============================== df.iloc[:, 0:1] ================================
        one
A  0.624742
B -0.498780
C -0.757928
D  1.192872
E  0.609221
F  1.099345
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3"><span class="section-number-5">1.2.2.3</span> 列赋值</h5>
<div class="outline-text-5" id="text-1-2-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'three'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] + df[<span style="color: #ff4ea3;">'two'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four
A  0.624742 -2.624470 -1.999729 -0.237805
B -0.498780 -0.526494 -1.025275 -0.733802
C -0.757928  0.342199 -0.415729 -1.739901
D  1.192872  0.576566  1.769437 -0.086314
E  0.609221 -1.135562 -0.526342  0.209602
F  1.099345  1.297526  2.396871  0.460228
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-4" class="outline-5">
<h5 id="sec-1-2-2-4"><span class="section-number-5">1.2.2.4</span> 列删除</h5>
<div class="outline-text-5" id="text-1-2-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">del</span> df[<span style="color: #ff4ea3;">'three'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two      four
A  0.624742 -2.624470 -0.237805
B -0.498780 -0.526494 -0.733802
C -0.757928  0.342199 -1.739901
D  1.192872  0.576566 -0.086314
E  0.609221 -1.135562  0.209602
F  1.099345  1.297526  0.460228
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = df.pop(<span style="color: #ff4ea3;">'four'</span>)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A   -0.237805
B   -0.733802
C   -1.739901
D   -0.086314
E    0.209602
F    0.460228
Name: four, dtype: float64
====================================== df ======================================
        one       two
A  0.624742 -2.624470
B -0.498780 -0.526494
C -0.757928  0.342199
D  1.192872  0.576566
E  0.609221 -1.135562
F  1.099345  1.297526
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop([<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">df &#19981;&#21464;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
Empty DataFrame
Columns: []
Index: [A, B, C, D, E, F]
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-5" class="outline-5">
<h5 id="sec-1-2-2-5"><span class="section-number-5">1.2.2.5</span> 增加列</h5>
<div class="outline-text-5" id="text-1-2-2-5">
</div><div id="outline-container-sec-1-2-2-5-1" class="outline-6">
<h6 id="sec-1-2-2-5-1"><span class="section-number-6">1.2.2.5.1</span> 添加到最后</h6>
<div class="outline-text-6" id="text-1-2-2-5-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'flag'</span>] = df[<span style="color: #ff4ea3;">'one'</span>] &gt; 0
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'five'</span>] = 5
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">'one_trunc'</span>] = df[<span style="color: #ff4ea3;">'one'</span>][:2]
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two   flag  five  one_trunc
A  0.624742 -2.624470   True     5   0.624742
B -0.498780 -0.526494  False     5  -0.498780
C -0.757928  0.342199  False     5        NaN
D  1.192872  0.576566   True     5        NaN
E  0.609221 -1.135562   True     5        NaN
F  1.099345  1.297526   True     5        NaN
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-5-2" class="outline-6">
<h6 id="sec-1-2-2-5-2"><span class="section-number-6">1.2.2.5.2</span> 指定位置添加</h6>
<div class="outline-text-6" id="text-1-2-2-5-2">
<div class="org-src-container">

<pre class="src src-ipython">df.insert(1, <span style="color: #ff4ea3;">'bar'</span>, df.one + df.two)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.624742 -1.999729 -2.624470   True     5   0.624742
B -0.498780 -1.025275 -0.526494  False     5  -0.498780
C -0.757928 -0.415729  0.342199  False     5        NaN
D  1.192872  1.769437  0.576566   True     5        NaN
E  0.609221 -0.526342 -1.135562   True     5        NaN
F  1.099345  2.396871  1.297526   True     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-5-3" class="outline-6">
<h6 id="sec-1-2-2-5-3"><span class="section-number-6">1.2.2.5.3</span> assign()</h6>
<div class="outline-text-6" id="text-1-2-2-5-3">
<p>
assign 方法并不会 inplace 地改变原来的 dataframe ，
该方法的 <b>优势</b> 在于可以对 dataframe 对象使用链式操作。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.assign(Ratio=df.one/df.two)
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
        one       bar       two   flag  five  one_trunc     Ratio
A  0.624742 -1.999729 -2.624470   True     5   0.624742 -0.238045
B -0.498780 -1.025275 -0.526494  False     5  -0.498780  0.947361
C -0.757928 -0.415729  0.342199  False     5        NaN -2.214874
D  1.192872  1.769437  0.576566   True     5        NaN  2.068925
E  0.609221 -0.526342 -1.135562   True     5        NaN -0.536493
F  1.099345  2.396871  1.297526   True     5        NaN  0.847262
====================================== df ======================================
        one       bar       two   flag  five  one_trunc
A  0.624742 -1.999729 -2.624470   True     5   0.624742
B -0.498780 -1.025275 -0.526494  False     5  -0.498780
C -0.757928 -0.415729  0.342199  False     5        NaN
D  1.192872  1.769437  0.576566   True     5        NaN
E  0.609221 -0.526342 -1.135562   True     5        NaN
F  1.099345  2.396871  1.297526   True     5        NaN
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.assign(Ratio=lambda x: x.one - x.two)"</span>,
    df.assign(Ratio=<span style="color: #a1db00;">lambda</span> x: x.one - x.two))

log(<span style="color: #ff4ea3;">"df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar)"</span>,
    df.assign(ABRatio=df.one/df.two).assign(BarValue=<span style="color: #a1db00;">lambda</span> x: x.ABRatio*x.bar))
</pre>
</div>

<pre class="example">
=================== df.assign(Ratio=lambda x: x.one - x.two) ===================
        one       bar       two   flag  five  one_trunc     Ratio
A  0.624742 -1.999729 -2.624470   True     5   0.624742  3.249212
B -0.498780 -1.025275 -0.526494  False     5  -0.498780  0.027714
C -0.757928 -0.415729  0.342199  False     5        NaN -1.100127
D  1.192872  1.769437  0.576566   True     5        NaN  0.616306
E  0.609221 -0.526342 -1.135562   True     5        NaN  1.744783
F  1.099345  2.396871  1.297526   True     5        NaN -0.198181
= df.assign(ABRatio=df.one/df.two).assign(BarValue=lambda x: x.ABRatio*x.bar) ==
        one       bar       two   flag  five  one_trunc   ABRatio  BarValue
A  0.624742 -1.999729 -2.624470   True     5   0.624742 -0.238045  0.476025
B -0.498780 -1.025275 -0.526494  False     5  -0.498780  0.947361 -0.971306
C -0.757928 -0.415729  0.342199  False     5        NaN -2.214874  0.920787
D  1.192872  1.769437  0.576566   True     5        NaN  2.068925  3.660834
E  0.609221 -0.526342 -1.135562   True     5        NaN -0.536493  0.282378
F  1.099345  2.396871  1.297526   True     5        NaN  0.847262  2.030778
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2-6" class="outline-5">
<h5 id="sec-1-2-2-6"><span class="section-number-5">1.2.2.6</span> 行选择(Series)</h5>
<div class="outline-text-5" id="text-1-2-2-6">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#26631;&#31614;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df.iloc[0]"</span>, df.iloc[0])    <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#34892;&#20301;&#32622;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
================================= df.loc['A'] ==================================
one          0.624742
bar          -1.99973
two          -2.62447
flag             True
five                5
one_trunc    0.624742
Name: A, dtype: object
================================== df.iloc[0] ==================================
one          0.624742
bar          -1.99973
two          -2.62447
flag             True
five                5
one_trunc    0.624742
Name: A, dtype: object
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-7" class="outline-5">
<h5 id="sec-1-2-2-7"><span class="section-number-5">1.2.2.7</span> 行选择(DataFrame)</h5>
<div class="outline-text-5" id="text-1-2-2-7">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df[2:4]"</span>, df[2:4])
log(<span style="color: #ff4ea3;">"df['A':'C']"</span>, df[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[2:4]"</span>, df.iloc[2:4])         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25928;&#29575;&#39640;</span>
log(<span style="color: #ff4ea3;">"df[df.one &gt; 0.5]"</span>, df[df.one &gt; 0.5])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[df &gt; 0]"</span>, df[df &gt; 0])             <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
log(<span style="color: #ff4ea3;">"df[[False, True, True, False, True, False]]"</span>,
    df[[<span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>, <span style="color: #5fafd7;">True</span>, <span style="color: #5fafd7;">False</span>]])  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#24067;&#23572;&#26041;&#24335;</span>
</pre>
</div>

<pre class="example">
=================================== df[2:4] ====================================
        one       bar       two   flag  five  one_trunc
C -0.757928 -0.415729  0.342199  False     5        NaN
D  1.192872  1.769437  0.576566   True     5        NaN
================================= df['A':'C'] ==================================
        one       bar       two   flag  five  one_trunc
A  0.624742 -1.999729 -2.624470   True     5   0.624742
B -0.498780 -1.025275 -0.526494  False     5  -0.498780
C -0.757928 -0.415729  0.342199  False     5        NaN
================================= df.iloc[2:4] =================================
        one       bar       two   flag  five  one_trunc
C -0.757928 -0.415729  0.342199  False     5        NaN
D  1.192872  1.769437  0.576566   True     5        NaN
=============================== df[df.one &gt; 0.5] ===============================
        one       bar       two  flag  five  one_trunc
A  0.624742 -1.999729 -2.624470  True     5   0.624742
D  1.192872  1.769437  0.576566  True     5        NaN
E  0.609221 -0.526342 -1.135562  True     5        NaN
F  1.099345  2.396871  1.297526  True     5        NaN
================================== df[df &gt; 0] ==================================
        one       bar       two  flag  five  one_trunc
A  0.624742       NaN       NaN   1.0     5   0.624742
B       NaN       NaN       NaN   NaN     5        NaN
C       NaN       NaN  0.342199   NaN     5        NaN
D  1.192872  1.769437  0.576566   1.0     5        NaN
E  0.609221       NaN       NaN   1.0     5        NaN
F  1.099345  2.396871  1.297526   1.0     5        NaN
================= df[[False, True, True, False, True, False]] ==================
        one       bar       two   flag  five  one_trunc
B -0.498780 -1.025275 -0.526494  False     5   -0.49878
C -0.757928 -0.415729  0.342199  False     5        NaN
E  0.609221 -0.526342 -1.135562   True     5        NaN
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-8" class="outline-5">
<h5 id="sec-1-2-2-8"><span class="section-number-5">1.2.2.8</span> 行删除</h5>
<div class="outline-text-5" id="text-1-2-2-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.drop(<span style="color: #ff4ea3;">'A'</span>)           <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">result &#26159;&#19968;&#20221;&#26032;&#30340;&#25968;&#25454;&#25335;&#36125;</span>
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
        one       bar       two   flag  five  one_trunc
B -0.498780 -1.025275 -0.526494  False     5   -0.49878
C -0.757928 -0.415729  0.342199  False     5        NaN
D  1.192872  1.769437  0.576566   True     5        NaN
E  0.609221 -0.526342 -1.135562   True     5        NaN
F  1.099345  2.396871  1.297526   True     5        NaN
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-9" class="outline-5">
<h5 id="sec-1-2-2-9"><span class="section-number-5">1.2.2.9</span> 行与列选择</h5>
<div class="outline-text-5" id="text-1-2-2-9">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A':'B', ['one', 'two']]"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>:<span style="color: #ff4ea3;">'B'</span>, [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]])
log(<span style="color: #ff4ea3;">"df.iloc[0:2, 0:3]"</span>, df.iloc[0:2, 0:3])
</pre>
</div>

<pre class="example">
======================= df.loc['A':'B', ['one', 'two']] ========================
        one       two
A  0.624742 -2.624470
B -0.498780 -0.526494
============================== df.iloc[0:2, 0:3] ===============================
        one       bar       two
A  0.624742 -1.999729 -2.624470
B -0.498780 -1.025275 -0.526494
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-10" class="outline-5">
<h5 id="sec-1-2-2-10"><span class="section-number-5">1.2.2.10</span> 选择指定坐标</h5>
<div class="outline-text-5" id="text-1-2-2-10">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['A', 'one']"</span>, df.loc[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.at['A', 'one']"</span>, df.at[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'one'</span>])
log(<span style="color: #ff4ea3;">"df.iloc[1, 1]"</span>, df.iloc[1, 1])
log(<span style="color: #ff4ea3;">"df.iat[1, 1]"</span>, df.iat[1, 1])
</pre>
</div>

<pre class="example">
============================== df.loc['A', 'one'] ==============================
0.624741731741543
============================== df.at['A', 'one'] ===============================
0.624741731741543
================================ df.iloc[1, 1] =================================
-1.0252747516330538
================================= df.iat[1, 1] =================================
-1.0252747516330538
</pre>
</div>
</div>


<div id="outline-container-sec-1-2-2-11" class="outline-5">
<h5 id="sec-1-2-2-11"><span class="section-number-5">1.2.2.11</span> 数据对齐</h5>
<div class="outline-text-5" id="text-1-2-2-11">
<p>
DataFrame 在进行数据计算时， <b>会自动按行和列进行数据对齐</b> 。
最终的计算结果会合并两个 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = pd.DataFrame(np.random.randn(10, 4),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefghij'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'D'</span>])

<span style="color: #ff8700;">df2</span> = pd.DataFrame(np.random.randn(7, 3),
                   index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'cdefghi'</span>),
                   columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>])

log(<span style="color: #ff4ea3;">"df1"</span>, df1)
log(<span style="color: #ff4ea3;">"df2"</span>, df2)

log(<span style="color: #ff4ea3;">"df1 + df2"</span>, df1 + df2)
log(<span style="color: #ff4ea3;">"df1 - df1.iloc[0]"</span>, df1 - df1.iloc[0])
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
          A         B         C         D
a  0.377634 -0.556974  2.041316 -0.683097
b  1.277876  0.285827 -0.923395  2.197208
c -2.174404  0.863986  0.127276  0.936876
d -1.484082  0.130357  2.113753 -2.116671
e -0.920127 -1.494546 -1.962536  0.631815
f  0.804857  1.188925  1.712200 -0.180187
g -1.086326  0.469700  0.072257 -0.149728
h -0.011807 -1.470717  1.046002  0.301448
i -1.464302  0.489558  0.247769  1.311970
j  0.366970  0.496196  0.652520  0.377583
===================================== df2 ======================================
          A         B         C
c -0.796342 -0.668158 -0.804846
d -0.527799 -0.250736  1.418304
e -0.306861  0.596801 -0.079840
f -0.076861  0.238254  0.363585
g  1.981501 -0.026693  0.249304
h  1.022270  0.769587 -0.144064
i  1.090153  1.320427  0.573888
================================== df1 + df2 ===================================
          A         B         C   D
a       NaN       NaN       NaN NaN
b       NaN       NaN       NaN NaN
c -2.970746  0.195828 -0.677570 NaN
d -2.011881 -0.120379  3.532056 NaN
e -1.226988 -0.897744 -2.042376 NaN
f  0.727996  1.427179  2.075785 NaN
g  0.895176  0.443006  0.321561 NaN
h  1.010463 -0.701131  0.901938 NaN
i -0.374149  1.809985  0.821658 NaN
j       NaN       NaN       NaN NaN
============================== df1 - df1.iloc[0] ===============================
          A         B         C         D
a  0.000000  0.000000  0.000000  0.000000
b  0.900242  0.842802 -2.964712  2.880305
c -2.552037  1.420960 -1.914040  1.619973
d -1.861716  0.687331  0.072436 -1.433574
e -1.297761 -0.937571 -4.003852  1.314912
f  0.427224  1.745899 -0.329116  0.502910
g -1.463960  1.026674 -1.969059  0.533369
h -0.389441 -0.913743 -0.995314  0.984545
i -1.841936  1.046532 -1.793547  1.995067
j -0.010664  1.053171 -1.388796  1.060680
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df3</span> = df2.loc[:, [<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>]].copy()
log(<span style="color: #ff4ea3;">"df3 (before)"</span>, df3)
<span style="color: #ff8700;">df3</span>[df3 &gt; 0] = -df3
log(<span style="color: #ff4ea3;">"df3 (after)"</span>, df3)
</pre>
</div>

<pre class="example">
================================= df3 (before) =================================
          B         C
c -0.668158 -0.804846
d -0.250736  1.418304
e  0.596801 -0.079840
f  0.238254  0.363585
g -0.026693  0.249304
h  0.769587 -0.144064
i  1.320427  0.573888
================================= df3 (after) ==================================
          B         C
c -0.668158 -0.804846
d -0.250736 -1.418304
e -0.596801 -0.079840
f -0.238254 -0.363585
g -0.026693 -0.249304
h -0.769587 -0.144064
i -1.320427 -0.573888
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2-12" class="outline-5">
<h5 id="sec-1-2-2-12"><span class="section-number-5">1.2.2.12</span> 使用 numpy 函数</h5>
<div class="outline-text-5" id="text-1-2-2-12">
<p>
因为从本质上讲，DataFrame 内部用的数据结构就是 numpy 的 ndarray 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>])
log(<span style="color: #ff4ea3;">"np.exp(df)"</span>, np.exp(df))
log(<span style="color: #ff4ea3;">"np.sin(df)"</span>, np.sin(df))
</pre>
</div>

<pre class="example">
================================== np.exp(df) ==================================
         one       two     three      four
0  11.170040  0.454007  3.990201  0.102700
1   1.356354  0.312709  0.468818  0.788990
2   0.639459  3.563325  1.566325  0.066693
3   1.979718  1.170441  0.768294  0.744595
4   1.947619  0.696596  0.345896  0.657910
5   2.238559  0.088354  1.407147  0.625394
6   1.252626  2.472952  0.770047  1.642042
7   0.517493  0.147705  1.591390  0.218760
8   0.341389  7.761868  1.078785  0.452102
9   2.138146  0.215454  1.569568  0.478977
================================== np.sin(df) ==================================
        one       two     three      four
0  0.665645 -0.710101  0.982575 -0.761516
1  0.300103 -0.917792 -0.687136 -0.234790
2 -0.432382  0.955306  0.433823 -0.420451
3  0.631088  0.156732 -0.260541 -0.290658
4  0.618323 -0.353724 -0.873145 -0.406561
5  0.721407 -0.655756  0.334962 -0.452328
6  0.223343  0.786680 -0.258341  0.475859
7 -0.612137 -0.942173  0.448072 -0.998699
8 -0.879463  0.887720  0.075763 -0.713056
9  0.688877 -0.999360  0.435686 -0.671404
</pre>
</div>

<div id="outline-container-sec-1-2-2-12-1" class="outline-6">
<h6 id="sec-1-2-2-12-1"><span class="section-number-6">1.2.2.12.1</span> DataFrame 转换为 ndarray 对象</h6>
<div class="outline-text-6" id="text-1-2-2-12-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ary</span> = np.asarray(df)
log(<span style="color: #ff4ea3;">"ary"</span>, ary)
log(<span style="color: #ff4ea3;">"ary == df.values"</span>, ary == df.values)
log(<span style="color: #ff4ea3;">"ary == df"</span>, ary == df)
</pre>
</div>

<pre class="example">
===================================== ary ======================================
[[ 2.41323517 -0.7896421   1.3838415  -2.27594433]
 [ 0.30480031 -1.16248376 -0.75753982 -0.23700218]
 [-0.44713235  1.27069413  0.44873207 -2.70764993]
 [ 0.68295465  0.15738074 -0.26358238 -0.29491441]
 [ 0.66660757 -0.3615493  -1.06161738 -0.41868689]
 [ 0.80583247 -2.42640929  0.34156453 -0.46937419]
 [ 0.22524233  0.90541243 -0.26130413  0.49594075]
 [-0.65875969 -1.91253658  0.4646077  -1.51977904]
 [-1.07473333  2.04922298  0.07583531 -0.793847  ]
 [ 0.75993923 -1.53500857  0.45080032 -0.73610226]]
=============================== ary == df.values ===============================
[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
================================== ary == df ===================================
    one   two  three  four
0  True  True   True  True
1  True  True   True  True
2  True  True   True  True
3  True  True   True  True
4  True  True   True  True
5  True  True   True  True
6  True  True   True  True
7  True  True   True  True
8  True  True   True  True
9  True  True   True  True
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Panel</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Panel 是三维带标签的数组。
</p>

<p>
Panel 由三个标签组成：
</p>

<dl class="org-dl">
<dt> items </dt><dd>坐标轴 0 ，索引对应的元素是一个 DataFrame
</dd>
<dt> major_axis </dt><dd>坐标轴 1 , DataFrame 里的行标签
</dd>
<dt> minor_axis </dt><dd>坐标轴 2 , DataFrame 里的列标签
</dd>
</dl>
</div>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 函数应用</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 将数据按行或列进行计算(apply)</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.arange(12).reshape(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
       A   B   C
one    0   1   2
two    3   4   5
three  6   7   8
four   9  10  11
</pre>
</div>

<div id="outline-container-sec-2-1-0-1" class="outline-5">
<h5 id="sec-2-1-0-1"><span class="section-number-5">2.1.0.1</span> 按列进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-1">
<p>
每一列作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>())
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
A    9
B    9
C    9
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-2" class="outline-5">
<h5 id="sec-2-1-0-2"><span class="section-number-5">2.1.0.2</span> 按行进行运算</h5>
<div class="outline-text-5" id="text-2-1-0-2">
<p>
每一行作为一个 Series 作为参数传递给 lambda 函数
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(<span style="color: #a1db00;">lambda</span> x: x.<span style="color: #d18aff;">max</span>() - x.<span style="color: #d18aff;">min</span>(), axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
one      2
two      2
three    2
four     2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-0-3" class="outline-5">
<h5 id="sec-2-1-0-3"><span class="section-number-5">2.1.0.3</span> 返回多个值组成的 Series</h5>
<div class="outline-text-5" id="text-2-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">min_max</span>(x):
    <span style="color: #a1db00;">return</span> pd.Series([x.<span style="color: #d18aff;">min</span>(), x.<span style="color: #d18aff;">max</span>()], index=[<span style="color: #ff4ea3;">'min'</span>, <span style="color: #ff4ea3;">'max'</span>])
<span style="color: #ff8700;">result</span> = df.<span style="color: #d18aff;">apply</span>(min_max, axis=1)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
       min  max
one      0    2
two      3    5
three    6    8
four     9   11
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 逐元素运算(applymap)</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3),
                  index=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>],
                  columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABC'</span>))

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
              A         B         C
one    0.463203 -1.128320  1.643553
two   -0.791495 -1.176356  0.311972
three  0.513295 -0.758507 -0.823157
four  -0.856576  0.121268  0.722507
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">x &#34920;&#31034; dataframe &#20013;&#30340;&#27599;&#20010;&#20803;&#32032;</span>
<span style="color: #ff8700;">result</span> = df.applymap(<span style="color: #a1db00;">lambda</span> x: <span style="color: #ff4ea3;">'{0:.03f}'</span>.<span style="color: #d18aff;">format</span>(x))
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            A       B       C
one     0.463  -1.128   1.644
two    -0.791  -1.176   0.312
three   0.513  -0.759  -0.823
four   -0.857   0.121   0.723
</pre>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 排序(sort_values)</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    3    1      6
B    2    5      1
C    5    4      4
D    6    8      8
</pre>
</div>


<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> 按列排序</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'two'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   one  two  three
D    6    8      8
B    2    5      1
C    5    4      4
A    3    1      6
</pre>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> 按行排序</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'C'</span>, axis=1, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
   one  two  three
A    3    1      6
B    2    5      1
C    5    4      4
D    6    8      8
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 索引排序(sort_index)</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   one  two  three
A    7    8      6
B    2    3      2
C    6    4      8
D    5    2      6
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">col_sort</span> = df.sort_index(axis=1, ascending=<span style="color: #5fafd7;">False</span>)
<span style="color: #ff8700;">row_sort</span> = df.sort_index(ascending=<span style="color: #5fafd7;">False</span>)

log(<span style="color: #ff4ea3;">"col_sort"</span>, col_sort)
log(<span style="color: #ff4ea3;">"row_sort"</span>, row_sort)
</pre>
</div>

<pre class="example">
=================================== col_sort ===================================
   two  three  one
A    8      6    7
B    3      2    2
C    4      8    6
D    2      6    5
=================================== row_sort ===================================
   one  two  three
D    5    2      6
C    6    4      8
B    2    3      2
A    7    8      6
</pre>
</div>
</div>


<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 排名(rank)</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([3, 6, 2, 6, 4])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0    3
1    6
2    2
3    6
4    4
dtype: int64
====================================== df ======================================
   one  two  three
A    1    1      8
B    8    4      2
C    5    7      3
D    7    1      2
</pre>



<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s_result</span> = s.rank(method=<span style="color: #ff4ea3;">'first'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"s_result"</span>, s_result)
</pre>
</div>

<pre class="example">
=================================== s_result ===================================
0    4.0
1    1.0
2    5.0
3    2.0
4    3.0
dtype: float64
</pre>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df_result</span> = df.rank(method=<span style="color: #ff4ea3;">'first'</span>)
log(<span style="color: #ff4ea3;">"df_result"</span>, df_result)
</pre>
</div>

<pre class="example">
================================== df_result ===================================
   one  two  three
A  1.0  1.0    4.0
B  4.0  3.0    1.0
C  2.0  4.0    3.0
D  3.0  2.0    2.0
</pre>
</div>
</div>


<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Series 元素统计</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abbcdabacad'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
0     a
1     b
2     b
3     c
4     d
5     a
6     b
7     a
8     c
9     a
10    d
dtype: object
</pre>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> 个数统计(value_counts)</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.value_counts()"</span>, s.value_counts())
</pre>
</div>

<pre class="example">
=============================== s.value_counts() ===============================
a    4
b    3
c    2
d    2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> 唯一性统计(uniq)</h4>
<div class="outline-text-4" id="text-2-6-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.unique()"</span>, s.unique())
</pre>
</div>

<pre class="example">
================================== s.unique() ==================================
['a' 'b' 'c' 'd']
</pre>
</div>
</div>


<div id="outline-container-sec-2-6-3" class="outline-4">
<h4 id="sec-2-6-3"><span class="section-number-4">2.6.3</span> 成员资格统计(isin)</h4>
<div class="outline-text-4" id="text-2-6-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.isin(['a', 'b', 'c'])"</span>, s.isin([<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>]))
</pre>
</div>

<pre class="example">
=========================== s.isin(['a', 'b', 'c']) ============================
0      True
1      True
2      True
3      True
4     False
5      True
6      True
7      True
8      True
9      True
10    False
dtype: bool
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 索引</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 重新索引</h3>
<div class="outline-text-3" id="text-3-1">
<p>
即把索引值进行重新赋值， <b>以增加一些行的数据</b> 。
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Series</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1, 3, 5, 6, 8], index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'acefh'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    1
c    3
e    5
f    6
h    8
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'))"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>)))
</pre>
</div>

<pre class="example">
========================= s.reindex(list('abcdefgh')) ==========================
a    1.0
b    NaN
c    3.0
d    NaN
e    5.0
f    6.0
g    NaN
h    8.0
dtype: float64
</pre>
</div>


<div id="outline-container-sec-3-1-1-0-1" class="outline-6">
<h6 id="sec-3-1-1-0-1"><span class="section-number-6">3.1.1.0.1</span> 填充默认值</h6>
<div class="outline-text-6" id="text-3-1-1-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), fill_value=0)"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), fill_value=0))
</pre>
</div>

<pre class="example">
================== s.reindex(list('abcdefgh'), fill_value=0) ===================
a    1
b    0
c    3
d    0
e    5
f    6
g    0
h    8
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-1-0-2" class="outline-6">
<h6 id="sec-3-1-1-0-2"><span class="section-number-6">3.1.1.0.2</span> 往前填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='ffill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='ffill') ==================
a    1
b    1
c    3
d    3
e    5
f    6
g    6
h    8
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-1-1-0-3" class="outline-6">
<h6 id="sec-3-1-1-0-3"><span class="section-number-6">3.1.1.0.3</span> 往后填充</h6>
<div class="outline-text-6" id="text-3-1-1-0-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.reindex(list('abcdefgh'), method='bfill')"</span>,
    s.reindex(<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcdefgh'</span>), method=<span style="color: #ff4ea3;">'bfill'</span>))
</pre>
</div>

<pre class="example">
================= s.reindex(list('abcdefgh'), method='bfill') ==================
a    1
b    3
c    3
d    5
e    5
f    6
g    8
h    8
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> DataFrame</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 6),
                  index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ADFH'</span>),
                  columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'four'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'six'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        one       two     three      four      five       six
A  0.106310 -0.465103  0.458735  0.388230  0.333518 -0.199344
D -0.636173 -0.262561 -0.435940  1.179164  0.382367 -0.490363
F -1.290498  1.127763 -0.808983  0.826825  0.765913 -0.652603
H -1.920708  1.188863  0.261151  0.076768  0.604244  1.109027
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1" class="outline-6">
<h6 id="sec-3-1-2-0-1"><span class="section-number-6">3.1.2.0.1</span> 对行重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'))"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>)))
</pre>
</div>

<pre class="example">
====================== df.reindex(index=list('ABCDEFGH')) ======================
        one       two     three      four      five       six
A  0.106310 -0.465103  0.458735  0.388230  0.333518 -0.199344
B       NaN       NaN       NaN       NaN       NaN       NaN
C       NaN       NaN       NaN       NaN       NaN       NaN
D -0.636173 -0.262561 -0.435940  1.179164  0.382367 -0.490363
E       NaN       NaN       NaN       NaN       NaN       NaN
F -1.290498  1.127763 -0.808983  0.826825  0.765913 -0.652603
G       NaN       NaN       NaN       NaN       NaN       NaN
H -1.920708  1.188863  0.261151  0.076768  0.604244  1.109027
</pre>
</div>

<div id="outline-container-sec-3-1-2-0-1-1" class="outline-7">
<h7 id="sec-3-1-2-0-1-1"><span class="section-number-7">3.1.2.0.1.1</span> 向前填充</h7>
<div class="outline-text-7" id="text-3-1-2-0-1-1">
<p>
<b>fill method 只对行重新索引有效，不适用列</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(index=list('ABCDEFGH'), method='ffill')"</span>,
    df.reindex(index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCDEFGH'</span>), method=<span style="color: #ff4ea3;">'ffill'</span>))
</pre>
</div>

<pre class="example">
============== df.reindex(index=list('ABCDEFGH'), method='ffill') ==============
        one       two     three      four      five       six
A  0.106310 -0.465103  0.458735  0.388230  0.333518 -0.199344
B  0.106310 -0.465103  0.458735  0.388230  0.333518 -0.199344
C  0.106310 -0.465103  0.458735  0.388230  0.333518 -0.199344
D -0.636173 -0.262561 -0.435940  1.179164  0.382367 -0.490363
E -0.636173 -0.262561 -0.435940  1.179164  0.382367 -0.490363
F -1.290498  1.127763 -0.808983  0.826825  0.765913 -0.652603
G -1.290498  1.127763 -0.808983  0.826825  0.765913 -0.652603
H -1.920708  1.188863  0.261151  0.076768  0.604244  1.109027
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-2-0-2" class="outline-6">
<h6 id="sec-3-1-2-0-2"><span class="section-number-6">3.1.2.0.2</span> 对列重新索引</h6>
<div class="outline-text-6" id="text-3-1-2-0-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0)"</span>,
    df.reindex(columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>, <span style="color: #ff4ea3;">'five'</span>, <span style="color: #ff4ea3;">'seven'</span>], fill_value=0))
</pre>
</div>

<pre class="example">
===== df.reindex(columns=['one', 'three', 'five', 'seven'], fill_value=0) ======
        one     three      five  seven
A  0.106310  0.458735  0.333518      0
D -0.636173 -0.435940  0.382367      0
F -1.290498 -0.808983  0.765913      0
H -1.920708  0.261151  0.604244      0
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 索引命名</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.rand(5), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcde'</span>))
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(4, 3), columns=[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>])

log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0.565623
b    0.528500
c    0.768241
d    0.860586
e    0.591866
dtype: float64
====================================== df ======================================
        one       two     three
0  0.691743  0.033842  1.209748
1  0.323450  1.061970 -1.306333
2  0.123988  0.483557  0.638213
3  0.578241  0.326928 -0.254767
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
<span style="color: #ff8700;">s.index.name</span> = <span style="color: #ff4ea3;">'alpha'</span>
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
=================================== s.index ====================================
Index(['a', 'b', 'c', 'd', 'e'], dtype='object')
====================================== s =======================================
alpha
a    0.565623
b    0.528500
c    0.768241
d    0.860586
e    0.591866
dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.index"</span>, df.index)
log(<span style="color: #ff4ea3;">"df.columns"</span>, df.columns)

<span style="color: #ff8700;">df.index.name</span> = <span style="color: #ff4ea3;">'row'</span>
<span style="color: #ff8700;">df.columns.name</span> = <span style="color: #ff4ea3;">'col'</span>

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
=================================== df.index ===================================
RangeIndex(start=0, stop=4, step=1)
================================== df.columns ==================================
Index(['one', 'two', 'three'], dtype='object')
====================================== df ======================================
col       one       two     three
row
0    0.691743  0.033842  1.209748
1    0.323450  1.061970 -1.306333
2    0.123988  0.483557  0.638213
3    0.578241  0.326928 -0.254767
</pre>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 重复索引</h3>
<div class="outline-text-3" id="text-3-3">
<p>
索引值有重复项的索引
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.arange(6), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'abcbda'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
</pre>
</div>

<pre class="example">
====================================== s =======================================
a    0
b    1
c    2
b    3
d    4
a    5
dtype: int64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['a']"</span>, s[<span style="color: #ff4ea3;">'a'</span>])
log(<span style="color: #ff4ea3;">"s.index.is_unique"</span>, s.index.is_unique)
</pre>
</div>

<pre class="example">
==================================== s['a'] ====================================
a    0
a    5
dtype: int64
============================== s.index.is_unique ===============================
False
</pre>
</div>


<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 对重复索引的处理（清洗）</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">sum_result</span> = s.groupby(s.index).<span style="color: #d18aff;">sum</span>()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#36827;&#34892;&#27714;&#21644;</span>
log(<span style="color: #ff4ea3;">"sum_result"</span>, sum_result)

<span style="color: #ff8700;">first_result</span> = s.groupby(s.index).first()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21482;&#21462;&#31532;&#19968;&#39033;</span>
log(<span style="color: #ff4ea3;">"first_result"</span>, first_result)

<span style="color: #ff8700;">avg_result</span> = s.groupby(s.index).mean()  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#23545;&#37325;&#22797;&#32034;&#24341;&#20869;&#23481;&#21462;&#24179;&#22343;&#20540;</span>
log(<span style="color: #ff4ea3;">"avg_result"</span>, avg_result)
</pre>
</div>

<pre class="example">
================================== sum_result ==================================
a    5
b    4
c    2
d    4
dtype: int64
================================= first_result =================================
a    0
b    1
c    2
d    4
dtype: int64
================================== avg_result ==================================
a    2.5
b    2.0
c    2.0
d    4.0
dtype: float64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 多级索引</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<b>用二维的数据表达更高维度的数据</b> ，使数据组织方式更清晰，它使用 <code>pd.MultiIndex</code> 类来表示。
</p>
</div>

<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> 层次化索引的作用</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
比如在分析股票数据：
</p>
<ul class="org-ul">
<li>一级行索引可以是日期
</li>
<li>二级行索引可以是股票代码
</li>
<li>列索引可以是股票的交易量，开盘价，收盘价等等
</li>
</ul>

<p>
这样就可以把多个股票放在同一个时间维度下进行考察和分析。
</p>
</div>
</div>


<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Series 多级索引</h4>
<div class="outline-text-4" id="text-3-4-2">
</div><div id="outline-container-sec-3-4-2-1" class="outline-5">
<h5 id="sec-3-4-2-1"><span class="section-number-5">3.4.2.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">a</span> = [[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'c'</span>], [1, 2, 3, 1, 2, 2, 3]]
<span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*a))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
log(<span style="color: #ff4ea3;">"index"</span>, index)
<span style="color: #ff8700;">s</span> = pd.Series(np.random.randn(7), index=index)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"s.index"</span>, s.index)
log(<span style="color: #ff4ea3;">"s.index.levels[1]"</span>, s.index.levels[1])
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('a', 1), ('a', 2), ('a', 3), ('b', 1), ('b', 2), ('c', 2), ('c', 3)]
==================================== index =====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
====================================== s =======================================
first  second
a      1        -0.575494
       2         0.089339
       3        -0.266689
b      1        -0.567371
       2         0.275326
c      2        -1.288683
       3         0.221641
dtype: float64
=================================== s.index ====================================
MultiIndex(levels=[['a', 'b', 'c'], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 2, 2], [0, 1, 2, 0, 1, 1, 2]],
           names=['first', 'second'])
============================== s.index.levels[1] ===============================
Int64Index([1, 2, 3], dtype='int64', name='second')
</pre>
</div>
</div>

<div id="outline-container-sec-3-4-2-2" class="outline-5">
<h5 id="sec-3-4-2-2"><span class="section-number-5">3.4.2.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s['b']"</span>, s[<span style="color: #ff4ea3;">'b'</span>])
log(<span style="color: #ff4ea3;">"s['b':'c']"</span>, s[<span style="color: #ff4ea3;">'b'</span>:<span style="color: #ff4ea3;">'c'</span>])
log(<span style="color: #ff4ea3;">"s[['b', 'a']]"</span>, s[[<span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>]])
log(<span style="color: #ff4ea3;">"s['b', 1]"</span>, s[<span style="color: #ff4ea3;">'b'</span>, 1])
log(<span style="color: #ff4ea3;">"s[:, 2]"</span>, s[:, 2])
</pre>
</div>

<pre class="example">
==================================== s['b'] ====================================
second
1   -0.567371
2    0.275326
dtype: float64
================================== s['b':'c'] ==================================
first  second
b      1        -0.567371
       2         0.275326
c      2        -1.288683
       3         0.221641
dtype: float64
================================ s[['b', 'a']] =================================
first  second
a      1        -0.575494
       2         0.089339
       3        -0.266689
b      1        -0.567371
       2         0.275326
dtype: float64
================================== s['b', 1] ===================================
-0.5673709449917991
=================================== s[:, 2] ====================================
first
a    0.089339
b    0.275326
c   -1.288683
dtype: float64
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> DataFrame 多级索引</h4>
<div class="outline-text-4" id="text-3-4-3">
</div><div id="outline-container-sec-3-4-3-1" class="outline-5">
<h5 id="sec-3-4-3-1"><span class="section-number-5">3.4.3.1</span> 创建</h5>
<div class="outline-text-5" id="text-3-4-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (4, 3)),  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">1-10 &#20043;&#38388;&#30340;&#38543;&#26426;&#25968;&#65292;4 &#34892; 3 &#21015;</span>
                  index=[[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>], [1, 2, 1, 2]],
                  columns=[[<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>], [<span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'blue'</span>]])
<span style="color: #ff8700;">df.index.names</span> = [<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>]
<span style="color: #ff8700;">df.columns.names</span> = [<span style="color: #ff4ea3;">'col-1'</span>, <span style="color: #ff4ea3;">'col-2'</span>]
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428gsV.png" alt="fig75428gsV.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-3-2" class="outline-5">
<h5 id="sec-3-4-3-2"><span class="section-number-5">3.4.3.2</span> 选取</h5>
<div class="outline-text-5" id="text-3-4-3-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.loc[<span style="color: #ff4ea3;">'a'</span>])
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286Ai.png" alt="fig754286Ai.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.loc['a', 1]"</span>, df.loc[<span style="color: #ff4ea3;">'a'</span>, 1])
</pre>
</div>

<pre class="example">
================================ df.loc['a', 1] ================================
col-1  col-2
one    blue     8
       red      1
two    blue     6
Name: (a, 1), dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-3-4-3-3" class="outline-5">
<h5 id="sec-3-4-3-3"><span class="section-number-5">3.4.3.3</span> 多级索引交换</h5>
<div class="outline-text-5" id="text-3-4-3-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.swaplevel(<span style="color: #ff4ea3;">'row-1'</span>, <span style="color: #ff4ea3;">'row-2'</span>)
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UVu.png" alt="fig75428UVu.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-4" class="outline-5">
<h5 id="sec-3-4-3-4"><span class="section-number-5">3.4.3.4</span> 多级索引排序</h5>
<div class="outline-text-5" id="text-3-4-3-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(0))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">0 &#34920;&#31034;&#26681;&#25454;&#19968;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428TpD.png" alt="fig75428TpD.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.sortlevel(1))  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#26681;&#25454;&#20108;&#32423;&#32034;&#24341;&#36827;&#34892;&#25490;&#24207;</span>
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428t9P.png" alt="fig75428t9P.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-5" class="outline-5">
<h5 id="sec-3-4-3-5"><span class="section-number-5">3.4.3.5</span> 多级索引统计</h5>
<div class="outline-text-5" id="text-3-4-3-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=0))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HSc.png" alt="fig75428HSc.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.<span style="color: #d18aff;">sum</span>(level=1))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428hmo.png" alt="fig75428hmo.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-3-4-3-6" class="outline-5">
<h5 id="sec-3-4-3-6"><span class="section-number-5">3.4.3.6</span> 列与索引的转换</h5>
<div class="outline-text-5" id="text-3-4-3-6">
<p>
创建多级索引比较复杂，一般情况下会从文件中读取一个 DataFrame ，
然后将其中某个列转换为多级索引，最终得到一个基于多级索引的 DataFrame 。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({
    <span style="color: #ff4ea3;">'a'</span>: <span style="color: #d18aff;">range</span>(7),
    <span style="color: #ff4ea3;">'b'</span>: <span style="color: #d18aff;">range</span>(7, 0, -1),
    <span style="color: #ff4ea3;">'c'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>],
    <span style="color: #ff4ea3;">'d'</span>: [0, 1, 2, 0, 1, 2, 3]
})
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428760.png" alt="fig75428760.png">
</p>
</div>
</div>

<div id="outline-container-sec-3-4-3-6-1" class="outline-6">
<h6 id="sec-3-4-3-6-1"><span class="section-number-6">3.4.3.6.1</span> 列转换为索引</h6>
<div class="outline-text-6" id="text-3-4-3-6-1">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.set_index(<span style="color: #ff4ea3;">'c'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig754286OK.png" alt="fig754286OK.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df2</span> = df.set_index([<span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>])
show_dataframe(df2)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428UjW.png" alt="fig75428UjW.png">
</p>
</div>
</div>
</div>



<div id="outline-container-sec-3-4-3-6-2" class="outline-6">
<h6 id="sec-3-4-3-6-2"><span class="section-number-6">3.4.3.6.2</span> 索引转换为列</h6>
<div class="outline-text-6" id="text-3-4-3-6-2">
<p>
将所有索引转换为列
</p>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df2.reset_index().sort_index(<span style="color: #ff4ea3;">'columns'</span>))
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428u3i.png" alt="fig75428u3i.png">
</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>





<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 分组与聚合</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5)})

show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428IMv.png" alt="fig75428IMv.png">
</p>
</div>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 原理</h3>
<div class="outline-text-3" id="text-4-1">
<p>
三步曲：
</p>

<ol class="org-ol">
<li>拆分：根据什么进行分组
</li>
<li>应用：每个分组进行什么样的计算（每个组应用一个 <b>计算规则</b> ，输出一个结果）
</li>
<li>聚合：把每个分组的计算结果合并起来，构成最终输出
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> 分组</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> 对 Series 进行分组</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
通过索引对齐关联起来
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df[<span style="color: #ff4ea3;">'data1'</span>].groupby(df[<span style="color: #ff4ea3;">'key1'</span>])
log(<span style="color: #ff4ea3;">"grouped"</span>, grouped)         <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">groupby &#23545;&#35937;</span>
log(<span style="color: #ff4ea3;">"grouped.mean()"</span>, grouped.mean())
<span style="color: #ff8700;">key</span> = [1, 2, 1, 2, 1]
log(<span style="color: #ff4ea3;">"df['data1'].groupby(key)"</span>, df[<span style="color: #ff4ea3;">'data1'</span>].groupby(key))
</pre>
</div>

<pre class="example">
=================================== grouped ====================================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x10939acf8&gt;
================================ grouped.mean() ================================
key1
a    3.666667
b    2.500000
Name: data1, dtype: float64
=========================== df['data1'].groupby(key) ===========================
&lt;pandas.core.groupby.SeriesGroupBy object at 0x109254b00&gt;
</pre>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).mean()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).mean())
log(<span style="color: #ff4ea3;">"df['data1'].groupby([df['key1'], df['key2']]).size()"</span>,
    df[<span style="color: #ff4ea3;">'data1'</span>].groupby([df[<span style="color: #ff4ea3;">'key1'</span>], df[<span style="color: #ff4ea3;">'key2'</span>]]).size())
</pre>
</div>

<pre class="example">
============= df['data1'].groupby([df['key1'], df['key2']]).mean() =============
key1  key2
a     one     4
      two     3
b     one     3
      two     2
Name: data1, dtype: int64
============= df['data1'].groupby([df['key1'], df['key2']]).size() =============
key1  key2
a     one     2
      two     1
b     one     1
      two     1
Name: data1, dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> 对 DataFrame 进行分组（默认按行分组）</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HgE.png" alt="fig75428HgE.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df1</span> = df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]).mean()
show_dataframe(df1)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428h0Q.png" alt="fig75428h0Q.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> 对分组对象进行迭代</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby(<span style="color: #ff4ea3;">'key1'</span>):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">'='</span>*80)

<span style="color: #a1db00;">for</span> name, group <span style="color: #a1db00;">in</span> df.groupby([<span style="color: #ff4ea3;">'key1'</span>, <span style="color: #ff4ea3;">'key2'</span>]):
    <span style="color: #a1db00;">print</span>(name)
    <span style="color: #a1db00;">print</span>(group)
</pre>
</div>

<pre class="example">
a
   data1  data2 key1 key2
0      5      7    a  one
1      3      4    a  two
4      3      9    a  one
b
   data1  data2 key1 key2
2      3      1    b  one
3      2      1    b  two
================================================================================
('a', 'one')
   data1  data2 key1 key2
0      5      7    a  one
4      3      9    a  one
('a', 'two')
   data1  data2 key1 key2
1      3      4    a  two
('b', 'one')
   data1  data2 key1 key2
2      3      1    b  one
('b', 'two')
   data1  data2 key1 key2
3      2      1    b  two
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> 通过字典进行分组</h4>
<div class="outline-text-4" id="text-4-2-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
<span style="color: #ff8700;">df.iloc</span>[1, 1:3] = np.NaN
show_dataframe(df)
</pre>
</div>


<div class="figure">
<p><img src="img/fig754287Id.png" alt="fig754287Id.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mapping</span> = {<span style="color: #ff4ea3;">'a'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'b'</span>: <span style="color: #ff4ea3;">'red'</span>, <span style="color: #ff4ea3;">'c'</span>: <span style="color: #ff4ea3;">'blue'</span>, <span style="color: #ff4ea3;">'d'</span>: <span style="color: #ff4ea3;">'orange'</span>, <span style="color: #ff4ea3;">'e'</span>: <span style="color: #ff4ea3;">'blue'</span>}
<span style="color: #ff8700;">grouped</span> = df.groupby(mapping, axis=1)  <span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25353;&#21015;&#20998;&#32452;</span>
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428Vdp.png" alt="fig75428Vdp.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428uFL.png" alt="fig75428uFL.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"grouped.size()"</span>, grouped.size())
</pre>
</div>

<pre class="example">
================================ grouped.size() ================================
blue      2
orange    1
red       2
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-4-2-5" class="outline-4">
<h4 id="sec-4-2-5"><span class="section-number-4">4.2.5</span> 通过函数分组</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
当函数作为分组依据时，数据表里的每个索引（可以是行索引，也可以是列索引）都会调用一次函数，
<b>函数的返回值作为分组的索引</b> ，即相同的返回值分在同一组。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)),
                  columns=[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'c'</span>, <span style="color: #ff4ea3;">'d'</span>, <span style="color: #ff4ea3;">'e'</span>],
                  index=[<span style="color: #ff4ea3;">'Alice'</span>, <span style="color: #ff4ea3;">'Bob'</span>, <span style="color: #ff4ea3;">'Candy'</span>, <span style="color: #ff4ea3;">'Dark'</span>, <span style="color: #ff4ea3;">'Emily'</span>])
show_dataframe(df)
</pre>
</div>


<div id="img/fig75428iuj.png" class="figure">
<p><img src="img/fig75428iuj.png" alt="fig75428iuj.png">
</p>
<p><span class="figure-number">Figure 18:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">_dummy_group</span>(idx):
    <span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"idx:"</span>, idx)
    <span style="color: #a1db00;">return</span> idx

<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=0"</span>)
df.groupby(_dummy_group)
<span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">"axis=1"</span>)
df.groupby(_dummy_group, axis=1)
</pre>
</div>

<pre class="example">
axis=0
idx: Alice
idx: Bob
idx: Candy
idx: Dark
idx: Emily
axis=1
idx: a
idx: b
idx: c
idx: d
idx: e
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">grouped</span> = df.groupby(<span style="color: #d18aff;">len</span>)
show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig754288Cw.png" alt="fig754288Cw.png">
</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-2-6" class="outline-4">
<h4 id="sec-4-2-6"><span class="section-number-4">4.2.6</span> 多级索引数据根据索引级别来分组</h4>
<div class="outline-text-4" id="text-4-2-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">columns</span> = pd.MultiIndex.from_arrays([[<span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>, <span style="color: #ff4ea3;">'USA'</span>, <span style="color: #ff4ea3;">'China'</span>],
                                     [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>, <span style="color: #ff4ea3;">'B'</span>]], names=[<span style="color: #ff4ea3;">'country'</span>, <span style="color: #ff4ea3;">'index'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randint(1, 10, (5, 5)), columns=columns)
show_dataframe(df)
</pre>
</div>


<div id="img/fig754287WF.png" class="figure">
<p><img src="img/fig754287WF.png" alt="fig754287WF.png">
</p>
<p><span class="figure-number">Figure 20:</span> 示例数据</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).count())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428VrR.png" alt="fig75428VrR.png">
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'country'</span>, axis=1).<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div class="figure">
<p><img src="img/fig3702047R.png" alt="fig3702047R.png">
</p>
</div>


<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(level=<span style="color: #ff4ea3;">'index'</span>, axis=1).count())
</pre>
</div>



<div class="figure">
<p><img src="img/fig37020FNM.png" alt="fig37020FNM.png">
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 数据聚合</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key1'</span>: [<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>],
                   <span style="color: #ff4ea3;">'key2'</span>: [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>],
                   <span style="color: #ff4ea3;">'data1'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data2'</span>: np.random.randint(1, 10, 5),
                   <span style="color: #ff4ea3;">'data3'</span>: np.random.randint(1, 10, 5)})
show_dataframe(df)
</pre>
</div>


<div id="img/fig37020fhY.png" class="figure">
<p><img src="img/fig37020fhY.png" alt="fig37020fhY.png">
</p>
<p><span class="figure-number">Figure 24:</span> 示例数据</p>
</div>
</div>

<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> 内置聚合函数</h4>
<div class="outline-text-4" id="text-4-3-1">
</div><div id="outline-container-sec-4-3-1-1" class="outline-5">
<h5 id="sec-4-3-1-1"><span class="section-number-5">4.3.1.1</span> sum</h5>
<div class="outline-text-5" id="text-4-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020TKx.png" class="figure">
<p><img src="img/fig37020TKx.png" alt="fig37020TKx.png">
</p>
<p><span class="figure-number">Figure 25:</span> sum</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-2" class="outline-5">
<h5 id="sec-4-3-1-2"><span class="section-number-5">4.3.1.2</span> mean</h5>
<div class="outline-text-5" id="text-4-3-1-2">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).mean())
</pre>
</div>


<div id="img/fig37020SeG.png" class="figure">
<p><img src="img/fig37020SeG.png" alt="fig37020SeG.png">
</p>
<p><span class="figure-number">Figure 26:</span> mean</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-3" class="outline-5">
<h5 id="sec-4-3-1-3"><span class="section-number-5">4.3.1.3</span> size</h5>
<div class="outline-text-5" id="text-4-3-1-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.groupby('key1').size()"</span>, df.groupby(<span style="color: #ff4ea3;">'key1'</span>).size())
</pre>
</div>

<pre class="example">
========================== df.groupby('key1').size() ===========================
key1
a    3
b    2
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-4-3-1-4" class="outline-5">
<h5 id="sec-4-3-1-4"><span class="section-number-5">4.3.1.4</span> count</h5>
<div class="outline-text-5" id="text-4-3-1-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).count())
</pre>
</div>


<div id="img/fig37020GHf.png" class="figure">
<p><img src="img/fig37020GHf.png" alt="fig37020GHf.png">
</p>
<p><span class="figure-number">Figure 27:</span> count</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-5" class="outline-5">
<h5 id="sec-4-3-1-5"><span class="section-number-5">4.3.1.5</span> min/max</h5>
<div class="outline-text-5" id="text-4-3-1-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).<span style="color: #d18aff;">min</span>())
</pre>
</div>


<div id="img/fig37020gbr.png" class="figure">
<p><img src="img/fig37020gbr.png" alt="fig37020gbr.png">
</p>
<p><span class="figure-number">Figure 28:</span> min</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-1-6" class="outline-5">
<h5 id="sec-4-3-1-6"><span class="section-number-5">4.3.1.6</span> describe</h5>
<div class="outline-text-5" id="text-4-3-1-6">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(df.groupby(<span style="color: #ff4ea3;">'key1'</span>).describe())
</pre>
</div>


<div id="img/fig37020fvA.png" class="figure">
<p><img src="img/fig37020fvA.png" alt="fig37020fvA.png">
</p>
<p><span class="figure-number">Figure 29:</span> describe</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> 自定义聚合函数</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
自定义聚合函数时，需使用 <code>agg()</code> 或 <code>aggregate()</code> 函数。
</p>


<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #a1db00;">def</span> <span style="color: #ffd700;">peak_range</span>(s):
    <span style="color: #a1db00;">print</span>(s)
    <span style="color: #a1db00;">print</span>(<span style="color: #d18aff;">type</span>(s))
    <span style="color: #a1db00;">print</span>(<span style="color: #ff4ea3;">'====='</span>)
    <span style="color: #a1db00;">return</span> s.<span style="color: #d18aff;">max</span>() - s.<span style="color: #d18aff;">min</span>()

<span style="color: #ff8700;">grouped</span> = df.groupby(<span style="color: #ff4ea3;">'key1'</span>)
<span style="color: #ff8700;">result</span> = grouped.agg(peak_range)
</pre>
</div>

<pre class="example">
0    7
1    5
4    9
Name: data1, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    4
3    8
Name: data1, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    4
1    3
4    3
Name: data2, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    5
3    6
Name: data2, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    6
1    8
4    7
Name: data3, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
2    2
3    7
Name: data3, dtype: int64
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: key2, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: key2, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: a, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
0    one
1    two
4    one
Name: a, dtype: object
&lt;class 'pandas.core.series.Series'&gt;
=====
</pre>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(result)
</pre>
</div>


<div class="figure">
<p><img src="img/fig3702051k.png" alt="fig3702051k.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> 应用多个聚合函数</h4>
<div class="outline-text-4" id="text-4-3-3">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.agg([<span style="color: #ff4ea3;">'std'</span>, <span style="color: #ff4ea3;">'mean'</span>, peak_range]))
</pre>
</div>


<div id="img/fig370205DN.png" class="figure">
<p><img src="img/fig370205DN.png" alt="fig370205DN.png">
</p>
<p><span class="figure-number">Figure 31:</span> 多个聚合函数</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> 给聚合后的列起别名</h4>
<div class="outline-text-4" id="text-4-3-4">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.agg([<span style="color: #ff4ea3;">'std'</span>, <span style="color: #ff4ea3;">'mean'</span>, (<span style="color: #ff4ea3;">'high-low'</span>, peak_range)]))
</pre>
</div>


<div id="img/fig37020TYZ.png" class="figure">
<p><img src="img/fig37020TYZ.png" alt="fig37020TYZ.png">
</p>
<p><span class="figure-number">Figure 32:</span> 别名</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-5" class="outline-4">
<h4 id="sec-4-3-5"><span class="section-number-4">4.3.5</span> 自定义需要显示的列</h4>
<div class="outline-text-4" id="text-4-3-5">
<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped.<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020tsl.png" class="figure">
<p><img src="img/fig37020tsl.png" alt="fig37020tsl.png">
</p>
<p><span class="figure-number">Figure 33:</span> 所有列</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython">show_dataframe(grouped[<span style="color: #ff4ea3;">'data1'</span>, <span style="color: #ff4ea3;">'data3'</span>].<span style="color: #d18aff;">sum</span>())
</pre>
</div>


<div id="img/fig37020HBy.png" class="figure">
<p><img src="img/fig37020HBy.png" alt="fig37020HBy.png">
</p>
<p><span class="figure-number">Figure 34:</span> 自定义后的列</p>
</div>
</div>
</div>



<div id="outline-container-sec-4-3-6" class="outline-4">
<h4 id="sec-4-3-6"><span class="section-number-4">4.3.6</span> 给不同的列应用不同的聚合函数</h4>
<div class="outline-text-4" id="text-4-3-6">
<p>
使用 dict 作为参数来实现，此方法也能实现自定义需要显示的列。
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">d</span> = {<span style="color: #ff4ea3;">'data1'</span>: [<span style="color: #ff4ea3;">'mean'</span>, peak_range, <span style="color: #ff4ea3;">'max'</span>, <span style="color: #ff4ea3;">'min'</span>],
     <span style="color: #ff4ea3;">'data2'</span>: <span style="color: #ff4ea3;">'sum'</span>}
show_dataframe(grouped.agg(d))
</pre>
</div>


<div id="img/fig37020GVH.png" class="figure">
<p><img src="img/fig37020GVH.png" alt="fig37020GVH.png">
</p>
<p><span class="figure-number">Figure 35:</span> 不同的聚合函数</p>
</div>
</div>
</div>


<div id="outline-container-sec-4-3-7" class="outline-4">
<h4 id="sec-4-3-7"><span class="section-number-4">4.3.7</span> 索引重置</h4>
<div class="outline-text-4" id="text-4-3-7">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#31561;&#25928;&#20110; df.groupby('key1', as_index=False).agg(d)</span>
show_dataframe(grouped.agg(d).reset_index())
</pre>
</div>


<div id="img/fig37020gpT.png" class="figure">
<p><img src="img/fig37020gpT.png" alt="fig37020gpT.png">
</p>
<p><span class="figure-number">Figure 36:</span> reset_index 效果</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 处理丢失数据</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
<span style="color: #ff8700;">df1</span> = df.reindex(index=dates[0:4], columns=<span style="color: #d18aff;">list</span>(df.columns) + [<span style="color: #ff4ea3;">'E'</span>])
df1.loc[dates[1:3], <span style="color: #ff4ea3;">'E'</span>] = 1
log(<span style="color: #ff4ea3;">"df1"</span>, df1)
</pre>
</div>

<pre class="example">
===================================== df1 ======================================
                   A         B         C         D    E
2016-03-01  0.348060  0.380930  2.151961 -1.281276  NaN
2016-03-02  0.796410  1.832368  1.451083  1.128148  1.0
2016-03-03  2.455315  1.035556  0.256025 -1.220884  1.0
2016-03-04  1.512556  0.328184  0.131012 -0.495669  NaN
</pre>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 丢弃 NaN 行</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.dropna(how='any')"</span>, df1.dropna(how=<span style="color: #ff4ea3;">'any'</span>))
</pre>
</div>

<pre class="example">
============================ df1.dropna(how='any') =============================
                   A         B         C         D    E
2016-03-02  0.796410  1.832368  1.451083  1.128148  1.0
2016-03-03  2.455315  1.035556  0.256025 -1.220884  1.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 用默认值替换 NaN</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.fillna(value=5)"</span>, df1.fillna(value=5))
</pre>
</div>

<pre class="example">
============================= df1.fillna(value=5) ==============================
                   A         B         C         D    E
2016-03-01  0.348060  0.380930  2.151961 -1.281276  5.0
2016-03-02  0.796410  1.832368  1.451083  1.128148  1.0
2016-03-03  2.455315  1.035556  0.256025 -1.220884  1.0
2016-03-04  1.512556  0.328184  0.131012 -0.495669  5.0
</pre>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 判断数据集是否包含 NaN</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.isnull(df1)"</span>, pd.isnull(df1))
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>())
log(<span style="color: #ff4ea3;">"pd.isnull(df1).any().any()"</span>, pd.isnull(df1).<span style="color: #d18aff;">any</span>().<span style="color: #d18aff;">any</span>())
</pre>
</div>

<pre class="example">
================================ pd.isnull(df1) ================================
                A      B      C      D      E
2016-03-01  False  False  False  False   True
2016-03-02  False  False  False  False  False
2016-03-03  False  False  False  False  False
2016-03-04  False  False  False  False   True
============================= pd.isnull(df1).any() =============================
A    False
B    False
C    False
D    False
E     True
dtype: bool
========================== pd.isnull(df1).any().any() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> NaN 不参与运算</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.mean()"</span>, df1.mean())
log(<span style="color: #ff4ea3;">"df1.mean(axis=1)"</span>, df1.mean(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.mean() ==================================
A    1.278085
B    0.894259
C    0.997520
D   -0.467420
E    1.000000
dtype: float64
=============================== df1.mean(axis=1) ===============================
2016-03-01    0.399919
2016-03-02    1.241602
2016-03-03    0.705203
2016-03-04    0.369021
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df1.sum()"</span>, df1.<span style="color: #d18aff;">sum</span>())
log(<span style="color: #ff4ea3;">"df1.sum(axis=1)"</span>, df1.<span style="color: #d18aff;">sum</span>(axis=1))
</pre>
</div>

<pre class="example">
================================== df1.sum() ===================================
A    5.112341
B    3.577038
C    3.990082
D   -1.869680
E    2.000000
dtype: float64
=============================== df1.sum(axis=1) ================================
2016-03-01    1.599676
2016-03-02    6.208008
2016-03-03    3.526013
2016-03-04    1.476084
Freq: D, dtype: float64
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)
log(<span style="color: #ff4ea3;">"s"</span>, s)
log(<span style="color: #ff4ea3;">"df"</span>, df)
log(<span style="color: #ff4ea3;">"df.sub(s, axis='index')"</span>, df.sub(s, axis=<span style="color: #ff4ea3;">'index'</span>))
</pre>
</div>

<pre class="example">
====================================== s =======================================
2016-03-01    NaN
2016-03-02    NaN
2016-03-03    1.0
2016-03-04    3.0
2016-03-05    5.0
2016-03-06    NaN
Freq: D, dtype: float64
====================================== df ======================================
                   A         B         C         D
2016-03-01  0.348060  0.380930  2.151961 -1.281276
2016-03-02  0.796410  1.832368  1.451083  1.128148
2016-03-03  2.455315  1.035556  0.256025 -1.220884
2016-03-04  1.512556  0.328184  0.131012 -0.495669
2016-03-05 -0.184936  1.562710 -0.643962  0.282540
2016-03-06 -0.953870 -0.203660 -0.469206 -0.647817
=========================== df.sub(s, axis='index') ============================
                   A         B         C         D
2016-03-01       NaN       NaN       NaN       NaN
2016-03-02       NaN       NaN       NaN       NaN
2016-03-03  1.455315  0.035556 -0.743975 -2.220884
2016-03-04 -1.487444 -2.671816 -2.868988 -3.495669
2016-03-05 -5.184936 -3.437290 -5.643962 -4.717460
2016-03-06       NaN       NaN       NaN       NaN
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 数据操作</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">dates</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=6)
<span style="color: #ff8700;">df</span> = pd.DataFrame(data=np.random.randn(6, 4), index=dates, columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
                   A         B         C         D
2016-03-01 -0.586638 -0.502849 -1.868444 -1.983263
2016-03-02 -0.347646 -0.997867  0.535032  0.251939
2016-03-03 -0.582766 -0.826616  0.706850  0.573306
2016-03-04 -1.457400 -0.180921  0.061118  1.467823
2016-03-05 -1.011809  2.181185  1.130552  2.029257
2016-03-06  0.660526  0.752059  0.054786  1.089506
</pre>
</div>



<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> concat</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(10, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
          A         B         C         D
0 -0.547031  0.071624  0.791394 -2.459250
1 -2.394957 -0.230033 -1.318876  1.148694
2 -0.574386  1.717190  1.248272 -1.318956
3 -0.034535 -1.161201  0.520403 -0.310667
4 -1.628282  1.206308  1.012988  0.075177
5  0.270789 -0.447145  0.047096 -1.747187
6 -0.944040  0.592658  1.819417 -0.664069
7  2.075145  0.047055  0.887396 -0.116388
8 -1.025095  0.288617  0.647005  0.346916
9 -2.082460 -1.337006  0.093433 -1.215210
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.concat([df.iloc[:3], df.iloc[3:7], df.iloc[7:]])
log(<span style="color: #ff4ea3;">"result"</span>, result)
log(<span style="color: #ff4ea3;">"(result == df).all().all()"</span>, (result == df).<span style="color: #d18aff;">all</span>().<span style="color: #d18aff;">all</span>())
</pre>
</div>

<pre class="example">
==================================== result ====================================
          A         B         C         D
0 -0.547031  0.071624  0.791394 -2.459250
1 -2.394957 -0.230033 -1.318876  1.148694
2 -0.574386  1.717190  1.248272 -1.318956
3 -0.034535 -1.161201  0.520403 -0.310667
4 -1.628282  1.206308  1.012988  0.075177
5  0.270789 -0.447145  0.047096 -1.747187
6 -0.944040  0.592658  1.819417 -0.664069
7  2.075145  0.047055  0.887396 -0.116388
8 -1.025095  0.288617  0.647005  0.346916
9 -2.082460 -1.337006  0.093433 -1.215210
========================== (result == df).all().all() ==========================
True
</pre>
</div>
</div>


<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> merge</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">left</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'lval'</span>: [1, 2]})
<span style="color: #ff8700;">right</span> = pd.DataFrame({<span style="color: #ff4ea3;">'key'</span>: [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>], <span style="color: #ff4ea3;">'rval'</span>: [4, 5]})
log(<span style="color: #ff4ea3;">"left"</span>, left)
log(<span style="color: #ff4ea3;">"right"</span>, right)

<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">SELECT * FROM left INNER JOIN right ON left.key = right.key;</span>
<span style="color: #ff8700;">result</span> = pd.merge(left, right, on=<span style="color: #ff4ea3;">'key'</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
===================================== left =====================================
   key  lval
0  foo     1
1  foo     2
==================================== right =====================================
   key  rval
0  foo     4
1  foo     5
==================================== result ====================================
   key  lval  rval
0  foo     1     4
1  foo     1     5
2  foo     2     4
3  foo     2     5
</pre>
</div>
</div>


<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> append</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">s</span> = pd.Series(np.random.randint(1, 5, size=4), index=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
log(<span style="color: #ff4ea3;">"s"</span>, s)
<span style="color: #ff8700;">result</span> = df.append(s, ignore_index=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
====================================== s =======================================
A    4
B    1
C    3
D    3
dtype: int64
==================================== result ====================================
           A         B         C         D
0  -0.547031  0.071624  0.791394 -2.459250
1  -2.394957 -0.230033 -1.318876  1.148694
2  -0.574386  1.717190  1.248272 -1.318956
3  -0.034535 -1.161201  0.520403 -0.310667
4  -1.628282  1.206308  1.012988  0.075177
5   0.270789 -0.447145  0.047096 -1.747187
6  -0.944040  0.592658  1.819417 -0.664069
7   2.075145  0.047055  0.887396 -0.116388
8  -1.025095  0.288617  0.647005  0.346916
9  -2.082460 -1.337006  0.093433 -1.215210
10  4.000000  1.000000  3.000000  3.000000
</pre>
</div>
</div>


<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> 数据整形</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">tuples</span> = <span style="color: #d18aff;">list</span>(<span style="color: #d18aff;">zip</span>(*[[<span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'baz'</span>, <span style="color: #ff4ea3;">'baz'</span>,
                     <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'qux'</span>, <span style="color: #ff4ea3;">'qux'</span>],
                    [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>,
                     <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>]]))
log(<span style="color: #ff4ea3;">"tuples"</span>, tuples)
<span style="color: #ff8700;">index</span> = pd.MultiIndex.from_tuples(tuples, names=[<span style="color: #ff4ea3;">'first'</span>, <span style="color: #ff4ea3;">'second'</span>])
<span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(8, 2), index=index, columns=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>])
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
==================================== tuples ====================================
[('bar', 'one'), ('bar', 'two'), ('baz', 'one'), ('baz', 'two'), ('foo', 'one'), ('foo', 'two'), ('qux', 'one'), ('qux', 'two')]
====================================== df ======================================
                     A         B
first second
bar   one    -0.777935 -0.035040
      two     0.657334 -1.484383
baz   one     1.417820  0.331720
      two    -1.031743  0.529094
foo   one    -1.479319 -1.254366
      two     1.549588  0.122076
qux   one     0.691207 -1.024079
      two     0.175488 -1.063834
</pre>
</div>

<div id="outline-container-sec-6-4-1" class="outline-4">
<h4 id="sec-6-4-1"><span class="section-number-4">6.4.1</span> 将列索引变为行索引 (stack)</h4>
<div class="outline-text-4" id="text-6-4-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">stacked</span> = df.stack()
log(<span style="color: #ff4ea3;">"stacked"</span>, stacked)
log(<span style="color: #ff4ea3;">"type(stacked)"</span>, <span style="color: #d18aff;">type</span>(stacked))
log(<span style="color: #ff4ea3;">"stacked.index"</span>, stacked.index)
</pre>
</div>

<pre class="example">
=================================== stacked ====================================
first  second
bar    one     A   -0.777935
               B   -0.035040
       two     A    0.657334
               B   -1.484383
baz    one     A    1.417820
               B    0.331720
       two     A   -1.031743
               B    0.529094
foo    one     A   -1.479319
               B   -1.254366
       two     A    1.549588
               B    0.122076
qux    one     A    0.691207
               B   -1.024079
       two     A    0.175488
               B   -1.063834
dtype: float64
================================ type(stacked) =================================
&lt;class 'pandas.core.series.Series'&gt;
================================ stacked.index =================================
MultiIndex(levels=[['bar', 'baz', 'foo', 'qux'], ['one', 'two'], ['A', 'B']],
           labels=[[0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3], [0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1], [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1]],
           names=['first', 'second', None])
</pre>
</div>
</div>

<div id="outline-container-sec-6-4-2" class="outline-4">
<h4 id="sec-6-4-2"><span class="section-number-4">6.4.2</span> 将行索引变为列索引 (unstack)</h4>
<div class="outline-text-4" id="text-6-4-2">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"stacked.unstack()"</span>, stacked.unstack())
</pre>
</div>

<pre class="example">
============================== stacked.unstack() ===============================
                     A         B
first second
bar   one    -0.777935 -0.035040
      two     0.657334 -1.484383
baz   one     1.417820  0.331720
      two    -1.031743  0.529094
foo   one    -1.479319 -1.254366
      two     1.549588  0.122076
qux   one     0.691207 -1.024079
      two     0.175488 -1.063834
</pre>
</div>
</div>

<div id="outline-container-sec-6-4-3" class="outline-4">
<h4 id="sec-6-4-3"><span class="section-number-4">6.4.3</span> 透视图（pivot_table）</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
只观察 data frame 中一部分数据
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>] * 3,
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'C'</span>] * 4,
                   <span style="color: #ff4ea3;">'C'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'bar'</span>] * 2,
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(12),
                   <span style="color: #ff4ea3;">'E'</span> : np.random.randn(12)})

log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
        A  B    C         D         E
0     one  A  foo  0.156983 -0.406509
1     one  B  foo  0.423003  0.818435
2     two  C  foo  0.745195 -0.297479
3   three  A  bar  0.777859 -1.551424
4     one  B  bar -0.549301 -0.688656
5     one  C  bar  0.290337  0.130456
6     two  A  foo -0.757318  0.915245
7   three  B  foo -1.764010  1.719939
8     one  C  foo -1.172655  1.532731
9     one  A  bar  0.411071 -0.903276
10    two  B  bar -0.436824  1.318898
11  three  C  bar -1.044443  0.070690
</pre>

<p>
以 A ，B 为行索引，以 C 为列索引的，针对 D 的数据：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=<span style="color: #ff4ea3;">'D'</span>, index=[<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
C             bar       foo
A     B
one   A  0.411071  0.156983
      B -0.549301  0.423003
      C  0.290337 -1.172655
three A  0.777859       NaN
      B       NaN -1.764010
      C -1.044443       NaN
two   A       NaN -0.757318
      B -0.436824       NaN
      C       NaN  0.745195
</pre>

<p>
<b>当透视表结果为多个值的时候，返回平均值</b> ，如：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = pd.pivot_table(df, values=[<span style="color: #ff4ea3;">'E'</span>], index=[<span style="color: #ff4ea3;">'A'</span>], columns=[<span style="color: #ff4ea3;">'C'</span>])
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
              E
C           bar       foo
A
one   -0.487159  0.648219
three -0.740367  1.719939
two    1.318898  0.308883
</pre>

<p>
针对 A 为 one 的那行数据，其计算过程相当于：
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df[df.A==<span style="color: #ff4ea3;">'one'</span>].groupby(<span style="color: #ff4ea3;">'C'</span>).mean()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            D         E
C
bar  0.050702 -0.487159
foo -0.197556  0.648219
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Category</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">"id"</span>:[1,2,3,4,5,6], <span style="color: #ff4ea3;">"raw_grade"</span>:[<span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'b'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'a'</span>, <span style="color: #ff4ea3;">'e'</span>]})
<span style="color: #ff8700;">df</span>[<span style="color: #ff4ea3;">"grade"</span>] = df[<span style="color: #ff4ea3;">"raw_grade"</span>].astype(<span style="color: #ff4ea3;">"category"</span>)
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
   id raw_grade grade
0   1         a     a
1   2         b     b
2   3         b     b
3   4         a     a
4   5         a     a
5   6         e     e
</pre>

<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"df.grade"</span>, df.grade)
log(<span style="color: #ff4ea3;">"df.grade.cat.categories"</span>, df.grade.cat.categories)
<span style="color: #ff8700;">df.grade.cat.categories</span> = [<span style="color: #ff4ea3;">'very good'</span>, <span style="color: #ff4ea3;">'good'</span>, <span style="color: #ff4ea3;">'bad'</span>]
log(<span style="color: #ff4ea3;">"df"</span>, df)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#20197; raw_grade &#21015;&#20026;&#25490;&#24207;&#26631;&#20934;</span>
<span style="color: #ff8700;">sort_result</span> = df.sort_values(by=<span style="color: #ff4ea3;">'grade'</span>, ascending=<span style="color: #5fafd7;">False</span>)
log(<span style="color: #ff4ea3;">"sort_result"</span>, sort_result)
</pre>
</div>

<pre class="example">
=================================== df.grade ===================================
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): [a, b, e]
=========================== df.grade.cat.categories ============================
Index(['a', 'b', 'e'], dtype='object')
====================================== df ======================================
   id raw_grade      grade
0   1         a  very good
1   2         b       good
2   3         b       good
3   4         a  very good
4   5         a  very good
5   6         e        bad
================================= sort_result ==================================
   id raw_grade      grade
5   6         e        bad
2   3         b       good
1   2         b       good
4   5         a  very good
3   4         a  very good
0   1         a  very good
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 信息统计</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> mode</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"s.mode()"</span>, s.mode())
</pre>
</div>

<pre class="example">
=================================== s.mode() ===================================
0    3
dtype: int64
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 分组统计</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame({<span style="color: #ff4ea3;">'A'</span> : [<span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>,
                          <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'bar'</span>, <span style="color: #ff4ea3;">'foo'</span>, <span style="color: #ff4ea3;">'foo'</span>],
                   <span style="color: #ff4ea3;">'B'</span> : [<span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'three'</span>,
                          <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'two'</span>, <span style="color: #ff4ea3;">'one'</span>, <span style="color: #ff4ea3;">'three'</span>],
                   <span style="color: #ff4ea3;">'C'</span> : np.random.randn(8),
                   <span style="color: #ff4ea3;">'D'</span> : np.random.randn(8)})
log(<span style="color: #ff4ea3;">"df"</span>, df)
</pre>
</div>

<pre class="example">
====================================== df ======================================
     A      B         C         D
0  foo    one -2.220140  0.169443
1  bar    one  0.511979  1.184585
2  foo    two -1.885599 -0.234920
3  bar  three  0.098725 -0.980015
4  foo    two  0.147832  0.061695
5  bar    two -0.342261  1.289478
6  foo    one -1.283700  1.020503
7  foo  three  0.532362 -0.230950
</pre>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 对单列分组</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby(<span style="color: #ff4ea3;">'A'</span>).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
            C         D
A
bar  0.268443  1.494048
foo -4.709245  0.785772
</pre>
</div>
</div>


<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 对多列分组</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'A'</span>, <span style="color: #ff4ea3;">'B'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
A   B
bar one    0.511979  1.184585
    three  0.098725 -0.980015
    two   -0.342261  1.289478
foo one   -3.503841  1.189946
    three  0.532362 -0.230950
    two   -1.737767 -0.173225
</pre>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result</span> = df.groupby([<span style="color: #ff4ea3;">'B'</span>, <span style="color: #ff4ea3;">'A'</span>]).<span style="color: #d18aff;">sum</span>()
log(<span style="color: #ff4ea3;">"result"</span>, result)
</pre>
</div>

<pre class="example">
==================================== result ====================================
                  C         D
B     A
one   bar  0.511979  1.184585
      foo -3.503841  1.189946
three bar  0.098725 -0.980015
      foo  0.532362 -0.230950
two   bar -0.342261  1.289478
      foo -1.737767 -0.173225
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 时间序列</h2>
<div class="outline-text-2" id="text-9">
<p>
pandas 提供了强大的时间序列功能，比如把秒级的股票数据转换为 5 分钟周期数据等。
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> data_range</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.date_range(<span style="color: #ff4ea3;">'20160301'</span>, periods=600, freq=<span style="color: #ff4ea3;">'s'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
<span style="color: #ff8700;">ts</span> = pd.Series(np.random.randint(0, 500, <span style="color: #d18aff;">len</span>(rng)), index=rng)
log(<span style="color: #ff4ea3;">"ts"</span>, ts)
</pre>
</div>

<pre class="example">
===================================== rng ======================================
DatetimeIndex(['2016-03-01 00:00:00', '2016-03-01 00:00:01',
               '2016-03-01 00:00:02', '2016-03-01 00:00:03',
               '2016-03-01 00:00:04', '2016-03-01 00:00:05',
               '2016-03-01 00:00:06', '2016-03-01 00:00:07',
               '2016-03-01 00:00:08', '2016-03-01 00:00:09',
               ...
               '2016-03-01 00:09:50', '2016-03-01 00:09:51',
               '2016-03-01 00:09:52', '2016-03-01 00:09:53',
               '2016-03-01 00:09:54', '2016-03-01 00:09:55',
               '2016-03-01 00:09:56', '2016-03-01 00:09:57',
               '2016-03-01 00:09:58', '2016-03-01 00:09:59'],
              dtype='datetime64[ns]', length=600, freq='S')
====================================== ts ======================================
2016-03-01 00:00:00    156
2016-03-01 00:00:01    256
2016-03-01 00:00:02    129
2016-03-01 00:00:03    107
2016-03-01 00:00:04    406
2016-03-01 00:00:05    326
2016-03-01 00:00:06    350
2016-03-01 00:00:07    350
2016-03-01 00:00:08    169
2016-03-01 00:00:09    180
2016-03-01 00:00:10    300
2016-03-01 00:00:11    174
2016-03-01 00:00:12     53
2016-03-01 00:00:13     15
2016-03-01 00:00:14     86
2016-03-01 00:00:15    166
2016-03-01 00:00:16    192
2016-03-01 00:00:17    450
2016-03-01 00:00:18    109
2016-03-01 00:00:19    365
2016-03-01 00:00:20     78
2016-03-01 00:00:21    359
2016-03-01 00:00:22    286
2016-03-01 00:00:23     90
2016-03-01 00:00:24    445
2016-03-01 00:00:25    198
2016-03-01 00:00:26    149
2016-03-01 00:00:27    234
2016-03-01 00:00:28    143
2016-03-01 00:00:29    291
                      ...
2016-03-01 00:09:30    238
2016-03-01 00:09:31    305
2016-03-01 00:09:32    390
2016-03-01 00:09:33     93
2016-03-01 00:09:34    363
2016-03-01 00:09:35    115
2016-03-01 00:09:36     44
2016-03-01 00:09:37     44
2016-03-01 00:09:38    487
2016-03-01 00:09:39      8
2016-03-01 00:09:40    109
2016-03-01 00:09:41     59
2016-03-01 00:09:42     60
2016-03-01 00:09:43    326
2016-03-01 00:09:44    499
2016-03-01 00:09:45    430
2016-03-01 00:09:46    349
2016-03-01 00:09:47    424
2016-03-01 00:09:48    359
2016-03-01 00:09:49    255
2016-03-01 00:09:50    138
2016-03-01 00:09:51    243
2016-03-01 00:09:52      3
2016-03-01 00:09:53    330
2016-03-01 00:09:54     96
2016-03-01 00:09:55    380
2016-03-01 00:09:56    247
2016-03-01 00:09:57    183
2016-03-01 00:09:58    186
2016-03-01 00:09:59    450
Freq: S, Length: 600, dtype: int64
</pre>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 重采样</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">result_sum</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'sum'</span>)
log(<span style="color: #ff4ea3;">"result_sum"</span>, result_sum)
<span style="color: #ff8700;">result_mean</span> = ts.resample(<span style="color: #ff4ea3;">'2Min'</span>, how=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"result_mean"</span>, result_mean)
</pre>
</div>

<pre class="example">
================================== result_sum ==================================
2016-03-01 00:00:00    30141
2016-03-01 00:02:00    28007
2016-03-01 00:04:00    31186
2016-03-01 00:06:00    26952
2016-03-01 00:08:00    30048
Freq: 2T, dtype: int64
================================= result_mean ==================================
2016-03-01 00:00:00    251.175000
2016-03-01 00:02:00    233.391667
2016-03-01 00:04:00    259.883333
2016-03-01 00:06:00    224.600000
2016-03-01 00:08:00    250.400000
Freq: 2T, dtype: float64
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).sum()
  """Entry point for launching an IPython kernel.
/Users/haoruan/Desktop/workspace/py3.5.3_env/lib/python3.5/site-packages/ipykernel_launcher.py:3: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  This is separate from the ipykernel package so we can avoid doing imports until
</pre>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> period_range</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">rng</span> = pd.period_range(<span style="color: #ff4ea3;">'2000Q1'</span>, <span style="color: #ff4ea3;">'2016Q1'</span>, freq=<span style="color: #ff4ea3;">'Q'</span>)
log(<span style="color: #ff4ea3;">"rng"</span>, rng)
log(<span style="color: #ff4ea3;">"rng.to_timestamp()"</span>, rng.to_timestamp())
</pre>
</div>

<pre class="example">
===================================== rng ======================================
PeriodIndex(['2000Q1', '2000Q2', '2000Q3', '2000Q4', '2001Q1', '2001Q2',
             '2001Q3', '2001Q4', '2002Q1', '2002Q2', '2002Q3', '2002Q4',
             '2003Q1', '2003Q2', '2003Q3', '2003Q4', '2004Q1', '2004Q2',
             '2004Q3', '2004Q4', '2005Q1', '2005Q2', '2005Q3', '2005Q4',
             '2006Q1', '2006Q2', '2006Q3', '2006Q4', '2007Q1', '2007Q2',
             '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3', '2008Q4',
             '2009Q1', '2009Q2', '2009Q3', '2009Q4', '2010Q1', '2010Q2',
             '2010Q3', '2010Q4', '2011Q1', '2011Q2', '2011Q3', '2011Q4',
             '2012Q1', '2012Q2', '2012Q3', '2012Q4', '2013Q1', '2013Q2',
             '2013Q3', '2013Q4', '2014Q1', '2014Q2', '2014Q3', '2014Q4',
             '2015Q1', '2015Q2', '2015Q3', '2015Q4', '2016Q1'],
            dtype='period[Q-DEC]', freq='Q-DEC')
============================== rng.to_timestamp() ==============================
DatetimeIndex(['2000-01-01', '2000-04-01', '2000-07-01', '2000-10-01',
               '2001-01-01', '2001-04-01', '2001-07-01', '2001-10-01',
               '2002-01-01', '2002-04-01', '2002-07-01', '2002-10-01',
               '2003-01-01', '2003-04-01', '2003-07-01', '2003-10-01',
               '2004-01-01', '2004-04-01', '2004-07-01', '2004-10-01',
               '2005-01-01', '2005-04-01', '2005-07-01', '2005-10-01',
               '2006-01-01', '2006-04-01', '2006-07-01', '2006-10-01',
               '2007-01-01', '2007-04-01', '2007-07-01', '2007-10-01',
               '2008-01-01', '2008-04-01', '2008-07-01', '2008-10-01',
               '2009-01-01', '2009-04-01', '2009-07-01', '2009-10-01',
               '2010-01-01', '2010-04-01', '2010-07-01', '2010-10-01',
               '2011-01-01', '2011-04-01', '2011-07-01', '2011-10-01',
               '2012-01-01', '2012-04-01', '2012-07-01', '2012-10-01',
               '2013-01-01', '2013-04-01', '2013-07-01', '2013-10-01',
               '2014-01-01', '2014-04-01', '2014-07-01', '2014-10-01',
               '2015-01-01', '2015-04-01', '2015-07-01', '2015-10-01',
               '2016-01-01'],
              dtype='datetime64[ns]', freq='QS-OCT')
</pre>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> 时间计算</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">

<pre class="src src-ipython">log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') - pd.Timestamp('20160201')"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) - pd.Timestamp(<span style="color: #ff4ea3;">'20160201'</span>))
log(<span style="color: #ff4ea3;">"pd.Timestamp('20160301') + pd.Timedelta(days=5)"</span>, pd.Timestamp(<span style="color: #ff4ea3;">'20160301'</span>) + pd.Timedelta(days=5))
</pre>
</div>

<pre class="example">
============= pd.Timestamp('20160301') - pd.Timestamp('20160201') ==============
29 days 00:00:00
=============== pd.Timestamp('20160301') + pd.Timedelta(days=5) ================
2016-03-06 00:00:00
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 可视化</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Series</h3>
<div class="outline-text-3" id="text-10-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ts</span> = pd.Series(np.random.randn(1000), index=pd.date_range(<span style="color: #ff4ea3;">'20000101'</span>, periods=1000))
<span style="color: #ff8700;">ts</span> = ts.cumsum()
show_fig(ts)
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428HE0.png" alt="fig75428HE0.png">
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 导入导出</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> 导出 csv</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">df</span> = pd.DataFrame(np.random.randn(100, 4), columns=<span style="color: #d18aff;">list</span>(<span style="color: #ff4ea3;">'ABCD'</span>))
df.to_csv(<span style="color: #ff4ea3;">"/tmp/df.csv"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 导入 csv</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">

<pre class="src src-ipython">pd.read_csv(<span style="color: #ff4ea3;">'/tmp/df.csv'</span>, index_col=0)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> 示例工程</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> 电影数据分析</h3>
<div class="outline-text-3" id="text-12-1">
</div><div id="outline-container-sec-12-1-1" class="outline-4">
<h4 id="sec-12-1-1"><span class="section-number-4">12.1.1</span> 数据读取</h4>
<div class="outline-text-4" id="text-12-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">user_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'gender'</span>, <span style="color: #ff4ea3;">'age'</span>, <span style="color: #ff4ea3;">'occupation'</span>, <span style="color: #ff4ea3;">'zip'</span>]
<span style="color: #ff8700;">users</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/users.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=user_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">rating_names</span> = [<span style="color: #ff4ea3;">'user_id'</span>, <span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'rating'</span>, <span style="color: #ff4ea3;">'timestamp'</span>]
<span style="color: #ff8700;">ratings</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/ratings.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=rating_names, engine=<span style="color: #ff4ea3;">'python'</span>)

<span style="color: #ff8700;">movie_names</span> = [<span style="color: #ff4ea3;">'movie_id'</span>, <span style="color: #ff4ea3;">'title'</span>, <span style="color: #ff4ea3;">'genres'</span>]
<span style="color: #ff8700;">movies</span> = pd.read_table(<span style="color: #ff4ea3;">'data/ml-1m/movies.dat'</span>, sep=<span style="color: #ff4ea3;">'::'</span>, header=<span style="color: #5fafd7;">None</span>, names=movie_names, engine=<span style="color: #ff4ea3;">'python'</span>)

log(<span style="color: #ff4ea3;">"users.head()"</span>, users.head())
log(<span style="color: #ff4ea3;">"ratings.head()"</span>, ratings.head())
log(<span style="color: #ff4ea3;">"movies.head()"</span>, movies.head())
</pre>
</div>

<pre class="example">
================================= users.head() =================================
   user_id gender  age  occupation    zip
0        1      F    1          10  48067
1        2      M   56          16  70072
2        3      M   25          15  55117
3        4      M   45           7  02460
4        5      M   25          20  55455
================================ ratings.head() ================================
   user_id  movie_id  rating  timestamp
0        1      1193       5  978300760
1        1       661       3  978302109
2        1       914       3  978301968
3        1      3408       4  978300275
4        1      2355       5  978824291
================================ movies.head() =================================
   movie_id                               title                        genres
0         1                    Toy Story (1995)   Animation|Children's|Comedy
1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
2         3             Grumpier Old Men (1995)                Comedy|Romance
3         4            Waiting to Exhale (1995)                  Comedy|Drama
4         5  Father of the Bride Part II (1995)                        Comedy
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-2" class="outline-4">
<h4 id="sec-12-1-2"><span class="section-number-4">12.1.2</span> 数据合并 (merge)</h4>
<div class="outline-text-4" id="text-12-1-2">
<p>
在 pandas 中，数据只有合并后才能进行分析
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">data</span> = pd.merge(pd.merge(users, ratings), movies)
show_dataframe(data.head())
</pre>
</div>


<div class="figure">
<p><img src="img/fig75428GYJ.png" alt="fig75428GYJ.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-12-1-3" class="outline-4">
<h4 id="sec-12-1-3"><span class="section-number-4">12.1.3</span> 按性别查看各个电影的平均评分 (pivot_table)</h4>
<div class="outline-text-4" id="text-12-1-3">
<p>
<b>关心的值</b> 是 rating ，以 title 作为 <b>行索引</b> ，gender 作为 <b>列索引</b>
</p>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, columns=<span style="color: #ff4ea3;">'gender'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
log(<span style="color: #ff4ea3;">"mean_ratings_gender.head()"</span>, mean_ratings_gender.head())
</pre>
</div>

<pre class="example">
========================== mean_ratings_gender.head() ==========================
gender                                F         M
title
$1,000,000 Duck (1971)         3.375000  2.761905
'Night Mother (1986)           3.388889  3.352941
'Til There Was You (1997)      2.675676  2.733333
'burbs, The (1989)             2.793478  2.962085
...And Justice for All (1979)  3.828571  3.689024
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-4" class="outline-4">
<h4 id="sec-12-1-4"><span class="section-number-4">12.1.4</span> 男女意见想差最大的电影 (sort_values)</h4>
<div class="outline-text-4" id="text-12-1-4">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings_gender</span>[<span style="color: #ff4ea3;">'diff'</span>] = mean_ratings_gender.F - mean_ratings_gender.M
<span style="color: #ff8700;">result</span> = mean_ratings_gender.sort_values(by=<span style="color: #ff4ea3;">'diff'</span>, ascending=<span style="color: #5fafd7;">True</span>)
log(<span style="color: #ff4ea3;">"result.head()"</span>, result.head())
</pre>
</div>

<pre class="example">
================================ result.head() =================================
gender                                        F         M      diff
title
Tigrero: A Film That Was Never Made (1994)  1.0  4.333333 -3.333333
Neon Bible, The (1995)                      1.0  4.000000 -3.000000
Enfer, L' (1994)                            1.0  3.750000 -2.750000
Stalingrad (1993)                           1.0  3.593750 -2.593750
Killer: A Journal of Murder (1995)          1.0  3.428571 -2.428571
</pre>
</div>
</div>

<div id="outline-container-sec-12-1-5" class="outline-4">
<h4 id="sec-12-1-5"><span class="section-number-4">12.1.5</span> 参与评分人数最多 (group_by)</h4>
<div class="outline-text-4" id="text-12-1-5">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">ratings_by_movie_title</span> = data.groupby(<span style="color: #ff4ea3;">'title'</span>).size()
<span style="color: #ff8700;">top_ratings</span> = ratings_by_movie_title[ratings_by_movie_title &gt; 1000]
<span style="color: #ff8700;">top_10_ratings</span> = top_ratings.sort_values(ascending=<span style="color: #5fafd7;">False</span>).head()
log(<span style="color: #ff4ea3;">"top_10_ratings"</span>, top_10_ratings)
</pre>
</div>

<pre class="example">
================================ top_10_ratings ================================
title
American Beauty (1999)                                   3428
Star Wars: Episode IV - A New Hope (1977)                2991
Star Wars: Episode V - The Empire Strikes Back (1980)    2990
Star Wars: Episode VI - Return of the Jedi (1983)        2883
Jurassic Park (1993)                                     2672
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-sec-12-1-6" class="outline-4">
<h4 id="sec-12-1-6"><span class="section-number-4">12.1.6</span> 活跃度超过 1000 的高分电影</h4>
<div class="outline-text-4" id="text-12-1-6">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #ff8700;">mean_ratings</span> = data.pivot_table(values=<span style="color: #ff4ea3;">'rating'</span>, index=<span style="color: #ff4ea3;">'title'</span>, aggfunc=<span style="color: #ff4ea3;">'mean'</span>)
<span style="color: #ff8700;">top_10_movies</span> = mean_ratings.loc[top_ratings.index].sort_values(by=<span style="color: #ff4ea3;">'rating'</span>, ascending=<span style="color: #5fafd7;">False</span>).head(10)
<span style="color: #6c6c6c; font-style: italic;"># </span><span style="color: #6c6c6c; font-style: italic;">&#25226;&#24179;&#22343;&#35780;&#20998;&#21644;&#28909;&#24230;&#32508;&#21512;&#36215;&#26469;</span>
<span style="color: #ff8700;">df_top_10_movies</span> = pd.DataFrame(top_10_movies)
<span style="color: #ff8700;">df_top_10_movies</span>[<span style="color: #ff4ea3;">'hot'</span>] = top_ratings.loc[top_10_movies.index]
log(<span style="color: #ff4ea3;">"df_top_10_movies"</span>, df_top_10_movies)
</pre>
</div>

<pre class="example">
=============================== df_top_10_movies ===============================
                                                      rating   hot
title
Shawshank Redemption, The (1994)                    4.554558  2227
Godfather, The (1972)                               4.524966  2223
Usual Suspects, The (1995)                          4.517106  1783
Schindler's List (1993)                             4.510417  2304
Raiders of the Lost Ark (1981)                      4.477725  2514
Rear Window (1954)                                  4.476190  1050
Star Wars: Episode IV - A New Hope (1977)           4.453694  2991
Dr. Strangelove or: How I Learned to Stop Worry...  4.449890  1367
Casablanca (1942)                                   4.412822  1669
Sixth Sense, The (1999)                             4.406263  2459
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>