<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2019-07-12 Fri 14:23 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SpingBoot</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Hao Ruan">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<link href="../org-html-themes/solarized/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">SpingBoot</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgeb42dfc">1. WEB</a>
<ul>
<li><a href="#orgf3d6fad">1.1. 静态资源路径</a></li>
<li><a href="#orgc324246">1.2. Spring MVC 原理</a>
<ul>
<li><a href="#orgbdbd922">1.2.1. DispatcherServlet 原理</a></li>
<li><a href="#org8bcc32a">1.2.2. 重要组件</a>
<ul>
<li><a href="#org816bcb2">1.2.2.1. ContentNegotiatingViewResovler</a></li>
<li><a href="#org51f14d5">1.2.2.2. <code>HttpMessageConverters</code></a></li>
<li><a href="#org9e300a1">1.2.2.3. <code>ConfigurableWebBindingInitializer</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0e52635">2. 缓存</a>
<ul>
<li><a href="#org8c6fdc7">2.1. JSR107</a></li>
<li><a href="#org741bd79">2.2. Springboot 缓存抽象</a></li>
<li><a href="#org531d465">2.3. 示例代码</a></li>
</ul>
</li>
<li><a href="#orgcdc44ba">3. 调度</a>
<ul>
<li><a href="#orgf1b03ac">3.1. 示例工程</a></li>
<li><a href="#org9cb4810">3.2. 每隔固定时间执行</a></li>
<li><a href="#org50be9d1">3.3. 指定任务间隔</a></li>
<li><a href="#org80f8534">3.4. UNIX Cron 风格</a></li>
</ul>
</li>
<li><a href="#orgf5a7878">4. 配置</a>
<ul>
<li><a href="#org3abb399">4.1. 自动配置原理</a>
<ul>
<li><a href="#orgca4bf00">4.1.1. 自动配置报告</a></li>
</ul>
</li>
<li><a href="#orga1dd9c0">4.2. @ConfigurationProperties 与 @Value 的区别</a></li>
<li><a href="#org5ca647f">4.3. Profile</a>
<ul>
<li><a href="#org92ea305">4.3.1. 主配置文件激活</a></li>
<li><a href="#orgedb593a">4.3.2. 命令行激活</a></li>
<li><a href="#orgeae6ba4">4.3.3. 虚拟机参数激活</a></li>
</ul>
</li>
<li><a href="#org769d9f7">4.4. 配置文件搜索顺序</a></li>
<li><a href="#org4d993b6">4.5. 配置文件占位符</a></li>
<li><a href="#orgfc2f3d3">4.6. <code>@Conditional</code> 派生注解</a></li>
</ul>
</li>
<li><a href="#org3b6c418">5. Async</a>
<ul>
<li><a href="#org2574a7f">5.1. 异常统一捕获</a></li>
</ul>
</li>
<li><a href="#org5547fe5">6. 工具</a>
<ul>
<li><a href="#orge9b31a4">6.1. JacksonXML</a>
<ul>
<li><a href="#org77b3760">6.1.1. 示例数据</a></li>
<li><a href="#org3b75e01">6.1.2. pom 配置</a></li>
<li><a href="#orge754b34">6.1.3. DTO</a></li>
<li><a href="#org8de94f8">6.1.4. Controller</a></li>
</ul>
</li>
<li><a href="#org0e9dcb2">6.2. MapStruct</a>
<ul>
<li><a href="#org2ede6d9">6.2.1. pom 配置</a>
<ul>
<li><a href="#org8bfdcad">6.2.1.1. properties</a></li>
<li><a href="#org2204848">6.2.1.2. dependency</a></li>
<li><a href="#org13fa0d0">6.2.1.3. plugin</a></li>
</ul>
</li>
<li><a href="#org818b7de">6.2.2. Mapper 接口</a></li>
<li><a href="#org9078b37">6.2.3. 调用</a></li>
</ul>
</li>
<li><a href="#org2d98365">6.3. MapperFactory</a>
<ul>
<li><a href="#org9be7b86">6.3.1. 配置</a></li>
<li><a href="#org31d7bae">6.3.2. 使用</a></li>
<li><a href="#orgebca401">6.3.3. 传送门</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga64a650">7. 实践</a>
<ul>
<li><a href="#org1ff97e8">7.1. Restful Service (MVC)</a>
<ul>
<li><a href="#org9e18359">7.1.1. WebApplicationInitializer</a></li>
<li><a href="#org913d131">7.1.2. Controller</a></li>
<li><a href="#orgfb6d990">7.1.3. HttpMessageConverter</a></li>
<li><a href="#orgdf20f92">7.1.4. 异常处理</a>
<ul>
<li><a href="#org05ed8b3">7.1.4.1. 异常级别</a></li>
<li><a href="#org7504d0e">7.1.4.2. 控制器级别</a></li>
<li><a href="#org98e6a2e">7.1.4.3. 全局级别</a>
<ul>
<li><a href="#org1839e92">7.1.4.3.1. 重新抛出</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org94911d4">7.2. Application Event</a>
<ul>
<li><a href="#org9f13647">7.2.1. Event</a></li>
<li><a href="#org6b1fc18">7.2.2. Listener</a></li>
<li><a href="#org86cd8d9">7.2.3. Publisher</a></li>
<li><a href="#orgfd2dbb2">7.2.4. 自定义 applicationEventMulticaster</a></li>
<li><a href="#org05948d9">7.2.5. 常见 SpringApplicationEvent</a></li>
</ul>
</li>
<li><a href="#org0cc5568">7.3. Springboot Test</a>
<ul>
<li><a href="#org32d1593">7.3.1. 样板文件</a></li>
<li><a href="#orgb2cba7a">7.3.2. MockMvc</a></li>
<li><a href="#org073895c">7.3.3. Hamcrest</a>
<ul>
<li><a href="#orga27e46b">7.3.3.1. Core API</a></li>
<li><a href="#org511a4ce">7.3.3.2. Object Matcher</a></li>
<li><a href="#org428a963">7.3.3.3. Bean Matcher</a></li>
<li><a href="#org90bfe6a">7.3.3.4. Collection Matcher</a></li>
<li><a href="#org79d85bb">7.3.3.5. Number Matcher</a></li>
<li><a href="#org086b6c2">7.3.3.6. Text Matcher</a></li>
</ul>
</li>
<li><a href="#org60a5ae4">7.3.4. Mockito</a>
<ul>
<li><a href="#org11d7d2b">7.3.4.1. Mock 与 Stub 的区别</a></li>
<li><a href="#org5714cdd">7.3.4.2. 验证行为</a></li>
<li><a href="#org156147a">7.3.4.3. 打桩</a></li>
<li><a href="#org4a13a3c">7.3.4.4. 连续调用打桩对象</a></li>
<li><a href="#org3fac4b3">7.3.4.5. 参数匹配器</a></li>
<li><a href="#orga445758">7.3.4.6. 调用次数</a></li>
<li><a href="#orgb7a07a7">7.3.4.7. 处理异常</a></li>
<li><a href="#orgfa0b999">7.3.4.8. 确保不发生交互</a></li>
<li><a href="#orgd1638cc">7.3.4.9. 寻找多余交互</a></li>
<li><a href="#org48d5b9d">7.3.4.10. 注解</a>
<ul>
<li><a href="#org1b63897">7.3.4.10.1. 启用注解</a></li>
<li><a href="#org58c2165">7.3.4.10.2. @Mock</a></li>
<li><a href="#org0c64320">7.3.4.10.3. @Spy</a></li>
<li><a href="#orga7bee76">7.3.4.10.4. @Captor</a></li>
<li><a href="#org9f7909b">7.3.4.10.5. @InjectMocks</a></li>
</ul>
</li>
<li><a href="#orgd3688a4">7.3.4.11. 传送门</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org104a9eb">8. 参考</a>
<ul>
<li><a href="#orga6cd3e9">8.1. 所有可配置选项</a></li>
<li><a href="#org0cf8ffb">8.2. Content Negotiation Using Views</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgeb42dfc">1. WEB</a>
<ul>
<li><a href="#orgf3d6fad">1.1. 静态资源路径</a></li>
<li><a href="#orgc324246">1.2. Spring MVC 原理</a>
<ul>
<li><a href="#orgbdbd922">1.2.1. DispatcherServlet 原理</a></li>
<li><a href="#org8bcc32a">1.2.2. 重要组件</a>
<ul>
<li><a href="#org816bcb2">1.2.2.1. ContentNegotiatingViewResovler</a></li>
<li><a href="#org51f14d5">1.2.2.2. <code>HttpMessageConverters</code></a></li>
<li><a href="#org9e300a1">1.2.2.3. <code>ConfigurableWebBindingInitializer</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0e52635">2. 缓存</a>
<ul>
<li><a href="#org8c6fdc7">2.1. JSR107</a></li>
<li><a href="#org741bd79">2.2. Springboot 缓存抽象</a></li>
<li><a href="#org531d465">2.3. 示例代码</a></li>
</ul>
</li>
<li><a href="#orgcdc44ba">3. 调度</a>
<ul>
<li><a href="#orgf1b03ac">3.1. 示例工程</a></li>
<li><a href="#org9cb4810">3.2. 每隔固定时间执行</a></li>
<li><a href="#org50be9d1">3.3. 指定任务间隔</a></li>
<li><a href="#org80f8534">3.4. UNIX Cron 风格</a></li>
</ul>
</li>
<li><a href="#orgf5a7878">4. 配置</a>
<ul>
<li><a href="#org3abb399">4.1. 自动配置原理</a>
<ul>
<li><a href="#orgca4bf00">4.1.1. 自动配置报告</a></li>
</ul>
</li>
<li><a href="#orga1dd9c0">4.2. @ConfigurationProperties 与 @Value 的区别</a></li>
<li><a href="#org5ca647f">4.3. Profile</a>
<ul>
<li><a href="#org92ea305">4.3.1. 主配置文件激活</a></li>
<li><a href="#orgedb593a">4.3.2. 命令行激活</a></li>
<li><a href="#orgeae6ba4">4.3.3. 虚拟机参数激活</a></li>
</ul>
</li>
<li><a href="#org769d9f7">4.4. 配置文件搜索顺序</a></li>
<li><a href="#org4d993b6">4.5. 配置文件占位符</a></li>
<li><a href="#orgfc2f3d3">4.6. <code>@Conditional</code> 派生注解</a></li>
</ul>
</li>
<li><a href="#org3b6c418">5. Async</a>
<ul>
<li><a href="#org2574a7f">5.1. 异常统一捕获</a></li>
</ul>
</li>
<li><a href="#org5547fe5">6. 工具</a>
<ul>
<li><a href="#orge9b31a4">6.1. JacksonXML</a>
<ul>
<li><a href="#org77b3760">6.1.1. 示例数据</a></li>
<li><a href="#org3b75e01">6.1.2. pom 配置</a></li>
<li><a href="#orge754b34">6.1.3. DTO</a></li>
<li><a href="#org8de94f8">6.1.4. Controller</a></li>
</ul>
</li>
<li><a href="#org0e9dcb2">6.2. MapStruct</a>
<ul>
<li><a href="#org2ede6d9">6.2.1. pom 配置</a>
<ul>
<li><a href="#org8bfdcad">6.2.1.1. properties</a></li>
<li><a href="#org2204848">6.2.1.2. dependency</a></li>
<li><a href="#org13fa0d0">6.2.1.3. plugin</a></li>
</ul>
</li>
<li><a href="#org818b7de">6.2.2. Mapper 接口</a></li>
<li><a href="#org9078b37">6.2.3. 调用</a></li>
</ul>
</li>
<li><a href="#org2d98365">6.3. MapperFactory</a>
<ul>
<li><a href="#org9be7b86">6.3.1. 配置</a></li>
<li><a href="#org31d7bae">6.3.2. 使用</a></li>
<li><a href="#orgebca401">6.3.3. 传送门</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga64a650">7. 实践</a>
<ul>
<li><a href="#org1ff97e8">7.1. Restful Service (MVC)</a>
<ul>
<li><a href="#org9e18359">7.1.1. WebApplicationInitializer</a></li>
<li><a href="#org913d131">7.1.2. Controller</a></li>
<li><a href="#orgfb6d990">7.1.3. HttpMessageConverter</a></li>
<li><a href="#orgdf20f92">7.1.4. 异常处理</a>
<ul>
<li><a href="#org05ed8b3">7.1.4.1. 异常级别</a></li>
<li><a href="#org7504d0e">7.1.4.2. 控制器级别</a></li>
<li><a href="#org98e6a2e">7.1.4.3. 全局级别</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org94911d4">7.2. Application Event</a>
<ul>
<li><a href="#org9f13647">7.2.1. Event</a></li>
<li><a href="#org6b1fc18">7.2.2. Listener</a></li>
<li><a href="#org86cd8d9">7.2.3. Publisher</a></li>
<li><a href="#orgfd2dbb2">7.2.4. 自定义 applicationEventMulticaster</a></li>
<li><a href="#org05948d9">7.2.5. 常见 SpringApplicationEvent</a></li>
</ul>
</li>
<li><a href="#org0cc5568">7.3. Springboot Test</a>
<ul>
<li><a href="#org32d1593">7.3.1. 样板文件</a></li>
<li><a href="#orgb2cba7a">7.3.2. MockMvc</a></li>
<li><a href="#org073895c">7.3.3. Hamcrest</a>
<ul>
<li><a href="#orga27e46b">7.3.3.1. Core API</a></li>
<li><a href="#org511a4ce">7.3.3.2. Object Matcher</a></li>
<li><a href="#org428a963">7.3.3.3. Bean Matcher</a></li>
<li><a href="#org90bfe6a">7.3.3.4. Collection Matcher</a></li>
<li><a href="#org79d85bb">7.3.3.5. Number Matcher</a></li>
<li><a href="#org086b6c2">7.3.3.6. Text Matcher</a></li>
</ul>
</li>
<li><a href="#org60a5ae4">7.3.4. Mockito</a>
<ul>
<li><a href="#org11d7d2b">7.3.4.1. Mock 与 Stub 的区别</a></li>
<li><a href="#org5714cdd">7.3.4.2. 验证行为</a></li>
<li><a href="#org156147a">7.3.4.3. 打桩</a></li>
<li><a href="#org4a13a3c">7.3.4.4. 连续调用打桩对象</a></li>
<li><a href="#org3fac4b3">7.3.4.5. 参数匹配器</a></li>
<li><a href="#orga445758">7.3.4.6. 调用次数</a></li>
<li><a href="#orgb7a07a7">7.3.4.7. 处理异常</a></li>
<li><a href="#orgfa0b999">7.3.4.8. 确保不发生交互</a></li>
<li><a href="#orgd1638cc">7.3.4.9. 寻找多余交互</a></li>
<li><a href="#org48d5b9d">7.3.4.10. 注解</a></li>
<li><a href="#orgd3688a4">7.3.4.11. 传送门</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org104a9eb">8. 参考</a>
<ul>
<li><a href="#orga6cd3e9">8.1. 所有可配置选项</a></li>
<li><a href="#org0cf8ffb">8.2. Content Negotiation Using Views</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="meta">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Author</td>
<td class="org-left">Hao Ruan (haoru@cisco.com)</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">2019-07-12 14:23:06</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgeb42dfc" class="outline-2">
<h2 id="orgeb42dfc"><span class="section-number-2">1</span> WEB</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgf3d6fad" class="outline-3">
<h3 id="orgf3d6fad"><span class="section-number-3">1.1</span> 静态资源路径</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><code>classpath:/META-INF/resources/</code></li>
<li><code>classpath:/resources/</code></li>
<li><code>classpath:/static/</code></li>
<li><code>classpath:/public/</code></li>
<li>当前项目的根路径(<code>/</code>)</li>
</ul>
</div>
</div>


<div id="outline-container-orgc324246" class="outline-3">
<h3 id="orgc324246"><span class="section-number-3">1.2</span> Spring MVC 原理</h3>
<div class="outline-text-3" id="text-1-2">
<img src="http://www.51gjie.com/Images/image1/epnnzel2.4i4.jpg"/>
</br>
<img src="http://www.51gjie.com/Images/image1/srcc4b4l.hix.jpg"/>


<ul class="org-ul">
<li>用户发送请求到前端控制器(DispatcherServlet)，前端控制器收到请求后自己不进行处理，而是委托给其他的解析器进行处理，作为统一访问点，进行全局的流程控制</li>
<li>前端控制器请求 HandlerMapping 查找 Handler ，返回 HandlerExecutionChain 对象（包含一个 Handler 对象，即 <b>Controller</b> ，和多个 HandlerInterceptor 拦截器）对象，
通过这种策略模式，很容易添加新的映射策略（这个过程可以根据 xml 配置或注解进行查找）</li>
<li>HandlerAdapter 将会把处理器包装为适配器，从而支持多种类型的处理器，即适配器设计模式的应用，从而很容易支持很多类型的处理器</li>
<li>处理器适配器去执行 Handler ，将会根据适配的结果调用真正的处理器的功能处理方法，完成功能处理，并返回一个 ModelAndView 对象</li>
<li>处理器适配器向前端控制器返回ModelAndView，ModelAndView是springmvc框架的一个底层对象，包括 Model 和 View</li>
<li>前端控制器请求 ViewResolver 进行视图解析，即根据逻辑视图名解析成真正的视图</li>
<li>View 会根据传进来的 Model 模型数据进行渲染</li>
<li>前端控制器向用户响应结果、</li>
</ul>
</div>

<div id="outline-container-orgbdbd922" class="outline-4">
<h4 id="orgbdbd922"><span class="section-number-4">1.2.1</span> DispatcherServlet 原理</h4>
<div class="outline-text-4" id="text-1-2-1">
<img src="http://www.51gjie.com/Images/image1/0meux44p.4vz.jpg"/>
</div>
</div>


<div id="outline-container-org8bcc32a" class="outline-4">
<h4 id="org8bcc32a"><span class="section-number-4">1.2.2</span> 重要组件</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<div id="outline-container-org816bcb2" class="outline-5">
<h5 id="org816bcb2"><span class="section-number-5">1.2.2.1</span> ContentNegotiatingViewResovler</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<img src="http://blog.springsource.org/wp-content/uploads/2013/06/cnvr-all-flow.png"/>

<ul class="org-ul">
<li><code>ContentNegotiatingViewResolver</code> 组合所有视图解析器</li>
<li>可以自定义一个视图解析器， <code>ContentNegotiatingViewResolver</code> 自动将其整合进来</li>
</ul>
</div>
</div>

<div id="outline-container-org51f14d5" class="outline-5">
<h5 id="org51f14d5"><span class="section-number-5">1.2.2.2</span> <code>HttpMessageConverters</code></h5>
<div class="outline-text-5" id="text-1-2-2-2">
<p>
转换 HTTP 响应，如 User =&gt; JOSN
</p>
</div>
</div>

<div id="outline-container-org9e300a1" class="outline-5">
<h5 id="org9e300a1"><span class="section-number-5">1.2.2.3</span> <code>ConfigurableWebBindingInitializer</code></h5>
<div class="outline-text-5" id="text-1-2-2-3">
<p>
用于将请求的数据转换成 RequestBody
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org0e52635" class="outline-2">
<h2 id="org0e52635"><span class="section-number-2">2</span> 缓存</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org8c6fdc7" class="outline-3">
<h3 id="org8c6fdc7"><span class="section-number-3">2.1</span> JSR107</h3>
<div class="outline-text-3" id="text-2-1">
<img src="https://img-blog.csdn.net/20180826194453182?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1bzYwOTYzMDE5OQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"/>

<p>
定义了 5 个核心接口:
</p>

<ol class="org-ol">
<li><p>
CachingProvider
</p>

<p>
创建，配置，获取，管理和控制 <code>CacheManager</code> ，一个应用运行期间可以访问多个 <code>CacheManager</code>
</p></li>
<li><p>
CacheManager
</p>

<p>
创建，配置，获取，管理和控制 <code>Cache</code> ，一个 <code>CacheManager</code> 仅被一个 <code>CachingProvider</code> 拥有
</p></li>
<li><p>
Cache
</p>

<p>
类似 <code>Map</code> 的数据结构，一个 Cache 仅被一个 <code>CacheManager</code> 拥有
</p></li>
<li><p>
Entry
</p>

<p>
存储在 <code>Cache</code> 中的 k-v 对
</p></li>
<li><p>
Expiry
</p>

<p>
<code>Cache</code> 中条目的有效期，可以通过 <code>ExpiryPolicy</code> 设置
</p></li>
</ol>
</div>
</div>




<div id="outline-container-org741bd79" class="outline-3">
<h3 id="org741bd79"><span class="section-number-3">2.2</span> Springboot 缓存抽象</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Cache</li>
</ul>

<p>
缓存接口，定义缓存操作。实现有：RedisCache, EhCacheCache, ConcurrentMapCache 等
</p>
<ul class="org-ul">
<li>CacheManager</li>
</ul>

<p>
缓存管理器
</p>
<ul class="org-ul">
<li>@Cacheable</li>
</ul>

<p>
根据方法的请求参数对其结果进行缓存
</p>
<ul class="org-ul">
<li>@CacheEvict</li>
</ul>

<p>
清空缓存
</p>
<ul class="org-ul">
<li>@CachePut</li>
</ul>

<p>
更新缓存
</p>
<ul class="org-ul">
<li>@EnableCaching</li>
</ul>

<p>
开启基于注解的缓存
</p>
<ul class="org-ul">
<li>keyGenerator</li>
</ul>

<p>
key 生成策略
</p>
<ul class="org-ul">
<li>serialize</li>
</ul>

<p>
value 序列化策略
</p>
</div>
</div>


<div id="outline-container-org531d465" class="outline-3">
<h3 id="org531d465"><span class="section-number-3">2.3</span> 示例代码</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li><a href="https://github.com/ruanhao/java-for-fun/tree/master/src/test/java/com/hao/notes/caching">基本使用</a></li>
<li><a href="https://github.com/ruanhao/java-for-fun/tree/master/src/test/java/com/hao/notes/caching/redis">使用 Redis 作为 CacheManager</a></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgcdc44ba" class="outline-2">
<h2 id="orgcdc44ba"><span class="section-number-2">3</span> 调度</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf1b03ac" class="outline-3">
<h3 id="orgf1b03ac"><span class="section-number-3">3.1</span> <a href="https://github.com/ruanhao/java-for-fun/tree/master/src/test/java/com/hao/notes/schedule">示例工程</a></h3>
</div>
<div id="outline-container-org9cb4810" class="outline-3">
<h3 id="org9cb4810"><span class="section-number-3">3.2</span> 每隔固定时间执行</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Scheduled</span>(fixedRate=5000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org50be9d1" class="outline-3">
<h3 id="org50be9d1"><span class="section-number-3">3.3</span> 指定任务间隔</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">// </span><span style="color: #465457;">specify the interval between invocations measured</span>
<span style="color: #465457;">// </span><span style="color: #465457;">from the completion of the task</span>
<span style="color: #ae81ff;">@Scheduled</span>(fixedDelay=5000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org80f8534" class="outline-3">
<h3 id="org80f8534"><span class="section-number-3">3.4</span> UNIX Cron 风格</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 28 11 ? * *"</span>)     <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#22825; 11 &#28857; 28 &#20998; &#25191;&#34892;</span>
<span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 */5 14,18 * * ?"</span>) <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#22825; 14/18 &#28857;&#25972;&#65292;&#27599;&#38548; 5 &#20998;&#38047;&#25191;&#34892;</span>
<span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 15 10 ? * 1-6"</span>)   <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#20010;&#26376;&#21608;&#19968;&#33267;&#21608;&#20845; 10:15 &#25191;&#34892;</span>
<span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 0 2 ? * 6L"</span>)      <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#20010;&#26376;&#26368;&#21518;&#19968;&#20010;&#21608;&#20845;&#20940;&#26216; 2 &#28857;&#25191;&#34892;</span>
<span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 0 2 LW * ?"</span>)      <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#20010;&#26376;&#26368;&#21518;&#19968;&#20010;&#24037;&#20316;&#26085;&#20940;&#26216; 2 &#28857;&#25191;&#34892;</span>
<span style="color: #ae81ff;">@Scheduled</span>(cron=<span style="color: #e6db74;">"0 0 2-4 ? * 1#1"</span>)   <span style="color: #465457;">// </span><span style="color: #465457;">&#27599;&#20010;&#26376;&#31532;&#19968;&#20010;&#21608;&#19968;&#20940;&#26216; 2 &#28857;&#33267; 4 &#28857;&#26399;&#38388;&#65292;&#27599;&#38548;&#25972;&#28857;&#25191;&#34892;</span>

</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgf5a7878" class="outline-2">
<h2 id="orgf5a7878"><span class="section-number-2">4</span> <a href="https://github.com/ruanhao/java-for-fun/tree/master/src/test/java/com/hao/notes/properties">配置</a></h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org3abb399" class="outline-3">
<h3 id="org3abb399"><span class="section-number-3">4.1</span> <a href="https://github.com/lxy-go/SpringBoot/blob/master/SpringBoot%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B.md#8%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE">自动配置原理</a></h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li><p>
SpringBoot 启动时加载自动配置类
</p>

<p>
扫描所有 jar 包类路径下的 <code>MATA-INF/spring.factories</code> 文件（比如 <code>spring-boot-autoconfigure-1.5.15.RELEASE.jar/META-INF/spring.factories</code> ），
文件中 <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> 对应的所有的自动配置类将进行自动配置。
</p></li>
<li><p>
自动配置类根据配置属性进行配置（创建 bean）
</p>

<p>
所有在配置文件中能配置的属性在 <code>xxxProperties</code> 类中封装，比如 <code>@EnableConfigurationProperties(RedisProperties.class)</code>
</p></li>
</ul>
</div>

<div id="outline-container-orgca4bf00" class="outline-4">
<h4 id="orgca4bf00"><span class="section-number-4">4.1.1</span> 自动配置报告</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
启用 <code>debug=true</code> 属性，打印自动配合报告，这样就可以知道哪些自动配置类生效。
</p>
</div>
</div>
</div>

<div id="outline-container-orga1dd9c0" class="outline-3">
<h3 id="orga1dd9c0"><span class="section-number-3">4.2</span> @ConfigurationProperties 与 @Value 的区别</h3>
<div class="outline-text-3" id="text-4-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">@ConfigurationProperties</td>
<td class="org-left">@Value</td>
</tr>

<tr>
<td class="org-left">功能</td>
<td class="org-left">批量注入配置文件属性</td>
<td class="org-left">单个指定</td>
</tr>

<tr>
<td class="org-left">松散绑定(语法)</td>
<td class="org-left">✓</td>
<td class="org-left">✗</td>
</tr>

<tr>
<td class="org-left">spEL</td>
<td class="org-left">✗</td>
<td class="org-left">✓</td>
</tr>

<tr>
<td class="org-left">JSR303 校验</td>
<td class="org-left">✓</td>
<td class="org-left">✗</td>
</tr>

<tr>
<td class="org-left">复杂类型</td>
<td class="org-left">✓</td>
<td class="org-left">✗</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org5ca647f" class="outline-3">
<h3 id="org5ca647f"><span class="section-number-3">4.3</span> <a href="https://github.com/ruanhao/java-for-fun/blob/master/src/test/java/com/hao/notes/properties/ExamplesWithDevProfile.java">Profile</a></h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-org92ea305" class="outline-4">
<h4 id="org92ea305"><span class="section-number-4">4.3.1</span> 主配置文件激活</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
主配置文件: <code>application.properties</code>
</p>

<pre class="example">
spring.profiles.active=&lt;profile1&gt;,&lt;profile2&gt;
</pre>
</div>
</div>

<div id="outline-container-orgedb593a" class="outline-4">
<h4 id="orgedb593a"><span class="section-number-4">4.3.2</span> 命令行激活</h4>
<div class="outline-text-4" id="text-4-3-2">
<div class="org-src-container">
<pre class="src src-sh">java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=&lt;profile&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeae6ba4" class="outline-4">
<h4 id="orgeae6ba4"><span class="section-number-4">4.3.3</span> 虚拟机参数激活</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
<code>-Dspring.profiles.active=</code>
</p>
</div>
</div>
</div>







<div id="outline-container-org769d9f7" class="outline-3">
<h3 id="org769d9f7"><span class="section-number-3">4.4</span> 配置文件搜索顺序</h3>
<div class="outline-text-3" id="text-4-4">
<ol class="org-ol">
<li><code>file:config</code></li>
<li><code>file:/</code></li>
<li><code>classpath:/config</code></li>
<li><code>classpath:/</code></li>
</ol>

<p>
项目打包好了以后，可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置: （指定配置文件和默认的配置文件会共同起作用）
</p>

<div class="org-src-container">
<pre class="src src-sh">java -jar project-0.0.1-SNAPSHOT.jar --spring.config.location=/path/to/application.properties
</pre>
</div>
</div>
</div>


<div id="outline-container-org4d993b6" class="outline-3">
<h3 id="org4d993b6"><span class="section-number-3">4.5</span> <a href="https://github.com/ruanhao/java-for-fun/blob/master/src/test/resources/test-properties-config/placeholder.properties">配置文件占位符</a></h3>
</div>

<div id="outline-container-orgfc2f3d3" class="outline-3">
<h3 id="orgfc2f3d3"><span class="section-number-3">4.6</span> <code>@Conditional</code> 派生注解</h3>
<div class="outline-text-3" id="text-4-6">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">@ConditionalOnJava</td>
<td class="org-left">系统的java版本是否符合要求</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnBean</td>
<td class="org-left">容器中存在指定Bean</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnMissBean</td>
<td class="org-left">容器中不存在指定Bean</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnExpression</td>
<td class="org-left">满足spEL表达式</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnClass</td>
<td class="org-left">系统中有指定的类</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnMissClass</td>
<td class="org-left">系统中没有指定的类</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnSingleCandidate</td>
<td class="org-left">容器中只有一个指定的Bean,或者这个Bean是首选Bean</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnProperty</td>
<td class="org-left">系统中指定的属性是否有指定的值</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnResource</td>
<td class="org-left">类路径下是否存在指定的资源文件</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnWebApplication</td>
<td class="org-left">当前是web环境</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnNotWebApplication</td>
<td class="org-left">当前不是web环境</td>
</tr>

<tr>
<td class="org-left">@ConditionalOnJndi</td>
<td class="org-left">JNDI存在指定项</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-org3b6c418" class="outline-2">
<h2 id="org3b6c418"><span class="section-number-2">5</span> <a href="https://github.com/ruanhao/java-for-fun/tree/master/src/test/java/com/hao/notes/async">Async</a></h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org2574a7f" class="outline-3">
<h3 id="org2574a7f"><span class="section-number-3">5.1</span> 异常统一捕获</h3>
<div class="outline-text-3" id="text-5-1">
<p>
如果需要统一进行异常捕获，可以实现 <code>AsyncConfigurer</code> 接口，
<code>getAsyncExecutor</code> 方法返回的 Executor 对象用于处理异步方法调用，
<code>getAsyncUncaughtExceptionHandler</code> 方法返回的对象捕获异步调用期间产生的异常，
<b>当且仅当异步调用方法的返回类型为 void</b> 。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@EnableAsync</span>
<span style="color: #ae81ff;">@Configuration</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">AsyncConfiguration</span> <span style="color: #f92672; font-weight: bold;">implements</span> <span style="color: #66d9ef; font-weight: bold;">AsyncConfigurer</span> {

    <span style="color: #ae81ff;">@Override</span>
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">Executor</span> <span style="color: #a6e22e;">getAsyncExecutor</span>() {
        <span style="color: #66d9ef; font-weight: bold;">ThreadPoolTaskExecutor</span> <span style="color: #fd971f;">taskExecutor</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ThreadPoolTaskExecutor</span>();
        taskExecutor.setCorePoolSize(4);
        taskExecutor.setMaxPoolSize(8);
        taskExecutor.setQueueCapacity(32);
        taskExecutor.initialize();
        <span style="color: #f92672; font-weight: bold;">return</span> taskExecutor;
    }

    <span style="color: #ae81ff;">@Override</span>
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">AsyncUncaughtExceptionHandler</span> <span style="color: #a6e22e;">getAsyncUncaughtExceptionHandler</span>() {
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">SimpleAsyncUncaughtExceptionHandler</span>();
    }

}
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-org5547fe5" class="outline-2">
<h2 id="org5547fe5"><span class="section-number-2">6</span> 工具</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orge9b31a4" class="outline-3">
<h3 id="orge9b31a4"><span class="section-number-3">6.1</span> JacksonXML</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org77b3760" class="outline-4">
<h4 id="org77b3760"><span class="section-number-4">6.1.1</span> 示例数据</h4>
<div class="outline-text-4" id="text-6-1-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a6e22e;">root</span> <span style="color: #fd971f;">k6</span>=<span style="color: #e6db74;">"6"</span>&gt;
    &lt;<span style="color: #a6e22e;">k1</span>&gt;str&lt;/<span style="color: #a6e22e;">k1</span>&gt;
    &lt;<span style="color: #a6e22e;">k-2</span>&gt;2&lt;/<span style="color: #a6e22e;">k-2</span>&gt;
    &lt;<span style="color: #a6e22e;">k3</span>&gt;
        &lt;<span style="color: #a6e22e;">ki</span>&gt;1&lt;/<span style="color: #a6e22e;">ki</span>&gt;
        &lt;<span style="color: #a6e22e;">ki</span>&gt;2&lt;/<span style="color: #a6e22e;">ki</span>&gt;
    &lt;/<span style="color: #a6e22e;">k3</span>&gt;
    &lt;<span style="color: #a6e22e;">k5</span>&gt;5-1&lt;/<span style="color: #a6e22e;">k5</span>&gt;
    &lt;<span style="color: #a6e22e;">k5</span>&gt;5-2&lt;/<span style="color: #a6e22e;">k5</span>&gt;
    &lt;<span style="color: #a6e22e;">k9</span>&gt;<span style="color: #e6db74;">&lt;![</span><span style="color: #a6e22e;">CDATA</span><span style="color: #e6db74;">[</span><span style="color: #e6db74;">&#20013;&lt;a&gt;&#25991;</span><span style="color: #e6db74;">]]&gt;</span>&lt;/<span style="color: #a6e22e;">k9</span>&gt;
&lt;/<span style="color: #a6e22e;">root</span>&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-org3b75e01" class="outline-4">
<h4 id="org3b75e01"><span class="section-number-4">6.1.2</span> pom 配置</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a6e22e;">dependency</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;com.fasterxml.jackson.dataformat&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;jackson-dataformat-xml&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
&lt;/<span style="color: #a6e22e;">dependency</span>&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-orge754b34" class="outline-4">
<h4 id="orge754b34"><span class="section-number-4">6.1.3</span> DTO</h4>
<div class="outline-text-4" id="text-6-1-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #f92672; font-weight: bold;">import</span> <span style="color: #ae81ff;">java</span>.<span style="color: #ae81ff;">util</span>.*;
<span style="color: #f92672; font-weight: bold;">import</span> <span style="color: #ae81ff;">com</span>.<span style="color: #ae81ff;">fasterxml</span>.<span style="color: #ae81ff;">jackson</span>.<span style="color: #ae81ff;">dataformat</span>.<span style="color: #ae81ff;">xml</span>.<span style="color: #ae81ff;">annotation</span>.*;
<span style="color: #f92672; font-weight: bold;">import</span> <span style="color: #ae81ff;">lombok</span>.<span style="color: #66d9ef; font-weight: bold;">Data</span>;


<span style="color: #ae81ff;">@Data</span>
<span style="color: #ae81ff;">@JacksonXmlRootElement</span>(localName=<span style="color: #e6db74;">"root"</span>)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">RootXml</span> {

    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">k1</span>;

    <span style="color: #ae81ff;">@JacksonXmlProperty</span>(localName=<span style="color: #e6db74;">"k-2"</span>)
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">Integer</span> <span style="color: #fd971f;">k2</span>;

    <span style="color: #ae81ff;">@JacksonXmlProperty</span>(localName=<span style="color: #e6db74;">"k3"</span>)
    <span style="color: #ae81ff;">@JacksonXmlElementWrapper</span>(useWrapping=<span style="color: #ae81ff;">true</span>)
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">Collection</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">kis</span>;

    <span style="color: #ae81ff;">@JacksonXmlElementWrapper</span>(useWrapping=<span style="color: #ae81ff;">false</span>)
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">Collection</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">k5</span>;

    <span style="color: #ae81ff;">@JacksonXmlProperty</span>(isAttribute=<span style="color: #ae81ff;">true</span>)
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">Integer</span> <span style="color: #fd971f;">k6</span>;

    <span style="color: #ae81ff;">@JacksonXmlCData</span>(value=<span style="color: #ae81ff;">true</span>) <span style="color: #465457;">// </span><span style="color: #465457;">&#24207;&#21015;&#21270;&#26102;&#26159;&#21542;&#24635;&#26159;&#20351;&#29992; CDATA &#22359;</span>
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">k9</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8de94f8" class="outline-4">
<h4 id="org8de94f8"><span class="section-number-4">6.1.4</span> Controller</h4>
<div class="outline-text-4" id="text-6-1-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@PostMapping</span>(path=<span style="color: #e6db74;">"/xml"</span>, consumes=<span style="color: #ae81ff;">MediaType</span>.APPLICATION_XML_VALUE)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">test</span>(<span style="color: #ae81ff;">@RequestBody</span> <span style="color: #66d9ef; font-weight: bold;">RootXml</span> <span style="color: #fd971f;">xml</span>) {

}
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org0e9dcb2" class="outline-3">
<h3 id="org0e9dcb2"><span class="section-number-3">6.2</span> MapStruct</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-org2ede6d9" class="outline-4">
<h4 id="org2ede6d9"><span class="section-number-4">6.2.1</span> pom 配置</h4>
<div class="outline-text-4" id="text-6-2-1">
</div>
<div id="outline-container-org8bfdcad" class="outline-5">
<h5 id="org8bfdcad"><span class="section-number-5">6.2.1.1</span> properties</h5>
<div class="outline-text-5" id="text-6-2-1-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a6e22e;">properties</span>&gt;
  &lt;<span style="color: #a6e22e;">org.mapstruct.version</span>&gt;1.2.0.Final&lt;/<span style="color: #a6e22e;">org.mapstruct.version</span>&gt;
&lt;/<span style="color: #a6e22e;">properties</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2204848" class="outline-5">
<h5 id="org2204848"><span class="section-number-5">6.2.1.2</span> dependency</h5>
<div class="outline-text-5" id="text-6-2-1-2">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #465457;">&lt;!-- </span><span style="color: #465457;">&#38024;&#23545; swagger &#30340; workaround </span><span style="color: #465457;">--&gt;</span>
&lt;<span style="color: #a6e22e;">dependency</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;io.springfox&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;springfox-swagger2&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
  &lt;<span style="color: #a6e22e;">exclusions</span>&gt;
    &lt;<span style="color: #a6e22e;">exclusion</span>&gt;
      &lt;<span style="color: #a6e22e;">groupId</span>&gt;org.mapstruct&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
      &lt;<span style="color: #a6e22e;">artifactId</span>&gt;mapstruct&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
    &lt;/<span style="color: #a6e22e;">exclusion</span>&gt;
  &lt;/<span style="color: #a6e22e;">exclusions</span>&gt;
&lt;/<span style="color: #a6e22e;">dependency</span>&gt;

&lt;<span style="color: #a6e22e;">dependency</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;org.mapstruct&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;mapstruct-jdk8&lt;/<span style="color: #a6e22e;">artifactId</span>&gt; <span style="color: #465457;">&lt;!-- </span><span style="color: #465457;">use mapstruct-jdk8 for Java 8 or higher </span><span style="color: #465457;">--&gt;</span>
  &lt;<span style="color: #a6e22e;">version</span>&gt;${org.mapstruct.version}&lt;/<span style="color: #a6e22e;">version</span>&gt;
&lt;/<span style="color: #a6e22e;">dependency</span>&gt;

&lt;<span style="color: #a6e22e;">dependency</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;org.mapstruct&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;mapstruct-processor&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
  &lt;<span style="color: #a6e22e;">version</span>&gt;${org.mapstruct.version}&lt;/<span style="color: #a6e22e;">version</span>&gt;
  &lt;<span style="color: #a6e22e;">scope</span>&gt;provided&lt;/<span style="color: #a6e22e;">scope</span>&gt;
&lt;/<span style="color: #a6e22e;">dependency</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org13fa0d0" class="outline-5">
<h5 id="org13fa0d0"><span class="section-number-5">6.2.1.3</span> plugin</h5>
<div class="outline-text-5" id="text-6-2-1-3">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #465457;">&lt;!-- </span><span style="color: #465457;">&#20860;&#23481; lombok </span><span style="color: #465457;">--&gt;</span>
&lt;<span style="color: #a6e22e;">plugin</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;org.apache.maven.plugins&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;maven-compiler-plugin&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
&lt;/<span style="color: #a6e22e;">plugin</span>&gt;
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org818b7de" class="outline-4">
<h4 id="org818b7de"><span class="section-number-4">6.2.2</span> Mapper 接口</h4>
<div class="outline-text-4" id="text-6-2-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Mapper</span>(unmappedTargetPolicy=<span style="color: #ae81ff;">ReportingPolicy</span>.IGNORE)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">interface</span> <span style="color: #66d9ef; font-weight: bold;">ClassAMapper</span> {

    <span style="color: #66d9ef; font-weight: bold;">ClassAMapper</span> <span style="color: #fd971f;">MAPPER</span> = Mappers.getMapper( ClassAMapper.<span style="color: #f92672; font-weight: bold;">class</span> );

    <span style="color: #ae81ff;">@Mappings</span>({
            <span style="color: #ae81ff;">@Mapping</span>(source=<span style="color: #e6db74;">"id"</span>, target=<span style="color: #e6db74;">"ID"</span>),
            <span style="color: #a6e22e;">@Mapping</span>(source=<span style="color: #e6db74;">"name"</span>, target=<span style="color: #e6db74;">"NAME"</span>)
    })
    <span style="color: #66d9ef; font-weight: bold;">ClassA</span> <span style="color: #a6e22e;">from</span>(<span style="color: #66d9ef; font-weight: bold;">ClassB</span> <span style="color: #fd971f;">obj</span>);

    <span style="color: #f92672; font-weight: bold;">default</span> <span style="color: #66d9ef; font-weight: bold;">ClassA</span> <span style="color: #a6e22e;">from</span>(<span style="color: #66d9ef; font-weight: bold;">ClassC</span> <span style="color: #fd971f;">obj</span>) {
        <span style="color: #465457;">// </span><span style="color: #465457;">Custmization</span>
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org9078b37" class="outline-4">
<h4 id="org9078b37"><span class="section-number-4">6.2.3</span> 调用</h4>
<div class="outline-text-4" id="text-6-2-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #66d9ef; font-weight: bold;">ClassB</span> <span style="color: #fd971f;">objB</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ClassB</span>();
<span style="color: #66d9ef; font-weight: bold;">ClassC</span> <span style="color: #fd971f;">objC</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ClassC</span>();
<span style="color: #ae81ff;">ClassA</span>.MAPPER.from(objB);
<span style="color: #ae81ff;">ClassA</span>.MAPPER.from(objC);
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org2d98365" class="outline-3">
<h3 id="org2d98365"><span class="section-number-3">6.3</span> MapperFactory</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-org9be7b86" class="outline-4">
<h4 id="org9be7b86"><span class="section-number-4">6.3.1</span> 配置</h4>
<div class="outline-text-4" id="text-6-3-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a6e22e;">dependency</span>&gt;
  &lt;<span style="color: #a6e22e;">groupId</span>&gt;ma.glasnost.orika&lt;/<span style="color: #a6e22e;">groupId</span>&gt;
  &lt;<span style="color: #a6e22e;">artifactId</span>&gt;orika-core&lt;/<span style="color: #a6e22e;">artifactId</span>&gt;
  &lt;<span style="color: #a6e22e;">version</span>&gt;1.5.2&lt;/<span style="color: #a6e22e;">version</span>&gt;<span style="color: #465457;">&lt;!-- </span><span style="color: #465457;">or latest version </span><span style="color: #465457;">--&gt;</span>
&lt;/<span style="color: #a6e22e;">dependency</span>&gt;
</pre>
</div>


<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Configuration</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MapperConfig</span> <span style="color: #f92672; font-weight: bold;">extends</span> <span style="color: #66d9ef; font-weight: bold;">ConfigurableMapper</span> {

    <span style="color: #ae81ff;">@Bean</span>
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">MapperFactory</span> <span style="color: #a6e22e;">mapperFactory</span>(){
        <span style="color: #66d9ef; font-weight: bold;">MapperFactory</span> <span style="color: #fd971f;">factory</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #ae81ff;">DefaultMapperFactory</span>.<span style="color: #66d9ef; font-weight: bold;">Builder</span>().build();
        factory.classMap(NetworkDto.<span style="color: #f92672; font-weight: bold;">class</span>, Network.<span style="color: #f92672; font-weight: bold;">class</span>)
            .field(<span style="color: #e6db74;">"group.id"</span>, <span style="color: #e6db74;">"groupId"</span>)
            .mapNulls(<span style="color: #ae81ff;">false</span>)
            .byDefault()
            .register();
        <span style="color: #f92672; font-weight: bold;">return</span> factory;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31d7bae" class="outline-4">
<h4 id="org31d7bae"><span class="section-number-4">6.3.2</span> 使用</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">NetworkBo</span> {

    <span style="color: #ae81ff;">@Autowired</span>
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">MapperFactory</span> <span style="color: #fd971f;">mapperFactory</span>;

    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">handle</span>() {
        <span style="color: #66d9ef; font-weight: bold;">NetworkDto</span> <span style="color: #fd971f;">dto</span> = ...;
        <span style="color: #66d9ef; font-weight: bold;">Network</span> <span style="color: #fd971f;">network</span> = ...;
        mapperFactory.getMapperFacade().map(dto, network);
    }
}

</pre>
</div>
</div>
</div>


<div id="outline-container-orgebca401" class="outline-4">
<h4 id="orgebca401"><span class="section-number-4">6.3.3</span> 传送门</h4>
<div class="outline-text-4" id="text-6-3-3">
<ul class="org-ul">
<li><a href="https://orika-mapper.github.io/orika-docs/advanced-mappings.html">高级映射配置</a></li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-orga64a650" class="outline-2">
<h2 id="orga64a650"><span class="section-number-2">7</span> 实践</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org1ff97e8" class="outline-3">
<h3 id="org1ff97e8"><span class="section-number-3">7.1</span> <a href="https://github.com/ruanhao/show-me-the-code/tree/springboot-restful-service">Restful Service (MVC)</a></h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-org9e18359" class="outline-4">
<h4 id="org9e18359"><span class="section-number-4">7.1.1</span> WebApplicationInitializer</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
实现 <code>WebApplicationInitializer</code> 接口便可以实现等同于对 <code>web.xml</code> 进行配置
</p>
</div>
</div>

<div id="outline-container-org913d131" class="outline-4">
<h4 id="org913d131"><span class="section-number-4">7.1.2</span> Controller</h4>
<div class="outline-text-4" id="text-7-1-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@RestController</span>
<span style="color: #ae81ff;">@RequestMapping</span>(<span style="color: #e6db74;">"/{userId}/bookmarks"</span>)
<span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">BookmarkRestController</span> {

    <span style="color: #ae81ff;">@PostMapping</span>
    <span style="color: #66d9ef; font-weight: bold;">ResponseEntity</span>&lt;?&gt; <span style="color: #a6e22e;">add</span>(<span style="color: #ae81ff;">@PathVariable</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">userId</span>, <span style="color: #ae81ff;">@RequestBody</span> <span style="color: #66d9ef; font-weight: bold;">Bookmark</span> <span style="color: #fd971f;">input</span>) {
        <span style="color: #f92672; font-weight: bold;">return</span> ResponseEntity.noContent().build();
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfb6d990" class="outline-4">
<h4 id="orgfb6d990"><span class="section-number-4">7.1.3</span> HttpMessageConverter</h4>
<div class="outline-text-4" id="text-7-1-3">
<p>
对每个 HTTP 请求，Spring MVC 将遍历所有配置的 HttpMessageConverter 对象，
直到找到一个合适的对象可以将返回的 POJO 转换成 Accept header 中指定的 content type 。
</p>

<p>
Spring Boot 会自动组装一个可以转换成 JSON 类型的 HttpMessageConverter 对象。
</p>

<p>
HttpMessageConverter 工作于两个方向：
</p>
<ul class="org-ul">
<li>请求（ content-type =&gt; Java object ）</li>
<li>响应（ Java object =&gt; content-type ）</li>
</ul>
</div>
</div>


<div id="outline-container-orgdf20f92" class="outline-4">
<h4 id="orgdf20f92"><span class="section-number-4">7.1.4</span> 异常处理</h4>
<div class="outline-text-4" id="text-7-1-4">
</div>
<div id="outline-container-org05ed8b3" class="outline-5">
<h5 id="org05ed8b3"><span class="section-number-5">7.1.4.1</span> 异常级别</h5>
<div class="outline-text-5" id="text-7-1-4-1">
<p>
正常情况下，任何未被处理的异常将导致服务器返回 HTTP 500 Response 。
自定义的异常可以通过添加 <code>@ResponseStatus</code> 注解从而使用指定的 status code 。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@ResponseStatus</span>(value=<span style="color: #ae81ff;">HttpStatus</span>.NOT_FOUND, reason=<span style="color: #e6db74;">"No such Order"</span>)  <span style="color: #465457;">// </span><span style="color: #465457;">404</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">OrderNotFoundException</span> <span style="color: #f92672; font-weight: bold;">extends</span> <span style="color: #66d9ef; font-weight: bold;">RuntimeException</span> {
    <span style="color: #465457;">// </span><span style="color: #465457;">TODO</span>
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@RequestMapping</span>(value=<span style="color: #e6db74;">"/orders/{id}"</span>, method=GET)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #a6e22e;">showOrder</span>(<span style="color: #ae81ff;">@PathVariable</span>(<span style="color: #e6db74;">"id"</span>) <span style="color: #66d9ef; font-weight: bold;">long</span> <span style="color: #fd971f;">id</span>, <span style="color: #66d9ef; font-weight: bold;">Model</span> <span style="color: #fd971f;">model</span>) {
    <span style="color: #66d9ef; font-weight: bold;">Order</span> <span style="color: #fd971f;">order</span> = orderRepository.findOrderById(id);

    <span style="color: #f92672; font-weight: bold;">if</span> (order == <span style="color: #ae81ff;">null</span>) <span style="color: #f92672; font-weight: bold;">throw</span> <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">OrderNotFoundException</span>(id);

    model.addAttribute(order);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">"orderDetail"</span>;
}
</pre>
</div>
</div>
</div>



<div id="outline-container-org7504d0e" class="outline-5">
<h5 id="org7504d0e"><span class="section-number-5">7.1.4.2</span> 控制器级别</h5>
<div class="outline-text-5" id="text-7-1-4-2">
<p>
使用 <code>@ExceptionHandler</code> 注解处理同一个控制器中抛出的异常，这种方式的优点：
</p>

<ul class="org-ul">
<li>可以处理没有被 <code>@ResponseStatus</code> 注解过的异常</li>
<li>可以将用户重定向到专门的错误页面</li>
<li>组装一个完全定制化的 error response</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Controller</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">ExceptionHandlingController</span> {

    <span style="color: #465457;">// </span><span style="color: #465457;">@RequestHandler methods that maybe throw exception</span>
    ...


    <span style="color: #465457;">// </span><span style="color: #465457;">Exception handling methods:</span>

    <span style="color: #465457;">// </span><span style="color: #465457;">Convert a predefined exception to an HTTP Status code</span>
    <span style="color: #ae81ff;">@ResponseStatus</span>(value=<span style="color: #ae81ff;">HttpStatus</span>.CONFLICT, reason=<span style="color: #e6db74;">"Data integrity violation"</span>)  <span style="color: #465457;">// </span><span style="color: #465457;">409</span>
    <span style="color: #ae81ff;">@ExceptionHandler</span>(DataIntegrityViolationException.<span style="color: #f92672; font-weight: bold;">class</span>)
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> conflict() {
        <span style="color: #465457;">// </span><span style="color: #465457;">TODO</span>
    }

    <span style="color: #465457;">// </span><span style="color: #465457;">Specify name of a specific view that will be used to display the error:</span>
    <span style="color: #ae81ff;">@ExceptionHandler</span>({SQLException.<span style="color: #f92672; font-weight: bold;">class</span>, DataAccessException.<span style="color: #f92672; font-weight: bold;">class</span>})
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #a6e22e;">databaseError</span>() {
        <span style="color: #465457;">// </span><span style="color: #465457;">Nothing to do.  Returns the logical view name of an error page, passed</span>
        <span style="color: #465457;">// </span><span style="color: #465457;">to the view-resolver(s) in usual way.</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">"databaseError"</span>;
    }

    <span style="color: #465457;">// </span><span style="color: #465457;">Total control - setup a model and return the view name yourself. Or</span>
    <span style="color: #465457;">// </span><span style="color: #465457;">consider subclassing ExceptionHandlerExceptionResolver.</span>
    <span style="color: #ae81ff;">@ExceptionHandler</span>(Exception.<span style="color: #f92672; font-weight: bold;">class</span>)
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span> <span style="color: #a6e22e;">handleError</span>(<span style="color: #66d9ef; font-weight: bold;">HttpServletRequest</span> <span style="color: #fd971f;">req</span>, <span style="color: #66d9ef; font-weight: bold;">Exception</span> <span style="color: #fd971f;">ex</span>) {
        logger.error(<span style="color: #e6db74;">"Request: "</span> + req.getRequestURL() + <span style="color: #e6db74;">" raised "</span> + ex);

        <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span> <span style="color: #fd971f;">mav</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span>();
        mav.addObject(<span style="color: #e6db74;">"exception"</span>, ex);
        mav.addObject(<span style="color: #e6db74;">"url"</span>, req.getRequestURL());
        mav.setViewName(<span style="color: #e6db74;">"error"</span>);
        <span style="color: #f92672; font-weight: bold;">return</span> mav;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org98e6a2e" class="outline-5">
<h5 id="org98e6a2e"><span class="section-number-5">7.1.4.3</span> 全局级别</h5>
<div class="outline-text-5" id="text-7-1-4-3">
<p>
任何标注 <code>@ControllerAdvice</code> / <code>@RestControllerAdvice</code> 注解的类支持 3 种类型的方法：
</p>

<ul class="org-ul">
<li>Exception handling methods annotated with <code>@ExceptionHandler</code></li>
<li>Model enhancement methods (for adding additional data to the model) annotated with <code>@ModelAttribute</code></li>
<li>Binder initialization methods (used for configuring form-handling) annotated with <code>@InitBinder</code></li>
</ul>


<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@ControllerAdvice</span>
<span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GlobalControllerExceptionHandler</span> {
    <span style="color: #ae81ff;">@ResponseStatus</span>(<span style="color: #ae81ff;">HttpStatus</span>.<span style="color: #66d9ef; font-weight: bold;">CONFLICT</span>)  <span style="color: #465457;">// </span><span style="color: #465457;">409</span>
    <span style="color: #ae81ff;">@ExceptionHandler</span>(DataIntegrityViolationException.<span style="color: #f92672; font-weight: bold;">class</span>)
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">handleConflict</span>() {
        <span style="color: #465457;">// </span><span style="color: #465457;">Nothing to do</span>
    }
}
</pre>
</div>
</div>

<div id="outline-container-org1839e92" class="outline-6">
<h6 id="org1839e92"><span class="section-number-6">7.1.4.3.1</span> 重新抛出</h6>
<div class="outline-text-6" id="text-7-1-4-3-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@ControllerAdvice</span>
<span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GlobalDefaultExceptionHandler</span> {
  <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">static</span> <span style="color: #f92672; font-weight: bold;">final</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">DEFAULT_ERROR_VIEW</span> = <span style="color: #e6db74;">"error"</span>;

  <span style="color: #ae81ff;">@ExceptionHandler</span>(value = Exception.<span style="color: #f92672; font-weight: bold;">class</span>)
  <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span> <span style="color: #a6e22e;">defaultErrorHandler</span>(<span style="color: #66d9ef; font-weight: bold;">HttpServletRequest</span> <span style="color: #fd971f;">req</span>, <span style="color: #66d9ef; font-weight: bold;">Exception</span> <span style="color: #fd971f;">e</span>) <span style="color: #f92672; font-weight: bold;">throws</span> <span style="color: #66d9ef; font-weight: bold;">Exception</span> {
    <span style="color: #465457;">// </span><span style="color: #465457;">If the exception is annotated with @ResponseStatus rethrow it and let</span>
    <span style="color: #465457;">// </span><span style="color: #465457;">the framework handle it - like the OrderNotFoundException example</span>
    <span style="color: #465457;">// </span><span style="color: #465457;">at the start of this post.</span>
    <span style="color: #465457;">// </span><span style="color: #465457;">AnnotationUtils is a Spring Framework utility class.</span>
    <span style="color: #f92672; font-weight: bold;">if</span> (AnnotationUtils.findAnnotation(e.getClass(), ResponseStatus.<span style="color: #f92672; font-weight: bold;">class</span>) != <span style="color: #ae81ff;">null</span>)
      <span style="color: #f92672; font-weight: bold;">throw</span> e;

    <span style="color: #465457;">// </span><span style="color: #465457;">Otherwise setup and send the user to a default error-view.</span>
    <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span> <span style="color: #fd971f;">mav</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ModelAndView</span>();
    mav.addObject(<span style="color: #e6db74;">"exception"</span>, e);
    mav.addObject(<span style="color: #e6db74;">"url"</span>, req.getRequestURL());
    mav.setViewName(DEFAULT_ERROR_VIEW);
    <span style="color: #f92672; font-weight: bold;">return</span> mav;
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>
</div>



<div id="outline-container-org94911d4" class="outline-3">
<h3 id="org94911d4"><span class="section-number-3">7.2</span> <a href="https://github.com/ruanhao/show-me-the-code/tree/springboot-application-event">Application Event</a></h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org9f13647" class="outline-4">
<h4 id="org9f13647"><span class="section-number-4">7.2.1</span> Event</h4>
<div class="outline-text-4" id="text-7-2-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@ToString</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Event</span> <span style="color: #f92672; font-weight: bold;">extends</span> <span style="color: #66d9ef; font-weight: bold;">ApplicationEvent</span> {

    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #f92672; font-weight: bold;">static</span> <span style="color: #f92672; font-weight: bold;">final</span> <span style="color: #66d9ef; font-weight: bold;">long</span> <span style="color: #fd971f;">serialVersionUID</span> = 1L;

    <span style="color: #ae81ff;">@Getter</span>
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">message</span>;

    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #a6e22e;">Event</span>(<span style="color: #66d9ef; font-weight: bold;">Object</span> <span style="color: #fd971f;">source</span>, <span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">message</span>) {
        <span style="color: #f92672; font-weight: bold;">super</span>(source);
        <span style="color: #f92672; font-weight: bold;">this</span>.message = message;
    }

}
</pre>
</div>
</div>
</div>


<div id="outline-container-org6b1fc18" class="outline-4">
<h4 id="org6b1fc18"><span class="section-number-4">7.2.2</span> Listener</h4>
<div class="outline-text-4" id="text-7-2-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Component</span>
<span style="color: #ae81ff;">@Slf4j</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Listener</span> {

    <span style="color: #ae81ff;">@EventListener</span>
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">handlerEvent</span>(<span style="color: #66d9ef; font-weight: bold;">Event</span> <span style="color: #fd971f;">event</span>) {
        log.info(<span style="color: #e6db74;">"Receive event: {}"</span>, event);
    }

}
</pre>
</div>
</div>
</div>


<div id="outline-container-org86cd8d9" class="outline-4">
<h4 id="org86cd8d9"><span class="section-number-4">7.2.3</span> Publisher</h4>
<div class="outline-text-4" id="text-7-2-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Service</span>
<span style="color: #ae81ff;">@Slf4j</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Publisher</span> {

    <span style="color: #ae81ff;">@Autowired</span>
    <span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">ApplicationContext</span> <span style="color: #fd971f;">applicationContext</span>;

    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">publish</span>(<span style="color: #66d9ef; font-weight: bold;">String</span> <span style="color: #fd971f;">message</span>) {
        log.info(<span style="color: #e6db74;">"Sending message: {}"</span>, message);
        applicationContext.publishEvent(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">Event</span>(<span style="color: #f92672; font-weight: bold;">this</span>, message));
    }

}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfd2dbb2" class="outline-4">
<h4 id="orgfd2dbb2"><span class="section-number-4">7.2.4</span> 自定义 applicationEventMulticaster</h4>
<div class="outline-text-4" id="text-7-2-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Bean</span>(name=<span style="color: #e6db74;">"applicationEventMulticaster"</span>)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">ApplicationEventMulticaster</span> <span style="color: #a6e22e;">simpleApplicationEventMulticaster</span>() {
    <span style="color: #66d9ef; font-weight: bold;">SimpleApplicationEventMulticaster</span> <span style="color: #fd971f;">eventMulticaster</span>
        = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">SimpleApplicationEventMulticaster</span>();
    eventMulticaster.setTaskExecutor(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">SimpleAsyncTaskExecutor</span>());
    <span style="color: #f92672; font-weight: bold;">return</span> eventMulticaster;
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org05948d9" class="outline-4">
<h4 id="org05948d9"><span class="section-number-4">7.2.5</span> 常见 SpringApplicationEvent</h4>
<div class="outline-text-4" id="text-7-2-5">
<ul class="org-ul">
<li>ApplicationEnvironmentPreparedEvent</li>
<li>ApplicationFailedEvent</li>
<li>ApplicationPreparedEvent</li>
<li>ApplicationReadyEvent</li>
<li>ApplicationStartingEvent</li>
</ul>
</div>
</div>
</div>





<div id="outline-container-org0cc5568" class="outline-3">
<h3 id="org0cc5568"><span class="section-number-3">7.3</span> Springboot Test</h3>
<div class="outline-text-3" id="text-7-3">
</div>
<div id="outline-container-org32d1593" class="outline-4">
<h4 id="org32d1593"><span class="section-number-4">7.3.1</span> 样板文件</h4>
<div class="outline-text-4" id="text-7-3-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@RunWith</span>(SpringRunner.<span style="color: #f92672; font-weight: bold;">class</span>)
<span style="color: #ae81ff;">@SpringBootTest</span>(<span style="color: #ae81ff;">SpringBootTest</span>.<span style="color: #ae81ff;">WebEnvironment</span>.<span style="color: #66d9ef; font-weight: bold;">MOCK</span>, classes=XxxApplication.<span style="color: #f92672; font-weight: bold;">class</span>)
<span style="color: #ae81ff;">@AutoConfigureMockMvc</span>
<span style="color: #ae81ff;">@ActiveProfiles</span>(<span style="color: #e6db74;">"xxx"</span>)
<span style="color: #ae81ff;">@TestPropertySource</span>(locations=<span style="color: #e6db74;">"classpath:xxx.properties"</span>)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">ApplicationTest</span> {

    <span style="color: #ae81ff;">@Test</span>
    <span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">test</span>() {
      <span style="color: #465457;">// </span><span style="color: #465457;">TODO</span>
    }

}

</pre>
</div>
</div>
</div>



<div id="outline-container-orgb2cba7a" class="outline-4">
<h4 id="orgb2cba7a"><span class="section-number-4">7.3.2</span> MockMvc</h4>
<div class="outline-text-4" id="text-7-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Autowired</span>
<span style="color: #f92672; font-weight: bold;">private</span> <span style="color: #66d9ef; font-weight: bold;">MockMvc</span> <span style="color: #fd971f;">mockMvc</span>;

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">testHttpMethodWithPathVariable</span>() <span style="color: #f92672; font-weight: bold;">throws</span> <span style="color: #66d9ef; font-weight: bold;">Exception</span> {
    mockMvc.perform(MockMvcRequestBuilders.get(<span style="color: #e6db74;">"/hello/{name}"</span>, <span style="color: #e6db74;">"John"</span>))
        .andDo(MockMvcResultHandlers.print()) <span style="color: #465457;">// </span><span style="color: #465457;">print request and response</span>
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(MockMvcResultMatchers.content().contentType(<span style="color: #e6db74;">"application/json;charset=UTF-8"</span>))
        .andExpect(MockMvcResultMatchers.jsonPath(<span style="color: #e6db74;">"$.message"</span>).value(<span style="color: #e6db74;">"Hello World John!!!"</span>));
}

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">testHttpMethodWithQueryParameters</span>() <span style="color: #f92672; font-weight: bold;">throws</span> <span style="color: #66d9ef; font-weight: bold;">Exception</span> {
    <span style="color: #f92672; font-weight: bold;">this</span>.mockMvc.perform(get(<span style="color: #e6db74;">"/greetWithQueryVariable"</span>)
                         .param(<span style="color: #e6db74;">"name"</span>, <span style="color: #e6db74;">"John Doe"</span>)
                         .param(<span style="color: #e6db74;">"age"</span>, <span style="color: #e6db74;">"30"</span>))
        .andDo(MockMvcResultHandlers.print())
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(MockMvcResultMatchers.content().contentType(<span style="color: #e6db74;">"application/json;charset=UTF-8"</span>))
        .andExpect(MockMvcResultMatchers.jsonPath(<span style="color: #e6db74;">"$.message"</span>).value(<span style="color: #e6db74;">"Hello World John Doe!!!"</span>));
}


</pre>
</div>
</div>
</div>


<div id="outline-container-org073895c" class="outline-4">
<h4 id="org073895c"><span class="section-number-4">7.3.3</span> Hamcrest</h4>
<div class="outline-text-4" id="text-7-3-3">
<p>
<code>import static org.hamcrest.Matchers.*;</code>
</p>

<p>
<code>import static org.junit.Assert.assertThat;</code>
</p>
</div>

<div id="outline-container-orga27e46b" class="outline-5">
<h5 id="orga27e46b"><span class="section-number-5">7.3.3.1</span> Core API</h5>
<div class="outline-text-5" id="text-7-3-3-1">
<ul class="org-ul">
<li>is</li>
<li>not</li>
<li id="anyOf">assertThat(str, anyOf(startsWith(start), containsString(end)))</li>
<li id="allOf">assertThat(str, allOf(startsWith(start), containsString(end)))</li>
</ul>
</div>
</div>


<div id="outline-container-org511a4ce" class="outline-5">
<h5 id="org511a4ce"><span class="section-number-5">7.3.3.2</span> Object Matcher</h5>
<div class="outline-text-5" id="text-7-3-3-2">
<dl class="org-dl">
<dt>hasToString(str)</dt><dd>To assert that the `toString` method of an Object returns a specified `str`</dd>
<dt>typeCompatibleWith(clazz)</dt><dd>check that one class is a sub-class of another</dd>
<dt>(no term)</dt><dd>sameInstance</dd>
<dt>(no term)</dt><dd>instanceOf</dd>
</dl>
</div>
</div>


<div id="outline-container-org428a963" class="outline-5">
<h5 id="org428a963"><span class="section-number-5">7.3.3.3</span> Bean Matcher</h5>
<div class="outline-text-5" id="text-7-3-3-3">
<ul class="org-ul">
<li>hasProperty</li>
<li>samePropertyValuesAs</li>
</ul>
</div>
</div>


<div id="outline-container-org90bfe6a" class="outline-5">
<h5 id="org90bfe6a"><span class="section-number-5">7.3.3.4</span> Collection Matcher</h5>
<div class="outline-text-5" id="text-7-3-3-4">
<ul class="org-ul">
<li>empty</li>
<li>hasSize</li>
<li>arrayWithSize</li>
<li>containsInAnyOrder</li>
<li id="contains">in given order</li>
<li>hasItemInArray</li>
<li>isOneOf / isIn</li>
<li>arrayContainingInAnyOrder</li>
<li>arrayContaining</li>
<li>hasKey</li>
<li>hasValue</li>
<li>hasEntry</li>
<li id="everyItem">assertThat(list, everyItem(greaterThan(0)))</li>
</ul>
</div>
</div>

<div id="outline-container-org79d85bb" class="outline-5">
<h5 id="org79d85bb"><span class="section-number-5">7.3.3.5</span> Number Matcher</h5>
<div class="outline-text-5" id="text-7-3-3-5">
<ul class="org-ul">
<li>greaterThan</li>
<li>greaterThanOrEqualTo</li>
<li>lessThan</li>
<li>lessThanOrEqualTo</li>
<li>closeTo(pivot, deviation)</li>
</ul>
</div>
</div>


<div id="outline-container-org086b6c2" class="outline-5">
<h5 id="org086b6c2"><span class="section-number-5">7.3.3.6</span> Text Matcher</h5>
<div class="outline-text-5" id="text-7-3-3-6">
<ul class="org-ul">
<li>isEmptyString</li>
<li>isEmptyOrNullString</li>
<li>equalToIgnoringWhiteSpace</li>
<li>stringContainsInOrder</li>
<li>equalToIgnoringCase</li>
<li>containsString(str)</li>
<li>startsWith(str)</li>
<li>endsWith(str)</li>
<li>notNullValue</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org60a5ae4" class="outline-4">
<h4 id="org60a5ae4"><span class="section-number-4">7.3.4</span> Mockito</h4>
<div class="outline-text-4" id="text-7-3-4">
<p>
Mock 测试就是在测试过程中，对于某些不容易构造（如 HttpServletRequest 必须在Servlet 容器中才能构造出来）
或者不容易获取比较复杂的对象（如 JDBC 中的ResultSet 对象），用一个虚拟的对象（Mock 对象）来创建以便测试的测试方法。
</p>

<p>
Mock 最大的功能是把单元测试的耦合分解开，如果代码对另一个类或者接口有依赖，它能够模拟这些依赖，并帮助验证所调用的依赖的行为。
</p>
</div>


<div id="outline-container-org11d7d2b" class="outline-5">
<h5 id="org11d7d2b"><span class="section-number-5">7.3.4.1</span> Mock 与 Stub 的区别</h5>
<div class="outline-text-5" id="text-7-3-4-1">
<p>
Mock 不是 Stub，两者是有区别的：
</p>

<ul class="org-ul">
<li>前者被称为 mockist TDD，而后者一般称为 classic TDD</li>
<li>前者是基于行为的验证（behavior verification），后者是基于状态的验证 （state verification）</li>
<li>前者使用的是模拟的对象，而后者使用的是真实的对象</li>
</ul>
</div>
</div>



<div id="outline-container-org5714cdd" class="outline-5">
<h5 id="org5714cdd"><span class="section-number-5">7.3.4.2</span> 验证行为</h5>
<div class="outline-text-5" id="text-7-3-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">Let's import Mockito statically so that the code looks clearer</span>
<span style="color: #f92672; font-weight: bold;">import</span> <span style="color: #f92672; font-weight: bold;">static</span> <span style="color: #ae81ff;">org</span>.<span style="color: #ae81ff;">mockito</span>.<span style="color: #ae81ff;">Mockito</span>.*;

<span style="color: #465457;">//</span><span style="color: #465457;">mock creation</span>
<span style="color: #66d9ef; font-weight: bold;">List</span> <span style="color: #fd971f;">mockedList</span> = mock(List.<span style="color: #f92672; font-weight: bold;">class</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">using mock object</span>
mockedList.add(<span style="color: #e6db74;">"one"</span>);
mockedList.clear();

<span style="color: #465457;">//</span><span style="color: #465457;">verification</span>
verify(mockedList).add(<span style="color: #e6db74;">"one"</span>);
verify(mockedList).clear();
</pre>
</div>

<p>
一旦创建 mock 将会 <b>记得所有的交互</b> 。可以选择验证感兴趣的任何交互。
</p>
</div>
</div>


<div id="outline-container-org156147a" class="outline-5">
<h5 id="org156147a"><span class="section-number-5">7.3.4.3</span> 打桩</h5>
<div class="outline-text-5" id="text-7-3-4-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">You can mock concrete classes, not just interfaces</span>
<span style="color: #66d9ef; font-weight: bold;">LinkedList</span> <span style="color: #fd971f;">mockedList</span> = mock(LinkedList.<span style="color: #f92672; font-weight: bold;">class</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">stubbing</span>
when(mockedList.get(0)).thenReturn(<span style="color: #e6db74;">"first"</span>);
when(mockedList.get(1)).thenThrow(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">RuntimeException</span>());

<span style="color: #465457;">//</span><span style="color: #465457;">following prints "first"</span>
System.out.println(mockedList.get(0));

<span style="color: #465457;">//</span><span style="color: #465457;">following throws runtime exception</span>
System.out.println(mockedList.get(1));

<span style="color: #465457;">//</span><span style="color: #465457;">following prints "null" because get(999) was not stubbed</span>
System.out.println(mockedList.get(999));
</pre>
</div>
</div>
</div>


<div id="outline-container-org4a13a3c" class="outline-5">
<h5 id="org4a13a3c"><span class="section-number-5">7.3.4.4</span> 连续调用打桩对象</h5>
<div class="outline-text-5" id="text-7-3-4-4">
<div class="org-src-container">
<pre class="src src-java">when(mock.someMethod(<span style="color: #e6db74;">"some arg"</span>))
 .thenThrow(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">RuntimeException</span>())
 .thenReturn(<span style="color: #e6db74;">"foo"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">First call: throws runtime exception:</span>
mock.someMethod(<span style="color: #e6db74;">"some arg"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">Second call: prints "foo"</span>
System.out.println(mock.someMethod(<span style="color: #e6db74;">"some arg"</span>));

<span style="color: #465457;">//</span><span style="color: #465457;">Any consecutive call: prints "foo" as well (last stubbing wins).</span>
System.out.println(mock.someMethod(<span style="color: #e6db74;">"some arg"</span>));

</pre>
</div>

<div class="org-src-container">
<pre class="src src-java">when(mock.someMethod(<span style="color: #e6db74;">"some arg"</span>))
    .thenReturn(<span style="color: #e6db74;">"one"</span>, <span style="color: #e6db74;">"two"</span>, <span style="color: #e6db74;">"three"</span>);

</pre>
</div>
</div>
</div>


<div id="outline-container-org3fac4b3" class="outline-5">
<h5 id="org3fac4b3"><span class="section-number-5">7.3.4.5</span> 参数匹配器</h5>
<div class="outline-text-5" id="text-7-3-4-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">stubbing using built-in anyInt() argument matcher</span>
when(mockedList.<span style="color: #66d9ef; font-weight: bold;">get</span>(<span style="color: #66d9ef; font-weight: bold;">anyInt</span>())).thenReturn(<span style="color: #e6db74;">"element"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">stubbing using custom matcher (let's say isValid() returns your own matcher implementation):</span>
when(mockedList.contains(argThat(isValid()))).thenReturn(<span style="color: #e6db74;">"element"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">following prints "element"</span>
System.out.println(mockedList.get(999));

<span style="color: #465457;">//</span><span style="color: #465457;">you can also verify using an argument matcher</span>
verify(mockedList).get(anyInt());
</pre>
</div>

<p>
<a href="https://static.javadoc.io/org.mockito/mockito-core/2.21.0/org/mockito/Matchers.html">更多内置匹配器</a>
</p>
</div>
</div>


<div id="outline-container-orga445758" class="outline-5">
<h5 id="orga445758"><span class="section-number-5">7.3.4.6</span> 调用次数</h5>
<div class="outline-text-5" id="text-7-3-4-6">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">using mock</span>
mockedList.add(<span style="color: #e6db74;">"once"</span>);

mockedList.add(<span style="color: #e6db74;">"twice"</span>);
mockedList.add(<span style="color: #e6db74;">"twice"</span>);

mockedList.add(<span style="color: #e6db74;">"three times"</span>);
mockedList.add(<span style="color: #e6db74;">"three times"</span>);
mockedList.add(<span style="color: #e6db74;">"three times"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">following two verifications work exactly the same - times(1) is used by default</span>
verify(mockedList).add(<span style="color: #e6db74;">"once"</span>);
verify(mockedList, times(1)).add(<span style="color: #e6db74;">"once"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">exact number of invocations verification</span>
verify(mockedList, times(2)).add(<span style="color: #e6db74;">"twice"</span>);
verify(mockedList, times(3)).add(<span style="color: #e6db74;">"three times"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">verification using never(). never() is an alias to times(0)</span>
verify(mockedList, never()).add(<span style="color: #e6db74;">"never happened"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">verification using atLeast()/atMost()</span>
verify(mockedList, atLeastOnce()).add(<span style="color: #e6db74;">"three times"</span>);
verify(mockedList, atLeast(2)).add(<span style="color: #e6db74;">"five times"</span>);
verify(mockedList, atMost(5)).add(<span style="color: #e6db74;">"three times"</span>);
</pre>
</div>

<p>
times(1) 是默认的，因此，使用的 times(1) 可以显示的省略
</p>
</div>
</div>


<div id="outline-container-orgb7a07a7" class="outline-5">
<h5 id="orgb7a07a7"><span class="section-number-5">7.3.4.7</span> 处理异常</h5>
<div class="outline-text-5" id="text-7-3-4-7">
<div class="org-src-container">
<pre class="src src-java">doThrow(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">RuntimeException</span>()).when(mockedList).clear();

<span style="color: #465457;">//</span><span style="color: #465457;">following throws RuntimeException:</span>
mockedList.clear();

</pre>
</div>
</div>
</div>


<div id="outline-container-orgfa0b999" class="outline-5">
<h5 id="orgfa0b999"><span class="section-number-5">7.3.4.8</span> 确保不发生交互</h5>
<div class="outline-text-5" id="text-7-3-4-8">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">using mocks - only mockOne is interacted</span>
mockOne.add(<span style="color: #e6db74;">"one"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">ordinary verification</span>
verify(mockOne).add(<span style="color: #e6db74;">"one"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">verify that method was never called on a mock</span>
verify(mockOne, never()).add(<span style="color: #e6db74;">"two"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">verify that other mocks were not interacted</span>
verifyZeroInteractions(mockTwo, mockThree);
</pre>
</div>
</div>
</div>


<div id="outline-container-orgd1638cc" class="outline-5">
<h5 id="orgd1638cc"><span class="section-number-5">7.3.4.9</span> 寻找多余交互</h5>
<div class="outline-text-5" id="text-7-3-4-9">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #465457;">//</span><span style="color: #465457;">using mocks</span>
mockedList.add(<span style="color: #e6db74;">"one"</span>);
mockedList.add(<span style="color: #e6db74;">"two"</span>);

verify(mockedList).add(<span style="color: #e6db74;">"one"</span>);

<span style="color: #465457;">//</span><span style="color: #465457;">following verification will fail</span>
verifyNoMoreInteractions(mockedList);
</pre>
</div>
</div>
</div>


<div id="outline-container-org48d5b9d" class="outline-5">
<h5 id="org48d5b9d"><span class="section-number-5">7.3.4.10</span> 注解</h5>
<div class="outline-text-5" id="text-7-3-4-10">
</div>
<div id="outline-container-org1b63897" class="outline-6">
<h6 id="org1b63897"><span class="section-number-6">7.3.4.10.1</span> 启用注解</h6>
<div class="outline-text-6" id="text-7-3-4-10-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@RunWith</span>(MockitoJUnitRunner.<span style="color: #f92672; font-weight: bold;">class</span>)
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MockitoAnnotationTest</span> {

}
</pre>
</div>
</div>
</div>


<div id="outline-container-org58c2165" class="outline-6">
<h6 id="org58c2165"><span class="section-number-6">7.3.4.10.2</span> @Mock</h6>
<div class="outline-text-6" id="text-7-3-4-10-2">
<p>
不使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenNotUseMockAnnotation_thenCorrect</span>() {
    <span style="color: #66d9ef; font-weight: bold;">List</span> <span style="color: #fd971f;">mockList</span> = Mockito.mock(ArrayList.<span style="color: #f92672; font-weight: bold;">class</span>);

    mockList.add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(mockList).add(<span style="color: #e6db74;">"one"</span>);
    assertEquals(0, mockList.size());

    Mockito.when(mockList.size()).thenReturn(100);
    assertEquals(100, mockList.size());
}
</pre>
</div>

<p>
使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Mock</span>
<span style="color: #66d9ef; font-weight: bold;">List</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">mockedList</span>;

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenUseMockAnnotation_thenMockIsInjected</span>() {
    mockedList.add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(mockedList).add(<span style="color: #e6db74;">"one"</span>);
    assertEquals(0, mockedList.size());

    Mockito.when(mockedList.size()).thenReturn(100);
    assertEquals(100, mockedList.size());
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org0c64320" class="outline-6">
<h6 id="org0c64320"><span class="section-number-6">7.3.4.10.3</span> @Spy</h6>
<div class="outline-text-6" id="text-7-3-4-10-3">
<p>
不使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenNotUseSpyAnnotation_thenCorrect</span>() {
    <span style="color: #66d9ef; font-weight: bold;">List</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">spyList</span> = Mockito.spy(<span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ArrayList</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt;());

    spyList.add(<span style="color: #e6db74;">"one"</span>);
    spyList.add(<span style="color: #e6db74;">"two"</span>);

    Mockito.verify(spyList).add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(spyList).add(<span style="color: #e6db74;">"two"</span>);

    assertEquals(2, spyList.size());

    Mockito.doReturn(100).when(spyList).size();
    assertEquals(100, spyList.size());
}
</pre>
</div>


<p>
使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Spy</span>
<span style="color: #66d9ef; font-weight: bold;">List</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">spiedList</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">ArrayList</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt;();

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenUseSpyAnnotation_thenSpyIsInjected</span>() {
    spiedList.add(<span style="color: #e6db74;">"one"</span>);
    spiedList.add(<span style="color: #e6db74;">"two"</span>);

    Mockito.verify(spiedList).add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(spiedList).add(<span style="color: #e6db74;">"two"</span>);

    assertEquals(2, spiedList.size());

    Mockito.doReturn(100).when(spiedList).size();
    assertEquals(100, spiedList.size());
}

</pre>
</div>
</div>
</div>


<div id="outline-container-orga7bee76" class="outline-6">
<h6 id="orga7bee76"><span class="section-number-6">7.3.4.10.4</span> @Captor</h6>
<div class="outline-text-6" id="text-7-3-4-10-4">
<p>
不使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenNotUseCaptorAnnotation_thenCorrect</span>() {
    <span style="color: #66d9ef; font-weight: bold;">List</span> <span style="color: #fd971f;">mockList</span> = Mockito.mock(List.<span style="color: #f92672; font-weight: bold;">class</span>);
    <span style="color: #66d9ef; font-weight: bold;">ArgumentCaptor</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">arg</span> = ArgumentCaptor.forClass(String.<span style="color: #f92672; font-weight: bold;">class</span>);

    mockList.add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(mockList).add(arg.capture());

    assertEquals(<span style="color: #e6db74;">"one"</span>, arg.getValue());
}

</pre>
</div>

<p>
使用注解：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Mock</span>
<span style="color: #66d9ef; font-weight: bold;">List</span> <span style="color: #fd971f;">mockedList</span>;

<span style="color: #ae81ff;">@Captor</span>
<span style="color: #66d9ef; font-weight: bold;">ArgumentCaptor</span> <span style="color: #fd971f;">argCaptor</span>;

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenUseCaptorAnnotation_thenTheSam</span>() {
    mockedList.add(<span style="color: #e6db74;">"one"</span>);
    Mockito.verify(mockedList).add(argCaptor.capture());

    assertEquals(<span style="color: #e6db74;">"one"</span>, argCaptor.getValue());
}

</pre>
</div>
</div>
</div>


<div id="outline-container-org9f7909b" class="outline-6">
<h6 id="org9f7909b"><span class="section-number-6">7.3.4.10.5</span> @InjectMocks</h6>
<div class="outline-text-6" id="text-7-3-4-10-5">
<p>
相当于同时使用 @Spy 和 @Mock
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #ae81ff;">@Mock</span>
<span style="color: #66d9ef; font-weight: bold;">Map</span>&lt;<span style="color: #66d9ef; font-weight: bold;">String</span>, <span style="color: #66d9ef; font-weight: bold;">String</span>&gt; <span style="color: #fd971f;">wordMap</span>;

<span style="color: #ae81ff;">@InjectMocks</span>
<span style="color: #66d9ef; font-weight: bold;">MyDictionary</span> <span style="color: #fd971f;">dic</span> = <span style="color: #f92672; font-weight: bold;">new</span> <span style="color: #66d9ef; font-weight: bold;">MyDictionary</span>();

<span style="color: #ae81ff;">@Test</span>
<span style="color: #f92672; font-weight: bold;">public</span> <span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">whenUseInjectMocksAnnotation_thenCorrect</span>() {
    Mockito.when(wordMap.get(<span style="color: #e6db74;">"aWord"</span>)).thenReturn(<span style="color: #e6db74;">"aMeaning"</span>);

    assertEquals(<span style="color: #e6db74;">"aMeaning"</span>, dic.getMeaning(<span style="color: #e6db74;">"aWord"</span>));
}

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd3688a4" class="outline-5">
<h5 id="orgd3688a4"><span class="section-number-5">7.3.4.11</span> 传送门</h5>
<div class="outline-text-5" id="text-7-3-4-11">
<p>
<a href="https://www.baeldung.com/tag/mockito/">Baeldung Mockito</a>
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org104a9eb" class="outline-2">
<h2 id="org104a9eb"><span class="section-number-2">8</span> 参考</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orga6cd3e9" class="outline-3">
<h3 id="orga6cd3e9"><span class="section-number-3">8.1</span> <a href="https://docs.spring.io/spring-boot/docs/2.0.1.RELEASE/reference/htmlsingle/#common-application-properties">所有可配置选项</a></h3>
</div>

<div id="outline-container-org0cf8ffb" class="outline-3">
<h3 id="org0cf8ffb"><span class="section-number-3">8.2</span> <a href="https://spring.io/blog/2013/06/03/content-negotiation-using-views">Content Negotiation Using Views</a></h3>
</div>
</div>
</div>
</body>
</html>